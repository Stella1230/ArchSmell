{"f55af664dd5cc2459c524e3ba8dda4353aa2a2e0":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/tools\/Generate.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/tools\/package-info.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/tools\/GenerateCustomLoggerTest.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/tools\/GenerateExtendedLoggerTest.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/tools\/Generate.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-519\" dev=\"rpopma\" type=\"add\">","25","        Added support for generating custom logger wrappers that replace the existing log levels","26","        and extended logger wrappers that add custom log levels to the existing ones.","27","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/tools\/package-info.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/tools\/GenerateCustomLoggerTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/tools\/GenerateExtendedLoggerTest.java":[{"add":[],"delete":[]}]}},"82dd809b94142078ee2ed1396a6054821120b41a":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/CompositeConfigurationTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-web\/src\/test\/resources\/log4j2-combined.xml":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/CompositeConfigurationMissingTest.java":"ADD","log4j-core\/src\/test\/resources\/log4j-comp-logger-root.xml":"MODIFY","log4j-web\/src\/test\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImplTest.java":"MODIFY","log4j-web\/src\/test\/resources\/log4j2-override.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/CompositeConfigurationTest.java":[{"add":["170","    public void testMissingConfig() {","171","        final LoggerContextRule lcr = new LoggerContextRule(\"classpath:log4j-comp-logger-root.xml,log4j-does-not-exist.json\");","172","        final Statement test = new Statement() {","173","            @Override","174","            public void evaluate() throws Throwable {","175","                final AbstractConfiguration config =  (AbstractConfiguration) lcr.getConfiguration();","176","                assertNotNull(\"No configuration returned\", config);","177","                \/\/Test for Root log level override","178","                assertEquals(\"Expected Root logger log level to be ERROR\", Level.ERROR, config.getRootLogger().getLevel());","179","","180","                \/\/Test for no cat2 level override","181","                final LoggerConfig cat2 = config.getLogger(\"cat2\");","182","                assertEquals(\"Expected cat2 log level to be INFO\", Level.DEBUG, cat2.getLevel());","183","            }","184","        };","185","        runTest(lcr, test);","186","    }","187","","188","    @Test"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["405","                            if (config != null) {","406","                                if (config instanceof AbstractConfiguration) {","407","                                    configs.add((AbstractConfiguration) config);","408","                                } else {","409","                                    LOGGER.error(\"Failed to created configuration at {}\", sourceLocation);","410","                                    return null;","411","                                }","413","                                LOGGER.warn(\"Unable to create configuration for {}, ignoring\", sourceLocation);","416","                        if (configs.size() > 1) {","417","                            return new CompositeConfiguration(configs);","418","                        } else if (configs.size() == 1) {","419","                            return configs.get(0);","420","                        }"],"delete":["405","                            if (config != null && config instanceof AbstractConfiguration) {","406","                                configs.add((AbstractConfiguration) config);","408","                                LOGGER.error(\"Failed to created configuration at {}\", sourceLocation);","409","                                return null;","412","                        return new CompositeConfiguration(configs);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":[{"add":["26","import org.apache.logging.log4j.core.config.DefaultConfiguration;","266","                    if (currentReadConfiguration != null) {","267","                        if (currentReadConfiguration instanceof DefaultConfiguration) {","268","                            LOGGER.warn(\"Unable to locate configuration {}, ignoring\", configLocation.toString());","269","                        }","270","                        else if (currentReadConfiguration instanceof AbstractConfiguration) {","271","                            configurations.add((AbstractConfiguration) currentReadConfiguration);","272","                        } else {","273","                            LOGGER.error(","274","                                    \"Found configuration {}, which is not an AbstractConfiguration and can't be handled by CompositeConfiguration\",","275","                                    configLocation);","276","                        }","278","                        LOGGER.info(\"Unable to access configuration {}, ignoring\", configLocation.toString());","281","                if (configurations.size() == 0) {","282","                    LOGGER.error(\"No configurations could be created for {}\", configLocations.toString());","283","                } else if (configurations.size() == 1) {","284","                    AbstractConfiguration config = configurations.get(0);","285","                    LOGGER.debug(\"Starting LoggerContext[name={}] from configuration at {}\", ctx.getName(),","286","                            config.getConfigurationSource().getLocation());","287","                    ctx.start(config);","288","                } else {","289","                    final CompositeConfiguration compositeConfiguration = new CompositeConfiguration(configurations);","290","                    LOGGER.debug(\"Starting LoggerContext[name={}] from configurations at {}\", ctx.getName(),","291","                            configLocations);","292","                    ctx.start(compositeConfiguration);","293","                }","294",""],"delete":["265","                    if (currentReadConfiguration instanceof AbstractConfiguration) {","266","                        configurations.add((AbstractConfiguration) currentReadConfiguration);","268","                        LOGGER.error(","269","                                \"Found configuration {}, which is not an AbstractConfiguration and can't be handled by CompositeConfiguration\",","270","                                configLocation);","273","                final CompositeConfiguration compositeConfiguration = new CompositeConfiguration(configurations);","274","                LOGGER.debug(\"Starting LoggerContext[name={}] from configurations at {}\", ctx.getName(),","275","                        configLocations);","276","                ctx.start(compositeConfiguration);"]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2901\" dev=\"rgoers\" type=\"fix\">","33","        Missing configuration files should be ignored when creating a composite configuration.","34","      <\/action>"],"delete":[]}],"log4j-web\/src\/test\/resources\/log4j2-combined.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":[{"add":["19","import javax.net.ssl.HttpsURLConnection;","36","import org.apache.logging.log4j.core.net.ssl.LaxHostnameVerifier;","37","import org.apache.logging.log4j.core.net.ssl.SslConfiguration;","38","import org.apache.logging.log4j.core.net.ssl.SslConfigurationFactory;","39","import org.apache.logging.log4j.core.util.AuthorizationProvider;","44","import org.apache.logging.log4j.util.PropertiesUtil;","63","    private static final String HTTPS = \"https\";","328","            return null;","340","        } catch (final FileNotFoundException ex) {","341","            ConfigurationFactory.LOGGER.warn(\"Could not locate file {}\", configLocation.toString());","361","        return getConfigurationSource(url);","362","    }","364","    private static ConfigurationSource getConfigurationSource(URL url) {","365","        try {","366","            URLConnection urlConnection = url.openConnection();","367","            AuthorizationProvider provider = ConfigurationFactory.authorizationProvider(PropertiesUtil.getProperties());","368","            provider.addAuthorization(urlConnection);","369","            if (url.getProtocol().equals(HTTPS)) {","370","                SslConfiguration sslConfiguration = SslConfigurationFactory.getSslConfiguration();","371","                if (sslConfiguration != null) {","372","                    ((HttpsURLConnection) urlConnection).setSSLSocketFactory(sslConfiguration.getSslSocketFactory());","373","                    if (!sslConfiguration.isVerifyHostName()) {","374","                        ((HttpsURLConnection) urlConnection).setHostnameVerifier(LaxHostnameVerifier.INSTANCE);","375","                    }","376","                }","378","            File file = FileUtils.fileFromUri(url.toURI());","379","            try {","380","                if (file != null) {","381","                    return new ConfigurationSource(urlConnection.getInputStream(), FileUtils.fileFromUri(url.toURI()));","382","                } else {","383","                    return new ConfigurationSource(urlConnection.getInputStream(), url, urlConnection.getLastModified());","384","                }","385","            } catch (FileNotFoundException ex) {","386","                ConfigurationFactory.LOGGER.info(\"Unable to locate file {}, ignoring.\", url.toString());","387","                return null;","388","            }","389","        } catch (IOException | URISyntaxException ex) {","390","            ConfigurationFactory.LOGGER.warn(\"Error accessing {} due to {}, ignoring.\", url.toString(),","391","                    ex.getMessage());","392","            return null;"],"delete":["351","        InputStream is = null;","352","        try {","353","            is = url.openStream();","354","        } catch (final IOException ioe) {","355","            ConfigurationFactory.LOGGER.catching(Level.DEBUG, ioe);","356","            return null;","357","        }","358","        if (is == null) {","359","            return null;","360","        }","362","        if (FileUtils.isFile(url)) {","363","            try {","364","                return new ConfigurationSource(is, FileUtils.fileFromUri(url.toURI()));","365","            } catch (final URISyntaxException ex) {","366","                \/\/ Just ignore the exception.","367","                ConfigurationFactory.LOGGER.catching(Level.DEBUG, ex);","370","        return new ConfigurationSource(is, url);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/CompositeConfigurationMissingTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-comp-logger-root.xml":[{"add":["18","<Configuration status=\"INFO\" name=\"LoggerConfigTest\">","23","        <File name=\"File\" fileName=\"target\/test.log\" bufferedIO=\"false\">"],"delete":["18","<Configuration status=\"ERROR\" name=\"LoggerConfigTest\">","23","        <File name=\"File\" fileName=\"${filename}\" bufferedIO=\"false\">"]}],"log4j-web\/src\/test\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImplTest.java":[{"add":["395","                \"log4j2-combined.xml,log4j2-override.xml\");"],"delete":["395","                \"\/a.txt,,\/WEB-INF\/log4j2-mycontext.xml\");"]}],"log4j-web\/src\/test\/resources\/log4j2-override.xml":[{"add":[],"delete":[]}]}},"bbcb663ac53202973af37d96baf6e33e5298fe40":{"changes":{"log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":"MODIFY"},"diff":{"log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":[{"add":["20","import java.text.SimpleDateFormat;\r","22","import java.util.Date;\r","159","            this.name = new SimpleDateFormat(\"yyyyMMdd_HHmmss.SSS\").format(new Date());\r"],"delete":["157","            return;\r"]}]}},"2352052d0bc797ede29a5b4a8897200aa49a8c43":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2158\" dev=\"rpopma\" type=\"fix\" due-to=\"Bj?rn Kautler\">","34","        Fixed bug where ThreadContext map was cleared, resulting in entries being only available for one log event.","35","      <\/action>"],"delete":[]}]}},"b457cf74f4054b514c2f280928fc3280be6411e5":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PrivateSecurityManagerStackTraceUtil.java":"MODIFY","log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PrivateSecurityManagerStackTraceUtil.java":"MODIFY","log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":"MODIFY","log4j-api-java9\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/java9\/StackLocatorTest.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/StackLocatorUtilTest.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PrivateSecurityManagerStackTraceUtil.java":[{"add":["19","import java.util.Collections;","67","        Collections.addAll(classes, array);"],"delete":["66","        for (final Class<?> clazz : array) {","67","            classes.push(clazz);","68","        }"]}],"log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PrivateSecurityManagerStackTraceUtil.java":[{"add":["18","import java.util.Deque;","30","    static Deque<Class<?>> getCurrentStackTrace() {"],"delete":["18","import java.util.Stack;","30","    static Stack<Class<?>> getCurrentStackTrace() {"]}],"log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":[{"add":["18","import java.util.ArrayDeque;","19","import java.util.Collections;","20","import java.util.Deque;","30","    private final static StackWalker WALKER = StackWalker.getInstance(StackWalker.Option.RETAIN_CLASS_REFERENCE);","32","    private final static StackWalker STACK_WALKER = StackWalker.getInstance();","50","        return WALKER.walk(s -> s","64","        return WALKER.walk(s -> s","74","        return WALKER.walk(s -> s.dropWhile(f -> !f.getDeclaringClass().equals(anchor))","75","                     .dropWhile(f -> f.getDeclaringClass().equals(anchor)).findFirst())","76","                     .map(StackWalker.StackFrame::getDeclaringClass).orElse(null);","80","        return WALKER.walk(s -> s.skip(depth).findFirst()).map(StackWalker.StackFrame::getDeclaringClass).orElse(null);","83","    public Deque<Class<?>> getCurrentStackTrace() {","88","        final Deque<Class<?>> stack = new ArrayDeque<Class<?>>();","89","        return WALKER.walk(s -> {","90","            s.forEach(f -> stack.add(f.getDeclaringClass()));","91","            return stack;","92","        });","96","        return STACK_WALKER.walk(","98","                      .dropWhile(f -> f.getClassName().equals(fqcnOfLogger)) \/\/ drop the logger frames","99","                      .findFirst()).map(StackWalker.StackFrame::toStackTraceElement).orElse(null);","103","        return STACK_WALKER.walk(s -> s.skip(depth).findFirst())"],"delete":["19","import java.util.Stack;","20","import java.util.function.Function;","23","import java.util.stream.Stream;","30","    private final static StackWalker walker = StackWalker.getInstance(StackWalker.Option.RETAIN_CLASS_REFERENCE);","32","    private final static StackWalker stackWalker = StackWalker.getInstance();","50","        return walker.walk(s -> s","64","        return walker.walk(s -> s","74","        return walker.walk(s -> s.dropWhile(f -> !f.getDeclaringClass().equals(anchor)).","75","                dropWhile(f -> f.getDeclaringClass().equals(anchor)).findFirst()).","76","                map(StackWalker.StackFrame::getDeclaringClass).orElse(null);","80","        return walker.walk(s -> s.skip(depth).findFirst()).map(StackWalker.StackFrame::getDeclaringClass).orElse(null);","83","    public Stack<Class<?>> getCurrentStackTrace() {","88","        Stack<Class<?>> stack = new Stack<Class<?>>();","89","        List<Class<?>> classes = walker.walk(s -> s.map(f -> f.getDeclaringClass()).collect(Collectors.toList()));","90","        stack.addAll(classes);","91","        return stack;","95","        return stackWalker.walk(","97","                        .dropWhile(f -> f.getClassName().equals(fqcnOfLogger)) \/\/ drop the logger frames","98","                        .findFirst()).map(StackWalker.StackFrame::toStackTraceElement).orElse(null);","102","        return stackWalker.walk(s -> s.skip(depth).findFirst())"]}],"log4j-api-java9\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/java9\/StackLocatorTest.java":[{"add":["21","import java.util.Deque;","46","        final Deque<Class<?>> classes = stackLocator.getCurrentStackTrace();","49","        while (!classes.isEmpty()) {","50","            reversed.push(classes.removeLast());","132","        \/\/ The line number below may need adjustment if this file is changed. ","133","        assertEquals(97, element.getLineNumber());"],"delete":["45","        final Stack<Class<?>> classes = stackLocator.getCurrentStackTrace();","48","        while (!classes.empty()) {","49","            reversed.push(classes.pop());","131","        assertEquals(96, element.getLineNumber());"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/StackLocatorUtilTest.java":[{"add":["75","            reversed.push(classes.removeLast());"],"delete":["75","            reversed.push(classes.pop());"]}]}},"6f23e6846e6000cccaa16c9a603d884360c40c97":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["34","      <action issue=\"LOG4J2-924\" dev=\"ggregory\" type=\"fix\" due-to=\"Ryan Rupp\">","35","        Log4j 1.2 Bridge doesn't map level ALL correctly in Category.getEffectiveLevel().","36","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["159","        case ALL:","160","            return Level.ALL;","161","        case TRACE:","162","            return Level.TRACE;","163","        case DEBUG:","164","            return Level.DEBUG;","165","        case INFO:","166","            return Level.INFO;","167","        case WARN:","168","            return Level.WARN;","169","        case ERROR:","170","            return Level.ERROR;","171","        case FATAL:","172","            return Level.FATAL;","173","        case OFF:","174","            return Level.OFF;","175","        default:","176","            \/\/ TODO Should this be an IllegalStateException?","177","            return Level.OFF;"],"delete":["159","            case TRACE:","160","                return Level.TRACE;","161","            case DEBUG:","162","                return Level.DEBUG;","163","            case INFO:","164","                return Level.INFO;","165","            case WARN:","166","                return Level.WARN;","167","            case ERROR:","168","                return Level.ERROR;","169","            case FATAL:","170","                return Level.FATAL;","171","            default:","172","                return Level.OFF;"]}]}},"843ca800ba60464059a22e9e12edcaf5ecd92d95":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":[{"add":["73","        if (allowed) {","74","            LOGGER.error(msg, error);","75","        }","76","        if (!appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","91","        if (allowed) {","92","            LOGGER.error(msg, error);","93","        }","94","        if (!appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {"],"delete":["73","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","88","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {"]}]}},"921f7223a687919c6643756355c6a9f00a5738b4":{"changes":{"dist\/src\/assembly\/bin.xml":"MODIFY","dist\/pom.xml":"MODIFY","dist\/src\/assembly\/src.xml":"MODIFY"},"diff":{"dist\/src\/assembly\/bin.xml":[{"add":["22","    <baseDirectory>apache-log4j-${project.version}-bin<\/baseDirectory>"],"delete":[]}],"dist\/pom.xml":[{"add":["190","              <finalName>apache-log4j-${project.version}<\/finalName>"],"delete":["190","              <finalName>log4j-${project.version}<\/finalName>"]}],"dist\/src\/assembly\/src.xml":[{"add":["26","  <baseDirectory>apache-log4j-${project.version}-src<\/baseDirectory>"],"delete":[]}]}},"346932ea80ab79318b42063fe6bbf031c902f6d2":{"changes":{"log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLogger.java":"MODIFY","log4j12-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY","\/dev\/null":"DELETE","log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContext.java":"MODIFY","log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"MODIFY","log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j12-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":"MODIFY","log4j2-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j2-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":"MODIFY","log4j12-api\/src\/main\/java\/org\/apache\/log4j\/LogManager.java":"MODIFY"},"diff":{"log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLogger.java":[{"add":[],"delete":["33","    @Override","34","    protected String getFQCN() {","35","        return SimpleLogger.class.getName();","36","    }","37",""]}],"log4j12-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["56","        this.logger = context.getLogger(name);","174","        maybeLog(FQCN, org.apache.logging.log4j.Level.DEBUG, message, null);","178","        maybeLog(FQCN, org.apache.logging.log4j.Level.DEBUG, message, t);","186","        maybeLog(FQCN, org.apache.logging.log4j.Level.ERROR, message, null);","190","        maybeLog(FQCN, org.apache.logging.log4j.Level.ERROR, message, t);","198","        maybeLog(FQCN, org.apache.logging.log4j.Level.WARN, message, null);","202","        maybeLog(FQCN, org.apache.logging.log4j.Level.WARN, message, t);","210","        maybeLog(FQCN, org.apache.logging.log4j.Level.FATAL, message, null);","214","        maybeLog(FQCN, org.apache.logging.log4j.Level.FATAL, message, t);","222","        maybeLog(FQCN, org.apache.logging.log4j.Level.INFO, message, null);","226","        maybeLog(FQCN, org.apache.logging.log4j.Level.INFO, message, t);","234","        maybeLog(FQCN, org.apache.logging.log4j.Level.TRACE, message, null);","238","        maybeLog(FQCN, org.apache.logging.log4j.Level.TRACE, message, t);","247","        return isEnabledFor(lvl);","252","        logger.log(null, fqcn, lvl, new ObjectMessage(message), t);","303","    private void maybeLog(String fqcn, org.apache.logging.log4j.Level level,","304","            Object message, Throwable throwable) {","305","        if(logger.isEnabled(level, null, message, throwable)) {","306","            logger.log(null, FQCN, level, new ObjectMessage(message), throwable);","307","        }","335","    private boolean isEnabledFor(org.apache.logging.log4j.Level level) {","336","        return logger.isEnabled(level, null, null);","338",""],"delete":["18","import org.apache.logging.log4j.Marker;","42","    private static final CategoryFactory FACTORY = new CategoryFactory();","43","","59","        this.logger = context.getLogger(getFactory(), name);","97","","178","        logger.debug(message);","182","        logger.debug(message, t);","190","        logger.error(message);","194","        logger.error(message, t);","202","        logger.warn(message);","206","        logger.warn(message, t);","214","        logger.fatal(message);","218","        logger.fatal(message, t);","226","        logger.info(message);","230","        logger.info(message, t);","238","        logger.trace(message);","242","        logger.trace(message, t);","251","        return ((CategoryFactory.CategoryLogger) logger).isEnabledFor(lvl);","256","        ((CategoryFactory.CategoryLogger) logger).log(null, fqcn, lvl, new ObjectMessage(message), t);","307","    protected org.apache.logging.log4j.spi.LoggerFactory getFactory() {","308","        return FACTORY;","336","    \/**","337","     * Private Category factory.","338","     *\/","339","    private static class CategoryFactory implements org.apache.logging.log4j.spi.LoggerFactory<LoggerContext> {","340","","341","        public org.apache.logging.log4j.core.Logger newInstance(LoggerContext ctx, String name) {","342","            return new CategoryLogger(ctx, name);","343","        }","344","","345","        \/**","346","         * Category Logger.","347","         *\/","348","        public class CategoryLogger extends org.apache.logging.log4j.core.Logger {","349","","350","            public CategoryLogger(LoggerContext ctx, String name) {","351","                super(ctx, name);","352","            }","353","","354","            @Override","355","            public String getFQCN() {","356","               return FQCN;","357","            }","358","","359","            @Override","360","            public void log(Marker marker, String fqcn, org.apache.logging.log4j.Level level,","361","                               Message data, Throwable t) {","362","                super.log(marker, fqcn, level, data, t);","363","            }","364","","365","            public boolean isEnabledFor(org.apache.logging.log4j.Level level) {","366","                return isEnabled(level, null, null);","367","            }","368","        }"]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContext.java":[{"add":[],"delete":["33","     * Return a Logger using the specified factory to create it.","34","     * @param factory The LoggerFactory.","35","     * @param name The name of the Logger.","36","     * @return The Logger with the specified name.","37","     *\/","38","    Logger getLogger(LoggerFactory factory, String name);","39","","40","    \/**"]}],"log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":["59","    private static final String FQCN = AbstractLogger.class.getName();","66","            log(ENTRY_MARKER, FQCN, Level.TRACE, new SimpleMessage(\" entry\"), null);","78","            log(ENTRY_MARKER, FQCN, Level.TRACE, entryMsg(params.length, params), null);","87","            log(EXIT_MARKER, FQCN, Level.TRACE, exitMsg(null), null);","98","            log(EXIT_MARKER, FQCN, Level.TRACE, exitMsg(result), null);","109","            log(THROWING_MARKER, FQCN, Level.ERROR, new SimpleMessage(\"throwing\"), t);","122","            log(THROWING_MARKER, FQCN, level, new SimpleMessage(\"throwing\"), t);","133","            log(THROWING_MARKER, FQCN, Level.DEBUG, new SimpleMessage(\"catching\"), t);","145","            log(THROWING_MARKER, FQCN, level, new SimpleMessage(\"catching\"), t);","156","            log(null, FQCN, Level.TRACE, new SimpleMessage(message), null);","168","            log(marker, FQCN, Level.TRACE, new SimpleMessage(message), null);","185","            log(null, FQCN, Level.TRACE, new SimpleMessage(message), t);","204","            log(marker, FQCN, Level.TRACE, new SimpleMessage(message), t);","215","            log(null, FQCN, Level.TRACE, new ObjectMessage(message), null);","227","            log(marker, FQCN, Level.TRACE, new ObjectMessage(message), null);","244","            log(null, FQCN, Level.TRACE, new ObjectMessage(message), t);","262","            log(marker, FQCN, Level.TRACE, new ObjectMessage(message), t);","275","            log(null, FQCN, Level.TRACE, msg, msg.getThrowable());","289","            log(marker, FQCN, Level.TRACE, msg, msg.getThrowable());","321","            log(null, FQCN, Level.TRACE, msg, null);","333","            log(null, FQCN, Level.TRACE, msg, t);","345","            log(marker, FQCN, Level.TRACE, msg, null);","358","            log(marker, FQCN, Level.TRACE, msg, t);","369","            log(null, FQCN, Level.DEBUG, new SimpleMessage(message), null);","381","            log(marker, FQCN, Level.DEBUG, new SimpleMessage(message), null);","394","            log(null, FQCN, Level.DEBUG, new SimpleMessage(message), t);","408","            log(marker, FQCN, Level.DEBUG, new SimpleMessage(message), t);","418","            log(null, FQCN, Level.DEBUG, new ObjectMessage(message), null);","430","            log(marker, FQCN, Level.DEBUG, new ObjectMessage(message), null);","443","            log(null, FQCN, Level.DEBUG, new ObjectMessage(message), t);","457","            log(marker, FQCN, Level.DEBUG, new ObjectMessage(message), t);","470","            log(null, FQCN, Level.DEBUG, msg, msg.getThrowable());","484","            log(marker, FQCN, Level.DEBUG, msg, msg.getThrowable());","516","            log(null, FQCN, Level.TRACE, msg, null);","528","            log(null, FQCN, Level.TRACE, msg, t);","540","            log(marker, FQCN, Level.DEBUG, msg, null);","553","            log(marker, FQCN, Level.DEBUG, msg, t);","564","            log(null, FQCN, Level.INFO, new SimpleMessage(message), null);","576","            log(marker, FQCN, Level.INFO, new SimpleMessage(message), null);","589","            log(null, FQCN, Level.INFO, new SimpleMessage(message), t);","603","            log(marker, FQCN, Level.INFO, new SimpleMessage(message), t);","614","            log(null, FQCN, Level.INFO, new ObjectMessage(message), null);","626","            log(marker, FQCN, Level.INFO, new ObjectMessage(message), null);","639","            log(null, FQCN, Level.INFO, new ObjectMessage(message), t);","654","            log(marker, FQCN, Level.INFO, new ObjectMessage(message), t);","667","            log(null, FQCN, Level.INFO, msg, msg.getThrowable());","681","            log(marker, FQCN, Level.INFO, msg, msg.getThrowable());","712","            log(null, FQCN, Level.INFO, msg, null);","724","            log(null, FQCN, Level.INFO, msg, t);","736","            log(marker, FQCN, Level.INFO, msg, null);","749","            log(marker, FQCN, Level.INFO, msg, t);","760","            log(null, FQCN, Level.WARN, new SimpleMessage(message), null);","772","            log(marker, FQCN, Level.WARN, new SimpleMessage(message), null);","785","            log(null, FQCN, Level.DEBUG, new SimpleMessage(message), t);","799","            log(marker, FQCN, Level.DEBUG, new SimpleMessage(message), t);","811","            log(marker, FQCN, Level.WARN, new ObjectMessage(message), null);","822","            log(null, FQCN, Level.WARN, new ObjectMessage(message), null);","835","            log(null, FQCN, Level.DEBUG, new ObjectMessage(message), t);","849","            log(marker, FQCN, Level.DEBUG, new ObjectMessage(message), t);","862","            log(null, FQCN, Level.WARN, msg, msg.getThrowable());","876","            log(marker, FQCN, Level.WARN, msg, msg.getThrowable());","908","            log(null, FQCN, Level.WARN, msg, null);","920","            log(null, FQCN, Level.WARN, msg, t);","932","            log(marker, FQCN, Level.WARN, msg, null);","945","            log(marker, FQCN, Level.WARN, msg, t);","956","            log(null, FQCN, Level.ERROR, new SimpleMessage(message), null);","968","            log(marker, FQCN, Level.ERROR, new SimpleMessage(message), null);","981","            log(null, FQCN, Level.ERROR, new SimpleMessage(message), t);","995","            log(marker, FQCN, Level.ERROR, new SimpleMessage(message), t);","1006","            log(null, FQCN, Level.ERROR, new ObjectMessage(message), null);","1018","            log(marker, FQCN, Level.ERROR, new ObjectMessage(message), null);","1031","            log(null, FQCN, Level.ERROR, new ObjectMessage(message), t);","1045","            log(marker, FQCN, Level.ERROR, new ObjectMessage(message), t);","1058","            log(null, FQCN, Level.ERROR, msg, msg.getThrowable());","1072","            log(marker, FQCN, Level.ERROR, msg, msg.getThrowable());","1105","            log(null, FQCN, Level.ERROR, msg, null);","1117","            log(null, FQCN, Level.ERROR, msg, t);","1129","            log(null, FQCN, Level.ERROR, msg, null);","1142","            log(marker, FQCN, Level.TRACE, msg, t);","1153","            log(null, FQCN, Level.FATAL, new SimpleMessage(message), null);","1166","            log(marker, FQCN, Level.FATAL, new SimpleMessage(message), null);","1179","            log(null, FQCN, Level.FATAL, new SimpleMessage(message), t);","1193","            log(marker, FQCN, Level.FATAL, new SimpleMessage(message), t);","1204","            log(null, FQCN, Level.FATAL, new ObjectMessage(message), null);","1216","            log(marker, FQCN, Level.FATAL, new ObjectMessage(message), null);","1229","            log(null, FQCN, Level.FATAL, new ObjectMessage(message), t);","1243","            log(marker, FQCN, Level.FATAL, new ObjectMessage(message), t);","1256","            log(null, FQCN, Level.FATAL, msg, msg.getThrowable());","1270","            log(marker, FQCN, Level.FATAL, msg, msg.getThrowable());","1302","            log(null, FQCN, Level.FATAL, msg, null);","1314","            log(null, FQCN, Level.FATAL, msg, t);","1326","            log(null, FQCN, Level.FATAL, msg, null);","1339","            log(marker, FQCN, Level.FATAL, msg, t);"],"delete":["59","    protected String getFQCN() {","60","        return AbstractLogger.class.getName();","61","    }","62","","69","            log(ENTRY_MARKER, getFQCN(), Level.TRACE, new SimpleMessage(\" entry\"), null);","81","            log(ENTRY_MARKER, getFQCN(), Level.TRACE, entryMsg(params.length, params), null);","90","            log(EXIT_MARKER, getFQCN(), Level.TRACE, exitMsg(null), null);","101","            log(EXIT_MARKER, getFQCN(), Level.TRACE, exitMsg(result), null);","112","            log(THROWING_MARKER, getFQCN(), Level.ERROR, new SimpleMessage(\"throwing\"), t);","125","            log(THROWING_MARKER, getFQCN(), level, new SimpleMessage(\"throwing\"), t);","136","            log(THROWING_MARKER, getFQCN(), Level.DEBUG, new SimpleMessage(\"catching\"), t);","148","            log(THROWING_MARKER, getFQCN(), level, new SimpleMessage(\"catching\"), t);","159","            log(null, getFQCN(), Level.TRACE, new SimpleMessage(message), null);","171","            log(marker, getFQCN(), Level.TRACE, new SimpleMessage(message), null);","188","            log(null, getFQCN(), Level.TRACE, new SimpleMessage(message), t);","207","            log(marker, getFQCN(), Level.TRACE, new SimpleMessage(message), t);","218","            log(null, getFQCN(), Level.TRACE, new ObjectMessage(message), null);","230","            log(marker, getFQCN(), Level.TRACE, new ObjectMessage(message), null);","247","            log(null, getFQCN(), Level.TRACE, new ObjectMessage(message), t);","265","            log(marker, getFQCN(), Level.TRACE, new ObjectMessage(message), t);","278","            log(null, getFQCN(), Level.TRACE, msg, msg.getThrowable());","292","            log(marker, getFQCN(), Level.TRACE, msg, msg.getThrowable());","324","            log(null, getFQCN(), Level.TRACE, msg, null);","336","            log(null, getFQCN(), Level.TRACE, msg, t);","348","            log(marker, getFQCN(), Level.TRACE, msg, null);","361","            log(marker, getFQCN(), Level.TRACE, msg, t);","372","            log(null, getFQCN(), Level.DEBUG, new SimpleMessage(message), null);","384","            log(marker, getFQCN(), Level.DEBUG, new SimpleMessage(message), null);","397","            log(null, getFQCN(), Level.DEBUG, new SimpleMessage(message), t);","411","            log(marker, getFQCN(), Level.DEBUG, new SimpleMessage(message), t);","421","            log(null, getFQCN(), Level.DEBUG, new ObjectMessage(message), null);","433","            log(marker, getFQCN(), Level.DEBUG, new ObjectMessage(message), null);","446","            log(null, getFQCN(), Level.DEBUG, new ObjectMessage(message), t);","460","            log(marker, getFQCN(), Level.DEBUG, new ObjectMessage(message), t);","473","            log(null, getFQCN(), Level.DEBUG, msg, msg.getThrowable());","487","            log(marker, getFQCN(), Level.DEBUG, msg, msg.getThrowable());","519","            log(null, getFQCN(), Level.TRACE, msg, null);","531","            log(null, getFQCN(), Level.TRACE, msg, t);","543","            log(marker, getFQCN(), Level.DEBUG, msg, null);","556","            log(marker, getFQCN(), Level.DEBUG, msg, t);","567","            log(null, getFQCN(), Level.INFO, new SimpleMessage(message), null);","579","            log(marker, getFQCN(), Level.INFO, new SimpleMessage(message), null);","592","            log(null, getFQCN(), Level.INFO, new SimpleMessage(message), t);","606","            log(marker, getFQCN(), Level.INFO, new SimpleMessage(message), t);","617","            log(null, getFQCN(), Level.INFO, new ObjectMessage(message), null);","629","            log(marker, getFQCN(), Level.INFO, new ObjectMessage(message), null);","642","            log(null, getFQCN(), Level.INFO, new ObjectMessage(message), t);","657","            log(marker, getFQCN(), Level.INFO, new ObjectMessage(message), t);","670","            log(null, getFQCN(), Level.INFO, msg, msg.getThrowable());","684","            log(marker, getFQCN(), Level.INFO, msg, msg.getThrowable());","715","            log(null, getFQCN(), Level.INFO, msg, null);","727","            log(null, getFQCN(), Level.INFO, msg, t);","739","            log(marker, getFQCN(), Level.INFO, msg, null);","752","            log(marker, getFQCN(), Level.INFO, msg, t);","763","            log(null, getFQCN(), Level.WARN, new SimpleMessage(message), null);","775","            log(marker, getFQCN(), Level.WARN, new SimpleMessage(message), null);","788","            log(null, getFQCN(), Level.DEBUG, new SimpleMessage(message), t);","802","            log(marker, getFQCN(), Level.DEBUG, new SimpleMessage(message), t);","814","            log(marker, getFQCN(), Level.WARN, new ObjectMessage(message), null);","825","            log(null, getFQCN(), Level.WARN, new ObjectMessage(message), null);","838","            log(null, getFQCN(), Level.DEBUG, new ObjectMessage(message), t);","852","            log(marker, getFQCN(), Level.DEBUG, new ObjectMessage(message), t);","865","            log(null, getFQCN(), Level.WARN, msg, msg.getThrowable());","879","            log(marker, getFQCN(), Level.WARN, msg, msg.getThrowable());","911","            log(null, getFQCN(), Level.WARN, msg, null);","923","            log(null, getFQCN(), Level.WARN, msg, t);","935","            log(marker, getFQCN(), Level.WARN, msg, null);","948","            log(marker, getFQCN(), Level.WARN, msg, t);","959","            log(null, getFQCN(), Level.ERROR, new SimpleMessage(message), null);","971","            log(marker, getFQCN(), Level.ERROR, new SimpleMessage(message), null);","984","            log(null, getFQCN(), Level.ERROR, new SimpleMessage(message), t);","998","            log(marker, getFQCN(), Level.ERROR, new SimpleMessage(message), t);","1009","            log(null, getFQCN(), Level.ERROR, new ObjectMessage(message), null);","1021","            log(marker, getFQCN(), Level.ERROR, new ObjectMessage(message), null);","1034","            log(null, getFQCN(), Level.ERROR, new ObjectMessage(message), t);","1048","            log(marker, getFQCN(), Level.ERROR, new ObjectMessage(message), t);","1061","            log(null, getFQCN(), Level.ERROR, msg, msg.getThrowable());","1075","            log(marker, getFQCN(), Level.ERROR, msg, msg.getThrowable());","1108","            log(null, getFQCN(), Level.ERROR, msg, null);","1120","            log(null, getFQCN(), Level.ERROR, msg, t);","1132","            log(null, getFQCN(), Level.ERROR, msg, null);","1145","            log(marker, getFQCN(), Level.TRACE, msg, t);","1156","            log(null, getFQCN(), Level.FATAL, new SimpleMessage(message), null);","1169","            log(marker, getFQCN(), Level.FATAL, new SimpleMessage(message), null);","1182","            log(null, getFQCN(), Level.FATAL, new SimpleMessage(message), t);","1196","            log(marker, getFQCN(), Level.FATAL, new SimpleMessage(message), t);","1207","            log(null, getFQCN(), Level.FATAL, new ObjectMessage(message), null);","1219","            log(marker, getFQCN(), Level.FATAL, new ObjectMessage(message), null);","1232","            log(null, getFQCN(), Level.FATAL, new ObjectMessage(message), t);","1246","            log(marker, getFQCN(), Level.FATAL, new ObjectMessage(message), t);","1259","            log(null, getFQCN(), Level.FATAL, msg, msg.getThrowable());","1273","            log(marker, getFQCN(), Level.FATAL, msg, msg.getThrowable());","1305","            log(null, getFQCN(), Level.FATAL, msg, null);","1317","            log(null, getFQCN(), Level.FATAL, msg, t);","1329","            log(null, getFQCN(), Level.FATAL, msg, null);","1342","            log(marker, getFQCN(), Level.FATAL, msg, t);"]}],"log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLoggerContext.java":[{"add":[],"delete":["19","import org.apache.logging.log4j.spi.LoggerFactory;","39","    public Logger getLogger(LoggerFactory factory, String name) {","40","        return factory.newInstance(this, name);","41","    }"]}],"src\/changes\/changes.xml":[{"add":["24","    <release version=\"2.0\" date=\"TBD\" description=\"Rewrite of Log4j\">","25","      <action issue=\"VFS-51\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">","26","        Remove LoggerContext support for custom logger factories. All Loggers returned","27","        by LoggerContext should be compatibile and of the same type.","28","      <\/action>","29","      <action issue=\"VFS-50\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">","30","        Make sure all application facing log methods use their own FQCN. This patch","31","        resolves a unit test failure for the %C pattern when using the Category logger.","32","      <\/action>"],"delete":["24","    <release version=\"2.0\" date=\"\" description=\"Rewrite of Log4j\">"]}],"log4j12-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":[{"add":["112","     * Test using a pre-existing log4j2 logger","113","     *\/","114","    @Test","115","    public void testExistingLog4j2Logger() {","116","        \/\/ create the logger using LogManager","117","        org.apache.logging.log4j.LogManager.getLogger(\"existingLogger\");","118","        \/\/ Logger will be the one created above","119","        Logger logger = Logger.getLogger(\"existingLogger\");","120","        Logger l2 = LogManager.getLogger(\"existingLogger\");","121","        assertEquals(logger, l2);","122","        logger.setLevel(Level.ERROR);","123","        Priority debug = Level.DEBUG;","124","        \/\/ the next line will throw an exception if the LogManager loggers","125","        \/\/ aren't supported by 1.2 Logger\/Category","126","        logger.l7dlog(debug, \"Hello, World\", new Object[0], null);","127","        assertTrue(appender.getEvents().size() == 0);","128","    }","129","","130","    \/**"],"delete":[]}],"log4j2-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["144","        logger = (Logger) newInstance(this, name);","254","    private Logger newInstance(LoggerContext ctx, String name) {","255","        return new Logger(ctx, name);"],"delete":["23","import org.apache.logging.log4j.spi.LoggerFactory;","39","    private static final LoggerFactory<LoggerContext> FACTORY = new Factory();","40","","141","        return getLogger(FACTORY, name);","142","    }","143","","144","    \/**","145","     * Obtain a Logger from the Context using the specified LoggerFactory.","146","     * @param factory The LoggerFactory.","147","     * @param name The name of the Logger.","148","     * @return The Logger.","149","     *\/","150","    public Logger getLogger(LoggerFactory factory, String name) {","157","        logger = (Logger) factory.newInstance(this, name);","266","    \/**","267","     * The default LoggerFactory.","268","     *\/","269","    private static class Factory implements LoggerFactory<LoggerContext> {","271","        public Logger newInstance(LoggerContext ctx, String name) {","272","            return new Logger(ctx, name);","273","        }"]}],"log4j2-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":[{"add":["106","    public void log(Marker marker, String fqcn, Level level, Message data, Throwable t) {","111","    public boolean isEnabled(Level level, Marker marker, String msg) {","116","    public boolean isEnabled(Level level, Marker marker, String msg, Throwable t) {","121","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1) {","126","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2) {","131","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3) {","136","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3,","142","    public boolean isEnabled(Level level, Marker marker, Object msg, Throwable t) {","147","    public boolean isEnabled(Level level, Marker marker, Message msg, Throwable t) {"],"delete":["106","    protected void log(Marker marker, String fqcn, Level level, Message data, Throwable t) {","111","    protected boolean isEnabled(Level level, Marker marker, String msg) {","116","    protected boolean isEnabled(Level level, Marker marker, String msg, Throwable t) {","121","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1) {","126","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2) {","131","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3) {","136","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3,","142","    protected boolean isEnabled(Level level, Marker marker, Object msg, Throwable t) {","147","    protected boolean isEnabled(Level level, Marker marker, Message msg, Throwable t) {"]}],"log4j12-api\/src\/main\/java\/org\/apache\/log4j\/LogManager.java":[{"add":["18","import org.apache.logging.log4j.core.LoggerContext;","29","        return (Logger) Category.getInstance((LoggerContext) PrivateManager.getContext(), \"\");","33","        return (Logger) Category.getInstance((LoggerContext) PrivateManager.getContext(), name);","37","        return (Logger) Category.getInstance((LoggerContext) PrivateManager.getContext(), clazz.getName());","41","        LoggerContext ctx = (LoggerContext) PrivateManager.getContext();","54","","55","        public static org.apache.logging.log4j.spi.LoggerContext getContext() {"],"delete":["18","import org.apache.logging.log4j.spi.LoggerContext;","29","        return (Logger) PrivateManager.getLogger(\"\");","33","        return (Logger) PrivateManager.getLogger(name);","37","        return (Logger) PrivateManager.getLogger(clazz.getName());","41","        LoggerContext ctx = PrivateManager.getContext();","54","        public static LoggerContext getContext() {"]}]}},"b13fe2d55323b0bd04cf315a3ffc38c37b9881be":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/OnStartupTriggeringPolicyTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileAppenderAccessTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FileManager.java":"MODIFY","src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["52","        super(fileName, pattern, os, append, size, time, policy, strategy, advertiseURI, layout, bufferSize);","77","        super.write(bytes, offset, length); \/\/ writes to dummy output stream, needed to track file size"],"delete":["52","        super(fileName, pattern, os, append, size, time, policy, strategy, advertiseURI, layout);","77","        super.write(bytes, offset, length); \/\/ writes to dummy output stream"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/OnStartupTriggeringPolicyTest.java":[{"add":["54","                false, 0, System.currentTimeMillis(), policy, strategy, null, null, 8192);"],"delete":["54","                false, 0, System.currentTimeMillis(), policy, strategy, null, null);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileAppenderAccessTest.java":[{"add":["41","                null, \"Name\", null, null, null, OnStartupTriggeringPolicy.createPolicy(), null, null, null, null, null,","42","                null, config);"],"delete":["41","                null, \"Name\", null, null, OnStartupTriggeringPolicy.createPolicy(), null, null, null, null, null, null,","42","                config);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FileManager.java":[{"add":["43","    private final int bufferSize;","46","            final String advertiseURI, final Layout<? extends Serializable> layout, final int bufferSize) {","51","        this.bufferSize = bufferSize;","127","    ","128","    \/**","129","     * Returns the buffer size to use if the appender was configured with BufferedIO=true, otherwise returns a negative","130","     * number.","131","     * @return the buffer size, or a negative number if the output stream is not buffered","132","     *\/","133","    public int getBufferSize() {","134","        return bufferSize;","135","    }","201","                int bufferSize = data.bufferSize;","203","                    os = new BufferedOutputStream(os, bufferSize);","204","                } else {","205","                    bufferSize = -1; \/\/ signals to RollingFileManager not to use BufferedOutputStream","207","                return new FileManager(name, os, data.append, data.locking, data.advertiseURI, data.layout, bufferSize);"],"delete":["45","                          final String advertiseURI, final Layout<? extends Serializable> layout) {","191","                    os = new BufferedOutputStream(os, data.bufferSize);","193","                return new FileManager(name, os, data.append, data.locking, data.advertiseURI, data.layout);"]}],"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["1917","              <td>bufferSize<\/td>","1918","              <td>int<\/td>","1919","              <td>When bufferedIO is true, this is the buffer size, the default is 8192 bytes.<\/td>","1920","            <\/tr>","1921","            <tr>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-622\" dev=\"rpopma\" type=\"fix\" due-to=\"Farooq Khan\">","25","        RollingFileManager now correctly honours the bufferedIO configuration after rollover.","26","      <\/action>","27","      <action issue=\"LOG4J2-674\" dev=\"rpopma\" type=\"add\">","28","        Made RollingFileAppender buffer size configurable.","29","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["49","            final boolean append, final long size, final long time, final TriggeringPolicy triggeringPolicy,","50","            final RolloverStrategy rolloverStrategy, final String advertiseURI,","51","            final Layout<? extends Serializable> layout, final int bufferSize) {","52","        super(fileName, os, append, false, advertiseURI, layout, bufferSize);","71","     * @param bufferSize buffer size to use if bufferedIO is true","75","            final boolean bufferedIO, final TriggeringPolicy policy, final RolloverStrategy strategy,","76","            final String advertiseURI, final Layout<? extends Serializable> layout, final int bufferSize) {","79","            bufferedIO, policy, strategy, advertiseURI, layout, bufferSize), factory);","122","        if (getBufferSize() > 0) { \/\/ negative buffer size means no buffering","123","            setOutputStream(new BufferedOutputStream(os, getBufferSize()));","124","        } else {","125","            setOutputStream(os);","126","        }","256","        private final int bufferSize;","269","         * @param bufferSize the buffer size","272","                final TriggeringPolicy policy, final RolloverStrategy strategy, final String advertiseURI,","273","                final Layout<? extends Serializable> layout, final int bufferSize) {","277","            this.bufferSize = bufferSize;","314","                int bufferSize = data.bufferSize;","316","                    os = new BufferedOutputStream(os, bufferSize);","317","                } else {","318","                    bufferSize = -1; \/\/ negative buffer size signals bufferedIO was configured false","322","                    data.strategy, data.advertiseURI, data.layout, bufferSize);"],"delete":["49","                                 final boolean append, final long size, final long time, final TriggeringPolicy triggeringPolicy,","50","                                 final RolloverStrategy rolloverStrategy, final String advertiseURI, final Layout<? extends Serializable> layout) {","51","        super(fileName, os, append, false, advertiseURI, layout);","73","                                                    final boolean bufferedIO, final TriggeringPolicy policy,","74","                                                    final RolloverStrategy strategy, final String advertiseURI,","75","                                                    final Layout<? extends Serializable> layout) {","78","            bufferedIO, policy, strategy, advertiseURI, layout), factory);","121","        setOutputStream(os);","265","                           final TriggeringPolicy policy, final RolloverStrategy strategy, final String advertiseURI,","266","                           final Layout<? extends Serializable> layout) {","307","                    os = new BufferedOutputStream(os);","311","                    data.strategy, data.advertiseURI, data.layout);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":[{"add":["39","import org.apache.logging.log4j.core.util.Integers;","47","    private static final int DEFAULT_BUFFER_SIZE = 8192;","55","            final RollingFileManager manager, final String fileName, final String filePattern,","56","            final boolean ignoreExceptions, final boolean immediateFlush, final Advertiser advertiser) {","112","     * @param bufferSizeStr buffer size for buffered IO (default is 8192).","132","            @PluginAttribute(\"bufferSize\") final String bufferSizeStr,","148","        final int bufferSize = Integers.parseInt(bufferSizeStr, DEFAULT_BUFFER_SIZE);","149","        if (!isBuffered && bufferSize > 0) {","150","            LOGGER.warn(\"The bufferSize is set to {} but bufferedIO is not true: {}\", bufferSize, bufferedIO);","151","        }","182","            isBuffered, policy, strategy, advertiseURI, layout, bufferSize);"],"delete":["53","                                final RollingFileManager manager, final String fileName,","54","                                final String filePattern, final boolean ignoreExceptions, final boolean immediateFlush,","55","                                final Advertiser advertiser) {","175","            isBuffered, policy, strategy, advertiseURI, layout);"]}]}},"a019ba878e1ae0d8a48423f26cec9f34e913c31e":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/webapp.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["79","      <action issue=\"LOG4J2-946\" dev=\"ggregory\" type=\"fix\" due-to=\"artemonster\">","80","        [docs] Using Log4j 2 in Web Applications: Update example (Log4jWebLifeCycle is not visible).","81","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/webapp.xml":[{"add":["316","","318","    protected void doGet(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException {","320","        asyncContext.start(WebLoggerContextUtils.wrapExecutionContext(this.getServletContext(), new Runnable() {","328","","329","    @Override","330","    protected void doPost(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException {","331","        final AsyncContext asyncContext = req.startAsync();","332","        asyncContext.start(new Runnable() {","333","            @Override","334","            public void run() {","335","                final Log4jWebSupport webSupport =","336","                    WebLoggerContextUtils.getWebLifeCycle(TestAsyncServlet.this.getServletContext());","337","                webSupport.setLoggerContext();","338","                \/\/ do stuff","339","                webSupport.clearLoggerContext();","340","            }","341","        });","342","    }"],"delete":["317","    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {","319","        asyncContext.start(WebLoggerContextUtils.wrapExecutionContext(getServletContext(), new Runnable() {"]}]}},"69d8d73d6e6422d554a635dfa9f8beb690c56189":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Loader.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-640\" dev=\"mattsicker\" type=\"fix\">","25","        Fix NPE that can be caused by a null ThreadContextClassLoader.","26","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Loader.java":[{"add":["22","import java.security.AccessController;","23","import java.security.PrivilegedAction;","40","    private static final PrivilegedAction<ClassLoader> THREAD_CONTEXT_CLASS_LOADER_GETTER =","41","        new ThreadContextClassLoaderGetter();","42","","209","        return System.getSecurityManager() == null","210","            ? THREAD_CONTEXT_CLASS_LOADER_GETTER.run()","211","            : AccessController.doPrivileged(THREAD_CONTEXT_CLASS_LOADER_GETTER);","212","    }","214","    private static class ThreadContextClassLoaderGetter implements PrivilegedAction<ClassLoader> {","215","        @Override","216","        public ClassLoader run() {","217","            final ClassLoader cl = Thread.currentThread().getContextClassLoader();","218","            \/\/ if the TCCL is null, that means we're using the system CL","219","            return cl == null ? ClassLoader.getSystemClassLoader() : cl;","220","        }"],"delete":["204","        ClassLoader cl;","205","        if (System.getSecurityManager() == null) {","206","            cl = Thread.currentThread().getContextClassLoader();","207","        } else {","208","            cl = java.security.AccessController.doPrivileged(","209","                new java.security.PrivilegedAction<ClassLoader>() {","210","                    @Override","211","                    public ClassLoader run() {","212","                        return Thread.currentThread().getContextClassLoader();","213","                    }","214","                }","215","            );","216","        }","218","        return cl;"]}]}},"9c7755e2922dccbf4f5de7416951b1058bfb067f":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":[{"add":["227","    private String formatXml(String xml)","228","        throws TransformerConfigurationException, TransformerException, TransformerFactoryConfigurationError {","229","        final StringWriter writer = new StringWriter();","230","        formatXml(new StreamSource(new StringReader(xml)), new StreamResult(writer));","231","        return writer.toString();","232","    }","233","","256","        } catch (final XMLStreamException | TransformerException e) {"],"delete":["249","        } catch (final XMLStreamException | TransformerException | TransformerFactoryConfigurationError e) {","255","    private String formatXml(String xml)","256","        throws TransformerConfigurationException, TransformerException, TransformerFactoryConfigurationError {","257","        final StringWriter writer = new StringWriter();","258","        formatXml(new StreamSource(new StringReader(xml)), new StreamResult(writer));","259","        return writer.toString();","260","    }","261",""]}]}},"7f64fe8cbdfb672eab2fab280d5b676babc99087":{"changes":{"log4j-1.2-api\/src\/test\/resources\/log-RouteWithMDC.xml":"ADD","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/LogWithRouteTest.java":"ADD"},"diff":{"log4j-1.2-api\/src\/test\/resources\/log-RouteWithMDC.xml":[{"add":[],"delete":[]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/LogWithRouteTest.java":[{"add":[],"delete":[]}]}},"13d1d78b5a67a7682b2d2cd89b45652204f44309":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":[{"add":["63","    protected boolean equalsImpl(final Object obj) {","67","        if (!super.equalsImpl(obj)) {","156","    protected int hashCodeImpl() {","158","        int result = super.hashCodeImpl();"],"delete":["63","    @Override","64","    public boolean equals(final Object obj) {","68","        if (!super.equals(obj)) {","157","    @Override","158","    public int hashCode() {","160","        int result = super.hashCode();"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-985\" dev=\"rpopma\" type=\"fix\" due-to=\"Sean Dawson\">","27","        AbstractFilter should not implement equals() and hashCode().","28","      <\/action>"],"delete":[]}]}},"efa8de005aa460f4b199fe34617b10991639fb68":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":[{"add":["64","     * ","65","     * @param name the name to escape so it can be used as a value in an","79","                \/\/ quote, star, question & backslash must be escaped","80","                sb.append('\\\\');","86","                \/\/ no need to escape these, but value must be quoted","87","                needsQuotes = true;","100","     * Creates MBeans to instrument classes in the log4j class hierarchy and","101","     * registers the MBeans in the platform MBean server so they can be accessed","102","     * by remote clients.","103","     * ","104","     * @throws JMException if a problem occurs during registration","105","     *\/","106","    public static void registerMBeans() throws JMException {","107","        final ContextSelector selector = getContextSelector();","108","        registerMBeans(selector);","109","    }","110","","111","    \/**","115","     * ","116","     * @param selector starting point in the log4j class hierarchy","117","     * @throws JMException if a problem occurs during registration","119","    public static void registerMBeans(final ContextSelector selector) throws JMException {","134","     * ","135","     * @param selector starting point in the log4j class hierarchy","136","     * @param mbs the MBean Server to register the instrumented objects in","137","     * @throws JMException if a problem occurs during registration","139","    public static void registerMBeans(final ContextSelector selector, final MBeanServer mbs) throws JMException {","151","","169","        unregisterMBeans(mbs);","174","            registerStatusLogger(mbs, executor);","175","            final ContextSelector selector = getContextSelector();","176","            if (selector == null) {","177","                LOGGER.debug(\"Could not register MBeans: no ContextSelector found.\");","178","                return;","179","            }","192","    \/**","193","     * Unregister all log4j MBeans from the platform MBean server.","194","     *\/","195","    public static void unregisterMBeans() {","196","        final MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();","197","        unregisterMBeans(mbs);","198","    }","199","","200","    \/**","201","     * Unregister all log4j MBeans from the specified MBean server.","202","     * ","203","     * @param mbs the MBean server to unregister from.","204","     *\/","205","    public static void unregisterMBeans(MBeanServer mbs) {","206","        unregisterStatusLogger(mbs);","207","        unregisterContextSelector(mbs);","208","        unregisterContexts(mbs);","209","        unregisterLoggerConfigs(\"*\", mbs);","210","        unregisterAsyncLoggerRingBufferAdmins(\"*\", mbs);","211","        unregisterAsyncLoggerConfigRingBufferAdmins(\"*\", mbs);","212","        unregisterAppenders(\"*\", mbs);","213","        unregisterAsyncAppenders(\"*\", mbs);","214","    }","215","","216","    \/**","217","     * Returns the {@code ContextSelector} of the current","218","     * {@code Log4jContextFactory}.","219","     * ","220","     * @return the {@code ContextSelector} of the current","221","     *         {@code Log4jContextFactory}","222","     *\/","226","            ContextSelector selector = ((Log4jContextFactory) factory).getSelector();","227","            return selector;","229","        return null;","236","     * ","237","     * @param loggerContextName name of the logger context to unregister","248","     * ","249","     * @param loggerContextName name of the logger context to unregister","250","     * @param mbs the MBean Server to unregister the instrumented objects from","279","     * Registers MBeans for all contexts in the list. First unregisters each","280","     * context (and nested loggers, appender etc) to prevent","281","     * InstanceAlreadyExistsExceptions.","290","","293","","309","    private static void unregisterLoggerConfigs(final String contextName, final MBeanServer mbs) {","321","    private static void unregisterAppenders(final String contextName, final MBeanServer mbs) {","327","    private static void unregisterAsyncAppenders(final String contextName, final MBeanServer mbs) {","333","    private static void unregisterAsyncLoggerRingBufferAdmins(final String contextName, final MBeanServer mbs) {","339","    private static void unregisterAsyncLoggerConfigRingBufferAdmins(final String contextName, final MBeanServer mbs) {","366","","381","","392","","393","    private static void register(MBeanServer mbs, Object mbean, ObjectName objectName)"],"delete":["64","     *","65","     * @param name","66","     *            the name to escape so it can be used as a value in an","80","                sb.append('\\\\'); \/\/ quote, star, question & backslash must be escaped","86","                needsQuotes = true; \/\/ no need to escape these, but value must be quoted","102","     *","103","     * @param selector","104","     *            starting point in the log4j class hierarchy","105","     * @throws JMException","106","     *             if a problem occurs during registration","108","    public static void registerMBeans(final ContextSelector selector)","109","            throws JMException {","124","     *","125","     * @param selector","126","     *            starting point in the log4j class hierarchy","127","     * @param mbs","128","     *            the MBean Server to register the instrumented objects in","129","     * @throws JMException","130","     *             if a problem occurs during registration","132","    public static void registerMBeans(final ContextSelector selector,","133","            final MBeanServer mbs) throws JMException {","145","    ","161","        ","162","        try {","163","            unregisterStatusLogger(mbs);","164","            registerStatusLogger(mbs, executor);","165","        } catch (Exception ex) {","166","            LOGGER.error(\"Could not register MBeans\", ex);","167","        }","168","","169","        final ContextSelector selector = getContextSelector();","170","        if (selector == null) {","171","            LOGGER.debug(\"Could not register MBeans: no ContextSelector found.\");","172","            return;","173","        }","176","        unregisterContextSelector(mbs);","177","        unregisterContexts(mbs);","178","        unregisterLoggerConfigs(\"*\", mbs);","179","        unregisterAsyncLoggerConfigRingBufferAdmins(\"*\", mbs);","180","        unregisterAppenders(\"*\", mbs);","181","        unregisterAsyncAppenders(\"*\", mbs);","199","        ContextSelector selector = null;","202","            selector = ((Log4jContextFactory) factory).getSelector();","204","        return selector;","211","     *","212","     * @param loggerContextName","213","     *            name of the logger context to unregister","224","     *","225","     * @param loggerContextName","226","     *            name of the logger context to unregister","227","     * @param mbs","228","     *            the MBean Server to unregister the instrumented objects from","257","     * Registers MBeans for all contexts in the list.","258","     * First unregisters each context (and nested loggers, appender etc)","259","     * to prevent InstanceAlreadyExistsExceptions.","268","            ","271","            ","287","    private static void unregisterLoggerConfigs(final String contextName,","288","            final MBeanServer mbs) {","300","    private static void unregisterAppenders(final String contextName,","301","            final MBeanServer mbs) {","307","    private static void unregisterAsyncAppenders(final String contextName,","308","            final MBeanServer mbs) {","314","    private static void unregisterAsyncLoggerRingBufferAdmins(final String contextName,","315","            final MBeanServer mbs) {","321","    private static void unregisterAsyncLoggerConfigRingBufferAdmins(final String contextName,","322","            final MBeanServer mbs) {","349","            ","364","            ","375","    ","376","    private static void register(MBeanServer mbs, Object mbean, ObjectName objectName) "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["217","            ","218","            \/\/ in finally: unregister MBeans even if an exception occurred while stopping ","219","            Server.unregisterMBeans(); \/\/ LOG4J2-406","353","","354","        try {","355","            Server.reregisterMBeansAfterReconfigure();","356","        } catch (final Exception ex) {","357","            LOGGER.error(\"Could not reconfigure JMX\", ex);","358","        }"],"delete":["22","import java.util.HashMap;","23","import java.util.Map;","384","        try {","385","            Server.reregisterMBeansAfterReconfigure();","386","        } catch (final Exception ex) {","387","            LOGGER.error(\"Could not reconfigure JMX\", ex);","388","        }","389",""]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-406\" dev=\"rpopma\" type=\"fix\" due-to=\"Kerrigan Joseph\">","24","        Unregister all log4j JMX MBeans when the LoggerContext is stopped","25","        to allow web application classes to be GC-ed on undeploy.","26","      <\/action>"],"delete":[]}]}},"e17bd05b5daf456b951ba940e3df59e515fa0e8a":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["83","      <action issue=\"LOG4J2-948\" dev=\"mattsicker\" type=\"fix\" due-to=\"Andrew Flower\">","84","        Fix plugin documentation error about Converters.","85","      <\/action>"],"delete":[]}]}},"092bf982957716a79fb25a09cf740c69da13a4b5":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["76","            lookups.put(\"jndi\", (StrLookup) Class.forName(\"org.apache.logging.log4j.core.lookup.JndiLookup\")","77","                    .newInstance());","78","        } catch (Throwable e) {"],"delete":["75","            lookups.put(\"jndi\", new JndiLookup());","76","        } catch (Throwable e) {"]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-713\" dev=\"rpopma\" type=\"fix\" due-to=\"Nelson Melina\">","27","      <action issue=\"LOG4J2-703\" dev=\"ggregory\" type=\"fix\" due-to=\"Nelson Melina\">","28","        Android: Could not find class 'javax.naming.InitialContext', referenced from method org.apache.logging.log4j.core.lookup.JndiLookup.lookup.","29","      <\/action>"],"delete":["24","      <action issue=\"LOG4J2-713\" dev=\"rpopma\" type=\"fix\">","43","      <action issue=\"LOG4J2-703\" dev=\"ggregory\" type=\"fix\" due-to=\"Nelson Melina\">","44","        Android: Could not find class 'javax.naming.InitialContext', referenced from method org.apache.logging.log4j.core.lookup.JndiLookup.lookup.","45","      <\/action>"]}]}},"8fc7bcd3f981437972f4dfa953a28bf1ae0f1fb7":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["138","     * @param suppressedVisited TODO","141","            final Throwable cause, Set<Throwable> suppressedVisited) {","147","        this.causeProxy = cause.getCause() == null ? null : new ThrowableProxy(parent, stack, map, cause.getCause(), suppressedVisited);","148","        this.suppressedProxies = this.toSuppressedProxies(cause, suppressedVisited);","597","    private ThrowableProxy[] toSuppressedProxies(final Throwable thrown, Set<Throwable> suppressedVisited) {","604","            if (suppressedVisited == null) {","605","                suppressedVisited = new HashSet<>(proxies.size());","609","                if (!suppressedVisited.contains(candidate)) {","610","                    suppressedVisited.add(candidate);","611","                    proxies.add(new ThrowableProxy(candidate, suppressedVisited));"],"delete":["138","     * @param visited TODO","141","            final Throwable cause, Set<Throwable> visited) {","147","        this.causeProxy = cause.getCause() == null ? null : new ThrowableProxy(parent, stack, map, cause.getCause(), visited);","148","        this.suppressedProxies = this.toSuppressedProxies(cause, visited);","597","    private ThrowableProxy[] toSuppressedProxies(final Throwable thrown, Set<Throwable> visited) {","604","            if (visited == null) {","605","                visited = new HashSet<>(proxies.size());","609","                if (!visited.contains(candidate)) {","610","                    visited.add(candidate);","611","                    proxies.add(new ThrowableProxy(candidate, visited));"]}]}},"a902612d42f98743e833a2e086efae6bb7a2be65":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["35","          which adds <a href=\"..\/log4j-core\/apidocs\/org\/apache\/logging\/log4j\/core\/LifeCycle.html\">Lifecycle<\/a>","43","          they delegate responsibility for formatting the event to a <a href=\"layouts.html\">layout<\/a>. Some"],"delete":["35","          which adds <a href=\"..\/log4j-core\/apidocs\/org\/apache\/logging\/log4j\/core\/Lifecycle.html\">Lifecycle<\/a>","43","          they delegate responsibility for formatting the event to a <a href=\"..\/layouts.html\">layout<\/a>. Some"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-855\" dev=\"rpopma\" type=\"fix\">","27","        Fix broken links on Appenders manual page.","28","      <\/action>"],"delete":[]}]}},"f60e4edee46e9782a42acac93ccb24a85392e5bc":{"changes":{"log4j-core\/revapi.json":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NetUtils.java":"MODIFY"},"diff":{"log4j-core\/revapi.json":[{"add":["189","      },","190","      {","191","        \"code\": \"java.method.removed\",","192","        \"old\": \"method java.util.List<java.lang.String> org.apache.logging.log4j.core.util.NetUtils::getLocalIps()\",","193","        \"justification\": \"method is no longer used.\""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3290\" dev=\"rogers\" type=\"fix\">","34","        Remove unused method.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NetUtils.java":[{"add":[],"delete":["19","import java.net.Inet4Address;","20","import java.net.Inet6Address;","29","import java.util.ArrayList;","32","import java.util.List;","36","import org.apache.logging.log4j.util.Strings;","87","     * Returns all the local host names and ip addresses.","88","     * @return The local host names and ip addresses.","89","     *\/","90","    public static List<String> getLocalIps() {","91","        List<String> localIps = new ArrayList<>();","92","        localIps.add(\"localhost\");","93","        localIps.add(\"127.0.0.1\");","94","        try {","95","            final InetAddress addr = Inet4Address.getLocalHost();","96","            setHostName(addr, localIps);","97","        } catch (final UnknownHostException ex) {","98","            \/\/ Ignore this.","99","        }","100","        try {","101","            final Enumeration<NetworkInterface> interfaces = NetworkInterface.getNetworkInterfaces();","102","            if (interfaces != null) {","103","                while (interfaces.hasMoreElements()) {","104","                    final NetworkInterface nic = interfaces.nextElement();","105","                    final Enumeration<InetAddress> addresses = nic.getInetAddresses();","106","                    while (addresses.hasMoreElements()) {","107","                        final InetAddress address = addresses.nextElement();","108","                        setHostName(address, localIps);","109","                    }","110","                }","111","            }","112","        } catch (final SocketException se) {","113","            \/\/ ignore.","114","        }","115","        return localIps;","116","    }","117","","118","    private static void setHostName(InetAddress address, List<String> localIps) {","119","        String[] parts = address.toString().split(\"\\\\s*\/\\\\s*\");","120","        if (parts.length > 0) {","121","            for (String part : parts) {","122","                if (Strings.isNotBlank(part) && !localIps.contains(part)) {","123","                    localIps.add(part);","124","                }","125","            }","126","        }","127","    }","128","","129","    \/**"]}]}},"9a3179a03b05639739f49e8798be17e6c2c47293":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/PluginManagerPackagesTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/PluginManagerPackagesTest.java":[{"add":["99","        \/\/ (switch off annotation processing: no need to create Log4j2Plugins.dat)","100","        List<String> options = Arrays.asList(\"-proc:none\");","101","        compiler.getTask(null, fileManager, diagnostics, options, null, compilationUnits).call();"],"delete":["99","        compiler.getTask(null, fileManager, diagnostics, null, null, compilationUnits).call();"]}],"src\/changes\/changes.xml":[{"add":["23","    <release version=\"2.1\" date=\"2014-0?-??\" description=\"Bug fixes and enhancements\">","24","      <action issue=\"LOG4J2-756\" dev=\"rpopma\" type=\"fix\" due-to=\"Scott Harrington\">","25","        Prevent JUnit test from creating unnecessary Log4j2Plugins.dat during build.","26","      <\/action>      ","27","    <\/release> "],"delete":[]}]}},"d1c67a73d660faca024a1a0a20f9b26ea5c2b5bc":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/EncodingPatternConverter.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/EncodingPatternConverterTest.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["68","      <action issue=\"LOG4J2-3070\" dev=\"vy\" type=\"fix\" due-to=\"Romain Manni-Bucau\">","69","        Ensure EncodingPatternConverter#handlesThrowable is implemented.","70","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/EncodingPatternConverter.java":[{"add":["19","import java.util.function.Function;","20","import java.util.stream.Stream;","55","    @Override","56","    public boolean handlesThrowable() {","57","        return formatters != null && formatters.stream()","58","                .map(PatternFormatter::getConverter)","59","                .anyMatch(LogEventPatternConverter::handlesThrowable);","60","    }","61",""],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/EncodingPatternConverterTest.java":[{"add":["21","import org.apache.logging.log4j.core.config.Configuration;","22","import org.apache.logging.log4j.core.config.DefaultConfiguration;","107","    @Test","108","    public void testHandlesThrowable() {","109","        final Configuration configuration = new DefaultConfiguration();","110","        assertFalse(EncodingPatternConverter.newInstance(configuration, new String[]{\"%msg\", \"XML\"})","111","            .handlesThrowable());","112","        assertTrue(EncodingPatternConverter.newInstance(configuration, new String[]{\"%xThrowable{full}\", \"JSON\"})","113","            .handlesThrowable());","114","        assertTrue(EncodingPatternConverter.newInstance(configuration, new String[]{\"%ex\", \"XML\"})","115","            .handlesThrowable());","116","    }"],"delete":[]}]}},"c9a199539304ea508660621448780819ad359ed1":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-77\" dev=\"rgoers\" type=\"fix\">","26","        RoutingAppender was calling the stop method for each of its referenced Appenders and was calling","27","        the stop method of the default Appender a second time. It will now only call the stop method of","28","        Appenders it creates.","29","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":[{"add":["88","        Map<String, Appender> map = config.getAppenders();","89","        for (Map.Entry<String, AppenderControl> entry : appenders.entrySet()) {","90","            String name = entry.getValue().getAppender().getName();","91","            if (!DEFAULT_KEY.equals(entry.getKey()) && !map.containsKey(name)) {","92","                entry.getValue().getAppender().stop();","93","            }"],"delete":["88","        for (AppenderControl control : appenders.values()) {","89","            control.getAppender().stop();"]}]}},"e20ac291a0c65950d20de588bcfe6af0f22be2ea":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-830\" dev=\"rpopma\" type=\"fix\">","27","        Respect external interrupt signal to allow application shutdown after joining AsyncAppender thread.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":[{"add":["235","                    break; \/\/ LOG4J2-830","267","                    \/\/ Here we ignore interrupts and try to process all remaining events."],"delete":["235","                    \/\/ No good reason for this.","236","                    continue;"]}]}},"12c159973bd4cd40f0070145309fb34a01b67668":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2163\" dev=\"rgoers\" type=\"fix\">","34","        Allow SortedArrayStringMap to be filtered upon deserialization. Fix build error in Java 9 when","35","        compiling log4j-core test classes.","36","      <\/action>"],"delete":[]}]}},"d73a529fcca02b8054983d21dad5502f459dac67":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/HtmlLayout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-933\" dev=\"ggregory\" type=\"add\" due-to=\"ppiman at gmail.com\">","27","        HTML layout should not use attribute minimalization for hr noshade.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/HtmlLayout.java":[{"add":["274","        sbuf.append(\"<hr size=\\\"1\\\" noshade=\\\"noshade\\\">\").append(Constants.LINE_SEPARATOR);"],"delete":["274","        sbuf.append(\"<hr size=\\\"1\\\" noshade>\").append(Constants.LINE_SEPARATOR);"]}]}},"231596956e23a1dd1aadf48c5e0f9ad0089a9940":{"changes":{"src\/site\/xdoc\/manual\/architecture.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/architecture.xml":[{"add":["71","          of the LoggerConfig named <code>\"com.foo.Bar\"<\/code>. Similarly,"],"delete":["71","          of the LoggerConfig named<code>\"com.foo.Bar\"<\/code>. Similarly,"]}]}},"db92157733a73ae5c939cd53dbd15d88c37e3671":{"changes":{"slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/SLF4JLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/SLF4JLogger.java":[{"add":["424","        if (!logger.isEnabled(getLevel(i), (org.apache.logging.log4j.Marker) marker, s1)) {","425","            return;","426","        }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-80\" dev=\"rgoers\" type=\"fix\" due-to=\"Oliver Lamy\">","26","        Allow Log4j 2 to be used as the implementation with SLF4J and SLF4J's jcl-over-slf4j by adding filtering","27","        to the log method in SLF4JLogger.","28","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["89","    <slf4j.version>1.7.0<\/slf4j.version>"],"delete":["89","    <slf4j.version>1.6.6<\/slf4j.version>"]}]}},"f12ef1580cd33fd704a5fa90d19f6f43c130a944":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/site.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-861\" dev=\"rpopma\" type=\"fix\">","27","        Documentation: fix broken links on left navigation Extending Log4j Configuration sub-menu.","28","      <\/action>"],"delete":[]}],"src\/site\/site.xml":[{"add":["178","        <item name=\"ConfigurationFactory\" href=\"\/manual\/customconfig.html#ConfigurationFactory\"\/>","179","        <item name=\"Manual\" href=\"\/manual\/customconfig.html#AddingToCurrent\"\/>"],"delete":["178","        <item name=\"ConfigurationFactory\" href=\"\/manual\/custom.config#ConfigurationFactory\"\/>","179","        <item name=\"Manual\" href=\"\/manual\/custom.config#AddingToCurrent\"\/>"]}]}},"904e58b266a673de2103000d8b7f021155661d65":{"changes":{"src\/site\/xdoc\/manual\/lookups.xml":"MODIFY","src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/lookups.xml":[{"add":["83","          <p>","84","            This lookup also supports default value syntax. In the sample below, when the <code>USER<\/code> environment","85","            variable is undefined, the default value <code>jdoe<\/code> is used:","86","          <\/p>","87","          <pre class=\"prettyprint linenums\"><![CDATA[","88","<File name=\"Application\" fileName=\"application.log\">","89","  <PatternLayout>","90","    <pattern>%d %p %c{1.} [%t] $${env:USER:-jdoe} %m%n<\/pattern>","91","  <\/PatternLayout>","92","<\/File>]]><\/pre>           ","433","          <p>","434","            This lookup also supports default value syntax. In the sample below, when the <code>logPath<\/code> system","435","            property is undefined, the default value <code>\/var\/logs<\/code> is used:","436","          <\/p>","437","          <pre class=\"prettyprint linenums\"><![CDATA[","438","<Appenders>","439","  <File name=\"ApplicationLog\" fileName=\"${sys:logPath:-\/var\/logs}\/app.log\"\/>","440","<\/Appenders>]]><\/pre>            "],"delete":[]}],"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["1020","                <td>System environment variables. The formats are <code>${dollar}{env:ENV_NAME}<\/code> and <code>${dollar}{env:ENV_NAME:-default_value}<\/code>.<\/td>","1055","                <td>System properties. The formats are <code>${dollar}{sys:some.property}<\/code> and <code>${dollar}{sys:some.property:-default_value}<\/code>.<\/td>"],"delete":["1020","                <td>System environment variables<\/td>","1055","                <td>System properties<\/td>"]}],"src\/changes\/changes.xml":[{"add":["97","      <action issue=\"LOG4J2-2197\" dev=\"ggregory\" type=\"update\" due-to=\"Fabrice Daugan\">","98","        Document default property value support.","99","      <\/action>"],"delete":[]}]}},"2afe3dff3dcf527c3b52d818a34d4696566be8db":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderTimeAndSizeTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/helper\/FileRenameAction.java":"MODIFY","core\/src\/test\/resources\/log4j-rolling3.xml":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderTimeAndSizeTest.java":[{"add":["37","    private static final String DIR = \"target\/rolling3\/test\";","51","        \/\/deleteDir();"],"delete":["37","    private static final String DIR = \"target\/rolling3\";","51","        deleteDir();"]}],"src\/changes\/changes.xml":[{"add":["28","      <action issue=\"LOG4J2-71\" dev=\"rgoers\" type=\"fix\">","29","        FileRenameAction did not create the parent directories of the archive files causing the rollover to fail.","30","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/helper\/FileRenameAction.java":[{"add":["18","import org.apache.logging.log4j.Logger;","19","import org.apache.logging.log4j.status.StatusLogger;","20","","32","","33","    private static final Logger LOGGER = StatusLogger.getLogger();","34","","82","            File parent = destination.getParentFile();","83","            if (!parent.exists()) {","84","                if (!parent.mkdirs()) {","85","                    LOGGER.error(\"Unable to create directory {}\", parent.getAbsolutePath());","86","                    return false;","87","                }","88","            }","90","                if (!source.renameTo(destination)) {","91","                    try {","92","                        copyFile(source, destination);","93","                        return source.delete();","94","                    } catch (IOException iex) {","95","                        LOGGER.error(\"Unable to rename file {} to {} - {}\", source.getAbsolutePath(),","96","                            destination.getAbsolutePath(), iex.getMessage());","97","                    }","98","                }","99","                return true;","105","                    LOGGER.error(\"Unable to rename file {} to {} - {}\", source.getAbsolutePath(),","106","                        destination.getAbsolutePath(), iex.getMessage());"],"delete":["77","","78","                boolean result = source.renameTo(destination);","79","                \/\/System.out.println(\"Rename of \" + source.getName() + \" to \" + destination.getName() + \": \" + result);","80","                return result;","86","                    iex.printStackTrace();"]}],"core\/src\/test\/resources\/log4j-rolling3.xml":[{"add":["28","    <RollingFile name=\"RollingFile\" fileName=\"${filename}\" filePattern=\"target\/rolling3\/test\/test1-%d{MM-dd-yy-HH-mm}-%i.log.gz\">"],"delete":["28","    <RollingFile name=\"RollingFile\" fileName=\"${filename}\" filePattern=\"target\/rolling3\/test1-%d{MM-dd-yy-HH-mm}-%i.log.gz\">"]}]}},"d80c6a20824bd13090bf80d415c02b39c53e8f21":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":[{"add":["54","        for (LoaderUtil.UrlResource resource : LoaderUtil.findUrlResources(PROVIDER_RESOURCE)) {","55","            loadProvider(resource.getUrl(), resource.getClassLoader());"],"delete":["21","import java.util.Enumeration;","55","        final ClassLoader cl = findClassLoader();","56","        Enumeration<URL> enumResources = null;","57","        try {","58","            enumResources = cl.getResources(PROVIDER_RESOURCE);","59","        } catch (final IOException e) {","60","            LOGGER.fatal(\"Unable to locate {}\", PROVIDER_RESOURCE, e);","61","        }","62","        loadProviders(enumResources, cl);","63","    }","64","","65","    protected static void loadProviders(final Enumeration<URL> enumResources, final ClassLoader cl) {","66","        if (enumResources != null) {","67","            while (enumResources.hasMoreElements()) {","68","                final URL url = enumResources.nextElement();","69","                loadProvider(url, cl);","70","            }"]}]}},"9ff63b2e50be754ae394feda2c33d9e64fd0ab3a":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverterTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ThrowablePatternConverter.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/Log4j2_2195_Test.java":"ADD","log4j-core\/src\/test\/resources\/LOG4J-2195\/log4j2.xml":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/HttpAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableFormatOptionsTest.java":"MODIFY","src\/site\/xdoc\/manual\/layouts.xml.vm":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":[{"add":["663","","664","    public Serializer getEventSerializer() {","665","        return eventSerializer;","666","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":[{"add":["70","            final String extStackTrace = proxy.getExtendedStackTraceAsString(options.getIgnorePackages(),","71","                    options.getTextRenderer(), getSuffix(event), options.getSeparator());","76","            toAppendTo.append(extStackTrace);"],"delete":["70","            final String suffix = getSuffix(event);","71","            final String extStackTrace = proxy.getExtendedStackTraceAsString(options.getIgnorePackages(), options.getTextRenderer(), suffix);","76","            if (!options.allLines() || !Strings.LINE_SEPARATOR.equals(options.getSeparator())) {","77","                final StringBuilder sb = new StringBuilder();","78","                final String[] array = extStackTrace.split(Strings.LINE_SEPARATOR);","79","                final int limit = options.minLines(array.length) - 1;","80","                for (int i = 0; i <= limit; ++i) {","81","                    sb.append(array[i]);","82","                    if (i < limit) {","83","                        sb.append(options.getSeparator());","84","                    }","85","                }","86","                toAppendTo.append(sb.toString());","87","            } else {","88","                toAppendTo.append(extStackTrace);","89","            }"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverterTest.java":[{"add":["20","import static org.junit.Assert.assertNotNull;","25","import java.util.List;","31","import org.apache.logging.log4j.core.impl.ThrowableFormatOptions;","158","        final String expected = sw.toString(); \/\/.replaceAll(\"\\r\", Strings.EMPTY);","161","    ","162","    @Test","163","    public void testFiltersAndSeparator() {","164","        final ExtendedThrowablePatternConverter exConverter = ExtendedThrowablePatternConverter.newInstance(null,","165","                new String[] { \"full\", \"filters(org.junit,org.eclipse)\", \"separator(|)\" });","166","        final ThrowableFormatOptions options = exConverter.getOptions();","167","        final List<String> ignorePackages = options.getIgnorePackages();","168","        assertNotNull(ignorePackages);","169","        final String ignorePackagesString = ignorePackages.toString();","170","        assertTrue(ignorePackagesString, ignorePackages.contains(\"org.junit\"));","171","        assertTrue(ignorePackagesString, ignorePackages.contains(\"org.eclipse\"));","172","        assertEquals(\"|\", options.getSeparator());","173","    }","174",""],"delete":["155","        final String expected = sw.toString().replaceAll(\"\\r\", Strings.EMPTY);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ThrowablePatternConverter.java":[{"add":["41","    \/**","42","     * Lists {@link PatternFormatter}s for the suffix attribute.","43","     *\/","48","     * Options.","67","            final List<PatternFormatter> parsedSuffixFormatters = parser.parse(this.options.getSuffix());","69","            boolean hasThrowableSuffixFormatter = false;","70","            for (final PatternFormatter suffixFormatter : parsedSuffixFormatters) {","71","                if (suffixFormatter.handlesThrowable()) {","72","                    hasThrowableSuffixFormatter = true;","75","            if (!hasThrowableSuffixFormatter) {","76","                this.formatters = parsedSuffixFormatters;","78","                final List<PatternFormatter> suffixFormatters = new ArrayList<>();","79","                for (final PatternFormatter suffixFormatter : parsedSuffixFormatters) {","80","                    if (!suffixFormatter.handlesThrowable()) {","81","                        suffixFormatters.add(suffixFormatter);","84","                this.formatters = suffixFormatters;","223","","224","    public ThrowableFormatOptions getOptions() {","225","        return options;","226","    }"],"delete":["45","     * The number of lines to write.","64","            final List<PatternFormatter> parsedFormatters = parser.parse(this.options.getSuffix());","66","            boolean hasThrowableFormatter = false;","67","            for (final PatternFormatter formatter : parsedFormatters) {","68","                if (formatter.handlesThrowable()) {","69","                    hasThrowableFormatter = true;","72","            if (!hasThrowableFormatter) {","73","                this.formatters = parsedFormatters;","75","                final List<PatternFormatter> formatters = new ArrayList<>();","76","                for (final PatternFormatter formatter : parsedFormatters) {","77","                    if (!formatter.handlesThrowable()) {","78","                        formatters.add(formatter);","81","                this.formatters = formatters;","92","     *"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/Log4j2_2195_Test.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/LOG4J-2195\/log4j2.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["49","import org.apache.logging.log4j.core.pattern.PlainTextRenderer;","97","    private boolean lastLineContains(final String text, final String containedText) {","98","        final String[] lines = text.split(\"\\n\");","99","        final String lastLine = lines[lines.length-1];","100","        return lastLine.contains(containedText);","101","    }","102","","303","    public void testSeparator_getExtendedStackTraceAsString() throws Exception {","304","        final Throwable throwable = new IllegalArgumentException(\"This is a test\");","305","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","306","","307","        final String separator = \" | \";","308","        final String extendedStackTraceAsString = proxy.getExtendedStackTraceAsString(null,","309","                PlainTextRenderer.getInstance(), \" | \", Strings.EMPTY);","310","        assertTrue(extendedStackTraceAsString, allLinesContain(extendedStackTraceAsString, separator));","311","    }","312","","313","    @Test","319","        final String extendedStackTraceAsString = proxy.getExtendedStackTraceAsString(suffix);","320","        assertTrue(extendedStackTraceAsString, lastLineContains(extendedStackTraceAsString, suffix));"],"delete":["301","        assertTrue(allLinesContain(proxy.getExtendedStackTraceAsString(suffix), suffix));"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["34","import org.apache.logging.log4j.core.impl.ThrowableFormatOptions;","120","        final String expected = \"INFO  [PatternParserTest        :104 ] - Hello, world\" + Strings.LINE_SEPARATOR;","372","","373","    @Test","374","    public void testExceptionWithFilters() {","375","        final List<PatternFormatter> formatters = parser","376","                .parse(\"%d{DEFAULT} - %msg - %xEx{full}{filters(org.junit,org.eclipse)}%n\");","377","        assertNotNull(formatters);","378","        assertEquals(6, formatters.size());","379","        final PatternFormatter patternFormatter = formatters.get(4);","380","        final LogEventPatternConverter converter = patternFormatter.getConverter();","381","        assertEquals(ExtendedThrowablePatternConverter.class, converter.getClass());","382","        final ExtendedThrowablePatternConverter exConverter = (ExtendedThrowablePatternConverter) converter;","383","        final ThrowableFormatOptions options = exConverter.getOptions();","384","        assertTrue(options.getIgnorePackages().contains(\"org.junit\"));","385","        assertTrue(options.getIgnorePackages().contains(\"org.eclipse\"));","386","        assertEquals(System.lineSeparator(), options.getSeparator());","387","    }","388","","389","    @Test","390","    public void testExceptionWithFiltersAndSeparator() {","391","        final List<PatternFormatter> formatters = parser","392","                .parse(\"%d{DEFAULT} - %msg - %xEx{full}{filters(org.junit,org.eclipse)}{separator(|)}%n\");","393","        assertNotNull(formatters);","394","        assertEquals(6, formatters.size());","395","        final PatternFormatter patternFormatter = formatters.get(4);","396","        final LogEventPatternConverter converter = patternFormatter.getConverter();","397","        assertEquals(ExtendedThrowablePatternConverter.class, converter.getClass());","398","        final ExtendedThrowablePatternConverter exConverter = (ExtendedThrowablePatternConverter) converter;","399","        final ThrowableFormatOptions options = exConverter.getOptions();","400","        final List<String> ignorePackages = options.getIgnorePackages();","401","        assertNotNull(ignorePackages);","402","        final String ignorePackagesString = ignorePackages.toString();","403","        assertTrue(ignorePackagesString, ignorePackages.contains(\"org.junit\"));","404","        assertTrue(ignorePackagesString, ignorePackages.contains(\"org.eclipse\"));","405","        assertEquals(\"|\", options.getSeparator());","406","    }","407",""],"delete":["119","        final String expected = \"INFO  [PatternParserTest        :103 ] - Hello, world\" + Strings.LINE_SEPARATOR;"]}],"src\/changes\/changes.xml":[{"add":["1040","      <action issue=\"LOG4J2-2195\" dev=\"ggregory\" type=\"add\" due-to=\"Raman Gupta, Gary Gregory\">","1041","        Cannot define both `filters` and `separator` for PatternLayout %xEx.","1042","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/HttpAppenderTest.java":[{"add":["48","import org.junit.Ignore;","55","@Ignore(\"Fails often on Windows\")"],"delete":["54","\/\/@Ignore(\"Fails often on Windows\")"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableFormatOptionsTest.java":[{"add":["65","     * Test {@code %throwable} with null options.","73","     * Test {@code %throwable}","115","     * Test {@code %throwable{full}{ansi()} }","235","     * Test {@code %throwable{separator( | )} }","251","     * Test {@code %throwable{full}{filters(org.junit)}{separator(|)} }","252","     *\/","253","    @Test","254","    public void testFullAndFiltersAndSeparator() {","255","        test(new String[] { \"full\", \"filters(org.junit)\", \"separator(|)\" }, Integer.MAX_VALUE, \"|\", Arrays.asList(\"org.junit\"));","256","    }","257","","258","    \/**","345","    public void testFullAndSeparatorAndFilter() {","351","     * Test {@code %throwable{full}{separator(|)}{filters(package1,package2)} }","352","     *\/","353","    @Test","354","    public void testFullAndSeparatorAndFilters() {","355","        test(new String[] { \"full\", \"separator(|)\", \"filters(package1,package2)\" }, Integer.MAX_VALUE, \"|\",","356","                Arrays.asList(\"package1\", \"package2\"));","357","    }","358","","359","    \/**"],"delete":["65","     * Test {@code %throwable } with null options.","73","     * Test {@code %throwable }","115","     * Test {@code %throwable{full}{ansi} }","235","     * Test {@code %throwable{separator(|)} }","337","    public void testFullAndSeparatorAndFilters() {"]}],"src\/site\/xdoc\/manual\/layouts.xml.vm":[{"add":["908","                &nbsp;&nbsp;&nbsp;| \"short.localizedMessage\"]<br \/>","909","                }<br \/>","910","                &nbsp;&nbsp;{filters(package,package,...)}<br\/>","911","                &nbsp;&nbsp;{suffix(<i>pattern<\/i>)}<br\/>","912","                &nbsp;&nbsp;{separator(<i>separator<\/i>)}<br\/>","950","                  Use <code>{filters(<i>packages<\/i>)}<\/code> where <i>packages<\/i> is a list of package names to","954","                  Use <code>{suffix(<i>pattern<\/i>)}<\/code> to add the output of <i>pattern<\/i> at the end of each stack frames.","957","                  Use a <code>{separator(...)}<\/code> as the end-of-line string. For example: <code>separator(|)<\/code>. ","958","                  The default value is the <code>line.separator<\/code> system property, which is operating system dependent."],"delete":["908","                &nbsp;&nbsp;&nbsp;| \"short.localizedMessage\"]}<br \/>","909","                &nbsp;&nbsp;[,filters(package,package,...)]<br\/>","910","                &nbsp;&nbsp;[,separator(<i>separator<\/i>)]<br\/>","911","                }<br\/>","912","                {suffix(<i>pattern<\/i>)<br\/>","913","                }<br\/>","951","                  Use <code>filters(<i>packages<\/i>)<\/code> where <i>packages<\/i> is a list of package names to","955","                  Use a <code>separator<\/code> string to separate the lines of a stack trace. For example:","956","                  <code>separator(|)<\/code>. The default value is the <code>line.separator<\/code> system property,","957","                  which is operating system dependent.","960","                  Use <code>ex{suffix(<i>pattern<\/i>)<\/code> to add the output of <i>pattern<\/i> to the output only","961","                  when there is a throwable to print."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["209","                             final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix, String lineSeparator) {","210","        formatThrowableProxy(sb, prefix, CAUSED_BY_LABEL, cause, ignorePackages, textRenderer, suffix, lineSeparator);","215","                                      final TextRenderer textRenderer, final String suffix, String lineSeparator) {","223","        textRenderer.render(lineSeparator, sb, \"Text\");","225","            throwableProxy.getStackTrace(), throwableProxy.extendedStackTrace, ignorePackages, textRenderer, suffix, lineSeparator);","226","        this.formatSuppressed(sb, prefix + TAB, throwableProxy.suppressedProxies, ignorePackages, textRenderer, suffix, lineSeparator);","227","        this.formatCause(sb, prefix, throwableProxy.causeProxy, ignorePackages, textRenderer, suffix, lineSeparator);","240","                                  final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix, String lineSeparator) {","245","            formatThrowableProxy(sb, prefix, SUPPRESSED_LABEL, suppressedProxy, ignorePackages, textRenderer, suffix, lineSeparator);","251","                                final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix, String lineSeparator) {","254","                this.formatEntry(element, sb, prefix, textRenderer, suffix, lineSeparator);","261","                        appendSuppressedCount(sb, prefix, count, textRenderer, suffix, lineSeparator);","264","                    this.formatEntry(extStackTrace[i], sb, prefix, textRenderer, suffix, lineSeparator);","270","                appendSuppressedCount(sb, prefix, count, textRenderer, suffix, lineSeparator);","279","            textRenderer.render(lineSeparator, sb, \"Text\");","291","                                       final TextRenderer textRenderer, final String suffix, String lineSeparator) {","301","        textRenderer.render(lineSeparator, sb, \"Text\");","305","                             final String prefix, final TextRenderer textRenderer, final String suffix, String lineSeparator) {","310","        textRenderer.render(lineSeparator, sb, \"Text\");","337","     * @param sb StringBuilder to contain the formatted Throwable.","338","     * @param cause The Throwable to format.","339","     * @param ignorePackages The List of packages to be suppressed from the stack trace.","340","     * @param textRenderer The text renderer.","341","     * @param suffix Append this to the end of each stack frame.","345","            final TextRenderer textRenderer, final String suffix) {","346","        formatWrapper(sb, cause, ignorePackages, textRenderer, suffix, EOL_STR);","347","    }","348","","349","    \/**","350","     * Formats the specified Throwable.","351","     * @param sb StringBuilder to contain the formatted Throwable.","352","     * @param cause The Throwable to format.","353","     * @param ignorePackages The List of packages to be suppressed from the stack trace.","354","     * @param textRenderer The text renderer.","355","     * @param suffix Append this to the end of each stack frame.","356","     * @param lineSeparator The end-of-line separator.","357","     *\/","358","    @SuppressWarnings(\"ThrowableResultOfMethodCallIgnored\")","359","    public void formatWrapper(final StringBuilder sb, final ThrowableProxy cause, final List<String> ignorePackages,","360","                              final TextRenderer textRenderer, final String suffix, final String lineSeparator) {","363","            this.formatWrapper(sb, cause.causeProxy, ignorePackages, textRenderer, suffix, lineSeparator);","369","        textRenderer.render(lineSeparator, sb, \"Text\");","371","            cause.getThrowable().getStackTrace(), cause.extendedStackTrace, ignorePackages, textRenderer, suffix, lineSeparator);","385","        return this.getCauseStackTraceAsString(null, PlainTextRenderer.getInstance(), suffix, EOL_STR);","392","     * @param suffix Append this to the end of each stack frame.","396","        return getCauseStackTraceAsString(packages, PlainTextRenderer.getInstance(), suffix, EOL_STR);","403","     * @param textRenderer The text renderer.","404","     * @param suffix Append this to the end of each stack frame.","408","        return getCauseStackTraceAsString(ignorePackages, textRenderer, suffix, EOL_STR);","409","    }","410","","411","    \/**","412","     * Formats the Throwable that is the cause of this Throwable.","413","     *","414","     * @param ignorePackages The List of packages to be suppressed from the stack trace.","415","     * @param textRenderer The text renderer.","416","     * @param suffix Append this to the end of each stack frame.","417","     * @param lineSeparator The end-of-line separator.","418","     * @return The formatted Throwable that caused this Throwable.","419","     *\/","420","    public String getCauseStackTraceAsString(final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix, final String lineSeparator) {","423","            this.formatWrapper(sb, this.causeProxy, ignorePackages, textRenderer, suffix, lineSeparator);","429","        textRenderer.render(lineSeparator, sb, \"Text\");","431","            ignorePackages, textRenderer, suffix, lineSeparator);","455","     * Formats the stack trace including packaging information.","460","        return this.getExtendedStackTraceAsString(null, PlainTextRenderer.getInstance(), Strings.EMPTY, EOL_STR);","464","     * Formats the stack trace including packaging information.","467","     * @param suffix Append this to the end of each stack frame.","470","        return this.getExtendedStackTraceAsString(null, PlainTextRenderer.getInstance(), suffix, EOL_STR);","474","     * Formats the stack trace including packaging information.","477","     * @param suffix Append this to the end of each stack frame.","481","        return getExtendedStackTraceAsString(ignorePackages, PlainTextRenderer.getInstance(), suffix, EOL_STR);","485","     * Formats the stack trace including packaging information.","488","     * @param textRenderer The message renderer.","489","     * @param suffix Append this to the end of each stack frame.","493","        return getExtendedStackTraceAsString(ignorePackages, textRenderer, suffix, EOL_STR);","494","    }","495","","496","    \/**","497","     * Formats the stack trace including packaging information.","498","     *","499","     * @param ignorePackages List of packages to be ignored in the trace.","500","     * @param textRenderer The message renderer.","501","     * @param suffix Append this to the end of each stack frame.","502","     * @param lineSeparator The end-of-line separator.","503","     * @return The formatted stack trace including packaging information.","504","     *\/","505","    public String getExtendedStackTraceAsString(final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix, final String lineSeparator) {","511","        textRenderer.render(lineSeparator, sb, \"Text\");","513","        this.formatElements(sb, Strings.EMPTY, 0, causedTrace, this.extendedStackTrace, ignorePackages, textRenderer, suffix, lineSeparator);","514","        this.formatSuppressed(sb, TAB, this.suppressedProxies, ignorePackages, textRenderer, suffix, lineSeparator);","515","        this.formatCause(sb, Strings.EMPTY, this.causeProxy, ignorePackages, textRenderer, suffix, lineSeparator);","550","     * Formats the suppressed Throwables."],"delete":["209","                             final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix) {","210","        formatThrowableProxy(sb, prefix, CAUSED_BY_LABEL, cause, ignorePackages, textRenderer, suffix);","215","                                      final TextRenderer textRenderer, final String suffix) {","223","        textRenderer.render(EOL_STR, sb, \"Text\");","225","            throwableProxy.getStackTrace(), throwableProxy.extendedStackTrace, ignorePackages, textRenderer, suffix);","226","        this.formatSuppressed(sb, prefix + TAB, throwableProxy.suppressedProxies, ignorePackages, textRenderer, suffix);","227","        this.formatCause(sb, prefix, throwableProxy.causeProxy, ignorePackages, textRenderer, suffix);","240","                                  final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix) {","245","            formatThrowableProxy(sb, prefix, SUPPRESSED_LABEL, suppressedProxy, ignorePackages, textRenderer, suffix);","251","                                final List<String> ignorePackages, final TextRenderer textRenderer, final String suffix) {","254","                this.formatEntry(element, sb, prefix, textRenderer, suffix);","261","                        appendSuppressedCount(sb, prefix, count, textRenderer, suffix);","264","                    this.formatEntry(extStackTrace[i], sb, prefix, textRenderer, suffix);","270","                appendSuppressedCount(sb, prefix, count, textRenderer, suffix);","279","            textRenderer.render(EOL_STR, sb, \"Text\");","291","                                       final TextRenderer textRenderer, final String suffix) {","301","        textRenderer.render(EOL_STR, sb, \"Text\");","305","                             final String prefix, final TextRenderer textRenderer, final String suffix) {","310","        textRenderer.render(EOL_STR, sb, \"Text\");","337","     *  @param sb             StringBuilder to contain the formatted Throwable.","338","     * @param cause          The Throwable to format.","339","     * @param ignorePackages The List of packages to be suppressed from the trace.","340","     * @param textRenderer   The text render","341","     * @param suffix","345","                              final TextRenderer textRenderer, final String suffix) {","348","            this.formatWrapper(sb, cause.causeProxy, ignorePackages, textRenderer, suffix);","354","        textRenderer.render(EOL_STR, sb, \"Text\");","356","            cause.getThrowable().getStackTrace(), cause.extendedStackTrace, ignorePackages, textRenderer, suffix);","370","        return this.getCauseStackTraceAsString(null, PlainTextRenderer.getInstance(), suffix);","377","     * @param suffix","381","        return getCauseStackTraceAsString(packages, PlainTextRenderer.getInstance(), suffix);","388","     * @param textRenderer   the text renderer","389","     * @param suffix","395","            this.formatWrapper(sb, this.causeProxy, ignorePackages, textRenderer, suffix);","401","        textRenderer.render(EOL_STR, sb, \"Text\");","403","            ignorePackages, textRenderer, suffix);","427","     * Format the stack trace including packaging information.","430","     * @param suffix","433","        return this.getExtendedStackTraceAsString(null, PlainTextRenderer.getInstance(), \"\");","437","     * Format the stack trace including packaging information.","440","     * @param suffix","443","        return this.getExtendedStackTraceAsString(null, PlainTextRenderer.getInstance(), suffix);","447","     * Format the stack trace including packaging information.","450","     * @param suffix","454","        return getExtendedStackTraceAsString(ignorePackages, PlainTextRenderer.getInstance(), suffix);","458","     * Format the stack trace including packaging information.","461","     * @param textRenderer   The message renderer","462","     * @param suffix","471","        textRenderer.render(EOL_STR, sb, \"Text\");","473","        this.formatElements(sb, Strings.EMPTY, 0, causedTrace, this.extendedStackTrace, ignorePackages, textRenderer, suffix);","474","        this.formatSuppressed(sb, TAB, this.suppressedProxies, ignorePackages, textRenderer, suffix);","475","        this.formatCause(sb, Strings.EMPTY, this.causeProxy, ignorePackages, textRenderer, suffix);","510","     * Format the suppressed Throwables."]}]}},"9d3f8364161cdbdea6ee41ba810b505c4a217b1a":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <!-- FIXES -->","60","      <action issue=\"LOG4J2-3040\" dev=\"ggregory\" type=\"fix\" due-to=\"LF-Lin\">","61","        Avoid ClassCastException in JeroMqManager with custom LoggerContextFactory #791","62","      <\/action>"],"delete":[]}]}},"4b8ca689b18d8e6c4b486572b0a129bce6c1724a":{"changes":{".travis.yml":"MODIFY",".travis-toolchains.xml":"ADD"},"diff":{".travis.yml":[{"add":["13","# sudo enabled because sudo vms have more memory: https:\/\/docs.travis-ci.com\/user\/ci-environment\/","14","sudo: true","19","env:","20","  global:","21","    JAVA_OPTS=-Xmx4g","22","","23","addons:","24","  apt:","25","    packages:","26","      - oracle-java9-installer","27","","28","install:","29","  - .\/mvnw --toolchains=.\/.travis-toolchains.xml install -DskipTests=true -Dmaven.javadoc.skip=true -B -V","30","","31","script:","32","  - .\/mvnw --toolchains=.\/.travis-toolchains.xml test -B","33","","35","  - .\/mvnw --show-version -pl !log4j-bom jacoco:prepare-agent test jacoco:report coveralls:report"],"delete":["13","sudo: false","19","  - mvn --show-version -pl !log4j-bom jacoco:prepare-agent test jacoco:report coveralls:report"]}],".travis-toolchains.xml":[{"add":[],"delete":[]}]}},"f9b0bbeed839f447fc0602fdee5a009315ebfcbb":{"changes":{"\/dev\/null":"DELETE","log4j-jul\/src\/main\/java\/org\/apache\/logging\/log4j\/jul\/DefaultLevelConverter.java":"MODIFY","log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/Log4jLevelTranslatorTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/JavaLevelTranslatorTest.java":"ADD"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"log4j-jul\/src\/main\/java\/org\/apache\/logging\/log4j\/jul\/DefaultLevelConverter.java":[{"add":["34","        new IdentityHashMap<Level, java.util.logging.Level>(10);","54","        LOG4J_TO_JDK.put(Level.FATAL, java.util.logging.Level.SEVERE);"],"delete":["34","        new IdentityHashMap<Level, java.util.logging.Level>(9);"]}],"log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/Log4jLevelTranslatorTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-892\" dev=\"ggregory\" type=\"fix\">","27","        JUL adapter does not map Log4j'2 FATAL level to JUL level.","28","      <\/action>"],"delete":[]}],"log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/JavaLevelTranslatorTest.java":[{"add":[],"delete":[]}]}},"3cfd7b14d6dc0354ebab81f0cd20f22472f07a49":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":["1149","        if (isEnabled(Level.ERROR, marker, msg, t)) {","1150","            log(marker, FQCN, Level.ERROR, msg, t);"],"delete":["1149","        if (isEnabled(Level.TRACE, marker, msg, t)) {","1150","            log(marker, FQCN, Level.TRACE, msg, t);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-74\" dev=\"rgoers\" type=\"fix\">","26","        Logger.error(Marker, Message, Throwable) was internally using Level.TRACE.","27","      <\/action>"],"delete":[]}]}},"ab1cfb2750f283d81383b069ab73d9acab31b7b7":{"changes":{"jcl-bridge\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/LogFactoryImpl.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"jcl-bridge\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/LogFactoryImpl.java":[{"add":["98","        if (value != null) {","99","            attributes.put(name, value);","100","        } else {","101","            removeAttribute(name);","102","        }"],"delete":["98","        attributes.put(name, value);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-78\" dev=\"rgoers\" type=\"fix\">","26","        LogFactoryImpl.setAttribute in the Commons Logging bridge got a NullPointerException when passed a null value.","27","        It will now remove the attribute.","28","      <\/action>"],"delete":[]}]}},"d8af1c93dd1006da01d0a45ccefe417ab3e56a5f":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-94\" dev=\"rgoers\" type=\"fix\" due-to=\"Denis Treskunov\">","26","        Interpolator was not stripping Lookup key separator when trying to locate the default value for a variable.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["109","            var = var.substring(prefixPos + 1);"],"delete":["109","            var = var.substring(prefixPos);"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":[{"add":["63","        ThreadContext.clear();","64","        value = lookup.lookup(\"ctx:\" + TESTKEY);","65","        assertEquals(TESTVAL, value);"],"delete":[]}]}},"3bd53c14f53c8178320a95fd27be8eac05081257":{"changes":{"src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["2029","    <td><a name=\"configurationAuthorizationProvider\"\/>log4j2.Configuration.authorizationProvider","2031","      (<a name=\"log4j.configurationAuthorizationProvider\"\/>log4j.configurationAuthorizationProvider","2033","    <td>LOG4J_CONFIGURATION_AUTHORIZATION_PROVIDER<\/td>","2034","    <td>org.apache.logging.log4j.core.util.BasicAuthorizationProvider<\/td>","2036","      The fully qualified class name of the AuthorizationProvider."],"delete":["2029","    <td><a name=\"configurationAuthenticationProvider\"\/>log4j2.Configuration.authenticationProvider","2031","      (<a name=\"log4j.configurationAuthenticationProvider\"\/>log4j.configurationAuthenticationProvider","2033","    <td>LOG4J_CONFIGURATION_ALLOWED_PROTOCOLS<\/td>","2034","    <td>&nbsp;<\/td>","2036","      A comma separated list of the protocols that may be used to load a configuration file. The default is https.","2037","      To completely prevent accessing the configuration via a URL specify a value of \"_none\"."]}]}},"d3989b40f92cdf2a7a0bc8a8d4d883386a640ebb":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["37","      <action issue=\"LOG4J2-834\" dev=\"ggregory\" type=\"fix\" due-to=\"Nikita Koval, Leonard Broman, Thiago Kronig\">","38","        ThrowableProxy throws NoClassDefFoundError."],"delete":["37","      <action issue=\"LOG4J2-834\" dev=\"ggregory\" type=\"fix\">","38","        NoClassDefFoundError in ThrowableProxy."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["453","            return initializeClass(className);","454","        } catch (final NoClassDefFoundError ignored) {","455","            return initializeClass(className);","460","    private Class<?> initializeClass(final String className) {","461","        try {","462","            return Loader.initializeClass(className, this.getClass().getClassLoader());","463","        } catch (final ClassNotFoundException ignore) {","464","            return null;","465","        } catch (final NoClassDefFoundError ignore) {","466","            return null;","467","        }","468","    }","469",""],"delete":["453","            try {","454","                clazz = Loader.initializeClass(className, this.getClass().getClassLoader());","455","            } catch (final ClassNotFoundException ignore) {","456","                return null;","457","            }"]}]}},"ae7f28079cf570ccd371bf49b7ed4c858b540889":{"changes":{"log4j12-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j12-api\/src\/test\/java\/org\/apache\/log4j\/LoggerTest.java":"MODIFY"},"diff":{"log4j12-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["23","import org.apache.logging.log4j.message.ParameterizedMessage;","24","import org.apache.logging.log4j.message.SimpleMessage;","305","    public void log(Priority priority, Object message, Throwable t) {","306","        if (isEnabledFor(priority)) {","307","            Message msg = new ObjectMessage(message);","308","            forcedLog(FQCN, priority, msg, t);","309","        }","310","    }","311","","312","    public void log(Priority priority, Object message) {","313","        if (isEnabledFor(priority)) {","314","            Message msg = new ObjectMessage(message);","315","            forcedLog(FQCN, priority, msg, null);","316","        }","317","    }","318","","319","    public void log(String fqcn, Priority priority, Object message, Throwable t) {","320","        if (isEnabledFor(priority)) {","321","            Message msg = new ObjectMessage(message);","322","            forcedLog(fqcn, priority, msg, t);","323","        }","324","    }","325",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-91\" dev=\"rgoers\" type=\"fix\">","26","        Log4j 1.2 adapter's Category class was missing 3 log methods.","27","      <\/action>"],"delete":[]}],"log4j12-api\/src\/test\/java\/org\/apache\/log4j\/LoggerTest.java":[{"add":["28","import org.apache.logging.log4j.core.layout.PatternLayout;","437","    @Test","438","    public void testLog() {","439","        PatternLayout layout = PatternLayout.createLayout(\"%d %C %L %m\", null, null, null);","440","        ListAppender appender = new ListAppender(\"List\", null, layout, false, false);","441","        Logger root = Logger.getRootLogger();","442","        root.getLogger().addAppender(appender);","443","        root.setLevel(Level.INFO);","444","        MyLogger log = new MyLogger(root);","445","        log.logInfo(\"This is a test\", null);","446","        root.log(Priority.INFO, \"Test msg2\", null);","447","        root.log(Priority.INFO, \"Test msg3\");","448","        List<String> msgs = appender.getMessages();","449","        assertTrue(\"Incorrect number of messages\", msgs.size() == 3);","450","        String msg = msgs.get(0);","451","        assertTrue(\"Message contains incorrect class name: \" + msg, msg.contains(LoggerTest.class.getName()));","452","    }","453","","454","    private static class MyLogger {","455","","456","        private Logger logger;","457","","458","        public MyLogger(Logger logger) {","459","            this.logger = logger;","460","        }","461","","462","        public void logInfo(String msg, Throwable t) {","463","            logger.log(MyLogger.class.getName(), Priority.INFO, msg, t);","464","        }","465","    }","466",""],"delete":[]}]}},"03f4db6e2af50cae093d5b2541d49cf957027e3c":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/src\/test\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentAppenderTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":[{"add":["383","            final String sdId = getId(id);","385","            if (sdElements.containsKey(sdId)) {","388","                sdElements.put(sdId, union);","391","                sdElements.put(sdId, formattedData);"],"delete":["384","            if (sdElements.containsKey(id.toString())) {","387","                sdElements.put(id.toString(), union);","390","                sdElements.put(id.toString(), formattedData);"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-404\" dev=\"rgoers\" type=\"fix\" due-to=\"Kamal Bahadur\">","24","        @EnterpriseNumber\" was missing in the ID of structured data when RFC5424Layout is used","25","      <\/action>"],"delete":[]}],"log4j-flume-ng\/src\/test\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentAppenderTest.java":[{"add":["277","    ","278","    @Test","279","    public void testRFC5424Layout() throws InterruptedException, IOException {","280","","281","        final StructuredDataMessage msg = new StructuredDataMessage(\"Test\", \"Test Log4j\", \"Test\");","282","        EventLogger.logEvent(msg);","283","","284","        final Event event = primary.poll();","285","        Assert.assertNotNull(event);","286","        final String body = getBody(event);","287","        Assert.assertTrue(\"Structured message does not contain @EID: \" + body,","288","            body.contains(\"Test@18060\"));","289","    }"],"delete":[]}]}},"cb5b0415f3d4110c7b349e276924d47a34bb8f3f":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["34","      <action issue=\"LOG4J2-919\" dev=\"ggregory\" type=\"fix\" due-to=\"David Johle\">","35","        Logging system fails to initialize if XInclude API is not available.","36","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["101","        } catch (final NoSuchMethodError err) {","102","            \/\/ LOG4J2-919","103","            LOGGER.warn(\"The DocumentBuilderFactory [{}] is out of date and does not support XInclude: {}\", factory, err);"],"delete":[]}]}},"c27136aad09ae0bf3c46605b6e9508056a06c5a3":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/ScriptPatternSelector.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/ScriptPatternSelector.java":[{"add":["122","            return null;"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["164","      <action issue=\"LOG4J2-1601\" dev=\"ggregory\" type=\"fix\">","165","        NPE due to org.apache.logging.log4j.core.layout.ScriptPatternSelector.createSelector(AbstractScript, PatternMatch[], String, boolean, boolean, Configuration).","166","      <\/action>"],"delete":[]}]}},"411dad656d78f3c35015eee6d7518a88db8ddcec":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["18","import static org.junit.Assert.assertArrayEquals;","19","import static org.junit.Assert.assertEquals;","20","import static org.junit.Assert.assertNotNull;","21","import static org.junit.Assert.fail;","22","","34","import org.apache.logging.log4j.LogManager;","35","import org.apache.logging.log4j.Logger;","47","    public static class AlwaysThrowsError {","48","        static {","49","            if (true) {","50","                throw new Error(\"I always throw an Error when initialized\");","51","            }","52","        }","53","    }","54","","60","    private ThrowableProxy deserialize(final byte[] binary) throws IOException, ClassNotFoundException {","61","        final ByteArrayInputStream inArr = new ByteArrayInputStream(binary);","62","        final ObjectInputStream in = new ObjectInputStream(inArr);","63","        return (ThrowableProxy) in.readObject();","64","    }","65","","66","    private byte[] serialize(final ThrowableProxy proxy) throws IOException {","67","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","68","        final ObjectOutputStream out = new ObjectOutputStream(arr);","69","        out.writeObject(proxy);","70","        return arr.toByteArray();","71","    }","72","","87","    \/**","88","     * Attempts to instantiate a class that cannot initialize and then logs the stack trace of the Error. The logger","89","     * must not fail when using {@link ThrowableProxy} to inspect the frames of the stack trace.","90","     *\/","92","    public void testLogStackTraceWithClassThatCannotInitialize() {","93","        try {","94","            \/\/ Try to create the object, which will always fail during class initialization","95","            AlwaysThrowsError error = new AlwaysThrowsError();","96","","97","            \/\/ If the error was not triggered then fail","98","            fail(\"Test did not throw expected error: \" + error);","99","        } catch (final Throwable e) {","100","            \/\/ Print the stack trace to System.out for informational purposes","101","            \/\/ System.err.println(\"### Here's the stack trace that we'll log with log4j ###\");","102","            \/\/ e.printStackTrace();","103","            \/\/ System.err.println(\"### End stack trace ###\");","104","","105","            final Logger logger = LogManager.getLogger(getClass());","106","","107","            \/\/ This is the critical portion of the test. The log message must be printed without","108","            \/\/ throwing a java.lang.Error when introspecting the AlwaysThrowError class in the","109","            \/\/ stack trace.","110","            logger.error(e.getMessage(), e);","111","            logger.error(e);","112","        }","115","    \/\/ DO NOT REMOVE THIS COMMENT:","116","    \/\/ UNCOMMENT WHEN GENERATING SERIALIZED THROWABLEPROXY FOR #testSerializationWithUnknownThrowable","117","    \/\/ public static class DeletedException extends Exception {","118","    \/\/ private static final long serialVersionUID = 1L;","119","    \/\/","120","    \/\/ public DeletedException(String msg) {","121","    \/\/ super(msg);","122","    \/\/ }","123","    \/\/ };","124","","142","","151","        final String base64 = \"rO0ABXNyADFvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJsZVByb3h52cww1Zp7rPoCAAdJABJjb21tb25FbGVtZW50Q291bnRMAApjYXVzZVByb3h5dAAzTG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL2ltcGwvVGhyb3dhYmxlUHJveHk7WwASZXh0ZW5kZWRTdGFja1RyYWNldAA\/W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnQ7TAAQbG9jYWxpemVkTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAB21lc3NhZ2VxAH4AA0wABG5hbWVxAH4AA1sAEXN1cHByZXNzZWRQcm94aWVzdAA0W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL1Rocm93YWJsZVByb3h5O3hwAAAAAHB1cgA\/W0xvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnQ7ys+II6XHz7wCAAB4cAAAABhzcgA8b3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1wbC5FeHRlbmRlZFN0YWNrVHJhY2VFbGVtZW504d7Pusa2kAcCAAJMAA5leHRyYUNsYXNzSW5mb3QANkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkQ2xhc3NJbmZvO0wAEXN0YWNrVHJhY2VFbGVtZW50dAAdTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDt4cHNyADRvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkQ2xhc3NJbmZvAAAAAAAAAAECAANaAAVleGFjdEwACGxvY2F0aW9ucQB+AANMAAd2ZXJzaW9ucQB+AAN4cAF0AA10ZXN0LWNsYXNzZXMvdAABP3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgADTAAIZmlsZU5hbWVxAH4AA0wACm1ldGhvZE5hbWVxAH4AA3hwAAAAaHQANW9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuVGhyb3dhYmxlUHJveHlUZXN0dAAXVGhyb3dhYmxlUHJveHlUZXN0LmphdmF0ACV0ZXN0U2VyaWFsaXphdGlvbldpdGhVbmtub3duVGhyb3dhYmxlc3EAfgAIc3EAfgAMAHEAfgAPdAAIMS43LjBfNTVzcQB+ABD\/\/\/\/+dAAkc3VuLnJlZmxlY3QuTmF0aXZlTWV0aG9kQWNjZXNzb3JJbXBscHQAB2ludm9rZTBzcQB+AAhzcQB+AAwAcQB+AA9xAH4AF3NxAH4AEP\/\/\/\/9xAH4AGXB0AAZpbnZva2VzcQB+AAhzcQB+AAwAcQB+AA9xAH4AF3NxAH4AEP\/\/\/\/90AChzdW4ucmVmbGVjdC5EZWxlZ2F0aW5nTWV0aG9kQWNjZXNzb3JJbXBscHEAfgAec3EAfgAIc3EAfgAMAHEAfgAPcQB+ABdzcQB+ABD\/\/\/\/\/dAAYamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kcHEAfgAec3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAvdAApb3JnLmp1bml0LnJ1bm5lcnMubW9kZWwuRnJhbWV3b3JrTWV0aG9kJDF0ABRGcmFtZXdvcmtNZXRob2QuamF2YXQAEXJ1blJlZmxlY3RpdmVDYWxsc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAMdAAzb3JnLmp1bml0LmludGVybmFsLnJ1bm5lcnMubW9kZWwuUmVmbGVjdGl2ZUNhbGxhYmxldAAXUmVmbGVjdGl2ZUNhbGxhYmxlLmphdmF0AANydW5zcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAACx0ACdvcmcuanVuaXQucnVubmVycy5tb2RlbC5GcmFtZXdvcmtNZXRob2RxAH4ALHQAEWludm9rZUV4cGxvc2l2ZWx5c3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAARdAAyb3JnLmp1bml0LmludGVybmFsLnJ1bm5lcnMuc3RhdGVtZW50cy5JbnZva2VNZXRob2R0ABFJbnZva2VNZXRob2QuamF2YXQACGV2YWx1YXRlc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAEPdAAeb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVydAARUGFyZW50UnVubmVyLmphdmF0AAdydW5MZWFmc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAABGdAAob3JnLmp1bml0LnJ1bm5lcnMuQmxvY2tKVW5pdDRDbGFzc1J1bm5lcnQAG0Jsb2NrSlVuaXQ0Q2xhc3NSdW5uZXIuamF2YXQACHJ1bkNoaWxkc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAycQB+AE1xAH4ATnEAfgBPc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAADudAAgb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVyJDNxAH4AR3EAfgA0c3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAA\/dAAgb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVyJDFxAH4AR3QACHNjaGVkdWxlc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAADscQB+AEZxAH4AR3QAC3J1bkNoaWxkcmVuc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAA1cQB+AEZxAH4AR3QACmFjY2VzcyQwMDBzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAOV0ACBvcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5uZXIkMnEAfgBHcQB+AEFzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAATVxAH4ARnEAfgBHcQB+ADRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAAAMnQAOm9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5qdW5pdDQucnVubmVyLkpVbml0NFRlc3RSZWZlcmVuY2V0ABhKVW5pdDRUZXN0UmVmZXJlbmNlLmphdmFxAH4ANHNxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAAAAAmdAAzb3JnLmVjbGlwc2UuamR0LmludGVybmFsLmp1bml0LnJ1bm5lci5UZXN0RXhlY3V0aW9udAASVGVzdEV4ZWN1dGlvbi5qYXZhcQB+ADRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAAB03QANm9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5qdW5pdC5ydW5uZXIuUmVtb3RlVGVzdFJ1bm5lcnQAFVJlbW90ZVRlc3RSdW5uZXIuamF2YXQACHJ1blRlc3Rzc3EAfgAIc3EAfgAMAXQABC5jcC9xAH4AD3NxAH4AEAAAAqtxAH4AgnEAfgCDcQB+AIRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAABhnEAfgCCcQB+AINxAH4ANHNxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAAAADFcQB+AIJxAH4Ag3QABG1haW50ABZPTUcgSSd2ZSBiZWVuIGRlbGV0ZWQhcQB+AJJ0AEZvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJsZVByb3h5VGVzdCREZWxldGVkRXhjZXB0aW9udXIANFtMb3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1wbC5UaHJvd2FibGVQcm94eTv67QHghaLrOQIAAHhwAAAAAA==\";","160","    @Test","161","    public void testStack() {","162","        final Map<String, ThrowableProxy.CacheEntry> map = new HashMap<String, ThrowableProxy.CacheEntry>();","163","        final Stack<Class<?>> stack = new Stack<Class<?>>();","164","        final Throwable throwable = new IllegalStateException(\"This is a test\");","165","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","166","        final ExtendedStackTraceElement[] callerPackageData = proxy.toExtendedStackTrace(stack, map, null,","167","                throwable.getStackTrace());","168","        assertNotNull(\"No package data returned\", callerPackageData);"],"delete":["35","import static org.junit.Assert.*;","36","","62","    public void testStack() {","63","        final Map<String, ThrowableProxy.CacheEntry> map = new HashMap<String, ThrowableProxy.CacheEntry>();","64","        final Stack<Class<?>> stack = new Stack<Class<?>>();","65","        final Throwable throwable = new IllegalStateException(\"This is a test\");","66","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","67","        final ExtendedStackTraceElement[] callerPackageData = proxy.toExtendedStackTrace(stack, map, null,","68","                throwable.getStackTrace());","69","        assertNotNull(\"No package data returned\", callerPackageData);","85","    \/\/ DO NOT REMOVE THIS COMMENT:","86","    \/\/ UNCOMMENT WHEN GENERATING SERIALIZED THROWABLEPROXY FOR #testSerializationWithUnknownThrowable","87","    \/\/ public static class DeletedException extends Exception {","88","    \/\/ private static final long serialVersionUID = 1L;","89","    \/\/","90","    \/\/ public DeletedException(String msg) {","91","    \/\/ super(msg);","92","    \/\/ }","93","    \/\/ };","94","","99","        ","108","         final String base64 = \"rO0ABXNyADFvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJsZVByb3h52cww1Zp7rPoCAAdJABJjb21tb25FbGVtZW50Q291bnRMAApjYXVzZVByb3h5dAAzTG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL2ltcGwvVGhyb3dhYmxlUHJveHk7WwASZXh0ZW5kZWRTdGFja1RyYWNldAA\/W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnQ7TAAQbG9jYWxpemVkTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAB21lc3NhZ2VxAH4AA0wABG5hbWVxAH4AA1sAEXN1cHByZXNzZWRQcm94aWVzdAA0W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL1Rocm93YWJsZVByb3h5O3hwAAAAAHB1cgA\/W0xvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnQ7ys+II6XHz7wCAAB4cAAAABhzcgA8b3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1wbC5FeHRlbmRlZFN0YWNrVHJhY2VFbGVtZW504d7Pusa2kAcCAAJMAA5leHRyYUNsYXNzSW5mb3QANkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkQ2xhc3NJbmZvO0wAEXN0YWNrVHJhY2VFbGVtZW50dAAdTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDt4cHNyADRvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkQ2xhc3NJbmZvAAAAAAAAAAECAANaAAVleGFjdEwACGxvY2F0aW9ucQB+AANMAAd2ZXJzaW9ucQB+AAN4cAF0AA10ZXN0LWNsYXNzZXMvdAABP3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgADTAAIZmlsZU5hbWVxAH4AA0wACm1ldGhvZE5hbWVxAH4AA3hwAAAAaHQANW9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuVGhyb3dhYmxlUHJveHlUZXN0dAAXVGhyb3dhYmxlUHJveHlUZXN0LmphdmF0ACV0ZXN0U2VyaWFsaXphdGlvbldpdGhVbmtub3duVGhyb3dhYmxlc3EAfgAIc3EAfgAMAHEAfgAPdAAIMS43LjBfNTVzcQB+ABD\/\/\/\/+dAAkc3VuLnJlZmxlY3QuTmF0aXZlTWV0aG9kQWNjZXNzb3JJbXBscHQAB2ludm9rZTBzcQB+AAhzcQB+AAwAcQB+AA9xAH4AF3NxAH4AEP\/\/\/\/9xAH4AGXB0AAZpbnZva2VzcQB+AAhzcQB+AAwAcQB+AA9xAH4AF3NxAH4AEP\/\/\/\/90AChzdW4ucmVmbGVjdC5EZWxlZ2F0aW5nTWV0aG9kQWNjZXNzb3JJbXBscHEAfgAec3EAfgAIc3EAfgAMAHEAfgAPcQB+ABdzcQB+ABD\/\/\/\/\/dAAYamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kcHEAfgAec3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAvdAApb3JnLmp1bml0LnJ1bm5lcnMubW9kZWwuRnJhbWV3b3JrTWV0aG9kJDF0ABRGcmFtZXdvcmtNZXRob2QuamF2YXQAEXJ1blJlZmxlY3RpdmVDYWxsc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAMdAAzb3JnLmp1bml0LmludGVybmFsLnJ1bm5lcnMubW9kZWwuUmVmbGVjdGl2ZUNhbGxhYmxldAAXUmVmbGVjdGl2ZUNhbGxhYmxlLmphdmF0AANydW5zcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAACx0ACdvcmcuanVuaXQucnVubmVycy5tb2RlbC5GcmFtZXdvcmtNZXRob2RxAH4ALHQAEWludm9rZUV4cGxvc2l2ZWx5c3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAARdAAyb3JnLmp1bml0LmludGVybmFsLnJ1bm5lcnMuc3RhdGVtZW50cy5JbnZva2VNZXRob2R0ABFJbnZva2VNZXRob2QuamF2YXQACGV2YWx1YXRlc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAEPdAAeb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVydAARUGFyZW50UnVubmVyLmphdmF0AAdydW5MZWFmc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAABGdAAob3JnLmp1bml0LnJ1bm5lcnMuQmxvY2tKVW5pdDRDbGFzc1J1bm5lcnQAG0Jsb2NrSlVuaXQ0Q2xhc3NSdW5uZXIuamF2YXQACHJ1bkNoaWxkc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAAycQB+AE1xAH4ATnEAfgBPc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAADudAAgb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVyJDNxAH4AR3EAfgA0c3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAA\/dAAgb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVyJDFxAH4AR3QACHNjaGVkdWxlc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAADscQB+AEZxAH4AR3QAC3J1bkNoaWxkcmVuc3EAfgAIc3EAfgAMAXQADmp1bml0LTQuMTEuamFycQB+AA9zcQB+ABAAAAA1cQB+AEZxAH4AR3QACmFjY2VzcyQwMDBzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAOV0ACBvcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5uZXIkMnEAfgBHcQB+AEFzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAATVxAH4ARnEAfgBHcQB+ADRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAAAMnQAOm9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5qdW5pdDQucnVubmVyLkpVbml0NFRlc3RSZWZlcmVuY2V0ABhKVW5pdDRUZXN0UmVmZXJlbmNlLmphdmFxAH4ANHNxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAAAAAmdAAzb3JnLmVjbGlwc2UuamR0LmludGVybmFsLmp1bml0LnJ1bm5lci5UZXN0RXhlY3V0aW9udAASVGVzdEV4ZWN1dGlvbi5qYXZhcQB+ADRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAAB03QANm9yZy5lY2xpcHNlLmpkdC5pbnRlcm5hbC5qdW5pdC5ydW5uZXIuUmVtb3RlVGVzdFJ1bm5lcnQAFVJlbW90ZVRlc3RSdW5uZXIuamF2YXQACHJ1blRlc3Rzc3EAfgAIc3EAfgAMAXQABC5jcC9xAH4AD3NxAH4AEAAAAqtxAH4AgnEAfgCDcQB+AIRzcQB+AAhzcQB+AAwBdAAELmNwL3EAfgAPc3EAfgAQAAABhnEAfgCCcQB+AINxAH4ANHNxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAAAADFcQB+AIJxAH4Ag3QABG1haW50ABZPTUcgSSd2ZSBiZWVuIGRlbGV0ZWQhcQB+AJJ0AEZvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJsZVByb3h5VGVzdCREZWxldGVkRXhjZXB0aW9udXIANFtMb3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1wbC5UaHJvd2FibGVQcm94eTv67QHghaLrOQIAAHhwAAAAAA==\";","117","    private byte[] serialize(final ThrowableProxy proxy) throws IOException {","118","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","119","        final ObjectOutputStream out = new ObjectOutputStream(arr);","120","        out.writeObject(proxy);","121","        return arr.toByteArray();","122","    }","123","","124","    private ThrowableProxy deserialize(final byte[] binary) throws IOException, ClassNotFoundException {","125","        final ByteArrayInputStream inArr = new ByteArrayInputStream(binary);","126","        final ObjectInputStream in = new ObjectInputStream(inArr);","127","        return (ThrowableProxy) in.readObject();"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-832\" dev=\"ggregory\" type=\"fix\" due-to=\"Seth Leger\">","27","        ThrowableProxy fails if a class in logged stack trace throws java.lang.Error from initializer","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["502","            } catch (final Throwable ignore) {"],"delete":["502","            } catch (final Exception ignore) {"]}]}},"9e56581ec11df9ec0e6f1887cd01cfe9099347c4":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseAppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLConnection.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JDBCDatabaseManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManagerTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLDatabaseManagerTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLDatabaseManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLProvider.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JPADatabaseManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManager.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseAppenderTest.java":[{"add":["128","        this.manager.connectAndStart();","129","        expectLastCall();","132","        this.manager.commitAndClose();","133","        expectLastCall();","140","        this.manager.connectAndStart();","141","        expectLastCall();","144","        this.manager.commitAndClose();","145","        expectLastCall();"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLConnection.java":[{"add":["57","     * HTTP web service), in which case this method would be a no-op. This method should also commit any open","58","     * transactions, if applicable and if not already committed.<br \/>","59","     * <br \/>","60","     * If this connection is part of a connection pool, executing this method should commit the transaction and return","61","     * the connection to the pool, but it should not actually close the underlying connection."],"delete":["57","     * HTTP web service), in which case this method would be a no-op."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JDBCDatabaseManager.java":[{"add":["55","    protected void startupInternal() {","56","        \/\/ nothing to see here","60","    protected void shutdownInternal() {","61","        if (this.connection != null || this.statement != null) {","62","            this.commitAndClose();","63","        }","64","    }","65","","66","    @Override","67","    protected void connectAndStart() {","69","            this.connection = this.connectionSource.getConnection();","70","            this.connection.setAutoCommit(false);","71","            this.statement = this.connection.prepareStatement(this.sqlStatement);","72","        } catch (SQLException e) {","73","            throw new AppenderLoggingException(","74","                    \"Cannot write logging event or flush buffer; JDBC manager cannot connect to the database.\", e","75","            );","83","            if (!this.isRunning() || this.connection == null || this.connection.isClosed() || this.statement == null","84","                    || this.statement.isClosed()) {","123","    @Override","124","    protected void commitAndClose() {","125","        try {","126","            if (this.connection != null && !this.connection.isClosed()) {","127","                this.connection.commit();","128","            }","129","        } catch (SQLException e) {","130","            throw new AppenderLoggingException(\"Failed to commit transaction logging event or flushing buffer.\", e);","131","        } finally {","132","            try {","133","                if (this.statement != null) {","134","                    this.statement.close();","135","                }","136","            } catch (Exception e) {","137","                LOGGER.warn(\"Failed to close SQL statement logging event or flushing buffer.\", e);","138","            } finally {","139","                this.statement = null;","140","            }","141","","142","            try {","143","                if (this.connection != null) {","144","                    this.connection.close();","145","                }","146","            } catch (Exception e) {","147","                LOGGER.warn(\"Failed to close database connection logging event or flushing buffer.\", e);","148","            } finally {","149","                this.connection = null;","150","            }","151","        }","152","    }","153",""],"delete":["55","    protected void startupInternal() throws SQLException {","56","        this.connection = this.connectionSource.getConnection();","57","        this.statement = this.connection.prepareStatement(this.sqlStatement);","61","    protected void shutdownInternal() throws SQLException {","63","            Closer.close(this.statement);","64","        } finally {","65","            Closer.close(this.connection);","73","            if (!this.isRunning() || this.connection == null || this.connection.isClosed()) {"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManagerTest.java":[{"add":["129","        verify(this.manager);","130","        reset(this.manager);","131","        this.manager.connectAndStart();","132","        expectLastCall();","133","        this.manager.writeInternal(same(event1));","134","        expectLastCall();","135","        this.manager.commitAndClose();","136","        expectLastCall();","137","        replay(this.manager);","138","","143","        this.manager.connectAndStart();","144","        expectLastCall();","147","        this.manager.commitAndClose();","148","        expectLastCall();","155","        this.manager.connectAndStart();","156","        expectLastCall();","159","        this.manager.commitAndClose();","160","        expectLastCall();","187","        this.manager.connectAndStart();","188","        expectLastCall();","197","        this.manager.commitAndClose();","198","        expectLastCall();","224","        this.manager.connectAndStart();","225","        expectLastCall();","232","        this.manager.commitAndClose();","233","        expectLastCall();","259","        this.manager.connectAndStart();","260","        expectLastCall();","267","        this.manager.commitAndClose();","268","        expectLastCall();"],"delete":["125","        this.manager.writeInternal(same(event1));","126","        expectLastCall();"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-489\" dev=\"nickwilliams\" type=\"fix\">","24","        Fixed the JPAAppender's overuse of transactions by connecting (borrowing from pool) on new write internal or on","25","        flush.","26","      <\/action>","27","      <action issue=\"LOG4J2-457\" dev=\"nickwilliams\" type=\"fix\">","28","        Fixed failure of JDBC and JPA appender to properly release database connections by connecting (borrowing from","29","        pool) on new write internal or on flush.","30","      <\/action>","31","      <action issue=\"LOG4J2-442\" dev=\"nickwilliams\" type=\"fix\">","32","        Fixed problem with JDBC and JPA appender connectivity in WebSphere by connecting (borrowing from pool) on new","33","        write internal or on flush.","34","      <\/action>","35","      <action issue=\"LOG4J2-438\" dev=\"nickwilliams\" type=\"fix\">","36","        Ensured the JDBCAppender commits transactions after a single write or a flush of multiple writes.","37","      <\/action>","38","      <action issue=\"LOG4J2-407\" dev=\"nickwilliams\" type=\"fix\">","39","        Fixed inability to recover from lost database connection in database appenders by connecting (borrowing from","40","        pool) on new write internal or on flush.","41","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLDatabaseManagerTest.java":[{"add":["71","            manager.connectAndStart();","80","            manager.commitAndClose();","125","            replay(this.provider, this.connection);","126","","131","            expect(this.provider.getConnection()).andReturn(this.connection);","132","            replay(this.provider, this.connection);","133","","134","            manager.connectAndStart();","135","","136","            verify(this.provider, this.connection);","137","            reset(this.provider, this.connection);","170","            replay(this.provider, this.connection);","171","","176","            expect(this.provider.getConnection()).andReturn(this.connection);","177","            replay(this.provider, this.connection);","178","","179","            manager.connectAndStart();","180","","181","            verify(this.provider, this.connection);","182","            reset(this.provider, this.connection);","262","            replay(this.provider, this.connection);","263","","268","            expect(this.provider.getConnection()).andReturn(this.connection);","269","            replay(this.provider, this.connection);","270","","271","            manager.connectAndStart();","272","","273","            verify(this.provider, this.connection);","274","            reset(this.provider, this.connection);","402","            replay(this.provider, this.connection);","403","","408","            expect(this.provider.getConnection()).andReturn(this.connection);","409","            replay(this.provider, this.connection);","410","","411","            manager.connectAndStart();","412","","413","            verify(this.provider, this.connection);","414","            reset(this.provider, this.connection);"],"delete":["71","            manager.startupInternal();","80","            manager.shutdownInternal();","122","        expect(this.provider.getConnection()).andReturn(this.connection);","123","        replay(this.provider, this.connection);","124","","161","        expect(this.provider.getConnection()).andReturn(this.connection);","162","        replay(this.provider, this.connection);","163","","247","        expect(this.provider.getConnection()).andReturn(this.connection);","248","        replay(this.provider, this.connection);","249","","381","        expect(this.provider.getConnection()).andReturn(this.connection);","382","        replay(this.provider, this.connection);","383",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLDatabaseManager.java":[{"add":["47","        \/\/ nothing to see here","52","        if (this.connection != null) {","53","            this.commitAndClose();","54","        }","55","    }","56","","57","    @Override","58","    protected void connectAndStart() {","59","        try {","60","            this.connection = this.provider.getConnection();","61","        } catch (Exception e) {","62","            throw new AppenderLoggingException(\"Failed to get connection from NoSQL connection provider.\", e);","150","    @Override","151","    protected void commitAndClose() {","152","        try {","153","            if (this.connection != null && !this.connection.isClosed()) {","154","                this.connection.close();","155","            }","156","        } catch (Exception e) {","157","            throw new AppenderLoggingException(\"Failed to commit and close NoSQL connection in manager.\", e);","158","        }","159","    }","160",""],"delete":["47","        this.connection = this.provider.getConnection();","52","        if (this.connection != null && !this.connection.isClosed()) {","53","            this.connection.close();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/NoSQLProvider.java":[{"add":["28","     * inserting objects that may use a persistent connection or may use HTTP web service calls, etc.<br \/>","29","     * <br \/>","30","     * Where applicable, this method should return a connection from the connection pool as opposed to opening a","31","     * brand new connection every time."],"delete":["28","     * inserting objects that may use a persistent connection or may use HTTP web service calls, etc."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JPADatabaseManager.java":[{"add":["41","    private EntityManager entityManager;","42","    private EntityTransaction transaction;","43","","61","        if (this.entityManager != null || this.transaction != null) {","62","            this.commitAndClose();","63","        }","70","    protected void connectAndStart() {","71","        try {","72","            this.entityManager = this.entityManagerFactory.createEntityManager();","73","            this.transaction = this.entityManager.getTransaction();","74","            this.transaction.begin();","75","        } catch (Exception e) {","76","            throw new AppenderLoggingException(","77","                    \"Cannot write logging event or flush buffer; manager cannot create EntityManager or transaction.\", e","78","            );","79","        }","80","    }","81","","82","    @Override","84","        if (!this.isRunning() || this.entityManagerFactory == null || this.entityManager == null","85","                || this.transaction == null) {","98","            this.entityManager.persist(entity);","100","            if (this.transaction != null && this.transaction.isActive()) {","101","                this.transaction.rollback();","102","                this.transaction = null;","104","            throw new AppenderLoggingException(\"Failed to insert record for log event in JPA manager: \" +","106","        }","107","    }","108","","109","    @Override","110","    protected void commitAndClose() {","111","        try {","112","            if (this.transaction != null && this.transaction.isActive()) {","113","                this.transaction.commit();","114","            }","115","        } catch (Exception e) {","116","            if (this.transaction != null && this.transaction.isActive()) {","117","                this.transaction.rollback();","118","            }","120","            this.transaction = null;","121","            try {","122","                if (this.entityManager != null && this.entityManager.isOpen()) {","123","                    this.entityManager.close();","124","                }","125","            } catch (Exception e) {","126","                LOGGER.warn(\"Failed to close entity manager while logging event or flushing buffer.\", e);","127","            } finally {","128","                this.entityManager = null;"],"delete":["65","        if (!this.isRunning() || this.entityManagerFactory == null) {","77","        EntityManager entityManager = null;","78","        EntityTransaction transaction = null;","80","            entityManager = this.entityManagerFactory.createEntityManager();","81","            transaction = entityManager.getTransaction();","82","            transaction.begin();","83","            entityManager.persist(entity);","84","            transaction.commit();","86","            if (transaction != null && transaction.isActive()) {","87","                transaction.rollback();","89","            throw new AppenderLoggingException(\"Failed to insert record for log event in JDBC manager: \" +","92","            if (entityManager != null && entityManager.isOpen()) {","93","                entityManager.close();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManager.java":[{"add":["108","     * Connects to the database and starts a transaction (if applicable). With buffering enabled, this is called when","109","     * flushing the buffer begins, before the first call to {@link #writeInternal}. With buffering disabled, this is","110","     * called immediately before every invocation of {@link #writeInternal}.","111","     *\/","112","    protected abstract void connectAndStart();","113","","114","    \/**","123","     * Commits any active transaction (if applicable) and disconnects from the database (returns the connection to the","124","     * connection pool). With buffering enabled, this is called when flushing the buffer completes, after the last call","125","     * to {@link #writeInternal}. With buffering disabled, this is called immediately after every invocation of","126","     * {@link #writeInternal}.","127","     *\/","128","    protected abstract void commitAndClose();","129","","130","    \/**","136","            this.connectAndStart();","140","            this.commitAndClose();","157","            this.connectAndStart();","159","            this.commitAndClose();"],"delete":[]}]}},"2bb59af2c1f20d89ae0fb00cb32b80d1bea80dea":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":[{"add":["372","        shutdownLock.lock();","373","        try {","374","            if (shutdown.compareAndSet(false, true)) {","375","                int retries = 0;","376","                while (counter.get() > 0) {","377","                    try {","378","                        noLogEvents.await(retries + 1, TimeUnit.SECONDS);","379","                    } catch (final InterruptedException ie) {","380","                        if (++retries > MAX_RETRIES) {","381","                            break;","382","                        }","386","        } finally {","387","            shutdownLock.unlock();"],"delete":["372","        if (shutdown.compareAndSet(false, true)) {","373","            int retries = 0;","374","            while (counter.get() > 0) {","375","                shutdownLock.lock();","376","                try {","377","                    noLogEvents.await(retries + 1, TimeUnit.SECONDS);","378","                } catch (final InterruptedException ie) {","379","                    if (++retries > MAX_RETRIES) {","380","                        break;","382","                } finally {","383","                    shutdownLock.unlock();"]}]}},"e6a36e85cf5f5fcab4f3d5fd71ab4acf265a024d":{"changes":{"src\/site\/markdown\/build.md":"MODIFY"},"diff":{"src\/site\/markdown\/build.md":[{"add":["68","Please see the [Log4j 2 Release Process](https:\/\/cwiki.apache.org\/confluence\/display\/LOGGING\/Log4j+2+Release+Process) wiki page."],"delete":["68","Please see the wiki [Log4j2ReleaseGuide](https:\/\/wiki.apache.org\/logging\/Log4j2ReleaseGuide)."]}]}},"df0b5a1d503aa297605ebc746693b39f4812dfc2":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["4465","        java.lang.System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"ServiceWindows\" : \"ServiceOther\";]]]]><![CDATA[>","4781","        java.lang.System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"MyCustomWindowsAppender\" : \"MySyslogAppender\";]]]]><![CDATA[>"],"delete":["4465","        importPackage(java.lang);","4466","        System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"ServiceWindows\" : \"ServiceOther\";]]]]><![CDATA[>","4782","        importPackage(java.lang);","4783","        System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"MyCustomWindowsAppender\" : \"MySyslogAppender\";]]]]><![CDATA[>"]}]}},"9e333461bfef962efa900cb36a1b54fd36742616":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/FileUtils.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/FileUtils.java":[{"add":["67","        final String charsetName = Charsets.UTF_8.name();"],"delete":["67","        String charsetName = Charsets.UTF_8.name();"]}]}},"6eb1d00e5106abd3b97dc1257380e91ca4b15580":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/LogManager.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/LogManager.java":[{"add":["38","    private static volatile LoggerContextFactory factory;","83","                                LOGGER.error(\"{} does not implement {}\", className, LoggerContextFactory.class.getName());","86","                            LOGGER.error(\"Unable to locate class {} specified in {}\", className,","89","                            LOGGER.error(\"Unable to create class {} specified in {}\", className,","92","                            LOGGER.error(\"Unable to create class {} specified in {}\", className,","127","    public static boolean exists(final String name) {","286","     * Returns the current LoggerContextFactory.","294","     * Sets the current LoggerContextFactory to use. Normally, the appropriate LoggerContextFactory is created at","295","     * startup, but in certain environments, a LoggerContextFactory implementation may not be available at this point.","296","     * Thus, an alternative LoggerContextFactory can be set at runtime.","297","     *","298","     * <p>","299","     * Note that any Logger or LoggerContext objects already created will still be valid, but they will no longer be","300","     * accessible through LogManager. Thus, <strong>it is a bad idea to use this method without a good reason<\/strong>!","301","     * Generally, this method should be used only during startup before any code starts caching Logger objects.","302","     * <\/p>","303","     *","304","     * @param factory the LoggerContextFactory to use.","305","     *\/","306","    \/\/ FIXME: should we allow only one update of the factory?","307","    public static void setFactory(final LoggerContextFactory factory) {","308","        LogManager.factory = factory;","309","    }","310","","311","    \/**"],"delete":["38","    private static LoggerContextFactory factory;","83","                                LOGGER.error(className + \" does not implement \" + LoggerContextFactory.class.getName());","86","                            LOGGER.error(\"Unable to locate class \" + className + \" specified in \" +","89","                            LOGGER.error(\"Unable to create class \" + className + \" specified in \" +","92","                            LOGGER.error(\"Unable to create class \" + className + \" specified in \" +","94","                            e.printStackTrace();","128","    public static boolean exists(String name) {","287","     * Returns the LoggerContextFactory."]}]}},"14f0bd06e64a1dd2c13b7deda7380fe9a2b7c755":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":[],"delete":["111","        strLookupMap.put(\"bundle\", new ResourceBundleLookup());","112","        strLookupMap.put(\"event\", new EventLookup());","113","        strLookupMap.put(\"sd\", new StructuredDataLookup());"]}],"src\/changes\/changes.xml":[{"add":[],"delete":["39","      <action issue=\"LOG4J2-3288\" dev=\"ckozak\" type=\"fix\">","40","        Interpolator non-plugin constructor registers all lookups from log4j-core, previously it was missing event, sd, and bundle.","41","      <\/action>"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":[{"add":[],"delete":["170","","171","    @Test","172","    public void testDefaultLookups() {","173","        Interpolator noPluginInterpolator = new Interpolator(Collections.emptyMap());","174","        Interpolator pluginBasedInterpolator = new Interpolator(null, Collections.emptyList());","175","        assertEquals(","176","                pluginBasedInterpolator.getStrLookupMap().keySet(),","177","                noPluginInterpolator.getStrLookupMap().keySet(),","178","                \"Plugin and non-plugin Interpolator constructors should support the same features\");","179","    }"]}]}},"751cebdb59e1046e080ee96a21233602355c65de":{"changes":{"\/dev\/null":"DELETE","log4j-core\/src\/test\/resources\/reconfiguration-deadlock.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ReconfigurationDeadlockTest.java":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/reconfiguration-deadlock.xml":[{"add":["1","<configuration status=\"error\" monitorInterval=\"5\">","2","  <appenders>","3","    <ReconfigurationDeadlockTestAppender name=\"testAppender\">","5","    <\/ReconfigurationDeadlockTestAppender>","9","  <\/appenders>","10","  <loggers>","11","    <root level=\"ERROR\">","12","      <appenderRef ref=\"testAppender\" \/>","13","    <\/root>","14","  <\/loggers>","15","<\/configuration>"],"delete":["1","<Configuration status=\"error\" monitorInterval=\"5\">","2","  <Appenders>","3","    <UsesLoggingAppender name=\"myAppender\">","5","    <\/UsesLoggingAppender>","9","  <\/Appenders>","10","  <Loggers>","11","    <Logger name=\"Dump\" level=\"trace\" additivity=\"false\">","12","      <AppenderRef ref=\"STDOUT\" \/>","13","    <\/Logger>","14","    <Root level=\"ERROR\">","15","      <AppenderRef ref=\"myAppender\" \/>","16","    <\/Root>","17","  <\/Loggers>","18","<\/Configuration>"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ReconfigurationDeadlockTest.java":[{"add":["20","import org.apache.logging.log4j.core.Appender;","21","import org.apache.logging.log4j.core.Core;","22","import org.apache.logging.log4j.core.Filter;","23","import org.apache.logging.log4j.core.Layout;","24","import org.apache.logging.log4j.core.LogEvent;","25","import org.apache.logging.log4j.core.appender.AbstractAppender;","26","import org.apache.logging.log4j.core.config.plugins.Plugin;","27","import org.apache.logging.log4j.core.config.plugins.PluginAttribute;","28","import org.apache.logging.log4j.core.config.plugins.PluginElement;","29","import org.apache.logging.log4j.core.config.plugins.PluginFactory;","30","import org.apache.logging.log4j.core.config.plugins.validation.constraints.Required;","32","import org.junit.jupiter.api.AfterEach;","33","import org.junit.jupiter.api.Assertions;","34","import org.junit.jupiter.api.BeforeEach;","35","import org.junit.jupiter.api.RepeatedTest;","37","import java.io.File;","38","import java.util.List;","39","import java.util.concurrent.CountDownLatch;","40","import java.util.concurrent.ExecutorService;","41","import java.util.concurrent.Executors;","42","import java.util.concurrent.Future;","43","import java.util.concurrent.TimeUnit;","44","import java.util.stream.Collectors;","45","import java.util.stream.IntStream;","47","\/**","48"," * Performs reconfiguration whilst logging.","49"," *","50"," * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-620\">LOG4J2-620<\/a>","51"," * @see TestAppender","52"," *\/","56","    private static final int WORKER_COUNT = 100;","58","    private ExecutorService executor;","60","    @BeforeEach","61","    public void startExecutor() {","62","        executor = Executors.newFixedThreadPool(WORKER_COUNT);","65","    @AfterEach","66","    public void stopExecutor() throws InterruptedException {","67","        executor.shutdownNow();","68","        final boolean terminated = executor.awaitTermination(30, TimeUnit.SECONDS);","69","        Assertions.assertTrue(terminated, \"couldn't terminate the executor\");","70","    }","72","    @RepeatedTest(100)","73","    public void reconfiguration_should_not_cause_deadlock_for_ongoing_logging() throws Exception {","75","        \/\/ Try to update the config file to ensure that we can indeed update it.","76","        updateConfigFileModTime();","77","","78","        \/\/ Start the workers.","79","        final CountDownLatch workerStartLatch = new CountDownLatch(WORKER_COUNT);","80","        List<Future<?>> workerFutures = initiateWorkers(workerStartLatch, executor);","81","","82","        \/\/ Await workers to start and update the config file.","83","        workerStartLatch.await(10, TimeUnit.SECONDS);","84","        updateConfigFileModTime();","85","","86","        \/\/ Verify that all workers have finished okay.","87","        for (int workerIndex = 0; workerIndex < WORKER_COUNT; workerIndex++) {","88","            final Future<?> workerFuture = workerFutures.get(workerIndex);","90","                Object workerResult = workerFuture.get(30, TimeUnit.SECONDS);","91","                Assertions.assertNull(workerResult);","92","            } catch (final Throwable failure) {","93","                final String message = String.format(","94","                        \"check for worker %02d\/%02d has failed\",","95","                        (workerIndex + 1), WORKER_COUNT);","96","                throw new AssertionError(message, failure);","99","","102","    private static void updateConfigFileModTime() {","103","        final File file = new File(\"target\/test-classes\/reconfiguration-deadlock.xml\");","104","        final boolean fileModified = file.setLastModified(System.currentTimeMillis());","105","        Assertions.assertTrue(fileModified, \"couldn't update file modification time\");","106","    }","108","    @SuppressWarnings(\"SameParameterValue\")","109","    private static List<Future<?>> initiateWorkers(","110","            final CountDownLatch workerStartLatch,","111","            final ExecutorService executor) {","112","        final Logger logger = LogManager.getRootLogger();","113","        return IntStream","114","                .range(0, WORKER_COUNT)","115","                .mapToObj((final int workerIndex) -> executor.submit(() -> {","116","                    int i = 0;","117","                    for (; i < 1_000; i++) {","118","                        logger.error(\"worker={}, iteration={}\", workerIndex, i);","119","                    }","120","                    workerStartLatch.countDown();","121","                    for (; i < 5_000; i++) {","122","                        logger.error(\"worker={}, iteration={}\", workerIndex, i);","123","                    }","124","                }))","125","                .collect(Collectors.toList());","126","    }","128","    \/**","129","     * A dummy appender doing nothing but burning CPU cycles whilst randomly accessing the logger.","130","     *\/","131","    @Plugin(name = \"ReconfigurationDeadlockTestAppender\",","132","            category = Core.CATEGORY_NAME,","133","            elementType = Appender.ELEMENT_TYPE,","134","            printObject = true)","135","    public static final class TestAppender extends AbstractAppender {","136","","137","        private final Logger logger;","138","","139","        private TestAppender(","140","                final String name,","141","                final Filter filter,","142","                final Layout<?> layout,","143","                final boolean ignoreExceptions) {","144","            super(name, filter, layout, ignoreExceptions, Property.EMPTY_ARRAY);","145","            this.logger = LogManager.getRootLogger();","147","","148","        @PluginFactory","149","        public static TestAppender createAppender(","150","                @PluginAttribute(\"name\") @Required(message = \"A name for the Appender must be specified\") final String name,","151","                @PluginAttribute(\"ignoreExceptions\") final boolean ignore,","152","                @PluginElement(\"Layout\") final Layout<?> layout,","153","                @PluginElement(\"Filter\") final Filter filter) {","154","            return new TestAppender(name, filter, layout, ignore);","155","        }","156","","157","        \/**","158","         * Does nothing but burning CPU cycles and accessing to the logger.","159","         *\/","160","        @Override","161","        public void append(final LogEvent event) {","162","            boolean endOfBatch;","163","            final int eventHashCode = event.hashCode();","164","            switch (Math.abs(eventHashCode % 4)) {","165","                case 0: endOfBatch = logger.isTraceEnabled(); break;","166","                case 1: endOfBatch = logger.isDebugEnabled(); break;","167","                case 2: endOfBatch = logger.isInfoEnabled(); break;","168","                case 3: endOfBatch = logger.isWarnEnabled(); break;","169","                default: throw new IllegalStateException();","170","            }","171","            event.setEndOfBatch(endOfBatch);","172","        }","173",""],"delete":["18","import java.io.File;","19","","23","import org.apache.logging.log4j.message.ThreadDumpMessage;","24","import org.junit.jupiter.api.Test;","26","import static org.junit.jupiter.api.Assertions.*;","31","    private static final int THREAD_COUNT = 5;","32","    private static final boolean[] finished = new boolean[THREAD_COUNT];","33","    private static LoggerThread[] threads = new LoggerThread[THREAD_COUNT];","35","    @Test","36","    public void testReconfig() throws InterruptedException {","38","        final Updater updater = new Updater();","39","        for (int i = 0; i < THREAD_COUNT; ++i) {","40","            threads[i] = new LoggerThread(i);","41","            threads[i].setDaemon(true);","42","        }","43","        for (int i = 0; i < THREAD_COUNT; ++i) {","44","","45","            threads[i].start();","46","        }","47","        updater.setDaemon(true);","48","        updater.start();","49","        Thread.sleep(100);","50","        boolean stillWaiting = true;","51","        for (int i = 0; i < 200; ++i) {","52","            int index = 0;","53","            for (; index < THREAD_COUNT; ++index) {","54","                if (!finished[index]) {","55","                    break;","56","                }","57","            }","58","            if (index == THREAD_COUNT) {","59","                stillWaiting = false;","60","                break;","61","            }","62","            Thread.sleep(100);","63","        }","64","        updater.shutdown = true;","65","        if (stillWaiting) {","66","            final ThreadDumpMessage message = new ThreadDumpMessage(\"Waiting\");","67","            System.err.print(message.getFormattedMessage());","68","        }","69","        for (int i = 0; i < THREAD_COUNT; ++i) {","70","            if (threads[i].isAlive()) {","71","                threads[i].interrupt();","72","            }","73","        }","74","        assertFalse(stillWaiting, \"loggerThread didn't finish\");","75","","78","    private static class LoggerThread extends Thread {","80","        private final Logger logger = LogManager.getRootLogger();","81","        private final int index;","83","        public LoggerThread(final int i) {","84","            index = i;","85","        }","86","        @Override","87","        public void run() {","88","            int i = 0;","90","                for (i=0; i < 30; ++i) {","91","                    logger.error(\"Thread: \" + index + \", Test: \" + i++);","92","                }","93","            } catch (final Exception ie) {","94","                return;","96","            finished[index] = true;","100","    private static class Updater extends Thread {","102","        public volatile boolean shutdown = false;","104","        @Override","105","        public void run() {","106","            while (!shutdown) {","107","                try {","108","                    Thread.sleep(1000);","109","                } catch (final InterruptedException e) {","110","                    e.printStackTrace();","111","                }","112","                \/\/ for running from IDE","113","                final File file = new File(\"target\/test-classes\/reconfiguration-deadlock.xml\");","114","                if (file.exists()) {","115","                    file.setLastModified(System.currentTimeMillis());","116","                }","117","            }"]}]}},"898b6f6f9097c2711be1e8f91813d8aa95adf0f3":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/appender\/SyslogAppenderBuilder.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["42","      <action issue=\"LOG4J2-3249\" dev=\"ggregory\" type=\"fix\">","43","        Log4j 1.2 bridge for Syslog Appender defaults to port 512 instead of 514.","44","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/appender\/SyslogAppenderBuilder.java":[{"add":["30","import org.apache.logging.log4j.core.appender.SocketAppender;","39","import java.io.Serializable;","57","    private static final String DEFAULT_HOST = \"localhost\";","58","    private static int DEFAULT_PORT = 514;","59","    private static final String DEFAULT_FACILITY = \"LOCAL0\";","60","","122","        String facility = getProperty(FACILITY_PARAM, DEFAULT_FACILITY);","123","        String syslogHost = getProperty(SYSLOG_HOST_PARAM, DEFAULT_HOST + \":\" + DEFAULT_PORT);","133","        org.apache.logging.log4j.core.Layout<? extends Serializable> appenderLayout;","146","        return new AppenderWrapper(SocketAppender.newBuilder()","165","            port.set(DEFAULT_PORT);","170","            LOGGER.warn(\"Invalid {} setting: {}. Using default.\", SYSLOG_HOST_PARAM, syslogHost);","171","            host.set(DEFAULT_HOST);","172","            port.set(DEFAULT_PORT);"],"delete":["58","    private static int SYSLOG_PORT = 512;","117","        String facility = getProperty(FACILITY_PARAM, \"LOCAL0\");","118","        String syslogHost = getProperty(SYSLOG_HOST_PARAM, \"localhost:514\");","128","        org.apache.logging.log4j.core.Layout appenderLayout;","141","        return new AppenderWrapper(SyslogAppender.newBuilder()","153","        int urlPort = -1;","154","","162","            port.set(SYSLOG_PORT);","167","            LOGGER.warn(\"Invalid syslogHost setting: {}. Using default\", syslogHost);","168","            host.set(\"localhost\");","169","            port.set(SYSLOG_PORT);"]}]}},"e1b232236026b77f4878d8dc599ade2873ce82de":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLoggerWrapper.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3292\" dev=\"ckozak\" type=\"fix\">","34","        ExtendedLoggerWrapper.logMessage no longer double-logs when location is requested.","35","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLoggerWrapper.java":[{"add":["220","        } else {","221","            logger.logMessage(fqcn, level, marker, message, t);"],"delete":["221","        logger.logMessage(fqcn, level, marker, message, t);"]}]}},"261455c46ea5c560e59fd5bfb22c9091f0db4311":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/MarkerManager.java":"MODIFY","slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/MarkerTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/Marker.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MarkerFilter.java":"MODIFY","slf4j-impl\/src\/main\/java\/org\/slf4j\/helpers\/MarkerWrapper.java":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/MarkerManager.java":[{"add":["111","        public boolean isInstanceOf(String name) {","112","            if (name == null) {","113","                throw new IllegalArgumentException(\"A marker name is required\");","114","            }","115","            Marker toTest = this;","116","            do {","117","                if (name.equals(toTest.getName())) {","118","                    return true;","119","                }","120","                toTest = toTest.getParent();","121","            } while (toTest != null);","122","            return false;","123","        }","124","","130","            if (o == null || !(o instanceof Marker)) {"],"delete":["116","            if (o == null || getClass() != o.getClass()) {"]}],"slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/MarkerTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-82\" dev=\"rgoers\" type=\"fix\">","26","        MarkerFilter called MarkerManager.getMarker causing the Marker to be created during the processing of the","27","        configuration. This prevents the application from creating the Marker with any parents. MarkerWrapper in","28","        SLF4J-impl was getting a ClassCastException in instanceOf because the Marker isn't a MarkerWrapper.","29","      <\/action>"],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/Marker.java":[{"add":["47","","48","    \/**","49","     * Checks whether this Marker is an instance of the specified Marker.","50","     * @param m The Marker name to check.","51","     * @return true of this Marker or one of its ancestors matches the specified name, false otherwise.","52","     *\/","53","    boolean isInstanceOf(String name);"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MarkerFilter.java":[{"add":["36","    private final String name;","38","    private MarkerFilter(String name, Result onMatch, Result onMismatch) {","40","        this.name = name;","61","        return marker != null && marker.isInstanceOf(name) ? onMatch : onMismatch;","66","        return name;","71","     * @param marker The Marker name to match.","88","        return new MarkerFilter(marker, onMatch, onMismatch);"],"delete":["36","    private final Marker marker;","38","    private MarkerFilter(Marker marker, Result onMatch, Result onMismatch) {","40","        this.marker = marker;","61","        return marker != null && marker.isInstanceOf(this.marker) ? onMatch : onMismatch;","66","        return marker.getName();","71","     * @param marker The Marker to match.","85","        Marker m = MarkerManager.getMarker(marker);","89","        return new MarkerFilter(m, onMatch, onMismatch);"]}],"slf4j-impl\/src\/main\/java\/org\/slf4j\/helpers\/MarkerWrapper.java":[{"add":["51","        if (marker instanceof MarkerWrapper) {","52","            return contains((MarkerWrapper) marker);","53","        } else {","54","            return contains(marker.getName());","55","        }","56","    }","57","","58","    public boolean isInstanceOf(String name) {","59","        if (name == null) {","60","            throw new IllegalArgumentException(\"A marker name is required\");","61","        }","62","        return contains(name);"],"delete":["51","        return contains((MarkerWrapper) marker);"]}]}},"4da152807820380d5642b00fad793816463f5ea5":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-web\/src\/main\/resources\/META-INF\/services\/javax.servlet.ServletContainerInitializer":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["68","      <action issue=\"LOG4J2-890\" dev=\"ggregory\" type=\"update\" due-to=\"Hassan Kalaldeh, Robert Andersson, Remko Popma\">","69","        log4j-web-2.1 should workaround a bug in JBOSS EAP 6.2.","70","      <\/action>"],"delete":[]}],"log4j-web\/src\/main\/resources\/META-INF\/services\/javax.servlet.ServletContainerInitializer":[{"add":["0","org.apache.logging.log4j.web.Log4jServletContainerInitializer","1","#","2","# See https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-890","3","# See https:\/\/issues.jboss.org\/browse\/WFLY-4458","4","#","5",""],"delete":["16","org.apache.logging.log4j.web.Log4jServletContainerInitializer"]}]}},"b77d7c0284b97b08178e4e871873f536d57077fb":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Property.java":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["1902","        <Property name=\"user\">${sys:user.name}<\/Property>","1903","        <Property name=\"env\">${sys:environment}<\/Property>"],"delete":["1902","        <Property key=\"user\">${sys:user.name}<\/Property>","1903","        <Property key=\"env\">${sys:environment}<\/Property>"]}],"src\/changes\/changes.xml":[{"add":["35","      <action issue=\"LOG4J2-950\" dev=\"ggregory\" type=\"update\" due-to=\"Joel Edwards\">","36","        Incorrect attribute name in PropertiesRewritePolicy example.","37","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Property.java":[{"add":["58","     * Creates a Property.","59","     * ","60","     * @param name The key.","66","            @PluginAttribute(\"name\") final String name,","68","        if (name == null) {","69","            LOGGER.error(\"Property name cannot be null\");","71","        return new Property(name, value);"],"delete":["58","     * Create a Property.","59","     * @param key The key.","65","            @PluginAttribute(\"name\") final String key,","67","        if (key == null) {","68","            LOGGER.error(\"Property key cannot be null\");","70","        return new Property(key, value);"]}]}},"5b6dee27081bc7e268138c7431c027ce99dbe7c0":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-893\" dev=\"ggregory\" type=\"fix\">","27","        NullPointerException on filter when mapping JUL to Log4j2.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":[{"add":["299","            return level != null && intLevel >= level.intLevel();","311","            return level != null && intLevel >= level.intLevel();","323","            return level != null && intLevel >= level.intLevel();","335","            return level != null && intLevel >= level.intLevel();","347","            return level != null && intLevel >= level.intLevel();"],"delete":["299","","300","            return intLevel >= level.intLevel();","312","","313","            return intLevel >= level.intLevel();","325","","326","            return intLevel >= level.intLevel();","338","","339","            return intLevel >= level.intLevel();","351","","352","            return intLevel >= level.intLevel();"]}]}},"3b4b370e8ba9f28f9268681e726e75933b6bab53":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-619\" dev=\"rgoers\" type=\"fix\" due-to=\"Scott Harrington\">"],"delete":["24","      <action issue=\"LOG4J2-619\" dev=\"mattsicker\" type=\"fix\" due-to=\"Scott Harrington\">"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["244","                return (config.rootElement == null) ? null : config;"],"delete":["244","                if (config.rootElement == null) {","245","                    return null;","246","                }"]}]}},"b87f7121833317bf5ea27efc7503760650cb5cb3":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1800\" dev=\"mikes\" type=\"fix\" due-to=\"Vincent Tieleman\">","27","        Report errors when sending to Kafka when using syncSend=false.","28","      <\/action>"],"delete":[]}]}},"1b547234c1b64dfe0e57fff13d7480e13752903e":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["39","      <action issue=\"LOG4J2-2397\" dev=\"ggregory\" type=\"fix\" due-to=\"EckelDong\">","40","        Predeployment of PersistenceUnit that using Log4j as session logger failed (#198).","41","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":[{"add":["318","            for (final PropertySource source : ServiceLoader.load(PropertySource.class, PropertySource.class.getClassLoader())) {"],"delete":["318","            for (final PropertySource source : ServiceLoader.load(PropertySource.class)) {"]}]}},"205d64e41b49f9b7a07ce6cdb2412cb04f02b34e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FormatCache.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FormatCache.java":[{"add":["244","            return obj != null && Arrays.equals(keys, ((MultipartKey) obj).keys);"],"delete":["244","            return Arrays.equals(keys, ((MultipartKey) obj).keys);"]}],"src\/changes\/changes.xml":[{"add":["167","      <action issue=\"LOG4J2-1602\" dev=\"ggregory\" type=\"fix\">","168","        NPE in org.apache.logging.log4j.core.util.datetime.FormatCache.MultipartKey.equals(Object) when object is null.","169","      <\/action>"],"delete":[]}]}},"7443184e1c8b39657f652391ccf39b8eee2c1a98":{"changes":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/layout\/TTCCLayoutBuilder.java":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/AbstractBuilder.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/XmlConfigurationTest.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/AbstractLog4j1ConfigurationTest.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/Log4j1ConfigurationFactoryTest.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/PropertiesConfigurationTest.java":"MODIFY","log4j-1.2-api\/src\/test\/resources\/config-1.2\/log4j-console-TTCCLayout.xml":"ADD"},"diff":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/layout\/TTCCLayoutBuilder.java":[{"add":["57","        final AtomicBoolean threadPrinting = new AtomicBoolean(Boolean.TRUE);","58","        final AtomicBoolean categoryPrefixing = new AtomicBoolean(Boolean.TRUE);","59","        final AtomicBoolean contextPrinting = new AtomicBoolean(Boolean.TRUE);","60","        final AtomicReference<String> dateFormat = new AtomicReference<>(RELATIVE);","89","        boolean threadPrinting = getBooleanProperty(THREAD_PRINTING_PARAM, true);","90","        boolean categoryPrefixing = getBooleanProperty(CATEGORY_PREFIXING_PARAM, true);","91","        boolean contextPrinting = getBooleanProperty(CONTEXT_PRINTING_PARAM, true);","92","        String dateFormat = getProperty(DATE_FORMAT_PARAM, RELATIVE);"],"delete":["57","        final AtomicBoolean threadPrinting = new AtomicBoolean();","58","        final AtomicBoolean categoryPrefixing = new AtomicBoolean();","59","        final AtomicBoolean contextPrinting = new AtomicBoolean();","60","        final AtomicReference<String> dateFormat = new AtomicReference<>();","89","        boolean threadPrinting = getBooleanProperty(THREAD_PRINTING_PARAM);","90","        boolean categoryPrefixing = getBooleanProperty(CATEGORY_PREFIXING_PARAM);","91","        boolean contextPrinting = getBooleanProperty(CONTEXT_PRINTING_PARAM);","92","        String dateFormat = getProperty(DATE_FORMAT_PARAM);"]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/AbstractBuilder.java":[{"add":["111","    public boolean getBooleanProperty(final String key, final boolean defaultValue) {","112","        return Boolean.parseBoolean(getProperty(key, Boolean.toString(defaultValue)));","113","    }","114","","116","        return getBooleanProperty(key, false);"],"delete":["112","        return Boolean.parseBoolean(getProperty(key, Boolean.FALSE.toString()));","176",""]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/XmlConfigurationTest.java":[{"add":["102","    @Override","103","    @Test","104","    public void testConsoleTtccLayout() throws Exception {","105","        super.testConsoleTtccLayout();","106","    }","107",""],"delete":[]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/AbstractLog4j1ConfigurationTest.java":[{"add":["24","import org.apache.logging.log4j.Level;","26","import org.apache.logging.log4j.core.Layout;","28","import org.apache.logging.log4j.core.appender.ConsoleAppender.Target;","30","import org.apache.logging.log4j.core.config.LoggerConfig;","61","","62","    private Layout<?> testConsole(final String configResource) throws Exception {","63","        final Configuration configuration = getConfiguration(configResource);","64","        final String name = \"Console\";","65","        final ConsoleAppender appender = configuration.getAppender(name);","66","        assertNotNull(\"Missing appender '\" + name + \"' in configuration \" + configResource + \"  \" + configuration,","67","                appender);","68","        assertEquals(Target.SYSTEM_ERR, appender.getTarget());","69","        \/\/","70","        final LoggerConfig loggerConfig = configuration.getLoggerConfig(\"com.example.foo\");","71","        assertNotNull(loggerConfig);","72","        assertEquals(Level.DEBUG, loggerConfig.getLevel());","73","        configuration.start();","74","        configuration.stop();","75","        return appender.getLayout();","76","    }","77","","78","    public void testConsoleTtccLayout() throws Exception {","79","        final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-TTCCLayout\");","80","        assertEquals(\"%r [%t] %p %notEmpty{%ndc }- %m%n\", layout.getConversionPattern());","81","    }","82",""],"delete":[]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/Log4j1ConfigurationFactoryTest.java":[{"add":["94","        final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-EnhancedPatternLayout\");","100","        final HtmlLayout layout = (HtmlLayout) testConsole(\"config-1.2\/log4j-console-HtmlLayout\");","107","        final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-PatternLayout\");","113","        final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-SimpleLayout\");","117","    @Override","120","        super.testConsoleTtccLayout();","125","        final Log4j1XmlLayout layout = (Log4j1XmlLayout) testConsole(\"config-1.2\/log4j-console-XmlLayout\");","132","        final PatternLayout layout = (PatternLayout) testFile(\"config-1.2\/log4j-file-SimpleLayout\");","138","        final Configuration configuration = getConfiguration(\"config-1.2\/log4j-NullAppender\");","147","        testRollingFileAppender(\"config-1.2\/log4j-RollingFileAppender\", \"RFA\", \"target\/hadoop.log.%i\");","152","        testDailyRollingFileAppender(\"config-1.2\/log4j-DailyRollingFileAppender\", \"DRFA\", \"target\/hadoop.log%d{.yyyy-MM-dd}\");","157","        testRollingFileAppender(\"config-1.2\/log4j-RollingFileAppender-with-props\", \"RFA\", \"target\/hadoop.log.%i\");","182","        final Configuration configuration = getConfiguration(\"config-1.2\/log4j-system-properties-2\");"],"delete":["94","       final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-EnhancedPatternLayout\");","100","       final HtmlLayout layout = (HtmlLayout) testConsole(\"config-1.2\/log4j-console-HtmlLayout\");","107","       final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-PatternLayout\");","113","       final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-SimpleLayout\");","119","       final PatternLayout layout = (PatternLayout) testConsole(\"config-1.2\/log4j-console-TTCCLayout\");","120","        assertEquals(\"%r [%t] %p %notEmpty{%ndc }- %m%n\", layout.getConversionPattern());","125","       final Log4j1XmlLayout layout = (Log4j1XmlLayout) testConsole(\"config-1.2\/log4j-console-XmlLayout\");","132","       final PatternLayout layout = (PatternLayout) testFile(\"config-1.2\/log4j-file-SimpleLayout\");","138","       final Configuration configuration = getConfiguration(\"config-1.2\/log4j-NullAppender\");","147","       testRollingFileAppender(\"config-1.2\/log4j-RollingFileAppender\", \"RFA\", \"target\/hadoop.log.%i\");","152","       testDailyRollingFileAppender(\"config-1.2\/log4j-DailyRollingFileAppender\", \"DRFA\", \"target\/hadoop.log%d{.yyyy-MM-dd}\");","157","       testRollingFileAppender(\"config-1.2\/log4j-RollingFileAppender-with-props\", \"RFA\", \"target\/hadoop.log.%i\");","182","       final Configuration configuration = getConfiguration(\"config-1.2\/log4j-system-properties-2\");"]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/PropertiesConfigurationTest.java":[{"add":["192","    @Override","193","    @Test","194","    public void testConsoleTtccLayout() throws Exception {","195","        super.testConsoleTtccLayout();","196","    }","197",""],"delete":[]}],"log4j-1.2-api\/src\/test\/resources\/config-1.2\/log4j-console-TTCCLayout.xml":[{"add":[],"delete":[]}]}},"9c5871adc3a72c856f609b2371db68dba253b096":{"changes":{"log4j-core\/src\/site\/xdoc\/index.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":"MODIFY","src\/site\/xdoc\/runtime-dependencies.xml":"MODIFY","src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-deflate.xml":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-xy.xml":"ADD","log4j-core\/src\/test\/resources\/log4j-rolling-pack200.xml":"ADD"},"diff":{"log4j-core\/src\/site\/xdoc\/index.xml":[{"add":["58","                <li>bzip2, Deflate, Pack200, and XZ compression on rollover requires","59","                <a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>. In addition, ","60","                XZ requires <a href=\"http:\/\/tukaani.org\/xz\/java.html\">XZ for Java<\/a>.<\/li>                "],"delete":["58","                <li>bzip2 compression at rollover requires","59","                <a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>.<\/li>                "]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":[{"add":["55","                        \/\/ Apache Commons Compress","57","                        { \"log4j-rolling-deflate.xml\", \".deflate\" },","58","                        { \"log4j-rolling-pack200.xml\", \".pack200\" },","59","                        { \"log4j-rolling-xy.xml\", \".xy\" },"],"delete":[]}],"src\/site\/xdoc\/runtime-dependencies.xml":[{"add":["93","          <td>bzip2, Deflate, Pack200, and XZ compression on rollover<\/td>","94","          <td><a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>.","95","            In addition, XZ requires <a href=\"http:\/\/tukaani.org\/xz\/java.html\">XZ for Java<\/a>."],"delete":["93","          <td>bzip2 compression at rollover<\/td>","94","          <td><a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>"]}],"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["2148","                the file pattern ends with \".gz\", \".zip\", \".bz2\", \".deflate\", \".pack200\", or \".xz\" the resulting archive ","2149","                will be compressed using the compression scheme that matches the suffix. The formats bzip2, Deflate, ","2150","                Pack200 and XZ require <a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>.","2151","                In addition, XZ requires <a href=\"http:\/\/tukaani.org\/xz\/java.html\">XZ for Java<\/a>. ","2152","                The pattern may also contain lookup references that can be resolved at runtime such as is shown in the example ","2153","                below."],"delete":["2148","                the file pattern ends with \".gz\", \".zip\" or \".bz2\" the resulting archive will be compressed using the","2149","                compression scheme that matches the suffix. (bzip2 requires ","2150","                <a href=\"http:\/\/commons.apache.org\/proper\/commons-compress\/\">Apache Commons Compress<\/a>.)","2151","                The pattern may also contain lookup references that","2152","                can be resolved at runtime such as is shown in the example below."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["98","                \/\/ One of \"gz\", \"bzip2\", \"xz\", \"pack200\", or \"deflate\".","100","            }            ","101","        },","102","        DEFALTE(\".deflate\") {","103","            Action createCompressAction(String renameTo, String compressedName, boolean deleteSource,","104","                    int compressionLevel) {","105","                \/\/ One of \"gz\", \"bzip2\", \"xz\", \"pack200\", or \"deflate\".","106","                return new CommonsCompressAction(\"deflate\", new File(baseName(renameTo)), new File(compressedName), deleteSource);","107","            }            ","108","        },","109","        PACK200(\".pack200\") {","110","            Action createCompressAction(String renameTo, String compressedName, boolean deleteSource,","111","                    int compressionLevel) {","112","                \/\/ One of \"gz\", \"bzip2\", \"xz\", \"pack200\", or \"deflate\".","113","                return new CommonsCompressAction(\"pack200\", new File(baseName(renameTo)), new File(compressedName), deleteSource);","114","            }            ","115","        },","116","        XY(\".xy\") {","117","            Action createCompressAction(String renameTo, String compressedName, boolean deleteSource,","118","                    int compressionLevel) {","119","                \/\/ One of \"gz\", \"bzip2\", \"xz\", \"pack200\", or \"deflate\".","120","                return new CommonsCompressAction(\"xy\", new File(baseName(renameTo)), new File(compressedName), deleteSource);","121","            }            ","256","        final int suffixLength = suffixLength(highFilename);","365","        final int suffixLength = suffixLength(lowFilename);","443","    private int suffixLength(String lowFilename) {","444","        if (FileExtensions.GZIP.isExtensionFor(lowFilename)) {","445","            return FileExtensions.GZIP.length();","446","        } else if (FileExtensions.ZIP.isExtensionFor(lowFilename)) {","447","            return FileExtensions.ZIP.length();","448","        } else if (FileExtensions.BZIP2.isExtensionFor(lowFilename)) {","449","            return FileExtensions.BZIP2.length();","450","        } else if (FileExtensions.DEFALTE.isExtensionFor(lowFilename)) {","451","            return FileExtensions.DEFALTE.length();","452","        } else if (FileExtensions.PACK200.isExtensionFor(lowFilename)) {","453","            return FileExtensions.PACK200.length();","454","        } else if (FileExtensions.XY.isExtensionFor(lowFilename)) {","455","            return FileExtensions.XY.length();","456","        }","457","        return 0;","458","    }","459",""],"delete":["99","            }","228","        int suffixLength = 0;","229","","235","","237","","238","        if (FileExtensions.GZIP.isExtensionFor(highFilename)) {","239","            suffixLength = FileExtensions.GZIP.length();","240","        } else if (FileExtensions.ZIP.isExtensionFor(highFilename)) {","241","            suffixLength = FileExtensions.ZIP.length();","242","        } else if (FileExtensions.BZIP2.isExtensionFor(highFilename)) {","243","            suffixLength = FileExtensions.BZIP2.length();","244","        }","245","","347","        int suffixLength = 0;","348","","356","","357","        if (FileExtensions.GZIP.isExtensionFor(lowFilename)) {","358","            suffixLength = FileExtensions.GZIP.length();","359","        } else if (FileExtensions.ZIP.isExtensionFor(lowFilename)) {","360","            suffixLength = FileExtensions.ZIP.length();","361","        } else if (FileExtensions.BZIP2.isExtensionFor(lowFilename)) {","362","            suffixLength = FileExtensions.BZIP2.length();","363","        }"]}],"log4j-core\/src\/test\/resources\/log4j-rolling-deflate.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["29","      <action issue=\"LOG4J2-1077\" dev=\"ggregory\" type=\"add\">","30","        Support additional Apache Commons Compress compression formats on rollover: Deflate, Pack200, XY.","31","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-rolling-xy.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-rolling-pack200.xml":[{"add":[],"delete":[]}]}},"ae1a095819138d39a044ef2984fbb0bf1b4f0cc1":{"changes":{"log4j-couchdb\/src\/main\/java\/org\/apache\/logging\/log4j\/couchdb\/CouchDbProvider.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginBuilderAttributeVisitor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NameUtil.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEmbeddedManager.java":"MODIFY","log4j-mongodb3\/src\/main\/java\/org\/apache\/logging\/log4j\/mongodb3\/MongoDbProvider.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginAttributeVisitor.java":"MODIFY"},"diff":{"log4j-couchdb\/src\/main\/java\/org\/apache\/logging\/log4j\/couchdb\/CouchDbProvider.java":[{"add":["19","import org.apache.logging.log4j.core.appender.nosql.NoSqlProvider;","32","import java.lang.reflect.Method;","33","","150","            description = \"uri=\" + client.getDBUri() + \", username=\" + username;"],"delete":["18","import java.lang.reflect.Method;","19","","27","import org.apache.logging.log4j.core.util.NameUtil;","28","import org.apache.logging.log4j.core.appender.nosql.NoSqlProvider;","108","                            + \", passwordHash=\" + NameUtil.md5(password + CouchDbProvider.class.getName())","152","            description = \"uri=\" + client.getDBUri() + \", username=\" + username + \", passwordHash=\"","153","                    + NameUtil.md5(password + CouchDbProvider.class.getName());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginBuilderAttributeVisitor.java":[{"add":["49","        final Object debugValue = this.annotation.sensitive() ? \"*****\" : value;"],"delete":["25","import org.apache.logging.log4j.core.util.NameUtil;","50","        final Object debugValue = this.annotation.sensitive() ? NameUtil.md5(value + this.getClass().getName()) : value;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":[{"add":["109","        final String name = createManagerName(to, cc, bcc, from, replyTo, subject, protocol, host, username, password, isDebug, filterName);","110","        final Serializer subjectSerializer = PatternLayout.newSerializerBuilder().setConfiguration(config).setPattern(subject).build();","111","","112","        return getManager(name, FACTORY, new FactoryData(to, cc, bcc, from, replyTo, subjectSerializer,","113","            protocol, host, port, username, password, isDebug, numElements, sslConfiguration));","114","","115","    }","116","","117","    private static String createManagerName(","118","            final String to,","119","            final String cc,","120","            final String bcc,","121","            final String from,","122","            final String replyTo,","123","            final String subject,","124","            final String protocol,","125","            final String host,","126","            final String username,","127","            final String password,","128","            final boolean isDebug,","129","            final String filterName) {","130","","132","","168","        final String hash = NameUtil.md5(sb.toString());","169","        return \"SMTP:\" + hash;"],"delete":["145","        final String name = \"SMTP:\" + NameUtil.md5(sb.toString());","146","        final Serializer subjectSerializer = PatternLayout.newSerializerBuilder().setConfiguration(config).setPattern(subject).build();","148","        return getManager(name, FACTORY, new FactoryData(to, cc, bcc, from, replyTo, subjectSerializer,","149","            protocol, host, port, username, password, isDebug, numElements, sslConfiguration));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NameUtil.java":[{"add":["20","import java.nio.charset.Charset;","21","import java.security.MessageDigest;","22","import java.security.NoSuchAlgorithmException;","23","import java.util.Objects;","24","","30","    private NameUtil() {}","40","    \/**","41","     * Calculates the <a href=\"https:\/\/en.wikipedia.org\/wiki\/MD5\">MD5<\/a> hash","42","     * of the given input string encoded using the default platform","43","     * {@link Charset charset}.","44","     * <p>","45","     * <b>MD5 has severe vulnerabilities and should not be used for sharing any","46","     * sensitive information.<\/b> This function should only be used to create","47","     * unique identifiers, e.g., configuration element names.","48","     *","49","     * @param input string to be hashed","50","     * @return string composed of 32 hexadecimal digits of the calculated hash","51","     *\/","52","    public static String md5(final String input) {","53","        Objects.requireNonNull(input, \"input\");","55","            final byte[] inputBytes = input.getBytes();","57","            final byte[] bytes = digest.digest(inputBytes);","58","            final StringBuilder md5 = new StringBuilder(bytes.length * 2);","60","                final String hex = Integer.toHexString(0xFF & b);","67","        }","68","        \/\/ Every implementation of the Java platform is required to support MD5.","69","        \/\/ Hence, this catch block should be unreachable.","70","        \/\/ See https:\/\/docs.oracle.com\/javase\/8\/docs\/api\/java\/security\/MessageDigest.html","71","        \/\/ for details.","72","        catch (final NoSuchAlgorithmException error) {","73","            throw new RuntimeException(error);","76",""],"delete":["18","import java.security.MessageDigest;","19","","27","    private static final int MASK = 0xff;","28","","29","    private NameUtil() {","30","    }","40","    public static String md5(final String string) {","43","            digest.update(string.getBytes());","44","            final byte[] bytes = digest.digest();","45","            final StringBuilder md5 = new StringBuilder();","47","                final String hex = Integer.toHexString(MASK & b);","54","        } catch (final Exception ex) {","55","            return string;"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3056\" dev=\"vy\" type=\"add\" due-to=\"Marcono1234\">","34","        Refactor MD5 usage for sharing sensitive information.","35","      <\/action>"],"delete":[]}],"log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEmbeddedManager.java":[{"add":["40","    private static final FlumeManagerFactory FACTORY = new FlumeManagerFactory();\r","81","        final String extendedName = extendManagerName(name, agents, properties);\r","82","        return getManager(extendedName, FACTORY,\r","83","                new FactoryData(name, agents, properties, batchSize, dataDir));\r","84","\r","85","    }\r","86","\r","87","    private static String extendManagerName(\r","88","            final String name,\r","89","            final Agent[] agents,\r","90","            final Property[] properties) {\r","91","\r","116","\r","117","        return sb.toString();\r","118","\r"],"delete":["34","\/**\r","35"," *\r","36"," *\/\r","43","    private static FlumeManagerFactory factory = new FlumeManagerFactory();\r","108","        return getManager(sb.toString(), factory,\r","109","                new FactoryData(name, agents, properties, batchSize, dataDir));\r"]}],"log4j-mongodb3\/src\/main\/java\/org\/apache\/logging\/log4j\/mongodb3\/MongoDbProvider.java":[{"add":["179","                    description += \", username=\" + userName;"],"delete":["32","import org.apache.logging.log4j.core.util.NameUtil;","180","                    description += \", username=\" + userName + \", passwordHash=\"","181","                            + NameUtil.md5(password + MongoDbProvider.class.getName());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginAttributeVisitor.java":[{"add":["44","        final Object debugValue = this.annotation.sensitive() ? \"*****\" : value;"],"delete":["25","import org.apache.logging.log4j.core.util.NameUtil;","45","        final Object debugValue = this.annotation.sensitive() ? NameUtil.md5(value + this.getClass().getName()) : value;"]}]}},"f8a421972a4858bf2026d757f5d1bea7c1062a35":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["139","    public void testSerialization_getExtendedStackTraceAsString() throws Exception {","140","        final Throwable throwable = new IllegalArgumentException(\"This is a test\");","141","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","142","        final byte[] binary = serialize(proxy);","143","        final ThrowableProxy proxy2 = deserialize(binary);","144","","145","        assertEquals(proxy.getExtendedStackTraceAsString(), proxy2.getExtendedStackTraceAsString());","146","    }","147","","148","    @Test"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["34","      <action issue=\"LOG4J2-914\" dev=\"ggregory\" type=\"fix\" due-to=\"Kaj Bjurman\">","35","        ThrowableProxy.getExtendedStackTraceAsString causes NullpointerException.","36","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["344","        StackTraceElement[] causedTrace = this.throwable != null ? this.throwable.getStackTrace() : null;","345","        this.formatElements(sb, 0, causedTrace, this.extendedStackTrace, ignorePackages);"],"delete":["344","        this.formatElements(sb, 0, this.throwable.getStackTrace(), this.extendedStackTrace, ignorePackages);"]}]}},"0ee8e2089457125a9efb9201fc6f7b301a3d2090":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/selector\/BasicContextSelectorTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/BasicContextSelector.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/selector\/BasicContextSelectorTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["47","      <action issue=\"LOG4J2-3054\" dev=\"ckozak\" type=\"fix\">","48","        BasicContextSelector hasContext and shutdown take the default context into account","49","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/BasicContextSelector.java":[{"add":["36","        LoggerContext ctx = getContext(fqcn, loader, currentContext);\r","37","        if (ctx != null && ctx.isStarted()) {\r","38","            ctx.stop(DEFAULT_STOP_TIMEOUT, TimeUnit.MILLISECONDS);\r","39","        }\r","44","        LoggerContext ctx = getContext(fqcn, loader, currentContext);\r"],"delete":["36","        ContextAnchor.THREAD_CONTEXT.get().stop(DEFAULT_STOP_TIMEOUT, TimeUnit.MILLISECONDS);\r","41","        LoggerContext ctx = ContextAnchor.THREAD_CONTEXT.get();\r","47","\r"]}]}},"3eb4409471c42370534f5cad6729b10f4f4a85ed":{"changes":{"log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/LevelTest.java":"ADD"},"diff":{"log4j2-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":[{"add":["98","        for (Level level : values()) {","99","            if (level.name().equals(sArg)) {","100","                return level;","101","            }","102","        }","103","        return defaultLevel;"],"delete":["98","","99","        Level level = valueOf(sArg);","100","        return (level == null) ? defaultLevel : level;"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-56\" dev=\"rgoers\" type=\"fix\" due-to=\"John Owen Atala\">","26","        Level.toLevel would throw an IllegalArgumentException instead of returning the default value.","27","      <\/action>","28","      <action issue=\"LOG4J2-51\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">","32","      <action issue=\"LOG4J2-50\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">"],"delete":["25","      <action issue=\"VFS-51\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">","29","      <action issue=\"VFS-50\" dev=\"rgoers\" type=\"fix\" due-to=\"John Vasileff\">"]}],"log4j2-api\/src\/test\/java\/org\/apache\/logging\/log4j\/LevelTest.java":[{"add":[],"delete":[]}]}},"5bce0e3e05a74310e18bc538abfcaaa07dfdd2a8":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MapFilter.java":"MODIFY","\/dev\/null":"DELETE","core\/src\/test\/resources\/log4j2-mapfilter.xml":"ADD","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilter.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilter.java":"MODIFY","core\/src\/test\/resources\/log4j2-dynamicfilter.xml":"ADD","src\/site\/xdoc\/manual\/filters.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilter.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/MapFilterTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MapFilter.java":[{"add":["24","import org.apache.logging.log4j.core.config.plugins.PluginElement;","30","import java.util.ArrayList;","32","import java.util.List;","40","    private final Map<String, List<String>> map;","44","    protected MapFilter(Map<String, List<String>> map, boolean oper, Result onMatch, Result onMismatch) {","56","            return filter(((MapMessage) msg).getData()) ? onMatch : onMismatch;","65","            return filter(((MapMessage) msg).getData()) ? onMatch : onMismatch;","70","    protected boolean filter(Map<String, String> data) {","72","        for (Map.Entry<String, List<String>> entry : map.entrySet()) {","73","            String toMatch = data.get(entry.getKey());","74","            if (toMatch != null) {","75","                match = entry.getValue().contains(toMatch);","76","            } else {","77","                match = false;","78","            }","83","        return match;","93","            for (Map.Entry<String, List<String>> entry : map.entrySet()) {","98","                List<String> list = entry.getValue();","99","                String value = list.size() > 1 ? list.get(0) : list.toString();","100","                sb.append(entry.getKey()).append(\"=\").append(value);","111","    protected Map<String, List<String>> getMap() {","116","    public static MapFilter createFilter(@PluginElement(\"pairs\") KeyValuePair[] pairs,","117","                                         @PluginAttr(\"operator\") String oper,","118","                                         @PluginAttr(\"onmatch\") String match,","119","                                         @PluginAttr(\"onmismatch\") String mismatch) {","124","        Map<String, List<String>> map = new HashMap<String, List<String>>();","136","            List<String> list = map.get(pair.getKey());","137","            if (list != null) {","138","                list.add(value);","139","            } else {","140","                list = new ArrayList<String>();","141","                list.add(value);","142","                map.put(pair.getKey(), list);","143","            }"],"delete":["37","    private final Map<String, String> map;","41","    protected MapFilter(Map<String, String> map, boolean oper, Result onMatch, Result onMismatch) {","53","            return filter((MapMessage) msg);","62","            return filter((MapMessage) msg);","67","    protected Result filter(MapMessage msg) {","69","        for (String key : map.keySet()) {","70","            String data = msg.getData().get(key);","71","            match = map.get(key).equals(data);","76","        return match ? onMatch : onMismatch;","86","            for (Map.Entry<String, String> entry : map.entrySet()) {","91","                sb.append(entry.getKey()).append(\"=\").append(entry.getValue());","102","    protected Map<String, String> getMap() {","107","    public static MapFilter createFilter(@PluginAttr(\"pairs\") KeyValuePair[] pairs,","108","                                                    @PluginAttr(\"operator\") String oper,","109","                                                    @PluginAttr(\"onmatch\") String match,","110","                                                    @PluginAttr(\"onmismatch\") String mismatch) {","115","        Map<String, String> map = new HashMap<String, String>();","127","            map.put(pair.getKey(), pair.getValue());"]}],"\/dev\/null":[{"add":[],"delete":[]}],"core\/src\/test\/resources\/log4j2-mapfilter.xml":[{"add":[],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilter.java":[{"add":["30","import java.util.ArrayList;","33","import java.util.List;","40","public class ThreadContextMapFilter extends MapFilter {","47","    public ThreadContextMapFilter(Map<String, List<String>> pairs, boolean oper, Result onMatch, Result onMismatch) {","48","        super(pairs, oper, onMatch, onMismatch);","50","            Iterator<Map.Entry<String, List<String>>> iter = pairs.entrySet().iterator();","51","            Map.Entry<String, List<String>> entry = iter.next();","52","            if (entry.getValue().size() == 1) {","53","                this.key = entry.getKey();","54","                this.value = entry.getValue().get(0);","55","                this.useMap = false;","56","            } else {","57","                this.key = null;","58","                this.value = null;","59","                this.useMap = true;","60","            }","86","            for (Map.Entry<String, List<String>> entry : getMap().entrySet()) {","87","                String toMatch = ThreadContext.get(entry.getKey());","88","                if (toMatch != null) {","89","                    match = entry.getValue().contains(toMatch);","90","                } else {","91","                    match = false;","92","                }","93","                if ((!isAnd() && match) || (isAnd() && !match)) {","105","        return super.filter(event.getContextMap()) ? onMatch : onMismatch;","117","        Map<String, List<String>> map = new HashMap<String, List<String>>();","121","                LOGGER.error(\"A null key is not valid in MapFilter\");","126","                LOGGER.error(\"A null value for key \" + key + \" is not allowed in MapFilter\");","129","            List<String> list = map.get(pair.getKey());","130","            if (list != null) {","131","                list.add(value);","132","            } else {","133","                list = new ArrayList<String>();","134","                list.add(value);","135","                map.put(pair.getKey(), list);","136","            }"],"delete":["38","public class ThreadContextMapFilter extends FilterBase {","39","    private final Map<String, String> map;","44","    private final boolean isAnd;","45","","48","    public ThreadContextMapFilter(Map<String, String> pairs, boolean oper, Result onMatch, Result onMismatch) {","49","        super(onMatch, onMismatch);","51","            Iterator<Map.Entry<String, String>> iter = pairs.entrySet().iterator();","52","            Map.Entry<String, String> entry = iter.next();","53","            this.key = entry.getKey();","54","            this.value = entry.getValue();","55","            this.map = null;","56","            this.isAnd = false;","57","            this.useMap = false;","59","            this.map = pairs;","60","            this.isAnd = oper;","85","            for (String key : map.keySet()) {","86","                match = map.get(key).equals(ThreadContext.get(key));","87","                if ((!isAnd && match) || (isAnd && !match)) {","99","        Map<String, String> ctx = event.getContextMap();","100","        boolean match = false;","101","        for (String key : map.keySet()) {","102","            match = map.get(key).equals(ctx.get(key));","103","            if ((!isAnd && match) || (isAnd && !match)) {","104","                break;","105","            }","106","        }","107","        return match ? onMatch : onMismatch;","108","    }","109","","110","    @Override","111","    public String toString() {","112","        StringBuilder sb = new StringBuilder();","113","        sb.append(\"isAnd=\").append(isAnd);","114","        if (useMap) {","115","            if (map.size() > 0) {","116","                sb.append(\", {\");","117","               boolean first = true;","118","                for (Map.Entry<String, String> entry : map.entrySet()) {","119","                    if (!first) {","120","                        sb.append(\", \");","121","                    }","122","                    first = false;","123","                    sb.append(entry.getKey()).append(\"=\").append(entry.getValue());","124","                }","125","                sb.append(\"}\");","126","          }","127","        } else {","128","            sb.append(\", {\").append(key).append(\"=\").append(value).append(\"}\");","129","        }","130","        return sb.toString();","142","        Map<String, String> map = new HashMap<String, String>();","146","                LOGGER.error(\"A null key is not valid in ThreadContextMapFilter\");","151","                LOGGER.error(\"A null value for key \" + key + \" is not allowed in ThreadContextMapFilter\");","154","            map.put(pair.getKey(), pair.getValue());"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterTest.java":[{"add":["19","import org.apache.logging.log4j.LogManager;","22","import org.apache.logging.log4j.core.LoggerContext;","23","import org.apache.logging.log4j.core.config.Configuration;","24","import org.apache.logging.log4j.core.config.Configurator;","25","import org.apache.logging.log4j.core.helpers.KeyValuePair;","29","import org.apache.logging.log4j.status.StatusLogger;","30","import org.junit.After;","33","import java.util.Map;","34","","36","import static org.junit.Assert.assertFalse;","37","import static org.junit.Assert.assertNotNull;","38","","45","    @After","46","    public void cleanup() {","47","        LoggerContext ctx = (LoggerContext) LogManager.getContext(false);","48","        ctx.reconfigure();","49","        StatusLogger.getLogger().reset();","50","    }","51","","56","        KeyValuePair[] pairs = new KeyValuePair[] { new KeyValuePair(\"testuser\", \"DEBUG\"),","57","                                                    new KeyValuePair(\"JohnDoe\", \"warn\")};","72","","73","    @Test","74","    public void testConfig() {","75","        LoggerContext ctx = Configurator.initialize(\"Test1\", null, \"target\/test-classes\/log4j2-dynamicFilter.xml\");","76","        Configuration config = ctx.getConfiguration();","77","        Filter filter = config.getFilter();","78","        assertNotNull(\"No DynamicThresholdFilter\", filter);","79","        assertTrue(\"Not a DynamicThresholdFilter\", filter instanceof DynamicThresholdFilter);","80","        DynamicThresholdFilter dynamic = (DynamicThresholdFilter) filter;","81","        String key = dynamic.getKey();","82","        assertNotNull(\"Key is null\", key);","83","        assertTrue(\"Incorrect key value\", key.equals(\"loginId\"));","84","        Map<String, Level> map = dynamic.getLevelMap();","85","        assertNotNull(\"Map is null\", map);","86","        assertTrue(\"Incorrect number of map elements\", map.size() == 1);","87","    }"],"delete":["37","        ValueLevelPair[] pairs = new ValueLevelPair[] { new ValueLevelPair(\"testuser\", Level.DEBUG),","38","                                                         new ValueLevelPair(\"JohnDoe\", Level.WARN)};"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-92\" dev=\"rgoers\" type=\"fix\">","26","        Converted DynamicThresholdFilter to use KeyValuePair. Fixed bugs in the Map-based filters","27","        to allow declaration of multiple values for a key to match the documentation.","28","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilter.java":[{"add":["27","import org.apache.logging.log4j.core.helpers.KeyValuePair;","90","    public Map<String, Level> getLevelMap() {","91","        return levelMap;","92","    }","93","","125","                                                      @PluginElement(\"pairs\") KeyValuePair[] pairs,","132","        for (KeyValuePair pair : pairs) {","133","            map.put(pair.getKey(), Level.toLevel(pair.getValue().toUpperCase()));"],"delete":["120","                                                      @PluginElement(\"pairs\") ValueLevelPair[] pairs,","127","        for (ValueLevelPair pair : pairs) {","128","            map.put(pair.getKey(), pair.getLevel());"]}],"core\/src\/test\/resources\/log4j2-dynamicfilter.xml":[{"add":[],"delete":[]}],"src\/site\/xdoc\/manual\/filters.xml":[{"add":["240","              <td>One or more KeyValuePair elements that define the key in the map and the value to match on. If the","241","              same key is specified more than once then the check for that key will automatically be an \"or\" since","242","              a Map can only contain a single value.<\/td>","478","                portion of the StructuredDataId, the type, and the formatted message respectively. If the","479","                same key is specified more than once then the check for that key will automatically be an \"or\" since","480","                a Map can only contain a single value.","543","              <td>One or more KeyValuePair elements that define the key in the map and the value to match on. If the","544","                same key is specified more than once then the check for that key will automatically be an \"or\" since","545","                a Map can only contain a single value.<\/td>"],"delete":["240","              <td>One or more KeyValuePair elements that define the key in the map and the value to match on.<\/td>","476","                portion of the StructuredDataId, the type, and the formatted message respectively.","539","              <td>One or more KeyValuePair elements that define the key in the map and the value to match on.<\/td>"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilter.java":[{"add":["29","import java.util.ArrayList;","31","import java.util.List;","40","    private StructuredDataFilter(Map<String, List<String>> map, boolean oper, Result onMatch, Result onMismatch) {","58","        return super.filter(event);","61","    protected Result filter(StructuredDataMessage message) {","63","        for (Map.Entry<String, List<String>> entry : getMap().entrySet()) {","64","            String toMatch = getValue(message, entry.getKey());","65","            if (toMatch != null) {","66","                match = entry.getValue().contains(toMatch);","68","                match = false;","77","    private String getValue(StructuredDataMessage data, String key) {","78","        if (key.equalsIgnoreCase(\"id\")) {","79","            return data.getId().toString();","80","        } else if (key.equalsIgnoreCase(\"id.name\")) {","81","            return data.getId().getName();","82","        } else if (key.equalsIgnoreCase(\"type\")) {","83","            return data.getType();","84","        } else if (key.equalsIgnoreCase(\"message\")) {","85","            return data.getFormattedMessage();","86","        } else {","87","            return data.getData().get(key);","108","        Map<String, List<String>> map = new HashMap<String, List<String>>();","112","                LOGGER.error(\"A null key is not valid in MapFilter\");","117","                LOGGER.error(\"A null value for key \" + key + \" is not allowed in MapFilter\");","120","            List<String> list = map.get(pair.getKey());","121","            if (list != null) {","122","                list.add(value);","123","            } else {","124","                list = new ArrayList<String>();","125","                list.add(value);","126","                map.put(pair.getKey(), list);","127","            }"],"delete":["26","import org.apache.logging.log4j.message.MapMessage;","39","    private StructuredDataFilter(Map<String, String> map, boolean oper, Result onMatch, Result onMismatch) {","57","        return Result.NEUTRAL;","60","    @Override","61","    protected Result filter(MapMessage message) {","62","        if (!(message instanceof StructuredDataMessage)) {","63","            return super.filter(message);","64","        }","65","        StructuredDataMessage msg = (StructuredDataMessage) message;","67","        Map<String, String> map = getMap();","68","        for (String key : map.keySet()) {","69","            if (key.equalsIgnoreCase(\"id\")) {","70","                match = map.get(key).equals(msg.getId().toString());","71","            } else if (key.equalsIgnoreCase(\"id.name\")) {","72","                match = map.get(key).equals(msg.getId().getName());","73","            } else if (key.equalsIgnoreCase(\"type\")) {","74","                match = map.get(key).equals(msg.getType());","75","            } else if (key.equalsIgnoreCase(\"message\")) {","76","                match = map.get(key).equals(msg.getFormattedMessage().toString());","78","                String data = msg.getData().get(key).toString();","79","                match = map.get(key).equals(data);","88","    @Override","89","    public String toString() {","90","        StringBuilder sb = new StringBuilder();","91","        sb.append(\"isAnd=\").append(isAnd());","92","        if (getMap().size() > 0) {","93","            sb.append(\", {\");","94","            boolean first = true;","95","            for (Map.Entry<String, String> entry : getMap().entrySet()) {","96","                if (!first) {","97","                    sb.append(\", \");","98","                }","99","                first = false;","100","                sb.append(entry.getKey()).append(\"=\").append(entry.getValue());","101","            }","102","            sb.append(\"}\");","104","        return sb.toString();","124","        Map<String, String> map = new HashMap<String, String>();","128","                LOGGER.error(\"A null key is not valid in StructuredDataFilter\");","133","                LOGGER.error(\"A null value for key \" + key + \" is not allowed in StructuredDataFilter\");","136","            map.put(pair.getKey(), pair.getValue());"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/MapFilterTest.java":[{"add":["19","import org.apache.logging.log4j.LogManager;","20","import org.apache.logging.log4j.Logger;","21","import org.apache.logging.log4j.core.Appender;","23","import org.apache.logging.log4j.core.LoggerContext;","24","import org.apache.logging.log4j.core.config.Configuration;","25","import org.apache.logging.log4j.core.config.Configurator;","28","import org.apache.logging.log4j.status.StatusLogger;","29","import org.apache.logging.log4j.test.appender.ListAppender;","30","import org.junit.After;","31","import org.junit.AfterClass;","32","import org.junit.BeforeClass;","35","import java.util.HashMap;","36","import java.util.List;","37","import java.util.Map;","38","","39","import static org.junit.Assert.assertFalse;","40","import static org.junit.Assert.assertNotNull;","48","    @After","49","    public void cleanup() {","50","        LoggerContext ctx = (LoggerContext) LogManager.getContext(false);","51","        ctx.reconfigure();","52","        StatusLogger.getLogger().reset();","53","    }","66","        assertTrue(filter.filter(null, Level.DEBUG, null, msg, null) == Filter.Result.NEUTRAL);","68","        assertTrue(filter.filter(null, Level.ERROR, null, msg, null) == Filter.Result.DENY);","76","        assertTrue(filter.filter(null, Level.DEBUG, null, msg, null) == Filter.Result.NEUTRAL);","78","        assertTrue(filter.filter(null, Level.ERROR, null, msg, null) == Filter.Result.NEUTRAL);","79","    }","80","","81","    @Test","82","    public void testConfig() {","83","        LoggerContext ctx = Configurator.initialize(\"Test1\", null, \"target\/test-classes\/log4j2-mapfilter.xml\");","84","        Configuration config = ctx.getConfiguration();","85","        Filter filter = config.getFilter();","86","        assertNotNull(\"No MapFilter\", filter);","87","        assertTrue(\"Not a MapFilter\", filter instanceof  MapFilter);","88","        MapFilter mapFilter = (MapFilter) filter;","89","        assertFalse(\"Should not be And filter\", mapFilter.isAnd());","90","        Map<String, List<String>> map = mapFilter.getMap();","91","        assertNotNull(\"No Map\", map == null);","92","        assertTrue(\"No elements in Map\", map.size() != 0);","93","        assertTrue(\"Incorrect number of elements in Map\", map.size() == 1);","94","        assertTrue(\"Map does not contain key eventId\", map.containsKey(\"eventId\"));","95","        assertTrue(\"List does not contain 2 elements\", map.get(\"eventId\").size() == 2);","96","        Logger logger = LogManager.getLogger(MapFilterTest.class);","97","        Map<String, String> eventMap = new HashMap<String, String>();","98","        eventMap.put(\"eventId\", \"Login\");","99","        logger.debug(new MapMessage(eventMap));","100","        Map<String,Appender> appenders = config.getAppenders();","101","        Appender app = appenders.get(\"LIST\");","102","        assertNotNull(\"No List appender\", app);","103","        List<String> msgs = ((ListAppender) app).getMessages();","104","        assertNotNull(\"No messages\", msgs);","105","        assertTrue(\"No messages\", msgs.size() > 0);","106","","107",""],"delete":["22","import org.apache.logging.log4j.message.StructuredDataMessage;","44","        assertTrue(filter.filter(null, Level.DEBUG, null, msg, (Throwable)null) == Filter.Result.NEUTRAL);","46","        assertTrue(filter.filter(null, Level.ERROR, null, msg, (Throwable)null) == Filter.Result.DENY);","54","        assertTrue(filter.filter(null, Level.DEBUG, null, msg, (Throwable)null) == Filter.Result.NEUTRAL);","56","        assertTrue(filter.filter(null, Level.ERROR, null, msg, (Throwable)null) == Filter.Result.NEUTRAL);"]}]}},"79d64279a022040518c3dd2f0472326af1964343":{"changes":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CustomNoopAppender.java":"ADD","log4j-1.2-api\/src\/test\/resources\/LOG4J2-3281.properties":"ADD","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/config\/PropertiesConfiguration.java":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/BuilderManager.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/PropertiesConfigurationTest.java":"MODIFY"},"diff":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CustomNoopAppender.java":[{"add":[],"delete":[]}],"log4j-1.2-api\/src\/test\/resources\/LOG4J2-3281.properties":[{"add":[],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/config\/PropertiesConfiguration.java":[{"add":["457","        appender.addFilter(parseAppenderFilters(props, filterPrefix, appenderName));","458","        String[] keys = new String[] { layoutPrefix };"],"delete":["457","        parseAppenderFilters(props, filterPrefix, appenderName);","458","        String[] keys = new String[] {","459","                layoutPrefix,","460","        };"]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/builders\/BuilderManager.java":[{"add":["38","import java.util.Objects;","63","            } catch (ReflectiveOperationException ex) {","72","        Objects.requireNonNull(plugins, \"plugins\");","73","        Objects.requireNonNull(className, \"className\");","90","            } catch (ReflectiveOperationException ex) {","114","            } catch (ReflectiveOperationException ex) {","137","            } catch (ReflectiveOperationException ex) {","166","        } catch (ReflectiveOperationException ex) {"],"delete":["62","            } catch (InstantiationException | IllegalAccessException | InvocationTargetException ex) {","87","            } catch (InstantiationException | IllegalAccessException | InvocationTargetException ex) {","111","            } catch (InstantiationException | IllegalAccessException | InvocationTargetException ex) {","134","            } catch (InstantiationException | IllegalAccessException | InvocationTargetException ex) {","163","        } catch (NoSuchMethodException | InstantiationException | IllegalAccessException | InvocationTargetException ex) {"]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/config\/PropertiesConfigurationTest.java":[{"add":["54","    public void testConsoleAppenderFilter() throws Exception {","69","    public void testCustomAppenderFilter() throws Exception {","70","        try (LoggerContext loggerContext = TestConfigurator.configure(\"target\/test-classes\/LOG4J2-3281.properties\")) {","71","            \/\/ LOG4J2-3281 PropertiesConfiguration.buildAppender not adding filters to appender","72","            Configuration configuration = loggerContext.getConfiguration();","73","            assertNotNull(configuration);","74","            Appender appender = configuration.getAppender(\"CUSTOM\");","75","            assertNotNull(appender);","76","            Filterable filterable = (Filterable) appender;","77","            FilterAdapter filter = (FilterAdapter) filterable.getFilter();","78","            assertNotNull(filter);","79","            assertTrue(filter.getFilter() instanceof NeutralFilterFixture);","80","        }","81","    }","82","","83","    @Test"],"delete":["54","    public void testFilter() throws Exception {"]}]}},"ce1183629fe89625a77872c7153853e7774502a6":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/Rfc5424Layout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["45","      <action issue=\"LOG4J2-922\" dev=\"ggregory\" type=\"fix\" due-to=\"angus.aqlu, Paul Burrowes\">","46","        Parameter of mdcId in SyslogAppender has no default value.","47","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/Rfc5424Layout.java":[{"add":["140","        this.mdcId = id == null ? DEFAULT_MDCID : id;"],"delete":["140","        this.mdcId = mdcId;"]}]}},"88853d4e8406bc4204669ebd295b77c778533293":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NotANumber.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeNoCompressTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/EligibleFilesTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/IntegerPatternConverter.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-size.xml":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NotANumber.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeNoCompressTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1804\" dev=\"rgoers\" type=\"fix\" due-to=\"Pierrick Hymbert\">","34","        Allow %i in file pattern to be preceded with characters other than just '-'.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":[{"add":["41","import org.apache.logging.log4j.core.pattern.NotANumber;","95","        String pattern = manager.getPatternProcessor().getPattern();","96","        manager.getPatternProcessor().formatFileName(strSubstitutor, buf, NotANumber.NAN);","97","        return getEligibleFiles(buf.toString(), pattern, isAscending);","100","    protected SortedMap<Integer, Path> getEligibleFiles(String path, String pattern) {","101","        return getEligibleFiles(path, pattern, true);","104","    protected SortedMap<Integer, Path> getEligibleFiles(String path, String logfilePattern, boolean isAscending) {","113","        if (!logfilePattern.contains(\"%i\")) {","122","        String filePattern = fileName.replace(NotANumber.VALUE, \"(\\\\d+)\");"],"delete":["94","        manager.getPatternProcessor().formatFileName(strSubstitutor, buf, -1);","95","        return getEligibleFiles(buf.toString(), isAscending);","98","    protected SortedMap<Integer, Path> getEligibleFiles(String path) {","99","        return getEligibleFiles(path, true);","102","    protected SortedMap<Integer, Path> getEligibleFiles(String path, boolean isAscending) {","111","        if (!path.contains(\"--1\")) {","120","        String filePattern = fileName.replace(\"--1\", \"-(\\\\d+)\");"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/EligibleFilesTest.java":[{"add":["21","import org.apache.logging.log4j.core.pattern.NotANumber;","33","        String path = \"target\/test-classes\/rolloverPath\/log4j.txt.20170112_09-\" + NotANumber.VALUE + \".gz\";","52","            return getEligibleFiles(path, \"log4j.txt.%d{yyyyMMdd}-%i.gz\");"],"delete":["32","        String path = \"target\/test-classes\/rolloverPath\/log4j.txt.20170112_09--1.gz\";","51","            return getEligibleFiles(path);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/IntegerPatternConverter.java":[{"add":["59","            } else if (objects[i] instanceof NotANumber) {","60","                toAppendTo.append(NotANumber.VALUE);","61","                break;"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-rolling-size.xml":[{"add":[],"delete":[]}]}},"8f1fc1bf46cf054fd2dcf99faf1c731dc3e9e82d":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/HtmlLayoutTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/HtmlLayoutTest.java":[{"add":["26","import java.util.Locale;","265","        \/\/ LOG4J2-3019 HtmlLayoutTest.testLayoutWithDatePatternFixedFormat test fails on windows","266","        \/\/ https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-3019","267","        \/\/ java.time.format.DateTimeFormatterBuilder.toFormatter() defaults to using ","268","        \/\/ Locale.getDefault(Locale.Category.FORMAT)","269","        final Locale formatLocale = Locale.getDefault(Locale.Category.FORMAT);","270","        final Locale locale = Locale.getDefault().equals(formatLocale) ? formatLocale : Locale.getDefault();","271","        ","277","            DateTimeFormatter.ofPattern(format.getPattern().replace('n', 'S').replace('X', 'x'), locale);"],"delete":["269","            DateTimeFormatter.ofPattern(format.getPattern().replace('n', 'S').replace('X', 'x'));"]}]}},"d329cf38aa7ccffde137ed53443d909dd18efd49":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":"MODIFY","src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":[{"add":["23","import java.util.concurrent.ExecutorService;","43","import org.apache.logging.log4j.core.util.Loader;","61","    private static final String PROPERTY_ASYNC_NOTIF = \"log4j2.jmx.notify.async\";","62","    private static final String THREAD_NAME_PREFIX = \"log4j2.jmx.notif\";","64","    static final Executor executor = createExecutor();","70","     * Returns either a {@code null} Executor (causing JMX notifications to be sent from the caller thread) or a daemon","71","     * background thread Executor, depending on the value of system property \"log4j2.jmx.notify.async\". If this","72","     * property is not set, use a {@code null} Executor for web apps to avoid memory leaks and other issues when the","73","     * web app is restarted.","74","     * @see LOG4J2-938","75","     *\/","76","    private static ExecutorService createExecutor() {","77","        boolean defaultAsync = !isWebApp();","78","        boolean async = PropertiesUtil.getProperties().getBooleanProperty(PROPERTY_ASYNC_NOTIF, defaultAsync);","79","        return async ? Executors.newFixedThreadPool(1, new DaemonThreadFactory(THREAD_NAME_PREFIX)) : null;","80","    }","81","","82","    \/**","83","     * Returns {@code true} if we think we are running in a web container, based on the presence of the","84","     * {@code javax.servlet.Servlet} class in the classpath.","85","     *\/","86","    private static boolean isWebApp() {","87","        return Loader.isClassAvailable(\"javax.servlet.Servlet\");","88","    }","89","","90","    \/**"],"delete":["60","    static final Executor executor = Executors.newFixedThreadPool(1, new DaemonThreadFactory(\"log4j2.jmx.notif\"));"]}],"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["1426","    <td>log4j2.jmx.notify.async<\/td>","1427","    <td>false for web apps, true otherwise<\/td>","1428","    <td>","1429","      If <tt>true<\/tt>, log4j's JMX notifications are sent from a separate background thread,","1430","      otherwise they are sent from the caller thread.","1431","      If the <tt>javax.servlet.Servlet<\/tt> class is on the classpath, the default behaviour","1432","      is to use the caller thread to send JMX notifications.","1433","    <\/td>","1434","  <\/tr>","1435","  <tr>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-938\" dev=\"rpopma\" type=\"fix\" due-to=\"Mauro Molinari\">","27","        (JMX) To avoid memory leaks when web applications are restarted, JMX notifications are sent from","28","        the caller thread in web applications. For non-web applications notifications are sent from a background thread","29","        as before.","30","      <\/action>"],"delete":[]}]}},"995e3c3bcf210f14c796ae6f57e8008d8cfe31b8":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/AbstractKeyStoreConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/KeyStoreConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/TrustStoreConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/SslConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/AbstractKeyStoreConfiguration.java":[{"add":["75","    @Override","76","    public int hashCode() {","77","        final int prime = 31;","78","        int result = super.hashCode();","79","        result = prime * result + ((keyStore == null) ? 0 : keyStore.hashCode());","80","        result = prime * result + ((keyStoreType == null) ? 0 : keyStoreType.hashCode());","81","        return result;","82","    }","83","","84","    @Override","85","    public boolean equals(Object obj) {","86","        if (this == obj) {","87","            return true;","88","        }","89","        if (!super.equals(obj)) {","90","            return false;","91","        }","92","        if (getClass() != obj.getClass()) {","93","            return false;","94","        }","95","        AbstractKeyStoreConfiguration other = (AbstractKeyStoreConfiguration) obj;","96","        if (keyStore == null) {","97","            if (other.keyStore != null) {","98","                return false;","99","            }","100","        } else if (!keyStore.equals(other.keyStore)) {","101","            return false;","102","        }","103","        if (keyStoreType == null) {","104","            if (other.keyStoreType != null) {","105","                return false;","106","            }","107","        } else if (!keyStoreType.equals(other.keyStoreType)) {","108","            return false;","109","        }","110","        return true;","111","    }","112",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/KeyStoreConfiguration.java":[{"add":["74","","75","    @Override","76","    public int hashCode() {","77","        final int prime = 31;","78","        int result = super.hashCode();","79","        result = prime * result + ((keyManagerFactoryAlgorithm == null) ? 0 : keyManagerFactoryAlgorithm.hashCode());","80","        return result;","81","    }","82","","83","    @Override","84","    public boolean equals(Object obj) {","85","        if (this == obj) {","86","            return true;","87","        }","88","        if (!super.equals(obj)) {","89","            return false;","90","        }","91","        if (getClass() != obj.getClass()) {","92","            return false;","93","        }","94","        KeyStoreConfiguration other = (KeyStoreConfiguration) obj;","95","        if (keyManagerFactoryAlgorithm == null) {","96","            if (other.keyManagerFactoryAlgorithm != null) {","97","                return false;","98","            }","99","        } else if (!keyManagerFactoryAlgorithm.equals(other.keyManagerFactoryAlgorithm)) {","100","            return false;","101","        }","102","        return true;","103","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/TrustStoreConfiguration.java":[{"add":["72","","73","    @Override","74","    public int hashCode() {","75","        final int prime = 31;","76","        int result = super.hashCode();","77","        result = prime * result","78","                + ((trustManagerFactoryAlgorithm == null) ? 0 : trustManagerFactoryAlgorithm.hashCode());","79","        return result;","80","    }","81","","82","    @Override","83","    public boolean equals(Object obj) {","84","        if (this == obj) {","85","            return true;","86","        }","87","        if (!super.equals(obj)) {","88","            return false;","89","        }","90","        if (getClass() != obj.getClass()) {","91","            return false;","92","        }","93","        TrustStoreConfiguration other = (TrustStoreConfiguration) obj;","94","        if (trustManagerFactoryAlgorithm == null) {","95","            if (other.trustManagerFactoryAlgorithm != null) {","96","                return false;","97","            }","98","        } else if (!trustManagerFactoryAlgorithm.equals(other.trustManagerFactoryAlgorithm)) {","99","            return false;","100","        }","101","        return true;","102","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["170","      <action issue=\"LOG4J2-1603\" dev=\"ggregory\" type=\"fix\">","171","        Redo hashCode() and equals() methods in org.apache.logging.log4j.core.net.ssl classes.","172","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/SslConfiguration.java":[{"add":["222","","223","    @Override","224","    public int hashCode() {","225","        final int prime = 31;","226","        int result = 1;","227","        result = prime * result + ((keyStoreConfig == null) ? 0 : keyStoreConfig.hashCode());","228","        result = prime * result + ((protocol == null) ? 0 : protocol.hashCode());","229","        result = prime * result + ((sslContext == null) ? 0 : sslContext.hashCode());","230","        result = prime * result + ((trustStoreConfig == null) ? 0 : trustStoreConfig.hashCode());","231","        return result;","232","    }","233","","234","    @Override","235","    public boolean equals(Object obj) {","236","        if (this == obj) {","237","            return true;","238","        }","239","        if (obj == null) {","240","            return false;","241","        }","242","        if (getClass() != obj.getClass()) {","243","            return false;","244","        }","245","        SslConfiguration other = (SslConfiguration) obj;","246","        if (keyStoreConfig == null) {","247","            if (other.keyStoreConfig != null) {","248","                return false;","249","            }","250","        } else if (!keyStoreConfig.equals(other.keyStoreConfig)) {","251","            return false;","252","        }","253","        if (protocol == null) {","254","            if (other.protocol != null) {","255","                return false;","256","            }","257","        } else if (!protocol.equals(other.protocol)) {","258","            return false;","259","        }","260","        if (sslContext == null) {","261","            if (other.sslContext != null) {","262","                return false;","263","            }","264","        } else if (!sslContext.equals(other.sslContext)) {","265","            return false;","266","        }","267","        if (trustStoreConfig == null) {","268","            if (other.trustStoreConfig != null) {","269","                return false;","270","            }","271","        } else if (!trustStoreConfig.equals(other.trustStoreConfig)) {","272","            return false;","273","        }","274","        return true;","275","    }"],"delete":["206","    public boolean equals(final SslConfiguration config) {","207","        if (config == null) {","208","            return false;","209","        }","210","","211","        boolean keyStoreEquals = false;","212","        boolean trustStoreEquals = false;","213","","214","        if (keyStoreConfig != null) {","215","            keyStoreEquals = keyStoreConfig.equals(config.keyStoreConfig);","216","        } else {","217","            keyStoreEquals = keyStoreConfig == config.keyStoreConfig;","218","        }","219","","220","        if (trustStoreConfig != null) {","221","            trustStoreEquals = trustStoreConfig.equals(config.trustStoreConfig);","222","        } else {","223","            trustStoreEquals = trustStoreConfig == config.trustStoreConfig;","224","        }","225","","226","        return keyStoreEquals && trustStoreEquals;","227","    }","228",""]}]}},"6597356106f2ed2c56683f16fe6d84b160edacc5":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/GelfLayout.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/GelfLayout.java":[{"add":["41","import org.apache.logging.log4j.util.Strings;","48"," * This layout compresses JSON to GZIP or ZLIB (the {@code compressionType}) if","49"," * log event data is larger than 1024 bytes (the {@code compressionThreshold}).","50"," * This layout does not implement chunking.","68"," * @see <a href=\"http:\/\/graylog2.org\/resources\/gelf\/specification\">GELF","69"," *      specification<\/a>","196","        builder.append(\"\\\"host\\\":\\\"\").append(jsonEncoder.quoteAsString(toNullSafeString(host))).append(QC);","208","                    .append(jsonEncoder.quoteAsString(toNullSafeString(additionalField.getValue()))).append(QC);","212","                    .append(jsonEncoder.quoteAsString(toNullSafeString(entry.getValue()))).append(QC);","219","        builder.append(\"\\\"short_message\\\":\\\"\").append(jsonEncoder.quoteAsString(toNullSafeString(event.getMessage().getFormattedMessage())))","220","                .append(Q);","224","","225","    private String toNullSafeString(String s) {","226","        return s == null ? Strings.EMPTY : s;","227","    }"],"delete":["47"," * This layout compresses JSON to GZIP or ZLIB (the {@code compressionType}) if log event data is larger than 1024 bytes","48"," * (the {@code compressionThreshold}). This layout does not implement chunking.","66"," * @see <a href=\"http:\/\/graylog2.org\/resources\/gelf\/specification\">GELF specification<\/a>","193","        builder.append(\"\\\"host\\\":\\\"\").append(jsonEncoder.quoteAsString(host)).append(QC);","205","                    .append(jsonEncoder.quoteAsString(additionalField.getValue())).append(QC);","209","                    .append(jsonEncoder.quoteAsString(entry.getValue())).append(QC);","216","        builder.append(\"\\\"short_message\\\":\\\"\")","217","                .append(jsonEncoder.quoteAsString(event.getMessage().getFormattedMessage())).append(Q);"]}],"src\/changes\/changes.xml":[{"add":["125","      <action issue=\"LOG4J2-1078\" dev=\"ggregory\" type=\"fix\" due-to=\"Mikael St?ldal\">","126","        GelfLayout throws exception if some log event fields are null.","127","      <\/action>"],"delete":[]}]}},"980a05388974787a21eb42c18c3fe464388e559e":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-3284\" dev=\"ckozak\" type=\"fix\" due-to=\"Michael Vorburger\">","33","        log4j-to-slf4j takes the provided MessageFactory into account","34","      <\/action>"],"delete":[]}]}},"bb131d49d832302ab262233f72f2e597f28c8f9d":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","    <release version=\"2.0-rc2\" date=\"2014-MM-DD\" description=\"Bug fixes and enhancements\">    ","24","      <action issue=\"LOG4J2-651\" dev=\"ggregory\" type=\"fix\">","25","        Log4j 2 throws ArrayIndexOutOfBoundsException.","26","      <\/action>"],"delete":["23","    <release version=\"2.0-rc2\" date=\"2014-MM-DD\" description=\"Bug fixes and enhancements\">"]}]}},"e1d0d99ea10437621269c500f8696107cb2b0923":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/Rfc5424Layout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-944\" dev=\"ggregory\" type=\"fix\" due-to=\"Vinayaka Ramachandra\">","27","        Log4j Flume appender is not adding millisecond to the event headers when the event is logged at 000 milliseconds.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/Rfc5424Layout.java":[{"add":["453","        buffer.append('.');","454","        pad(cal.get(Calendar.MILLISECOND), THREE_DIGITS, buffer);"],"delete":["453","","454","        final int millis = cal.get(Calendar.MILLISECOND);","455","        if (millis != 0) {","456","            buffer.append('.');","457","            pad(millis, THREE_DIGITS, buffer);","458","        }"]}]}},"0aae2f16ae1c08230c4c428d1f451a8368a9d2a5":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/MarkerPatternSelector.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/MarkerPatternSelector.java":[{"add":["100","            LOGGER.warn(\"No marker patterns were provided with PatternMatch\");","101","            return null;"],"delete":["100","            LOGGER.warn(\"No marker patterns were provided\");"]}],"src\/changes\/changes.xml":[{"add":["161","      <action issue=\"LOG4J2-1600\" dev=\"ggregory\" type=\"fix\">","162","        NPE due to org.apache.logging.log4j.core.layout.MarkerPatternSelector.createSelector(PatternMatch[], String, boolean, boolean, Configuration).","163","      <\/action>"],"delete":[]}]}},"e9b628ec5d3c45a5fa6a1160119d15cf31d60138":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/JsonInputStreamLogEventBridge.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/AbstractSocketServerTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/JsonInputStreamLogEventBridge.java":[{"add":["57","            if (inEsc) {","58","            \t\/\/ Skip this char and continue","59","            \tinEsc = false;","60","            } else { "],"delete":["57","            if (!inEsc) {","58","                inEsc = false;"]}],"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1069\" dev=\"ggregory\" type=\"fix\" due-to=\"Sam Braam\">\r","51","        Improper handling of JSON escape chars when deserializing JSON log events.\r","52","      <\/action>\r"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/AbstractSocketServerTest.java":[{"add":["71","    ","72","    private static final String MESSAGE_WITH_SPECIAL_CHARS = \"{This}\\n[is]\\\"n\\\"a\\\"\\r\\ntrue:\\n\\ttest,\\nmessage\";","73","    ","162","    ","163","    ","164","    @Test","165","    public void testMessagesWithSpecialChars() throws Exception {","166","        testServer(MESSAGE_WITH_SPECIAL_CHARS);","167","    }","168","    "],"delete":["71",""]}]}},"82d689c920f8cee617da351c18a0c552dd182e87":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["140","        Thread runner = new Thread(new ThreadContextDataTask(), \"Thread Context Data Task\");","141","        runner.setDaemon(true);","142","        runner.start();","171","        Thread runner = new Thread(new ThreadContextDataTask(), \"Thread Context Data Task\");","172","        runner.setDaemon(true);","173","        runner.start();","781","    private class ThreadContextDataTask implements Runnable {","782","","783","        @Override","784","        public void run() {","785","            LOGGER.debug(\"Initializing Thread Context Data Service Providers\");","786","            ThreadContextDataInjector.initServiceProviders();","787","            LOGGER.debug(\"Thread Context Data Service Provider initialization complete\");","788","        }","789","    }"],"delete":["140","        CompletableFuture.runAsync(ThreadContextDataInjector::initServiceProviders);","169","        CompletableFuture.runAsync(ThreadContextDataInjector::initServiceProviders);"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3006\" dev=\"rgoers\" type=\"fix\">","34","        Directly create a thread instead of using the common ForkJoin pool when initializing ThreadContextDataInjector\"","35","      <\/action>"],"delete":[]}]}},"66e797329937213f27fbdf9b01c2d39755ec54b8":{"changes":{"api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLogger.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/LoggerTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLoggerWrapper.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":"ADD"},"diff":{"api\/src\/test\/java\/org\/apache\/logging\/log4j\/SimpleLogger.java":[{"add":["79","    protected boolean isEnabled(Level level, Marker marker, String msg, Object... p1) {"],"delete":["68","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3,","69","                                Object...params) {","70","        return true;","71","    }","72","","73","    @Override","85","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1) {","86","        return true;","87","    }","88","","89","    @Override","90","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2) {","91","        return true;","92","    }","93","","94","    @Override","95","    protected boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3) {"]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/LoggerTest.java":[{"add":["69","                results.get(0).startsWith(\" ERROR catching java.lang.NullPointerException\"));"],"delete":["69","                results.get(0).startsWith(\" DEBUG catching java.lang.NullPointerException\"));"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":[{"add":["129","    public boolean isEnabled(Level level, Marker marker, String msg, Object... p1) {","305","        boolean filter(Level level, Marker marker, String msg, Object... p1) {"],"delete":["129","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1) {","134","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2) {","135","        return config.filter(level, marker, msg, p1, p2);","136","    }","137","","138","    @Override","139","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3) {","140","        return config.filter(level, marker, msg, p1, p2, p3);","141","    }","142","","143","    @Override","144","    public boolean isEnabled(Level level, Marker marker, String msg, Object p1, Object p2, Object p3,","145","                                Object... params) {","146","        return config.filter(level, marker, msg, p1, p2, p3, params);","147","    }","148","","149","    @Override","321","        boolean filter(Level level, Marker marker, String msg, Object p1) {","334","        boolean filter(Level level, Marker marker, String msg, Object p1, Object p2) {","335","            config.getConfigurationMonitor().checkConfiguration();","336","            Filter filter = config.getFilter();","337","            if (filter != null) {","338","                Filter.Result r = filter.filter(logger, level, marker, msg, p1, p2);","339","                if (r != Filter.Result.NEUTRAL) {","340","                    return r == Filter.Result.ACCEPT;","341","                }","342","            }","343","","344","            return intLevel >= level.intLevel();","345","        }","346","","347","        boolean filter(Level level, Marker marker, String msg, Object p1, Object p2, Object p3) {","348","            config.getConfigurationMonitor().checkConfiguration();","349","            Filter filter = config.getFilter();","350","            if (filter != null) {","351","                Filter.Result r = filter.filter(logger, level, marker, msg, p1, p2, p3);","352","                if (r != Filter.Result.NEUTRAL) {","353","                    return r == Filter.Result.ACCEPT;","354","                }","355","            }","356","","357","            return intLevel >= level.intLevel();","358","        }","359","","360","        boolean filter(Level level, Marker marker, String msg, Object p1, Object p2, Object p3,","361","                       Object... params) {","362","            config.getConfigurationMonitor().checkConfiguration();","363","            Filter filter = config.getFilter();","364","            if (filter != null) {","365","                Filter.Result r = filter.filter(logger, level, marker, msg, p1, p2, p3, params);","366","                if (r != Filter.Result.NEUTRAL) {","367","                    return r == Filter.Result.ACCEPT;","368","                }","369","            }","370","","371","            return intLevel >= level.intLevel();","372","        }","373",""]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":["140","        if (isEnabled(Level.DEBUG, CATCHING_MARKER, (Object) null, null)) {","141","            log(CATCHING_MARKER, FQCN, Level.ERROR, new SimpleMessage(\"catching\"), t);","152","        if (isEnabled(level, CATCHING_MARKER, (Object) null, null)) {","153","            log(CATCHING_MARKER, FQCN, level, new SimpleMessage(\"catching\"), t);","523","        if (isEnabled(Level.DEBUG, null, msg, null)) {","524","            log(null, FQCN, Level.DEBUG, msg, null);","535","        if (isEnabled(Level.DEBUG, null, msg, t)) {","536","            log(null, FQCN, Level.DEBUG, msg, t);","793","            log(null, FQCN, Level.WARN, new SimpleMessage(message), t);","807","            log(marker, FQCN, Level.WARN, new SimpleMessage(message), t);","843","            log(null, FQCN, Level.WARN, new ObjectMessage(message), t);","857","            log(marker, FQCN, Level.WARN, new ObjectMessage(message), t);","1289","        return isEnabled(Level.FATAL, null, (Object) null, null);","1392","     * @param p1 The parameters.","1395","    protected abstract boolean isEnabled(Level level, Marker marker, String data, Object... p1);"],"delete":["140","        if (isEnabled(Level.DEBUG, THROWING_MARKER, (Object) null, null)) {","141","            log(THROWING_MARKER, FQCN, Level.DEBUG, new SimpleMessage(\"catching\"), t);","152","        if (isEnabled(level, THROWING_MARKER, (Object) null, null)) {","153","            log(THROWING_MARKER, FQCN, level, new SimpleMessage(\"catching\"), t);","523","        if (isEnabled(Level.TRACE, null, msg, null)) {","524","            log(null, FQCN, Level.TRACE, msg, null);","535","        if (isEnabled(Level.TRACE, null, msg, t)) {","536","            log(null, FQCN, Level.TRACE, msg, t);","793","            log(null, FQCN, Level.DEBUG, new SimpleMessage(message), t);","807","            log(marker, FQCN, Level.DEBUG, new SimpleMessage(message), t);","843","            log(null, FQCN, Level.DEBUG, new ObjectMessage(message), t);","857","            log(marker, FQCN, Level.DEBUG, new ObjectMessage(message), t);","1289","        return isEnabled(Level.ERROR, null, (Object) null, null);","1392","     * @param p1 The first parameter.","1395","    protected abstract boolean isEnabled(Level level, Marker marker, String data, Object p1);","1396","","1397","    \/**","1398","     * Determine if logging is enabled.","1399","     * @param level The logging Level to check.","1400","     * @param marker A Marker or null.","1401","     * @param data The message.","1402","     * @param p1 The first parameter.","1403","     * @param p2 The second parameter.","1404","     * @return True if logging is enabled, false otherwise.","1405","     *\/","1406","    protected abstract boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2);","1407","","1408","    \/**","1409","     * Determine if logging is enabled.","1410","     * @param level The logging Level to check.","1411","     * @param marker A Marker or null.","1412","     * @param data The message.","1413","     * @param p1 The first parameter.","1414","     * @param p2 The second parameter.","1415","     * @param p3 The third parameter.","1416","     * @return True if logging is enabled, false otherwise.","1417","     *\/","1418","    protected abstract boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2, Object p3);","1419","","1420","","1421","    \/**","1422","     * Determine if logging is enabled.","1423","     * @param level The logging Level to check.","1424","     * @param marker A Marker or null.","1425","     * @param data The message.","1426","     * @param p1 The first parameter.","1427","     * @param p2 The second parameter.","1428","     * @param p3 The third parameter.","1429","     * @param params More message parameters.","1430","     * @return True if logging is enabled, false otherwise.","1431","     *\/","1432","    protected abstract boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2,","1433","                                         Object p3, Object... params);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-88\" dev=\"rgoers\" type=\"fix\">","26","        Many logging methods in AbstractLogger were set to an incorrect logging level. catching was","27","        using the THROWING marker and was set to debug instead of error.","28","      <\/action>"],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":[{"add":["195","    protected boolean isEnabled(Level level, Marker marker, String data, Object... p1) {"],"delete":["195","    protected boolean isEnabled(Level level, Marker marker, String data, Object p1) {","196","        return isEnabled(level, marker);","197","    }","198","","199","    @Override","200","    protected boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2) {","201","        return isEnabled(level, marker);","202","    }","203","","204","    @Override","205","    protected boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2, Object p3) {","206","        return isEnabled(level, marker);","207","    }","208","","209","    @Override","210","    protected boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2, Object p3,","211","                                Object... params) {"]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLoggerWrapper.java":[{"add":["89","     * @param p1 The parameters.","93","    public boolean isEnabled(Level level, Marker marker, String data, Object... p1) {"],"delete":["89","     * @param p1 The first parameter.","93","    public boolean isEnabled(Level level, Marker marker, String data, Object p1) {","102","     * @param p1 The first parameter.","103","     * @param p2 The second parameter.","104","     * @return true if the event would be logged for the Level, Marker, data and parameters.","105","     *\/","106","    @Override","107","    public boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2) {","108","        return logger.isEnabled(level, marker, data, p1, p2);","109","    }","110","","111","    \/**","112","     * Detect if the event would be logged.","113","     * @param level The logging Level to check.","114","     * @param marker A Marker or null.","115","     * @param data The message.","116","     * @param p1 The first parameter.","117","     * @param p2 The second parameter.","118","     * @param p3 The third parameter.","119","     * @return true if the event would be logged for the Level, Marker, data and parameters.","120","     *\/","121","    @Override","122","    public boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2, Object p3) {","123","        return logger.isEnabled(level, marker, data, p1, p2, p3);","124","    }","125","","126","    \/**","127","     * Detect if the event would be logged.","128","     * @param level The logging Level to check.","129","     * @param marker A Marker or null.","130","     * @param data The message.","131","     * @param p1 The first parameter.","132","     * @param p2 The second parameter.","133","     * @param p3 The third parameter.","134","     * @param params More message parameters.","135","     * @return true if the event would be logged for the Level, Marker, data and parameters.","136","     *\/","137","    @Override","138","    public boolean isEnabled(Level level, Marker marker, String data, Object p1, Object p2, Object p3,","139","                                Object... params) {","140","        return logger.isEnabled(level, marker, data, p2, p2, p3, params);","141","    }","142","","143","    \/**","144","     * Detect if the event would be logged.","145","     * @param level The logging Level to check.","146","     * @param marker A Marker or null.","147","     * @param data The message."]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":[{"add":[],"delete":[]}]}},"eb8fefc059caf74a1e08bb086739c200a5a96f7d":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["79","      <action issue=\"LOG4J2-925\" dev=\"ggregory\" type=\"update\">","80","        Update from Jackson 2.4.4 to 2.5.0.","81","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["166","    <jackson2Version>2.5.0<\/jackson2Version>"],"delete":["166","    <jackson2Version>2.4.4<\/jackson2Version>"]}]}},"7f075a710230484cd7f9f3850b57d4cb7ee4ec9f":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTranslator.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/DummyNanoClock.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/JacksonFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClock.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClockFactory.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LogEventTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JpaHyperSqlAppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/AbstractLogEventWrapperEntity.java":"MODIFY","log4j-core\/src\/main\/resources\/Log4j-events.xsd":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTestNanoTime.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClockFactoryTest.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventNanoTimeTest.java":"ADD","log4j-core\/src\/test\/resources\/log4j2-config.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NanoTimePatternConverterTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY","log4j-core\/src\/test\/resources\/NanoTimeToFileTest.xml":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jackson\/JsonConstants.java":"MODIFY","log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JpaH2AppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NanoTimePatternConverter.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractLogEvent.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY","src\/site\/xdoc\/manual\/layouts.xml.vm":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemNanoClock.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/TestBaseEntity.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/DummyNanoClockTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/BasicLogEventEntity.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemNanoClockTest.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTranslator.java":[{"add":["48","    private long nanoTime;","55","                currentTimeMillis, nanoTime);","75","                0, \/\/ currentTimeMillis","76","                0 \/\/ nanoTime","84","            final StackTraceElement location, final long currentTimeMillis, final long nanoTime) {","97","        this.nanoTime = nanoTime;"],"delete":["54","                currentTimeMillis);","74","                0 \/\/ currentTimeMillis","82","            final StackTraceElement location, final long currentTimeMillis) {","96",""]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTest.java":[{"add":["60","        final long nanoTime = 1;","62","                contextStack, threadName, location, currentTimeMillis, nanoTime);","80","        final long nanoTime = 1;","82","                contextStack, threadName, location, currentTimeMillis, nanoTime);","100","        final long nanoTime = 1;","102","                contextStack, threadName, location, currentTimeMillis, nanoTime);","120","        final long nanoTime = 1;","122","                contextStack, threadName, location, currentTimeMillis, nanoTime);","159","        final long nanoTime = 1;","161","                contextStack, threadName, location, currentTimeMillis, nanoTime);"],"delete":["61","                contextStack, threadName, location, currentTimeMillis);","80","                contextStack, threadName, location, currentTimeMillis);","99","                contextStack, threadName, location, currentTimeMillis);","118","                contextStack, threadName, location, currentTimeMillis);","156","                contextStack, threadName, location, currentTimeMillis);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/DummyNanoClock.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/JacksonFactory.java":[{"add":["51","        protected String getPropertNameForNanoTime() {","52","            return JsonConstants.ELT_NANO_TIME;","53","        }","54","","55","        @Override","84","        protected String getPropertNameForNanoTime() {","85","            return JsonConstants.ELT_NANO_TIME;","86","        }","87","","88","        @Override","108","    ","109","    abstract protected String getPropertNameForNanoTime();","126","        except.add(this.getPropertNameForNanoTime());"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClock.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClockFactory.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LogEventTest.java":[{"add":["74","    @Test","75","    public void testNanoTimeIsNotSerialized1() throws Exception {","76","        final LogEvent event1 = Log4jLogEvent.newBuilder() \/\/","77","                .setLoggerName(this.getClass().getName()) \/\/","78","                .setLoggerFqcn(\"org.apache.logging.log4j.core.Logger\") \/\/","79","                .setLevel(Level.INFO) \/\/","80","                .setMessage(new SimpleMessage(\"Hello, world!\")) \/\/","81","                .setThreadName(\"this must be initialized or the test fails\") \/\/","82","                .setNanoTime(12345678L) \/\/","83","                .build();","84","        final LogEvent copy = new Log4jLogEvent.Builder(event1).build();","85","","86","        final ByteArrayOutputStream baos = new ByteArrayOutputStream();","87","        final ObjectOutputStream oos = new ObjectOutputStream(baos);","88","        oos.writeObject(event1);","89","","90","        final ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());","91","        final ObjectInputStream ois = new ObjectInputStream(bais);","92","        ","93","        LogEvent actual = (LogEvent) ois.readObject();","94","        assertNotEquals(\"Different event: nanoTime\", copy, actual);","95","        assertNotEquals(\"Different nanoTime\", copy.getNanoTime(), actual.getNanoTime());","96","        assertEquals(\"deserialized nanoTime is zero\", 0, actual.getNanoTime());","97","    }","98","","99","    @Test","100","    public void testNanoTimeIsNotSerialized2() throws Exception {","101","        final LogEvent event1 = Log4jLogEvent.newBuilder() \/\/","102","                .setLoggerName(this.getClass().getName()) \/\/","103","                .setLoggerFqcn(\"org.apache.logging.log4j.core.Logger\") \/\/","104","                .setLevel(Level.INFO) \/\/","105","                .setMessage(new SimpleMessage(\"Hello, world!\")) \/\/","106","                .setThreadName(\"this must be initialized or the test fails\") \/\/","107","                .setNanoTime(0) \/\/","108","                .build();","109","        final LogEvent event2 = new Log4jLogEvent.Builder(event1).build();","110","","111","        final ByteArrayOutputStream baos = new ByteArrayOutputStream();","112","        final ObjectOutputStream oos = new ObjectOutputStream(baos);","113","        oos.writeObject(event1);","114","","115","        final ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());","116","        final ObjectInputStream ois = new ObjectInputStream(bais);","117","        ","118","        LogEvent actual = (LogEvent) ois.readObject();","119","        assertEquals(\"both zero nanoTime\", event2, actual);","120","    }","121",""],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventTest.java":[{"add":["23","import java.util.Collections;","24","import java.util.HashMap;","25","import java.util.Map;","31","import org.apache.logging.log4j.MarkerManager;","32","import org.apache.logging.log4j.ThreadContext;","33","import org.apache.logging.log4j.ThreadContext.ContextStack;","38","import org.apache.logging.log4j.core.util.DummyNanoClock;","40","import org.apache.logging.log4j.message.ObjectMessage;","203","    }","204","    ","205","    @Test","206","    public void testInitiallyDummyNanoClock() {","207","        assertTrue(Log4jLogEvent.getNanoClock() instanceof DummyNanoClock);","208","        assertEquals(\"initial dummy nanotime\", 0, Log4jLogEvent.getNanoClock().nanoTime());","209","    }","210","    ","211","    @Test","212","    public void testNanoTimeGeneratedByNanoClock() {","213","        Log4jLogEvent.setNanoClock(new DummyNanoClock(123));","214","        verifyNanoTimeWithAllConstructors(123);","215","        Log4jLogEvent.setNanoClock(new DummyNanoClock(87654));","216","        verifyNanoTimeWithAllConstructors(87654);","217","    }","219","    @SuppressWarnings(\"deprecation\")","220","    private void verifyNanoTimeWithAllConstructors(long expected) {","221","        assertEquals(expected, Log4jLogEvent.getNanoClock().nanoTime());","222","","223","        assertEquals(\"No-arg constructor\", expected, new Log4jLogEvent().getNanoTime());","224","        assertEquals(\"1-arg constructor\", expected, new Log4jLogEvent(98).getNanoTime());","225","        assertEquals(\"6-arg constructor\", expected, new Log4jLogEvent(\"l\", null, \"a\", null, null, null).getNanoTime());","226","        assertEquals(\"7-arg constructor\", expected, new Log4jLogEvent(\"l\", null, \"a\", null, null, null, null)","227","                .getNanoTime());","228","        assertEquals(\"11-arg constructor\", expected, new Log4jLogEvent(\"l\", null, \"a\", null, null, null, null, null,","229","                null, null, 0).getNanoTime());","230","        assertEquals(\"12-arg factory method\", expected, Log4jLogEvent.createEvent(\"l\", null, \"a\", null, null, null,","231","                null, null, null, null, null, 0).getNanoTime());","232","    }","233","    ","234","    @Test","235","    public void testBuilderCorrectlyCopiesAllEventAttributes() {","236","        final Map<String, String> contextMap = new HashMap<String, String>();","237","        contextMap.put(\"A\", \"B\");","238","        final ContextStack contextStack = ThreadContext.getImmutableStack();","239","        final Exception exception = new Exception(\"test\");","240","        final Marker marker = MarkerManager.getMarker(\"EVENTTEST\");","241","        final Message message = new SimpleMessage(\"foo\");","242","        final StackTraceElement stackTraceElement = new StackTraceElement(\"A\", \"B\", \"file\", 123);","243","        final String fqcn = \"qualified\";","244","        final String name = \"Ceci n'est pas une pipe\";","245","        final String threadName = \"threadName\";","246","        final Log4jLogEvent event = Log4jLogEvent.newBuilder() \/\/","247","                .setContextMap(contextMap) \/\/","248","                .setContextStack(contextStack) \/\/","249","                .setEndOfBatch(true) \/\/","250","                .setIncludeLocation(true) \/\/","251","                .setLevel(Level.FATAL) \/\/","252","                .setLoggerFqcn(fqcn) \/\/","253","                .setLoggerName(name) \/\/","254","                .setMarker(marker) \/\/","255","                .setMessage(message) \/\/","256","                .setNanoTime(1234567890L) \/\/","257","                .setSource(stackTraceElement) \/\/","258","                .setThreadName(threadName) \/\/","259","                .setThrown(exception) \/\/","260","                .setTimeMillis(987654321L)","261","                .build();","262","        ","263","        assertSame(contextMap, event.getContextMap());","264","        assertSame(contextStack, event.getContextStack());","265","        assertEquals(true, event.isEndOfBatch());","266","        assertEquals(true, event.isIncludeLocation());","267","        assertSame(Level.FATAL, event.getLevel());","268","        assertSame(fqcn, event.getLoggerFqcn());","269","        assertSame(name, event.getLoggerName());","270","        assertSame(marker, event.getMarker());","271","        assertSame(message, event.getMessage());","272","        assertEquals(1234567890L, event.getNanoTime());","273","        assertSame(stackTraceElement, event.getSource());","274","        assertSame(threadName, event.getThreadName());","275","        assertSame(exception, event.getThrown());","276","        assertEquals(987654321L, event.getTimeMillis());","277","        ","278","        LogEvent event2 = new Log4jLogEvent.Builder(event).build();","279","        assertEquals(\"copy constructor builder\", event2, event);","280","        assertEquals(\"same hashCode\", event2.hashCode(), event.hashCode());","281","    }","282","    ","283","    @Test","284","    public void testEquals() {","285","        final Map<String, String> contextMap = new HashMap<String, String>();","286","        contextMap.put(\"A\", \"B\");","287","        ThreadContext.push(\"first\");","288","        final ContextStack contextStack = ThreadContext.getImmutableStack();","289","        final Exception exception = new Exception(\"test\");","290","        final Marker marker = MarkerManager.getMarker(\"EVENTTEST\");","291","        final Message message = new SimpleMessage(\"foo\");","292","        final StackTraceElement stackTraceElement = new StackTraceElement(\"A\", \"B\", \"file\", 123);","293","        final String fqcn = \"qualified\";","294","        final String name = \"Ceci n'est pas une pipe\";","295","        final String threadName = \"threadName\";","296","        final Log4jLogEvent event = Log4jLogEvent.newBuilder() \/\/","297","                .setContextMap(contextMap) \/\/","298","                .setContextStack(contextStack) \/\/","299","                .setEndOfBatch(true) \/\/","300","                .setIncludeLocation(true) \/\/","301","                .setLevel(Level.FATAL) \/\/","302","                .setLoggerFqcn(fqcn) \/\/","303","                .setLoggerName(name) \/\/","304","                .setMarker(marker) \/\/","305","                .setMessage(message) \/\/","306","                .setNanoTime(1234567890L) \/\/","307","                .setSource(stackTraceElement) \/\/","308","                .setThreadName(threadName) \/\/","309","                .setThrown(exception) \/\/","310","                .setTimeMillis(987654321L)","311","                .build();","312","        ","313","        assertSame(contextMap, event.getContextMap());","314","        assertSame(contextStack, event.getContextStack());","315","        assertEquals(true, event.isEndOfBatch());","316","        assertEquals(true, event.isIncludeLocation());","317","        assertSame(Level.FATAL, event.getLevel());","318","        assertSame(fqcn, event.getLoggerFqcn());","319","        assertSame(name, event.getLoggerName());","320","        assertSame(marker, event.getMarker());","321","        assertSame(message, event.getMessage());","322","        assertEquals(1234567890L, event.getNanoTime());","323","        assertSame(stackTraceElement, event.getSource());","324","        assertSame(threadName, event.getThreadName());","325","        assertSame(exception, event.getThrown());","326","        assertEquals(987654321L, event.getTimeMillis());","327","        ","328","        final LogEvent event2 = builder(event).build();","329","        assertEquals(\"copy constructor builder\", event2, event);","330","        assertEquals(\"same hashCode\", event2.hashCode(), event.hashCode());","331","        ","332","        assertSame(contextMap, event2.getContextMap());","333","        assertSame(contextStack, event2.getContextStack());","334","        assertEquals(true, event2.isEndOfBatch());","335","        assertEquals(true, event2.isIncludeLocation());","336","        assertSame(Level.FATAL, event2.getLevel());","337","        assertSame(fqcn, event2.getLoggerFqcn());","338","        assertSame(name, event2.getLoggerName());","339","        assertSame(marker, event2.getMarker());","340","        assertSame(message, event2.getMessage());","341","        assertEquals(1234567890L, event2.getNanoTime());","342","        assertSame(stackTraceElement, event2.getSource());","343","        assertSame(threadName, event2.getThreadName());","344","        assertSame(exception, event2.getThrown());","345","        assertEquals(987654321L, event2.getTimeMillis());","346","        ","347","        final Map<String, String> differentMap = Collections.emptyMap();","348","        different(\"different contextMap\", builder(event).setContextMap(differentMap), event);","349","        different(\"null contextMap\", builder(event).setContextMap(null), event);","350","","351","        ThreadContext.push(\"abc\");","352","        final ContextStack contextStack2 = ThreadContext.getImmutableStack();","353","        different(\"different contextStack\", builder(event).setContextStack(contextStack2), event);","354","        different(\"null contextStack\", builder(event).setContextStack(null), event);","355","","356","        different(\"different EndOfBatch\", builder(event).setEndOfBatch(false), event);","357","        different(\"different IncludeLocation\", builder(event).setIncludeLocation(false), event);","358","","359","        different(\"different level\", builder(event).setLevel(Level.INFO), event);","360","        different(\"null level\", builder(event).setLevel(null), event);","361","","362","        different(\"different fqcn\", builder(event).setLoggerFqcn(\"different\"), event);","363","        different(\"null fqcn\", builder(event).setLoggerFqcn(null), event);","364","","365","        different(\"different name\", builder(event).setLoggerName(\"different\"), event);","366","        try { \/\/ TODO null logger name throws NPE in equals. Use Objects.requireNonNull in constructor?","367","            different(\"null name\", builder(event).setLoggerName(null), event);","368","            fail(\"Expected NullPointerException\");","369","        } catch (NullPointerException ok) {","370","        }","371","","372","        different(\"different marker\", builder(event).setMarker(MarkerManager.getMarker(\"different\")), event);","373","        different(\"null marker\", builder(event).setMarker(null), event);","374","","375","        different(\"different message\", builder(event).setMessage(new ObjectMessage(\"different\")), event);","376","        try { \/\/ TODO null message throws NPE in equals(). Use Objects.requireNonNull in constructor?","377","            different(\"null message\", builder(event).setMessage(null), event);","378","            fail(\"Expected NullPointerException\");","379","        } catch (NullPointerException ok) {","380","        }","381","","382","        different(\"different nanoTime\", builder(event).setNanoTime(135), event);","383","        different(\"different milliTime\", builder(event).setTimeMillis(137), event);","384","","385","        final StackTraceElement stack2 = new StackTraceElement(\"XXX\", \"YYY\", \"file\", 123);","386","        different(\"different source\", builder(event).setSource(stack2), event);","387","        different(\"null source\", builder(event).setSource(null), event);","388","        ","389","        different(\"different threadname\", builder(event).setThreadName(\"different\"), event);","390","        different(\"null threadname\", builder(event).setThreadName(null), event);","391","        ","392","        different(\"different exception\", builder(event).setThrown(new Error(\"Boo!\")), event);","393","        different(\"null exception\", builder(event).setThrown(null), event);","394","    }","395","    ","396","    private static Log4jLogEvent.Builder builder(LogEvent event) {","397","        return new Log4jLogEvent.Builder(event);","398","    }","399","    ","400","    private void different(String reason, Log4jLogEvent.Builder builder, LogEvent event) {","401","        final LogEvent other = builder.build();","402","        assertNotEquals(reason, other, event);","403","        assertNotEquals(reason + \" hashCode\", other.hashCode(), event.hashCode());"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["31","import org.apache.logging.log4j.core.util.NanoClockFactory;","114","        final String expected = \"INFO  [PatternParserTest        :98  ] - Hello, world\" + Constants.LINE_SEPARATOR;","226","    ","227","    @Test","228","    public void testNanoPatternShort() {","229","        final List<PatternFormatter> formatters = parser.parse(\"%N\");","230","        assertNotNull(formatters);","231","        assertEquals(1, formatters.size());","232","        assertTrue(formatters.get(0).getConverter() instanceof NanoTimePatternConverter);","233","    }","234","    ","235","    @Test","236","    public void testNanoPatternLong() {","237","        final List<PatternFormatter> formatters = parser.parse(\"%nano\");","238","        assertNotNull(formatters);","239","        assertEquals(1, formatters.size());","240","        assertTrue(formatters.get(0).getConverter() instanceof NanoTimePatternConverter);","241","    }","242","    ","243","    @Test","244","    public void testNanoPatternShortChangesNanoClockFactoryMode() {","245","        parser.parse(\"%m\");","246","        assertEquals(NanoClockFactory.Mode.Dummy, NanoClockFactory.getMode());","247","        parser.parse(\"%nano\");","248","        assertEquals(NanoClockFactory.Mode.System, NanoClockFactory.getMode());","249","    }","250","    ","251","    @Test","252","    public void testNanoPatternLongChangesNanoClockFactoryMode() {","253","        parser.parse(\"%m\");","254","        assertEquals(NanoClockFactory.Mode.Dummy, NanoClockFactory.getMode());","255","        parser.parse(\"%N\");","256","        assertEquals(NanoClockFactory.Mode.System, NanoClockFactory.getMode());","257","    }"],"delete":["113","        final String expected = \"INFO  [PatternParserTest        :97  ] - Hello, world\" + Constants.LINE_SEPARATOR;","225",""]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JpaHyperSqlAppenderTest.java":[{"add":["50","                \"id INTEGER IDENTITY, timemillis BIGINT, nanoTime BIGINT, level VARCHAR(10), loggerName VARCHAR(255), \" +"],"delete":["50","                \"id INTEGER IDENTITY, timemillis BIGINT, level VARCHAR(10), loggerName VARCHAR(255), \" +"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/AbstractLogEventWrapperEntity.java":[{"add":["174","    public void setNanoTime(final long nanoTime) {","175","        \/\/ this entity is write-only","176","    }","177","","178","    \/**","179","     * A no-op mutator to satisfy JPA requirements, as this entity is write-only.","180","     *","181","     * @param millis Ignored.","182","     *\/","183","    @SuppressWarnings(\"unused\")"],"delete":[]}],"log4j-core\/src\/main\/resources\/Log4j-events.xsd":[{"add":["58","                        <xs:attribute name=\"nanoTime\" type=\"xs:long\" use=\"optional\"\/>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTestNanoTime.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/NanoClockFactoryTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTest.java":[{"add":["27","import org.apache.logging.log4j.core.util.DummyNanoClock;","70","    ","71","    @Test","72","    public void testNanoClockInitiallyDummy() {","73","        assertTrue(AsyncLogger.getNanoClock() instanceof DummyNanoClock);","74","    }"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventNanoTimeTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j2-config.xml":[{"add":["24","      <PatternLayout pattern=\"%m%n\"\/>"],"delete":["24","      <PatternLayout pattern=\"${env:PATH} %m%n\"\/>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":[{"add":["72","    private long nanoTime;","77","            final StackTraceElement location, final long currentTimeMillis, final long nanoTime) {","91","        this.nanoTime = nanoTime;","206","    ","207","    @Override","208","    public long getNanoTime() {","209","        return nanoTime;","210","    }","255","                0, \/\/ currentTimeMillis","256","                0 \/\/ nanoTime","274","","275","    \/**","276","     * Initializes the specified {@code Log4jLogEvent.Builder} from this {@code RingBufferLogEvent}.","277","     * @param builder the builder whose fields to populate","278","     *\/","279","    public void initializeBuilder(Log4jLogEvent.Builder builder) {","280","        builder.setContextMap(contextMap) \/\/","281","                .setContextStack(contextStack) \/\/","282","                .setEndOfBatch(endOfBatch) \/\/","283","                .setIncludeLocation(includeLocation) \/\/","284","                .setLevel(getLevel()) \/\/ ensure non-null","285","                .setLoggerFqcn(fqcn) \/\/","286","                .setLoggerName(loggerName) \/\/","287","                .setMarker(marker) \/\/","288","                .setMessage(getMessage()) \/\/ ensure non-null","289","                .setNanoTime(nanoTime) \/\/","290","                .setSource(location) \/\/","291","                .setThreadName(threadName) \/\/","292","                .setThrown(getThrown()) \/\/ may deserialize from thrownProxy","293","                .setThrownProxy(thrownProxy) \/\/ avoid unnecessarily creating thrownProxy","294","                .setTimeMillis(currentTimeMillis) \/\/","295","                ;        ","296","    }"],"delete":["76","            final StackTraceElement location, final long currentTimeMillis) {","248","                0 \/\/ currentTimeMillis"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["31","import org.apache.logging.log4j.core.async.AsyncLogger;","39","import org.apache.logging.log4j.core.impl.Log4jLogEvent;","42","import org.apache.logging.log4j.core.util.NanoClockFactory;","49","import static org.apache.logging.log4j.core.util.ShutdownCallbackRegistry.*;","379","            Log4jLogEvent.setNanoClock(NanoClockFactory.createNanoClock());","380","            try {","381","                AsyncLogger.setNanoClock(NanoClockFactory.createNanoClock());","382","            } catch (Throwable ignored) {","383","                \/\/ LMAX Disruptor jar may not be in the classpath. Ignore this.","384","                LOGGER.debug(\"Could not set AsyncLogger NanoClock. Ignoring: \", ignored);","385","            }"],"delete":["46","import static org.apache.logging.log4j.core.util.ShutdownCallbackRegistry.SHUTDOWN_HOOK_MARKER;"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NanoTimePatternConverterTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["27","import org.apache.logging.log4j.Logger;","28","import org.apache.logging.log4j.core.config.Configuration;","29","import org.apache.logging.log4j.core.config.plugins.util.PluginManager;","30","import org.apache.logging.log4j.core.config.plugins.util.PluginType;","31","import org.apache.logging.log4j.core.util.NanoClockFactory;","32","import org.apache.logging.log4j.status.StatusLogger;","33","import org.apache.logging.log4j.util.Strings;","34","","175","        NanoClockFactory.setMode(NanoClockFactory.Mode.Dummy); \/\/ LOG4J2-1074 use dummy clock by default","177","            if (converter instanceof NanoTimePatternConverter) {","178","                \/\/ LOG4J2-1074 Switch to actual clock if nanosecond timestamps are required in config.","179","                \/\/ LoggerContext will notify known NanoClockFactory users that the configuration has changed.","180","                NanoClockFactory.setMode(NanoClockFactory.Mode.System);","181","            }"],"delete":["18","import org.apache.logging.log4j.Logger;","19","import org.apache.logging.log4j.core.config.Configuration;","20","import org.apache.logging.log4j.core.config.plugins.util.PluginManager;","21","import org.apache.logging.log4j.core.config.plugins.util.PluginType;","22","import org.apache.logging.log4j.status.StatusLogger;","23","import org.apache.logging.log4j.util.Strings;","24",""]}],"log4j-core\/src\/test\/resources\/NanoTimeToFileTest.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LogEvent.java":[{"add":["172","    \/**","173","     * Returns the value of the running Java Virtual Machine's high-resolution time source when this event was created,","174","     * or a dummy value if it is known that this value will not be used downstream.","175","     * @return The value of the running Java Virtual Machine's high-resolution time source when this event was created.","176","     * @since Log4J 2.4","177","     *\/","178","    long getNanoTime();"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["31","import org.apache.logging.log4j.core.async.RingBufferLogEvent;","35","import org.apache.logging.log4j.core.util.DummyNanoClock;","36","import org.apache.logging.log4j.core.util.NanoClock;","49","    private static volatile NanoClock nanoClock = new DummyNanoClock();","64","    \/** @since Log4J 2.4 *\/","65","    private transient final long nanoTime;","83","        private long nanoTime;","90","            if (other instanceof RingBufferLogEvent) {","91","                RingBufferLogEvent evt = (RingBufferLogEvent) other;","92","                evt.initializeBuilder(this);","93","                return;","94","            }","106","            this.nanoTime = other.getNanoTime();","107","            ","108","            \/\/ Avoid unnecessarily initializing thrownProxy, threadName and source if possible","109","            if (other instanceof Log4jLogEvent) {","110","                Log4jLogEvent evt = (Log4jLogEvent) other;","111","                this.thrownProxy = evt.thrownProxy;","112","                this.source = evt.source;","113","                this.threadName = evt.threadName;","114","            } else {","115","                this.thrownProxy = other.getThrownProxy();","116","                this.source = other.getSource();","117","                this.threadName = other.getThreadName();","118","            }","191","        \/**","192","         * Sets the nano time for the event.","193","         * @param nanoTime The value of the running Java Virtual Machine's high-resolution time source when the event","194","         *          was created.","195","         * @return this builder","196","         *\/","197","        public Builder setNanoTime(long nanoTime) {","198","            this.nanoTime = nanoTime;","199","            return this;","200","        }","201","","205","                    thrownProxy, contextMap, contextStack, threadName, source, timeMillis, nanoTime);","229","        this(Strings.EMPTY, null, Strings.EMPTY, null, null, (Throwable) null, null, null, null, null, null, ","230","                clock.currentTimeMillis(), nanoClock.nanoTime());","238","       this(Strings.EMPTY, null, Strings.EMPTY, null, null, (Throwable) null, null, null, null, null, null, timestamp,","239","               nanoClock.nanoTime());","267","   \/\/ This constructor is called from LogEventFactories.","277","               clock.currentTimeMillis(),","278","           nanoClock.nanoTime());","301","               location, timestampMillis, nanoClock.nanoTime());","327","                thrownProxy, mdc, ndc, threadName, location, timestamp, nanoClock.nanoTime());","345","     * @param nanoTime The value of the running Java Virtual Machine's high-resolution time source when the event was","346","     *          created.","351","            final String threadName, final StackTraceElement source, final long timestampMillis, final long nanoTime) {","361","        this.timeMillis = message instanceof TimestampMessage","362","                ? ((TimestampMessage) message).getTimestamp()","363","                : timestampMillis;","369","        this.nanoTime = nanoTime;","389","    ","390","    \/**","391","     * Returns the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","392","     * @return the {@code NanoClock} to use for creating the nanoTime timestamp of log events","393","     *\/","394","    public static NanoClock getNanoClock() {","395","        return nanoClock;","396","    }","397","    ","398","    \/**","399","     * Sets the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","400","     * <p>","401","     * FOR INTERNAL USE. This method may be called with a different {@code NanoClock} implementation when the","402","     * configuration changes.","403","     * ","404","     * @param nanoClock the {@code NanoClock} to use for creating the nanoTime timestamp of log events","405","     *\/","406","    public static void setNanoClock(NanoClock nanoClock) {","407","        Log4jLogEvent.nanoClock = Objects.requireNonNull(nanoClock, \"NanoClock must be non-null\");","408","    }","569","    @Override","570","    public long getNanoTime() {","571","        return nanoTime;","572","    }","573","","600","                    proxy.source, proxy.timeMillis, proxy.nanoTime);","642","        if (nanoTime != that.nanoTime) {","643","            return false;","644","        }","690","        result = 31 * result + (int) (nanoTime ^ (nanoTime >>> 32));","722","        \/** @since Log4J 2.4 *\/","723","        private final transient long nanoTime;","740","            this.nanoTime = event.nanoTime;","749","                    thrownProxy, contextMap, contextStack, threadName, source, timeMillis, nanoTime);"],"delete":["90","            \/\/ avoid creating thrownProxy until necessary","91","            this.thrownProxy = other instanceof Log4jLogEvent ? ((Log4jLogEvent) other).thrownProxy ","92","                    : other.getThrownProxy();","95","            this.source = other.getSource();","96","            this.threadName = other.getThreadName();","174","                    thrownProxy, contextMap, contextStack, threadName, source, timeMillis);","198","        this(clock.currentTimeMillis());","206","       this(Strings.EMPTY, null, Strings.EMPTY, null, null, (Throwable) null, null, null, null, null, null, timestamp);","234","   \/\/ This constructor is called from DefaultLogEventFactory and is in the hot path.","235","   \/\/ Do not replace this constructor with a Builder.","245","               clock.currentTimeMillis());","268","               location, timestampMillis);","294","                thrownProxy, mdc, ndc, threadName, location, timestamp);","316","            final String threadName, final StackTraceElement source, final long timestamp) {","326","        this.timeMillis = message instanceof TimestampMessage ? ((TimestampMessage) message).getTimestamp() : timestamp;","537","                    proxy.source, proxy.timeMillis);","679","                    thrownProxy, contextMap, contextStack, threadName, source, timeMillis);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jackson\/JsonConstants.java":[{"add":["32","    public static final String ELT_NANO_TIME = \"nanoTime\";"],"delete":[]}],"log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":[{"add":["268","     * Returns the value of the running Java Virtual Machine's high-resolution time source when this event was created,","269","     * or a dummy value if it is known that this value will not be used downstream.","270","     * @return the event nanosecond timestamp.","271","     *\/","272","    @Override","273","    public long getNanoTime() {","274","        return event.getNanoTime();","275","    }","276","","277","    \/**"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/JpaH2AppenderTest.java":[{"add":["46","                \"id INTEGER IDENTITY, timemillis BIGINT, nanoTime BIGINT, level NVARCHAR(10), loggerName NVARCHAR(255), \" +"],"delete":["46","                \"id INTEGER IDENTITY, timemillis BIGINT, level NVARCHAR(10), loggerName NVARCHAR(255), \" +"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/NanoTimePatternConverter.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractLogEvent.java":[{"add":["119","    @Override","120","    public long getNanoTime() {","121","        return 0;","122","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1076\" dev=\"rpopma\" type=\"add\">","27","        Added support for system nanosecond time in pattern layout.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["19","import java.util.Objects;","33","import org.apache.logging.log4j.core.util.DummyNanoClock;","36","import org.apache.logging.log4j.core.util.NanoClock;","117","    private static volatile NanoClock nanoClock = new DummyNanoClock();","282","                        clock.currentTimeMillis(), \/\/","283","                nanoClock.nanoTime() \/\/","284","        );","354","    ","355","    \/**","356","     * Returns the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","357","     * @return the {@code NanoClock} to use for creating the nanoTime timestamp of log events","358","     *\/","359","    public static NanoClock getNanoClock() {","360","        return nanoClock;","361","    }","362","    ","363","    \/**","364","     * Sets the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","365","     * <p>","366","     * FOR INTERNAL USE. This method may be called with a different {@code NanoClock} implementation when the","367","     * configuration changes.","368","     * ","369","     * @param nanoClock the {@code NanoClock} to use for creating the nanoTime timestamp of log events","370","     *\/","371","    public static void setNanoClock(NanoClock nanoClock) {","372","        AsyncLogger.nanoClock = Objects.requireNonNull(nanoClock, \"NanoClock must be non-null\");","373","    }"],"delete":["278","                        clock.currentTimeMillis());"]}],"src\/site\/xdoc\/manual\/layouts.xml.vm":[{"add":["820","              <a name=\"NanoTime\" \/>","821","                <b>N<\/b><br \/>","822","                <b>nano<\/b>","823","              <\/td>","824","              <td><p>Outputs the result of <code>System.nanoTime()<\/code> at the time the log event was created.<\/p>","825","              <\/td>","826","            <\/tr>","827","            <tr>","828","              <td align=\"center\">"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemNanoClock.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/TestBaseEntity.java":[{"add":["125","    @Transient","126","    public long getNanoTime() {","127","        return this.getWrappedEvent().getNanoTime();","128","    }","129","","130","    @Override"],"delete":["45","@SuppressWarnings(\"unused\")"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/DummyNanoClockTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jpa\/BasicLogEventEntity.java":[{"add":["42"," * create an entity based on this class, you need only create two constructors matching this class's constructors,","43"," * annotate the class {@link javax.persistence.Entity @Entity} and {@link javax.persistence.Table @Table}, and implement","44"," * the fully mutable entity ID property annotated with {@link javax.persistence.Id @Id} and","171","     * Returns the value of the running Java Virtual Machine's high-resolution time source when this event was created,","172","     * or a dummy value if it is known that this value will not be used downstream.","173","     *","174","     * @return the JVM nano time","175","     *\/","176","    @Override","177","    @Basic","178","    public long getNanoTime() {","179","        return this.getWrappedEvent().getNanoTime();","180","    }","181","","182","    \/**"],"delete":["42"," * create an entity based on this class, you need only create two constructors matching this class's","43"," * constructors, annotate the class {@link javax.persistence.Entity @Entity} and {@link javax.persistence.Table @Table},","44"," * and implement the fully mutable entity ID property annotated with {@link javax.persistence.Id @Id} and","75","    @SuppressWarnings(\"unused\")"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemNanoClockTest.java":[{"add":[],"delete":[]}]}},"4786a7395121e0fd1b4e12d7e1b3c0eebd64d794":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["147","    ","148","    @Test","149","\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth1() throws Exception {","150","\t\tfinal Throwable throwable = new RuntimeException(new IllegalArgumentException(\"This is a test\"));","151","\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);","152","\t}","153","","154","    @Test","155","\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth2() throws Exception {","156","\t\tfinal Throwable throwable = new RuntimeException(","157","\t\t\t\tnew IllegalArgumentException(\"This is a test\", new IOException(\"level 2\")));","158","\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);","159","\t}","160","","161","    @Test","162","\tpublic void testSerialization_getExtendedStackTraceAsStringWithNestedThrowableDepth3() throws Exception {","163","\t\tfinal Throwable throwable = new RuntimeException(new IllegalArgumentException(\"level 1\",","164","\t\t\t\tnew IOException(\"level 2\", new IllegalStateException(\"level 3\"))));","165","\t\ttestSerialization_getExtendedStackTraceAsStringWithNestedThrowable(throwable);","166","\t}","167","","168","    private void testSerialization_getExtendedStackTraceAsStringWithNestedThrowable(Throwable throwable) throws Exception {","169","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","170","        final byte[] binary = serialize(proxy);","171","        final ThrowableProxy proxy2 = deserialize(binary);","172","","173","        assertEquals(proxy.getExtendedStackTraceAsString(), proxy2.getExtendedStackTraceAsString());","174","    }"],"delete":["37","import org.junit.Ignore;"]}],"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1067\" dev=\"ggregory\" type=\"fix\" due-to=\"Sam Braam\">\r","51","        ThrowableProxy getExtendedStackTraceAsString throws NPE on deserialized nested exceptions.\r","52","      <\/action>\r"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["204","\tprivate void formatCause(final StringBuilder sb, final ThrowableProxy cause, final List<String> ignorePackages) {","205","\t\tif (cause == null) {","206","\t\t\treturn;","207","\t\t}","208","\t\tsb.append(\"Caused by: \").append(cause).append(EOL);","209","\t\tthis.formatElements(sb, cause.commonElementCount, cause.getStackTrace(), cause.extendedStackTrace,","210","\t\t\t\tignorePackages);","211","\t\tthis.formatCause(sb, cause.causeProxy, ignorePackages);","212","\t}"],"delete":["204","    private void formatCause(final StringBuilder sb, final ThrowableProxy cause, final List<String> ignorePackages) {","205","        if (cause == null) {","206","            return;","207","        }","208","        sb.append(\"Caused by: \").append(cause).append(EOL);","209","        this.formatElements(sb, cause.commonElementCount, cause.getThrowable().getStackTrace(),","210","                cause.extendedStackTrace, ignorePackages);","211","        this.formatCause(sb, cause.causeProxy, ignorePackages);","212","    }"]}]}},"8d4dc1f28c062d968b2fc6b4432cb6d5d3d4f490":{"changes":{"src\/site\/xdoc\/manual\/async.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/async.xml":[{"add":["283","          A configuration can contain only one root logger (either a <tt>&lt;root&gt;<\/tt>","284","          or an <tt>&lt;asyncRoot&gt;<\/tt> element), but otherwise async and non-async loggers may be","285","          combined.","286","          For example, a configuration file containing <tt>&lt;asyncLogger&gt;<\/tt> elements","287","          can also contain <tt>&lt;root&gt;<\/tt> and"],"delete":["283","          The same configuration file can also contain <tt>&lt;root&gt;<\/tt> and"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-918\" dev=\"rpopma\" type=\"fix\">\r","27","        Clarify documentation for combining async with sync loggers.\r","28","      <\/action>\r","29","      <action issue=\"LOG4J2-1044\" dev=\"rgoers\" type=\"update\">\r"],"delete":["26","      <action issue=\"LOG4J2=1044\" dev=\"rgoers\" type=\"update\">\r"]}]}},"95a71e3d5638d164c9695a5856d8785570b45eb0":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jWebInitializerImpl.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdmin.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/helpers\/FileUtilsTest.java":"MODIFY","src\/site\/xdoc\/manual\/webapp.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/helpers\/FileUtils.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jWebInitializerImpl.java":[{"add":["27","import org.apache.logging.log4j.core.helpers.FileUtils;","96","                configLocation = FileUtils.getCorrectedFilePathUri(location);"],"delete":["95","                configLocation = new URI(location);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["373","                        source = getInputFromURI(FileUtils.getCorrectedFilePathUri(config));"],"delete":["373","                        source = getInputFromURI(new URI(config));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":[{"add":["23","import org.apache.logging.log4j.core.helpers.FileUtils;","64","            final URI uri = configLocation == null ? null : FileUtils.getCorrectedFilePathUri(configLocation);","146","                configLocation = source.getLocation() == null ?","147","                        null : FileUtils.getCorrectedFilePathUri(source.getLocation());"],"delete":["63","            final URI uri = configLocation == null ? null : new URI(configLocation);","145","                configLocation = source.getLocation() == null ? null : new URI(source.getLocation());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":[{"add":["98","                                final File destFile = FileUtils.fileFromURI(FileUtils.getCorrectedFilePathUri(dest));"],"delete":["98","                                final File destFile = FileUtils.fileFromURI(new URI(dest));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdmin.java":[{"add":["47","import org.apache.logging.log4j.core.helpers.FileUtils;","124","        final URI uri = FileUtils.getCorrectedFilePathUri(configLocation);","160","            return readContents(FileUtils.getCorrectedFilePathUri(getConfigLocationURI()), charset);"],"delete":["123","        final URI uri = new URI(configLocation);","159","            return readContents(new URI(getConfigLocationURI()), charset);"]}],"src\/changes\/changes.xml":[{"add":["168","      <action issue=\"LOG4J2-409\" dev=\"nickwilliams\" type=\"fix\" due-to=\"Frank Steinmann, Thomas Neidhart\">","169","        Created a utility to properly escape backslashes before creating URIs, and changed URI creation to use the","170","        utility instead of instantiating URI directly.","171","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/helpers\/FileUtilsTest.java":[{"add":["23","import java.net.URISyntaxException;","34","        String config = \"target\/test-classes\/log4j+config+with+plus+characters.xml\";","35","        URI uri = new URI(config);","44","        String config = \"NON-EXISTING-PATH\/this+file+does+not+exist.xml\";","45","        URI uri = new URI(config);","50","","51","    @Test","52","    public void testGetCorrectedFilePathUriWithoutBackslashes() throws URISyntaxException {","53","        String config = \"file:\/\/\/path\/to\/something\/on\/unix\";","54","        URI uri = FileUtils.getCorrectedFilePathUri(config);","55","","56","        assertNotNull(\"The URI should not be null.\", uri);","57","        assertEquals(\"The URI is not correct.\", \"file:\/\/\/path\/to\/something\/on\/unix\", uri.toString());","58","    }","59","","60","    @Test","61","    public void testGetCorrectedFilePathUriWithBackslashes() throws URISyntaxException {","62","        String config = \"file:\/\/\/D:\\\\path\\\\to\\\\something\/on\/windows\";","63","        URI uri = FileUtils.getCorrectedFilePathUri(config);","64","","65","        assertNotNull(\"The URI should not be null.\", uri);","66","        assertEquals(\"The URI is not correct.\", \"file:\/\/\/D:\/path\/to\/something\/on\/windows\", uri.toString());","67","    }"],"delete":["33","        String CONFIG = \"target\/test-classes\/log4j+config+with+plus+characters.xml\";","34","        URI uri = new URI(CONFIG);","43","        String CONFIG = \"NON-EXISTING-PATH\/this+file+does+not+exist.xml\";","44","        URI uri = new URI(CONFIG);"]}],"src\/site\/xdoc\/manual\/webapp.xml":[{"add":["173","        <param-value>file:\/\/\/D:\/conf\/myLogging.xml<\/param-value>"],"delete":["173","        <param-value>file:\/\/D:\\conf\\myLogging.xml<\/param-value>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":[{"add":["167","                                final File destFile = FileUtils.fileFromURI(FileUtils.getCorrectedFilePathUri(dest));"],"delete":["167","                                final File destFile = FileUtils.fileFromURI(new URI(dest));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/helpers\/FileUtils.java":[{"add":["23","import java.net.URISyntaxException;","103","","104","    \/**","105","     * Takes a given URI string which may contain backslashes (illegal in URIs) in it due to user input or variable","106","     * substitution and returns a URI with the backslashes replaced with forward slashes.","107","     *","108","     * @param uri The URI string","109","     * @return the URI.","110","     * @throws URISyntaxException if instantiating the URI threw a {@code URISyntaxException}.","111","     *\/","112","    public static URI getCorrectedFilePathUri(String uri) throws URISyntaxException {","113","        return new URI(uri.replaceAll(\"\\\\\\\\+\", \"\/\"));","114","    }"],"delete":[]}]}},"8ce7dbcdf1d8a92bba3f0c8c9429cd4c8c491306":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["27","      <action issue=\"LOG4J2-1803\" dev=\"rgoers\" type=\"fix\">","28","        Fix Maven POM to ensure JMH generated classes in log4j-perf are included in benchmarks jar.","29","      <\/action>"],"delete":[]}]}},"e7bbeceb123e60bc84186395e2a29c2a90769886":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverterTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":[{"add":["66","        if ((throwable != null || proxy != null) && options.anyLines()) {"],"delete":["66","        if (throwable != null && options.anyLines()) {"]}],"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1068\" dev=\"ggregory\" type=\"fix\" due-to=\"Andy McMullan\">\r","51","        Exceptions not logged when using TcpSocketServer + SerializedLayout.\r","52","      <\/action>\r"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverterTest.java":[{"add":["18","import static org.junit.Assert.assertEquals;","19","import static org.junit.Assert.assertTrue;","20","","27","import org.apache.logging.log4j.core.impl.ThrowableProxy;","38","\tpublic void testDeserializedLogEventWithThrowableProxyButNoThrowable() {","39","\t\tfinal ExtendedThrowablePatternConverter converter = ExtendedThrowablePatternConverter.newInstance(null);","40","\t\tfinal Throwable originalThrowable = new Exception(\"something bad happened\");","41","\t\tfinal ThrowableProxy throwableProxy = new ThrowableProxy(originalThrowable);","42","\t\tfinal Throwable deserializedThrowable = null;","43","\t\tfinal LogEvent event = Log4jLogEvent.createEvent(\"testLogger\", null, this.getClass().getName(), Level.DEBUG,","44","\t\t\t\tnew SimpleMessage(\"\"), deserializedThrowable, throwableProxy, null, null, null, null, 0);","45","\t\tfinal StringBuilder sb = new StringBuilder();","46","\t\tconverter.format(event, sb);","47","\t\tfinal String result = sb.toString();","48","\t\tassertTrue(result, result.contains(originalThrowable.getMessage()));","49","\t\tassertTrue(result, result.contains(originalThrowable.getStackTrace()[0].getMethodName()));","50","\t}","51","","52","    @Test","53","    public void testFiltering() {","54","        final String packages = \"filters(org.junit, org.apache.maven, sun.reflect, java.lang.reflect)\";","55","        final String[] options = {packages};","56","        final ExtendedThrowablePatternConverter converter = ExtendedThrowablePatternConverter.newInstance(options);","57","        final Throwable cause = new NullPointerException(\"null pointer\");","58","        final Throwable parent = new IllegalArgumentException(\"IllegalArgument\", cause);","59","        final LogEvent event = new Log4jLogEvent(\"testLogger\", null, this.getClass().getName(), Level.DEBUG,","60","            new SimpleMessage(\"test exception\"), parent);","61","        final StringBuilder sb = new StringBuilder();","62","        converter.format(event, sb);","63","        final String result = sb.toString();","64","        assertTrue(\"No suppressed lines\", result.contains(\" suppressed \"));","65","    }","66","","67","    @Test"],"delete":["28","import static org.junit.Assert.*;","29","","52","","53","    @Test","54","    public void testFiltering() {","55","        final String packages = \"filters(org.junit, org.apache.maven, sun.reflect, java.lang.reflect)\";","56","        final String[] options = {packages};","57","        final ExtendedThrowablePatternConverter converter = ExtendedThrowablePatternConverter.newInstance(options);","58","        final Throwable cause = new NullPointerException(\"null pointer\");","59","        final Throwable parent = new IllegalArgumentException(\"IllegalArgument\", cause);","60","        final LogEvent event = new Log4jLogEvent(\"testLogger\", null, this.getClass().getName(), Level.DEBUG,","61","            new SimpleMessage(\"test exception\"), parent);","62","        final StringBuilder sb = new StringBuilder();","63","        converter.format(event, sb);","64","        final String result = sb.toString();","65","        assertTrue(\"No suppressed lines\", result.contains(\" suppressed \"));","66","    }"]}]}},"a2ab6e21a1d679b63fcbfc7e90b5f7e588b597c6":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RegexReplacementConverter.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternFormatter.java":"ADD","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RegexReplacementConverter.java":[{"add":["37","    private List<PatternFormatter> formatters;","41","     * @param formatters The PatternFormatters to generate the text to manipulate.","45","    private RegexReplacementConverter(List<PatternFormatter> formatters,","50","        this.formatters = formatters;","80","        List<PatternFormatter> formatters = parser.parse(options[0]);","81","        return new RegexReplacementConverter(formatters, p, options[2]);","90","        for (PatternFormatter formatter : formatters) {","91","            formatter.format(event, buf);"],"delete":["37","    private List<PatternConverter> converters;","41","     * @param converters The PatternConverters to generate the text to manipulate.","45","    private RegexReplacementConverter(List<PatternConverter> converters,","50","        this.converters = converters;","80","        List<PatternConverter> converters = parser.parse(options[0]);","81","        return new RegexReplacementConverter(converters, p, options[2]);","90","        for (PatternConverter c : converters) {","91","            c.format(event, buf);"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["18","import org.apache.logging.log4j.Level;","20","import org.apache.logging.log4j.MarkerManager;","21","import org.apache.logging.log4j.core.LogEvent;","25","import org.apache.logging.log4j.core.impl.Log4jLogEvent;","26","import org.apache.logging.log4j.message.SimpleMessage;","35","import java.util.HashMap;","37","import java.util.Map;","56","    private static String customPattern = \"[%d{yyyyMMdd HH:mm:ss,SSS}] %-5p [%-25.25c{1}:%-4L] - %m%n\";","57","","67","    private void validateConverter(List<PatternFormatter> formatter, int index, String name) {","68","        PatternConverter pc = formatter.get(index).getConverter();","78","        List<PatternFormatter> formatters = parser.parse(msgPattern);","79","        assertNotNull(formatters);","80","        assertTrue(formatters.size() == 2);","81","        validateConverter(formatters, 0, \"Message\");","82","        validateConverter(formatters, 1, \"Line Sep\");","85","    \/**","86","     * Test the custome pattern","87","     *\/","88","    @Test","89","    public void testCustomPattern() {","90","        List<PatternFormatter> formatters = parser.parse(customPattern);","91","        assertNotNull(formatters);","92","        Map<String, String> mdc = new HashMap<String, String>();","93","        mdc.put(\"loginId\", \"Fred\");","94","        Throwable t = new Throwable();","95","        StackTraceElement[] elements = t.getStackTrace();","96","        LogEvent event = new Log4jLogEvent(\"org.apache.logging.log4j.PatternParserTest\", MarkerManager.getMarker(\"TEST\"),","97","            Logger.class.getName(), Level.INFO, new SimpleMessage(\"Hello, world\"), null,","98","            mdc, null, \"Thread1\", elements[0], System.currentTimeMillis());","99","        StringBuilder buf = new StringBuilder();","100","        for (PatternFormatter formatter : formatters) {","101","            formatter.format(event, buf);","102","        }","103","        String str = buf.toString();","104","        String expected = \"INFO  [PatternParserTest        :95  ] - Hello, world\\n\";","105","        assertTrue(\"Expected to end with: \" + expected + \". Actual: \" + str, str.endsWith(expected));","106","    }","107","","108",""],"delete":["58","    private void validateConverter(List<PatternConverter> converters, int index, String name) {","59","        PatternConverter pc = converters.get(index);","69","        List<PatternConverter> converters = parser.parse(msgPattern);","70","        assertNotNull(converters);","71","        assertTrue(converters.size() == 2);","72","        validateConverter(converters, 0, \"Message\");","73","        validateConverter(converters, 1, \"Line Sep\");"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J-81\" dev=\"rgoers\" type=\"fix\">","26","        PatternLayout was not honoring format modifiers.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":[{"add":["28","import org.apache.logging.log4j.core.pattern.PatternFormatter;","76","    private List<PatternFormatter> formatters;","110","        formatters = parser.parse((pattern == null) ? DEFAULT_CONVERSION_PATTERN : pattern);","128","        formatters = parser.parse(pattern);","140","        for (PatternFormatter formatter : formatters) {","141","            formatter.format(event, buf);"],"delete":["75","    private List<PatternConverter> converters;","109","        converters = parser.parse((pattern == null) ? DEFAULT_CONVERSION_PATTERN : pattern);","127","        converters = parser.parse(pattern);","139","        for (PatternConverter c : converters) {","140","            c.format(event, buf);"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternFormatter.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["19","import org.apache.logging.log4j.core.LogEvent;","128","    public List<PatternFormatter> parse(String pattern) {","129","        List<PatternFormatter> list = new ArrayList<PatternFormatter>();","138","            LogEventPatternConverter pc;","140","                pc = (LogEventPatternConverter) converter;","141","                handlesExceptions |= pc.handlesThrowable();","143","                pc = new LiteralPatternConverter(\"\");","146","            FormattingInfo field;","148","                field = (FormattingInfo) fieldIter.next();","150","                field = FormattingInfo.getDefault();","152","            list.add(new PatternFormatter(pc, field));","154","        return list;"],"delete":["127","    public List<PatternConverter> parse(String pattern) {","133","        LogEventPatternConverter[] patternConverters = new LogEventPatternConverter[converters.size()];","134","        FormattingInfo[] patternFields = new FormattingInfo[converters.size()];","135","","136","        int i = 0;","141","                patternConverters[i] = (LogEventPatternConverter) converter;","142","                handlesExceptions |= patternConverters[i].handlesThrowable();","144","                patternConverters[i] = new LiteralPatternConverter(\"\");","148","                patternFields[i] = (FormattingInfo) fieldIter.next();","150","                patternFields[i] = FormattingInfo.getDefault();","152","","153","            i++;","155","        return converters;"]}]}},"21cc0609d363237dd2826a12300b99739fe26cac":{"changes":{"src\/changes\/changes.xml":"MODIFY","flume-ng\/src\/site\/xdoc\/index.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-99\" dev=\"rgoers\" type=\"fix\" due-to=\"Das Archive\">","26","        MapRewritePolicy had an extra call to putAll that caused updates to behave like adds.","27","      <\/action>"],"delete":[]}],"flume-ng\/src\/site\/xdoc\/index.xml":[{"add":["30","          <subsection name=\"Remote Agent\">","31","            <p>","32","","33","            <\/p>","34","          <\/subsection>","35","","36","          <subsection name=\"Embedded Agent\">","37","            <p>","38","              The following is a sample pom file for Maven that can be used as a template for integrating the","39","              Flume Embedded Appender into an application.","40","            <\/p>","41","            <source><![CDATA[<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"","42","                     xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/xsd\/maven-4.0.0.xsd\">","43","              <modelVersion>4.0.0<\/modelVersion>","44","              <groupId>com.myapp<\/groupId>","45","              <artifactId>myapp<\/artifactId>","46","              <version>0.0.1-SNAPSHOT<\/version>","47","              <name>My App<\/name>","48","              <description>App to test log4j appender<\/description>","49","","50","              <properties>","51","                <log4j.version>2.0-beta1<\/log4j.version>","52","                <slf4j.version>1.6.6<\/slf4j.version>","53","                <jackson.version>1.9.3<\/jackson.version>","54","              <\/properties>","55","","56","              <dependencyManagement>","57","                <dependencies>","58","                  <dependency>","59","                    <groupId>org.slf4j<\/groupId>","60","                    <artifactId>slf4j-api<\/artifactId>","61","                    <version>${slf4j.version}<\/version>","62","                  <\/dependency>","63","                  <dependency>","64","                    <groupId>org.slf4j<\/groupId>","65","                    <artifactId>slf4j-ext<\/artifactId>","66","                    <version>${slf4j.version><\/version>","67","                  <\/dependency>","68","                  <dependency>","69","                    <groupId>org.apache.logging.log4j<\/groupId>","70","                    <artifactId>log4j-api<\/artifactId>","71","                    <version>${log4j2_version}<\/version>","72","                  <\/dependency>","73","                  <dependency>","74","                    <groupId>org.apache.logging.log4j.adapters<\/groupId>","75","                    <artifactId>log4j12-api<\/artifactId>","76","                    <version>${log4j2_version}<\/version>","77","                  <\/dependency>","78","                  <dependency>","79","                    <groupId>org.apache.logging.log4j<\/groupId>","80","                    <artifactId>log4j-core<\/artifactId>","81","                    <version>${log4j2_version}<\/version>","82","                  <\/dependency>","83","                  <dependency>","84","                    <groupId>org.apache.logging.log4j.adapters<\/groupId>","85","                    <artifactId>log4j-flume-ng<\/artifactId>","86","                    <version>${log4j2_version}<\/version>","87","                  <\/dependency>","88","                  <dependency>","89","                    <groupId>org.apache.logging.log4j.adapters<\/groupId>","90","                    <artifactId>slf4j-impl<\/artifactId>","91","                    <version>${log4j2_version}<\/version>","92","                  <\/dependency>","93","                  <dependency>","94","                    <groupId>org.apache.logging.log4j.adapters<\/groupId>","95","                    <artifactId>log4j-jcl<\/artifactId>","96","                    <version>${log4j2_version}<\/version>","97","                  <\/dependency>","98","                  <dependency>","99","                    <groupId>org.apache.logging.log4j.adapters<\/groupId>","100","                    <artifactId>log4j-web<\/artifactId>","101","                    <version>${log4j2_version}<\/version>","102","                  <\/dependency>","103","                  <dependency>","104","                    <groupId>org.codehaus.jackson<\/groupId>","105","                    <artifactId>jackson-core-asl<\/artifactId>","106","                    <version>${jackson.version}<\/version>","107","                  <\/dependency>","108","                  <dependency>","109","                    <groupId>org.codehaus.jackson<\/groupId>","110","                    <artifactId>jackson-mapper-asl<\/artifactId>","111","                    <version>${jackson.version}<\/version>","112","                  <\/dependency>","113","                  <dependency>","114","                    <groupId>org.codehaus.jackson<\/groupId>","115","                    <artifactId>jackson-jaxrs<\/artifactId>","116","                    <version>${jackson.version}<\/version>","117","                  <\/dependency>","118","                  <dependency>","119","                    <groupId>org.codehaus.jackson<\/groupId>","120","                    <artifactId>jackson-xc<\/artifactId>","121","                    <version>${jackson.version}<\/version>","122","                  <\/dependency>","123","                <\/dependencies>","124","              <\/dependencyManagement>","125","","126","              <dependencies>","127","                <!-- Log4j 2 API -->","128","                <dependency>","129","                  <groupId>org.apache.logging.log4j<\/groupId>","130","                  <artifactId>log4j-api<\/artifactId>","131","                <\/dependency>","132","                <!-- Log4j 1.x API -->","133","                <dependency>","134","                  <groupId>org.apache.logging.log4j.adapters<\/groupId>","135","                  <artifactId>log4j12-api<\/artifactId>","136","                <\/dependency>","137","                <!-- Log4j 2 implementation -->","138","                <dependency>","139","                  <groupId>org.apache.logging.log4j<\/groupId>","140","                  <artifactId>log4j-core<\/artifactId>","141","                <\/dependency>","142","                <!-- SLF4J to Log4j 2 binding -->","143","                <dependency>","144","                  <groupId>org.apache.logging.log4j.adapters<\/groupId>","145","                  <artifactId>slf4j-impl<\/artifactId>","146","                <\/dependency>","147","                <!-- SLF4J API -->","148","                <dependency>","149","                  <groupId>org.slf4j<\/groupId>","150","                  <artifactId>slf4j-api<\/artifactId>","151","                <\/dependency>","152","                <!-- SLF4J extensions -->","153","                <dependency>","154","                  <groupId>org.slf4j<\/groupId>","155","                  <artifactId>slf4j-ext<\/artifactId>","156","                <\/dependency>","157","                <!-- Commson Logging to Log4j 2 binding -->","158","                <dependency>","159","                  <groupId>org.apache.logging.log4j.adapters<\/groupId>","160","                  <artifactId>log4j-jcl<\/artifactId>","161","                <\/dependency>","162","                <!-- Log4j 2 Servlet Context Listener -->","163","                <dependency>","164","                  <groupId>org.apache.logging.log4j.adapters<\/groupId>","165","                  <artifactId>log4j-web<\/artifactId>","166","                <\/dependency>","167","                <!-- Avro transport protocol - required for Flume -->","168","                <dependency>","169","                  <groupId>org.apache.avro<\/groupId>","170","                  <artifactId>avro<\/artifactId>","171","                  <version>1.6.3<\/version>","172","                <\/dependency>","173","                <!-- Hadoop core - required by embedded Flume Agent -->","174","                <dependency>","175","                  <groupId>org.apache.hadoop<\/groupId>","176","                  <artifactId>hadoop-core<\/artifactId>","177","                  <version>1.0.3<\/version>","178","                  <exclusions>","179","                    <exclusion>","180","                      <groupId>org.mortbay.jetty<\/groupId>","181","                      <artifactId>servlet-api<\/artifactId>","182","                    <\/exclusion>","183","                    <exclusion>","184","                      <groupId>org.mortbay.jetty<\/groupId>","185","                      <artifactId>servlet-api-2.5<\/artifactId>","186","                    <\/exclusion>","187","                    <exclusion>","188","                      <groupId>junit<\/groupId>","189","                      <artifactId>junit<\/artifactId>","190","                    <\/exclusion>","191","                  <\/exclusions>","192","                <\/dependency>","193","                <!-- Flume File Channel - required by embedded Flume agent -->","194","                <dependency>","195","                  <groupId>org.apache.flume.flume-ng-channels<\/groupId>","196","                  <artifactId>flume-file-channel<\/artifactId>","197","                  <version>1.2.0<\/version>","198","                  <exclusions>","199","                    <exclusion>","200","                      <groupId>log4j<\/groupId>","201","                      <artifactId>log4j<\/artifactId>","202","                    <\/exclusion>","203","                    <exclusion>","204","                      <groupId>org.slf4j<\/groupId>","205","                      <artifactId>slf4j-log4j12<\/artifactId>","206","                    <\/exclusion>","207","                  <\/exclusions>","208","                <\/dependency>","209","              <\/dependencies>","210","            <\/project>]]><\/source>","211","          <\/subsection>"],"delete":[]}]}},"115234e7319f0da340e85b1c8dbca42aaad5eaec":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["42"," * <p>","43"," * TODO: Move this class to org.apache.logging.log4j.core because it is used from LogEvent.","44"," * <\/p>","45"," * <p>","46"," * TODO: Deserialize: Try to rebuild Throwable if the target exception is in this class loader?","47"," * <\/p>"],"delete":["42"," * TODO: Move this class to org.apache.logging.log4j.core because it is used from LogEvent. TODO: Deserialize: Try to","43"," * rebuild Throwable if the target exception is in this class loader?"]}]}},"4a76057d22e29f479cd2512084e4e7146fb2913d":{"changes":{"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/junit\/BundleTestInfo.java":"ADD","log4j-osgi\/pom.xml":"ADD","log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/felix\/FelixLoadApiBundleTest.java":"ADD","log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/equinox\/EquinoxLoadApiBundleTest.java":"ADD","log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/junit\/OsgiRule.java":"ADD","log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/AbstractLoadBundleTest.java":"ADD","pom.xml":"MODIFY"},"diff":{"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/junit\/BundleTestInfo.java":[{"add":[],"delete":[]}],"log4j-osgi\/pom.xml":[{"add":[],"delete":[]}],"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/felix\/FelixLoadApiBundleTest.java":[{"add":[],"delete":[]}],"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/equinox\/EquinoxLoadApiBundleTest.java":[{"add":[],"delete":[]}],"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/junit\/OsgiRule.java":[{"add":[],"delete":[]}],"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/AbstractLoadBundleTest.java":[{"add":[],"delete":[]}],"pom.xml":[{"add":["1252","    <module>log4j-osgi<\/module>"],"delete":[]}]}},"12f91ebc700ea7f4a57306a4d84fce2f75f8442b":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["205","     * @param lowIndex low index. Log file associated with low index will be deleted if needed.","206","     * @param highIndex high index."],"delete":["205","     * @param lowIndex low index","206","     * @param highIndex high index. Log file associated with high index will be deleted if needed."]}],"src\/changes\/changes.xml":[{"add":["39","      <action issue=\"LOG4J2-1806\" dev=\"rpopma\" type=\"fix\" due-to=\"challarao\">","40","        Fix javadoc for DefaultRolloverStrategy::purgeAscending","41","      <\/action>"],"delete":[]}]}},"311fce5171e9fd197b3f5e35342df173d61c2842":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/FileAppenderBenchmark.java":"MODIFY","log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/PatternLayoutComparisonBenchmark.java":"MODIFY","pom.xml":"MODIFY","log4j-perf\/src\/main\/resources\/log4j2-perf.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["28","        Update to use Logback 1.1.10 and then Logback 1.2 for tests."],"delete":["28","        Update to use Logback 1.1.10 for tests."]}],"log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/FileAppenderBenchmark.java":[{"add":["52","    Logger log4j2MemoryLogger;","66","        log4j2MemoryLogger = LogManager.getLogger(\"MemoryMapped\");","94","        final File log4jMemoryFile = new File (\"target\/testMappedlog4j2.log\");","95","        log4jMemoryFile.delete();","109","    @BenchmarkMode(Mode.Throughput)","110","    @OutputTimeUnit(TimeUnit.SECONDS)","111","    @Benchmark","112","    public void log4j2MMF() {","113","        log4j2MemoryLogger.debug(MESSAGE);","114","    }","115",""],"delete":[]}],"log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/PatternLayoutComparisonBenchmark.java":[{"add":["115","        return patternLayoutEncoder.encode(LOGBACKEVENT);"],"delete":["105","        patternLayoutEncoder.init(baos);","116","        patternLayoutEncoder.doEncode(LOGBACKEVENT);","117","        \/\/ patternLayoutEncoder.close();","118","        return baos.toByteArray();"]}],"pom.xml":[{"add":["179","    <logbackVersion>1.2.0<\/logbackVersion>"],"delete":["179","    <logbackVersion>1.1.10<\/logbackVersion>"]}],"log4j-perf\/src\/main\/resources\/log4j2-perf.xml":[{"add":["25","        <MemoryMappedFile name=\"MemoryMappedLogFile\" fileName=\"target\/testMappedlog4j2.log\" immediateFlush=\"false\">","26","            <PatternLayout>","27","                <Pattern>%d %5p [%t] %c{1} %X{transactionId} - %m%n<\/Pattern>","28","            <\/PatternLayout>","29","        <\/MemoryMappedFile>","37","        <Logger name=\"MemoryMapped\" level=\"debug\" additivity=\"false\">","38","            <AppenderRef ref=\"MemoryMappedLogFile\"\/>","39","        <\/Logger>"],"delete":[]}]}},"487588b7c34bc0b540e769d98c42d018fa1bc1b8":{"changes":{"log4j-to-slf4j\/src\/test\/java\/org\/apache\/logging\/slf4j\/LoggerTest.java":"MODIFY","log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-to-slf4j\/src\/test\/java\/org\/apache\/logging\/slf4j\/LoggerTest.java":[{"add":["19","import java.lang.reflect.InvocationTargetException;","20","import java.lang.reflect.Proxy;","164","        String message = list.strList.get(0);","165","        assertEquals(\"Hello, World\", message);","166","    }","167","","168","    @Test","169","    public void paramIncludesSubstitutionMarker_locationAware() {","170","        logger.info(\"Hello, {}\", \"foo {} bar\");","171","        assertThat(list.strList, hasSize(1));","172","        String message = list.strList.get(0);","173","        assertEquals(\"Hello, foo {} bar\", message);","174","    }","175","","176","    @Test","177","    public void paramIncludesSubstitutionMarker_nonLocationAware() {","178","        final org.slf4j.Logger slf4jLogger = CTX.getLogger();","179","        Logger nonLocationAwareLogger = new SLF4JLogger(","180","                slf4jLogger.getName(),","181","                (org.slf4j.Logger) Proxy.newProxyInstance(","182","                        getClass().getClassLoader(),","183","                        new Class<?>[]{org.slf4j.Logger.class},","184","                        (proxy, method, args) -> {","185","                            try {","186","                                return method.invoke(slf4jLogger, args);","187","                            } catch (InvocationTargetException e) {","188","                                throw e.getCause();","189","                            }","190","                        }));","191","        nonLocationAwareLogger.info(\"Hello, {}\", \"foo {} bar\");","192","        assertThat(list.strList, hasSize(1));","193","        String message = list.strList.get(0);","194","        assertEquals(\"Hello, foo {} bar\", message);"],"delete":[]}],"log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLogger.java":[{"add":["88","    private static org.slf4j.Marker getMarker(final Marker marker) {","89","        \/\/ No marker is provided in the common case, small methods","90","        \/\/ are optimized more effectively.","91","        return marker == null ? null : convertMarker(marker);","92","    }","93","","94","    private static org.slf4j.Marker convertMarker(final Marker marker) {","227","        org.slf4j.Marker slf4jMarker = getMarker(marker);","228","        String formattedMessage = message.getFormattedMessage();","233","            locationAwareLogger.log(slf4jMarker, fqcn, convertLevel(level), formattedMessage, null, t);","237","                    logger.debug(slf4jMarker, formattedMessage, t);","240","                    logger.trace(slf4jMarker, formattedMessage, t);","243","                    logger.info(slf4jMarker, formattedMessage, t);","246","                    logger.warn(slf4jMarker, formattedMessage, t);","249","                    logger.error(slf4jMarker, formattedMessage, t);","252","                    logger.error(slf4jMarker, formattedMessage, t);"],"delete":["88","    private org.slf4j.Marker getMarker(final Marker marker) {","89","        if (marker == null) {","90","            return null;","91","        }","228","            locationAwareLogger.log(getMarker(marker), fqcn, convertLevel(level), message.getFormattedMessage(),","229","                    message.getParameters(), t);","233","                    logger.debug(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);","236","                    logger.trace(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);","239","                    logger.info(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);","242","                    logger.warn(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);","245","                    logger.error(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);","248","                    logger.error(getMarker(marker), message.getFormattedMessage(), message.getParameters(), t);"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3289\" dev=\"ckozak\" type=\"fix\">","34","        log4j-to-slf4j no longer re-interpolates formatted message contents.","35","      <\/action>"],"delete":[]}]}},"8bb1eca600b38bd962e31b957894c573b70718dd":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["37","      <action issue=\"LOG4J2-931\" dev=\"ggregory\" type=\"fix\" due-to=\"Robert Gacki\">","38","        ConsoleAppender is missing @PluginFactory annotation at createAppender method.","39","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["33","import org.apache.logging.log4j.core.config.plugins.PluginFactory;","84","    @PluginFactory"],"delete":[]}]}},"8f0c48719769a99a927cd25364ccc7612b6c8874":{"changes":{"log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/SerializeTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/SLF4JLogger.java":"MODIFY","log4j-slf4j-impl\/pom.xml":"MODIFY"},"diff":{"log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/SerializeTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-410\" dev=\"rgoers\" type=\"update\" due-to=\"Ivlin Zeng\">","24","        SLf4JLogger is now Serializable.","25","      <\/action>"],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/SLF4JLogger.java":[{"add":["19","import org.apache.logging.log4j.LogManager;","30","import java.io.IOException;","31","import java.io.ObjectInputStream;","32","import java.io.ObjectOutputStream;","33","import java.io.Serializable;","34","","38","public class SLF4JLogger implements LocationAwareLogger, Serializable {","40","    private static final long serialVersionUID = 7869000638091304316L;","44","    private transient AbstractLoggerWrapper logger;","46","    private transient EventDataConverter converter;","511","    \/**","512","     * Always treat de-serialization as a full-blown constructor, by","513","     * validating the final state of the de-serialized object.","514","     *\/","515","    private void readObject(ObjectInputStream aInputStream) throws ClassNotFoundException, IOException {","516","        \/\/always perform the default de-serialization first","517","        aInputStream.defaultReadObject();","518","        logger = new AbstractLoggerWrapper((AbstractLogger) LogManager.getLogger(name), name, null);","519","        converter = createConverter();","520","    }","521","","522","    \/**","523","     * This is the default implementation of writeObject.","524","     * Customise if necessary.","525","     *\/","526","    private void writeObject(ObjectOutputStream aOutputStream","527","    ) throws IOException {","528","        \/\/perform the default serialization for all non-transient, non-static fields","529","        aOutputStream.defaultWriteObject();","530","    }","531",""],"delete":["32","public class SLF4JLogger implements LocationAwareLogger {","37","    private final AbstractLoggerWrapper logger;","39","    private final EventDataConverter converter;"]}],"log4j-slf4j-impl\/pom.xml":[{"add":["101","                <exclude>**\/SerializeTest.java<\/exclude>"],"delete":[]}]}},"a87c1e37b003f85ffe7f64df3c86120b0ace767f":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/StatusLoggerAdmin.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/StatusLoggerAdmin.java":[{"add":["65","        removeListeners(contextName);","69","    \/**","70","     * Add listener to StatusLogger for this context, or replace it if it already exists.","71","     *","72","     * @param ctxName","73","     *\/","74","    private void removeListeners(final String ctxName) {","75","        final StatusLogger logger = StatusLogger.getLogger();","76","        final Iterable<StatusListener> listeners = logger.getListeners();","77","        \/\/ Remove any StatusLoggerAdmin listeners already registered for this context","78","        for (final StatusListener statusListener : listeners) {","79","            if (statusListener instanceof StatusLoggerAdmin) {","80","                final StatusLoggerAdmin adminListener = (StatusLoggerAdmin) statusListener;","81","                if (ctxName != null && ctxName.equals(adminListener.contextName)) {","82","                    logger.removeListener(adminListener);","83","                }","84","            }","85","        }","86","    }","87",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["29","      <action issue=\"LOG4J2-947\" dev=\"ggregory\" type=\"fix\" due-to=\" Stefan Wehner\">","30","        A new StatusLoggerAdmin listener is added to StatusLogger every time the log is reconfigured.","31","      <\/action>"],"delete":[]}]}},"375d363f2d2e9587574b02a66a7789bf83302b63":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["34","      <action issue=\"LOG4J2-912\" dev=\"ggregory\" type=\"fix\">","35","        XML configuration does not report full error message for XInclude parser configuration problems.","36","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["98","            LOGGER.warn(\"The DocumentBuilderFactory [{}] does not support XInclude: {}\", factory, e);","100","            LOGGER.warn(\"The DocumentBuilderFactory [{}] is out of date and does not support XInclude: {}\", factory, err);","107","            LOGGER.warn(\"The DocumentBuilderFactory [{}] does not support the feature [{}]: {}\", factory,","110","            LOGGER.warn(\"The DocumentBuilderFactory [{}] is out of date and does not support setFeature: {}\", factory, err);","115","            LOGGER.warn(\"The DocumentBuilderFactory [{}] does not support the feature [{}]: {}\", factory,","118","            LOGGER.warn(\"The DocumentBuilderFactory [{}] is out of date and does not support setFeature: {}\", factory, err);"],"delete":["98","            LOGGER.warn(\"The DocumentBuilderFactory does not support XInclude: {}\", factory, e);","100","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support XInclude: {}\", factory, err);","107","            LOGGER.warn(\"The DocumentBuilderFactory [{}] does not support the feature [{}].\", factory,","110","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory, err);","115","            LOGGER.warn(\"The DocumentBuilderFactory [{}] does not support the feature [{}].\", factory,","118","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory, err);"]}]}},"457e81d13b336b3071466b3e3956103701b8749c":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/PluginBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/couchdb\/CouchDBProvider.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/SensitivePluginAttribute.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongodb\/MongoDBProvider.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/PluginBuilder.java":[{"add":["181","                    args[i] = getReplacedAttributeValue(name, aliases);","182","                    sb.append(name).append(\"=\\\"\").append(args[i]).append('\"');","183","                } else if (a instanceof SensitivePluginAttribute) {","186","                    final SensitivePluginAttribute attribute = (SensitivePluginAttribute) a;","187","                    final String name = attribute.value();","188","                    args[i] = getReplacedAttributeValue(name, aliases);","189","                    sb.append(name).append(\"=\\\"\").append(NameUtil.md5(args[i] + PluginBuilder.class.getName())).append('\"');","265","    private String getReplacedAttributeValue(final String name, final String... aliases) {","266","        return configuration.getStrSubstitutor().replace(event, getAttrValue(name, aliases));","267","    }","268","","279","                for (final String alias : aliases) {"],"delete":["181","                    final String value = configuration.getStrSubstitutor().replace(event, getAttrValue(name, aliases));","182","                    args[i] = value;","183","                    sb.append(name).append(\"=\\\"\");","186","                    if (\"password\".equalsIgnoreCase(name)) {","187","                        sb.append(NameUtil.md5(value + PluginBuilder.class.getName()));","188","                    } else {","189","                        sb.append(value);","190","                    }","191","                    sb.append('\"');","277","                for (String alias : aliases) {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/couchdb\/CouchDBProvider.java":[{"add":["23","import org.apache.logging.log4j.core.config.plugins.SensitivePluginAttribute;","89","            @SensitivePluginAttribute(\"password\") final String password,"],"delete":["88","            @PluginAttribute(\"password\") final String password,"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/SensitivePluginAttribute.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongodb\/MongoDBProvider.java":[{"add":["25","import org.apache.logging.log4j.core.config.plugins.SensitivePluginAttribute;","100","            @SensitivePluginAttribute(\"password\") final String password,"],"delete":["99","            @PluginAttribute(\"password\") final String password,"]}]}},"ede7b0b818338f85f63ed9f3a1fa0122e3a7629f":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/ResolverUtil.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["143","                            LOGGER.warn(\"Unable to add class {}\", type.getPluginClass(), ex);"],"delete":["143","                            LOGGER.warn(\"Unable to add class {}\", type.getPluginClass());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["141","                } catch (final Exception e) {","142","                    LOGGER.error(\"Unable to initialize {} due to {}\", type.getPluginClass().getName(), e.getClass()","143","                            .getSimpleName(), e);","730","            } catch (final Exception e) {","731","                LOGGER.warn(\"Unable to create Map for {} of class {}\", type.getElementName(), clazz, e);","738","            } catch (final Exception e) {","739","                LOGGER.warn(\"Unable to create List for {} of class {}\", type.getElementName(), clazz, e);"],"delete":["141","                } catch (final Exception ex) {","142","                    LOGGER.error(\"Unable to initialize {} due to {}: {}\", type.getPluginClass().getName(),","143","                            ex.getClass().getSimpleName(), ex.getMessage());","730","            } catch (final Exception ex) {","731","                LOGGER.warn(\"Unable to create Map for {} of class {}\", type.getElementName(), clazz);","738","            } catch (final Exception ex) {","739","                LOGGER.warn(\"Unable to create List for {} of class {}\", type.getElementName(), clazz);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/ResolverUtil.java":[{"add":["303","                    + \" file not found\", ex);","384","            LOGGER.warn(\"Could not examine class '\" + fqn, t);"],"delete":["303","                    + \" file not found\");","384","            LOGGER.warn(\"Could not examine class '\" + fqn + \"' due to a \" +","385","                t.getClass().getName() + \" with message: \" + t.getMessage());"]}],"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-707\" dev=\"ggregory\" type=\"fix\">","72","        Some exceptions are not logged when configuration problems are detected.","73","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["108","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory, err);","116","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory, err);","182","                LOGGER.error(\"Unable to access schema {}\", this.schema, ex);"],"delete":["108","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory);","116","            LOGGER.warn(\"The DocumentBuilderFactory is out of date and does not support setFeature: {}\", factory);","182","                LOGGER.error(\"Unable to access schema {}\", this.schema);"]}]}},"1155376cae5770118af27f89c0925ec6199e1081":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/api.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-631\" dev=\"rpopma\" type=\"fix\">","25","        Update docs to clarify how to use formatter logger and standard logger together.","26","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/api.xml":[{"add":["102","          <h4>Mixing Loggers with Formatter Loggers<\/h4>","103","          <p>","104","          Formatter loggers give fine-grained control over the output format, but have the drawback","105","          that the correct type must be specified (for example, passing anything other than a decimal integer","106","          for a %d format parameter gives an exception).","107","          <\/p>","108","          <p>","109","          If your main usage is to use {}-style parameters, but occasionally you need fine-grained","110","          control over the output format, you can use the <code>printf<\/code> method:<\/p>","111","            <pre class=\"prettyprint linenums\">public static Logger logger = LogManager.getLogger(\"Foo\");","112","","113","logger.debug(\"Opening connection to {}...\", someDataSource);","114","logger.printf(Level.INFO, \"Logging in user %1$s with birthday %2$tm %2$te,%2$tY\", user.getName(), user.getBirthdayCalendar());","115","<\/pre>","116","          <h4>Logger Names<\/h4>"],"delete":["102","          <h4>Logger names<\/h4>"]}]}},"4cf831b69978218c97649400c33ca6ec882e3989":{"changes":{"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMarker.java":"MODIFY","log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/MarkerTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMarker.java":[{"add":["52","\t\tif (marker == null) {\r","53","\t\t\tthrow new IllegalArgumentException();\r","54","\t\t}\r"],"delete":[]}],"log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/MarkerTest.java":[{"add":["42","\tpublic void testAddNullMarker() {","43","\t\tfinal org.slf4j.Marker slf4jMarker = org.slf4j.MarkerFactory.getMarker(CHILD_MAKER_NAME + \"-ANM\");","44","\t\tfinal org.slf4j.Marker slf4jParent = org.slf4j.MarkerFactory.getMarker(PARENT_MARKER_NAME + \"-ANM\");","45","\t\tslf4jMarker.add(slf4jParent);","46","\t\tfinal Marker log4jParent = MarkerManager.getMarker(PARENT_MARKER_NAME + \"-ANM\");","47","\t\tfinal Marker log4jMarker = MarkerManager.getMarker(CHILD_MAKER_NAME + \"ANM\");","48","\t\tLog4jMarker log4jSlf4jParent = new Log4jMarker(log4jParent);","49","\t\tLog4jMarker log4jSlf4jMarker = new Log4jMarker(log4jMarker);","50","\t\tfinal org.slf4j.Marker nullMarker = null;","51","\t\ttry {","52","\t\t\tlog4jSlf4jParent.add(nullMarker);","53","\t\t\tfail(\"Expected \" + IllegalArgumentException.class.getName());","54","\t\t} catch (IllegalArgumentException e) {","55","\t\t\t\/\/ expected","56","\t\t}","57","\t\ttry {","58","\t\t\tlog4jSlf4jMarker.add(nullMarker);","59","\t\t\tfail(\"Expected \" + IllegalArgumentException.class.getName());","60","\t\t} catch (IllegalArgumentException e) {","61","\t\t\t\/\/ expected","62","\t\t}","63","\t}","64","","65","    @Test"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["98","      <action issue=\"LOG4J2-1062\" dev=\"ggregory\" type=\"fix\">\r","99","        Log4jMarker#add(Marker) does not respect org.slf4j.Marker contract.\r","100","      <\/action>            \r"],"delete":[]}]}},"547574f972754001b4c0cd162dcff3c9346aa69e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/DatagramSocketManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/test\/appender\/InMemoryAppender.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManagerTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/AbstractSocketManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/OnStartupTriggeringPolicyTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FileManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManagerTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/DatagramSocketManager.java":[{"add":["47","        super(name, os, inetAddress, host, port, layout, true);"],"delete":["47","        super(name, os, inetAddress, host, port, layout);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":[{"add":["32","    protected OutputStreamManager(final OutputStream os, final String streamName, final Layout<?> layout,","33","            boolean writeHeader) {","37","        if (writeHeader && layout != null) {"],"delete":["32","    protected OutputStreamManager(final OutputStream os, final String streamName, final Layout<?> layout) {","36","        if (layout != null) {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["52","            final String advertiseURI, final Layout<? extends Serializable> layout, final boolean writeHeader) {","53","        super(fileName, pattern, os, append, size, time, policy, strategy, advertiseURI, layout, bufferSize,","54","                writeHeader);","184","            final boolean writeHeader = !data.append || !file.exists();","198","                        data.advertiseURI, data.layout, writeHeader);"],"delete":["52","            final String advertiseURI, final Layout<? extends Serializable> layout) {","53","        super(fileName, pattern, os, append, size, time, policy, strategy, advertiseURI, layout, bufferSize);","196","                        data.advertiseURI, data.layout);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/test\/appender\/InMemoryAppender.java":[{"add":["34","                            final boolean ignoreExceptions, final boolean writeHeader) {","35","        super(name, layout, filters, ignoreExceptions, true, new InMemoryManager(name, layout, writeHeader));","45","        public InMemoryManager(final String name, final Layout<? extends Serializable> layout,","46","                final boolean writeHeader) {","47","            super(new ByteArrayOutputStream(), name, layout, writeHeader);"],"delete":["34","                            final boolean ignoreExceptions) {","35","        super(name, layout, filters, ignoreExceptions, true, new InMemoryManager(name, layout));","45","        public InMemoryManager(final String name, final Layout<? extends Serializable> layout) {","46","            super(new ByteArrayOutputStream(), name, layout);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManagerTest.java":[{"add":["64","                triggerPolicy, rolloverStrategy, null, null, true);","95","                triggerPolicy, rolloverStrategy, null, null, true);","122","                triggerPolicy, rolloverStrategy, null, null, true);"],"delete":["64","                triggerPolicy, rolloverStrategy, null, null);","95","                triggerPolicy, rolloverStrategy, null, null);","122","                triggerPolicy, rolloverStrategy, null, null);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["354","            return new OutputStreamManager(data.os, data.type, data.layout, true);"],"delete":["354","            return new OutputStreamManager(data.os, data.type, data.layout);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/AbstractSocketManager.java":[{"add":["55","    public AbstractSocketManager(final String name, final OutputStream os, final InetAddress inetAddress,","56","            final String host, final int port, final Layout<? extends Serializable> layout, final boolean writeHeader) {","57","        super(os, name, layout, writeHeader);"],"delete":["55","    public AbstractSocketManager(final String name, final OutputStream os, final InetAddress inetAddress, final String host,","56","                                 final int port, final Layout<? extends Serializable> layout) {","57","        super(os, name, layout);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileManager.java":[{"add":["66","            final Layout<? extends Serializable> layout, final boolean writeHeader) throws IOException {","67","        super(os, fileName, layout, writeHeader);","309","            final boolean writeHeader = !data.append || !file.exists();","317","                        data.advertiseURI, data.layout, writeHeader);"],"delete":["66","            final Layout<? extends Serializable> layout) throws IOException {","67","        super(os, fileName, layout);","316","                        data.advertiseURI, data.layout);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamAppenderTest.java":[{"add":["38","        final boolean writeHeader = true;","39","        final InMemoryAppender app = new InMemoryAppender(\"test\", layout, null, false, writeHeader);","40","        final String expectedHeader = null;","41","        assertMessage(\"Test\", app, expectedHeader);","42","    }","43","","44","    @Test","45","    public void testHeaderRequested() {","46","        final PatternLayout layout = PatternLayout.newBuilder().withHeader(\"HEADERHEADER\").build();","47","        final boolean writeHeader = true;","48","        final InMemoryAppender app = new InMemoryAppender(\"test\", layout, null, false, writeHeader);","49","        final String expectedHeader = \"HEADERHEADER\";","50","        assertMessage(\"Test\", app, expectedHeader);","51","    }","52","","53","    @Test","54","    public void testHeaderSuppressed() {","55","        final PatternLayout layout = PatternLayout.newBuilder().withHeader(\"HEADERHEADER\").build();","56","        final boolean writeHeader = false;","57","        final InMemoryAppender app = new InMemoryAppender(\"test\", layout, null, false, writeHeader);","58","        final String expectedHeader = null;","59","        assertMessage(\"Test\", app, expectedHeader);","60","    }","61","","62","    private void assertMessage(String string, InMemoryAppender app, String header) {","63","        final LogEvent event = new Log4jLogEvent(\"TestLogger\", null, OutputStreamAppenderTest.class.getName(),","64","                Level.INFO, new SimpleMessage(\"Test\"), null);","68","        app.append(event);","71","        final String expectedHeader = header == null ? \"\" : header;","72","        final String expected = expectedHeader + \"Test\" + Constants.LINE_SEPARATOR + \"Test\" + Constants.LINE_SEPARATOR;","73","        assertTrue(\"Incorrect message: \" + msg, msg.equals(expected));"],"delete":["38","        final InMemoryAppender app = new InMemoryAppender(\"test\", layout, null, false);","39","        final LogEvent event = new Log4jLogEvent(\"TestLogger\", null, OutputStreamAppenderTest.class.getName(), Level.INFO,","40","            new SimpleMessage(\"Test\"), null);","46","        assertTrue(\"Incorrect message: \" + msg , msg.endsWith(\"Test\" + Constants.LINE_SEPARATOR));"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/OnStartupTriggeringPolicyTest.java":[{"add":["54","                false, 0, System.currentTimeMillis(), policy, strategy, null, null, 8192, true);"],"delete":["54","                false, 0, System.currentTimeMillis(), policy, strategy, null, null, 8192);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FileManager.java":[{"add":["46","            final String advertiseURI, final Layout<? extends Serializable> layout, final int bufferSize,","47","            final boolean writeHeader) {","48","        super(os, fileName, layout, writeHeader);","199","            final boolean writeHeader = !data.append || !file.exists();","209","                return new FileManager(name, os, data.append, data.locking, data.advertiseURI, data.layout, bufferSize,","210","                        writeHeader);"],"delete":["46","            final String advertiseURI, final Layout<? extends Serializable> layout, final int bufferSize) {","47","        super(os, fileName, layout);","207","                return new FileManager(name, os, data.append, data.locking, data.advertiseURI, data.layout, bufferSize);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-889\" dev=\"rpopma\" type=\"fix\">\r","27","        Header in layout should not be written on application startup if appending to an existing file.\r","28","      <\/action>\r"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":[{"add":["80","        super(name, os, inetAddress, host, port, layout, true);"],"delete":["80","        super(name, os, inetAddress, host, port, layout);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["51","            final Layout<? extends Serializable> layout, final int bufferSize, final boolean writeHeader) {","52","        super(fileName, os, append, false, advertiseURI, layout, bufferSize, writeHeader);","312","            final boolean writeHeader = !data.append || !file.exists();","324","                    data.strategy, data.advertiseURI, data.layout, bufferSize, writeHeader);"],"delete":["51","            final Layout<? extends Serializable> layout, final int bufferSize) {","52","        super(fileName, os, append, false, advertiseURI, layout, bufferSize);","323","                    data.strategy, data.advertiseURI, data.layout, bufferSize);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManager.java":[{"add":["49","            final String advertiseURI, final Layout<? extends Serializable> layout, final boolean writeHeader) {","50","        super(os, fileName, layout, writeHeader);","212","            final boolean writeHeader = !data.append || !file.exists();","223","                        data.bufferSize, data.advertiseURI, data.layout, writeHeader);"],"delete":["49","            final String advertiseURI, final Layout<? extends Serializable> layout) {","50","        super(os, fileName, layout);","222","                        data.bufferSize, data.advertiseURI, data.layout);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManagerTest.java":[{"add":["46","                    RandomAccessFileManager.DEFAULT_BUFFER_SIZE, null, null, true);","68","                    RandomAccessFileManager.DEFAULT_BUFFER_SIZE, null, null, true);","89","                    bufferSize, null, null, true);","103","                    bufferSize, null, null, true);"],"delete":["46","                    RandomAccessFileManager.DEFAULT_BUFFER_SIZE, null, null);","68","                    RandomAccessFileManager.DEFAULT_BUFFER_SIZE, null, null);","89","                    bufferSize, null, null);","103","                    bufferSize, null, null);"]}]}},"4d963a30e43e914ff058902eb0c98627a1dcd825":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SetUtils.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SetUtils.java":[{"add":["24","","25","    private static final String[] EMPTY_STRINGS = new String[0];","26","","27","    private SetUtils() {}","30","     * Collects strings starting with the given {@code prefix} from the given {@code set}.","32","     * @param set a (nullable) set of strings","33","     * @param prefix a prefix to look for in the string set","37","        if (set == null) {","38","            return EMPTY_STRINGS;","40","        return set","41","                .stream()","42","                .filter(string -> string.startsWith(prefix))","43","                .toArray(String[]::new);","45",""],"delete":["18","import java.util.HashSet;","25","    private SetUtils() {","26","    }","29","     * Extracts the Strings from a Set that start with a given prefix.","31","     * @param set a Set of Strings (assumed to all be non-{@code null})","32","     * @param prefix the prefix to look for in the string set","36","        final Set<String> prefixSet = new HashSet<>();","37","        for (final String str : set) {","38","            if (str.startsWith(prefix)) {","39","                prefixSet.add(str);","40","            }","42","        return prefixSet.toArray(new String[prefixSet.size()]);"]}]}},"4e61e766624d33d9850ab1282ffee773ddcf4f9f":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstantTest.java":"MODIFY","log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/JsonTemplateLayoutTest.java":"MODIFY","\/dev\/null":"DELETE","log4j-core\/revapi.json":"MODIFY","log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/DateTimeFormatBenchmark.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstant.java":"MODIFY","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":"ADD","log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatterTest.java":"ADD","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstantTest.java":[{"add":["21","import java.time.ZoneId;","22","import java.time.format.DateTimeFormatter;","23","","26","class MutableInstantTest {","29","    void testGetEpochSecond() {","47","    void testGetNanoOfSecond() {","65","    void testGetEpochMillisecond() {","83","    void getGetNanoOfMillisecond() {","101","    void testInitFromInstantRejectsNull() {","106","    void testInitFromInstantCopiesValues() {","120","    void testInitFromEpochMillis() {","130","    void testInitFromEpochMillisRejectsNegativeNanoOfMilli() {","136","    void testInitFromEpochMillisRejectsTooLargeNanoOfMilli() {","142","    void testInitFromEpochMillisAcceptsTooMaxNanoOfMilli() {","149","    void testInitFromEpochSecond() {","159","    void testInitFromEpochSecondRejectsNegativeNanoOfMilli() {","165","    void testInitFromEpochSecondRejectsTooLargeNanoOfMilli() {","171","    void testInitFromEpochSecondAcceptsTooMaxNanoOfMilli() {","178","    void testInstantToMillisAndNanos() {","186","    void testInitFromClock() {","199","    void testEquals() {","210","    void testHashCode() {","225","    void testToString() {","233","","234","    @Test","235","    void testTemporalAccessor() {","236","        java.time.Instant javaInstant = java.time.Instant.parse(\"2020-05-10T22:09:04.123456789Z\");","237","        MutableInstant log4jInstant = new MutableInstant();","238","        log4jInstant.initFromEpochSecond(javaInstant.getEpochSecond(), javaInstant.getNano());","239","        DateTimeFormatter formatter = DateTimeFormatter","240","                .ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSSSSSSSS'Z'\")","241","                .withZone(ZoneId.of(\"UTC\"));","242","        assertEquals(formatter.format(javaInstant), formatter.format(log4jInstant));","243","    }","244",""],"delete":["23","public class MutableInstantTest {","26","    public void testGetEpochSecond() {","44","    public void testGetNanoOfSecond() {","62","    public void testGetEpochMillisecond() {","80","    public void getGetNanoOfMillisecond() {","98","    public void testInitFromInstantRejectsNull() {","103","    public void testInitFromInstantCopiesValues() {","117","    public void testInitFromEpochMillis() {","127","    public void testInitFromEpochMillisRejectsNegativeNanoOfMilli() {","133","    public void testInitFromEpochMillisRejectsTooLargeNanoOfMilli() {","139","    public void testInitFromEpochMillisAcceptsTooMaxNanoOfMilli() {","146","    public void testInitFromEpochSecond() {","156","    public void testInitFromEpochSecondRejectsNegativeNanoOfMilli() {","162","    public void testInitFromEpochSecondRejectsTooLargeNanoOfMilli() {","168","    public void testInitFromEpochSecondAcceptsTooMaxNanoOfMilli() {","175","    public void testInstantToMillisAndNanos() {","183","    public void testInitFromClock() {","196","    public void testEquals() {","207","    public void testHashCode() {","222","    public void testToString() {"]}],"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/JsonTemplateLayoutTest.java":[{"add":["69","import java.time.temporal.ChronoField;","70","import java.time.temporal.TemporalAccessor;","208","    void test_inline_template() {","212","        final String formattedInstant = \"2017-09-28T17:13:29.098Z\";","213","        final TemporalAccessor instantAccessor = Instant.parse(formattedInstant);","214","        final long instantEpochSeconds = instantAccessor.getLong(ChronoField.INSTANT_SECONDS);","215","        final int instantEpochSecondsNanos = instantAccessor.get(ChronoField.NANO_OF_SECOND);","216","        final MutableInstant instant = new MutableInstant();","217","        instant.initFromEpochSecond(instantEpochSeconds, instantEpochSecondsNanos);","223","                .setInstant(instant)","233","                        \"pattern\", asMap(","234","                                \"format\", \"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\",","235","                                \"timeZone\", \"UTC\")),","247","            assertThat(accessor.getString(timestampFieldName)).isEqualTo(formattedInstant);"],"delete":["68","import java.text.SimpleDateFormat;","207","    void test_inline_template() throws Exception {","211","        final String timestamp = \"2017-09-28T17:13:29.098+02:00\";","212","        final long timeMillis = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\")","213","                .parse(timestamp)","214","                .getTime();","220","                .setTimeMillis(timeMillis)","230","                        \"pattern\", asMap(\"timeZone\", \"Europe\/Amsterdam\")),","242","            assertThat(accessor.getString(timestampFieldName)).isEqualTo(timestamp);"]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/revapi.json":[{"add":["148","      },","149","      {","150","        \"code\": \"java.class.defaultSerializationChanged\",","151","        \"old\": \"class org.apache.logging.log4j.core.time.MutableInstant\",","152","        \"new\": \"class org.apache.logging.log4j.core.time.MutableInstant\",","153","        \"justification\": \"LOG4J2-3075 MutableInstant extends from TemporalAccessor\""],"delete":[]}],"log4j-perf\/src\/main\/java\/org\/apache\/logging\/log4j\/perf\/jmh\/DateTimeFormatBenchmark.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3075\" dev=\"vy\" type=\"fix\">","72","        Fix formatting of nanoseconds in JsonTemplateLayout.","73","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstant.java":[{"add":["22","import java.time.temporal.ChronoField;","23","import java.time.temporal.TemporalAccessor;","24","import java.time.temporal.TemporalField;","25","import java.time.temporal.TemporalQueries;","26","import java.time.temporal.TemporalQuery;","27","import java.time.temporal.UnsupportedTemporalTypeException;","28","import java.time.temporal.ValueRange;","29","","30","import static java.time.temporal.ChronoField.INSTANT_SECONDS;","31","import static java.time.temporal.ChronoField.MICRO_OF_SECOND;","32","import static java.time.temporal.ChronoField.MILLI_OF_SECOND;","33","import static java.time.temporal.ChronoField.NANO_OF_SECOND;","34","import static java.time.temporal.ChronoUnit.NANOS;","47","public class MutableInstant implements Instant, Serializable, TemporalAccessor {","142","    public boolean isSupported(final TemporalField field) {","143","        if (field instanceof ChronoField) {","144","            return field == INSTANT_SECONDS ||","145","                    field == NANO_OF_SECOND ||","146","                    field == MICRO_OF_SECOND ||","147","                    field == MILLI_OF_SECOND;","148","        }","149","        return field != null && field.isSupportedBy(this);","150","    }","151","","152","    @Override","153","    public long getLong(final TemporalField field) {","154","        if (field instanceof ChronoField) {","155","            switch ((ChronoField) field) {","156","                case NANO_OF_SECOND: return nanoOfSecond;","157","                case MICRO_OF_SECOND: return nanoOfSecond \/ 1000;","158","                case MILLI_OF_SECOND: return nanoOfSecond \/ 1000_000;","159","                case INSTANT_SECONDS: return epochSecond;","160","            }","161","            throw new UnsupportedTemporalTypeException(\"Unsupported field: \" + field);","162","        }","163","        return field.getFrom(this);","164","    }","165","","166","    @Override","167","    public ValueRange range(final TemporalField field) {","168","        return TemporalAccessor.super.range(field);","169","    }","170","","171","    @Override","172","    public int get(final TemporalField field) {","173","        if (field instanceof ChronoField) {","174","            switch ((ChronoField) field) {","175","                case NANO_OF_SECOND: return nanoOfSecond;","176","                case MICRO_OF_SECOND: return nanoOfSecond \/ 1000;","177","                case MILLI_OF_SECOND: return nanoOfSecond \/ 1000_000;","178","                case INSTANT_SECONDS: INSTANT_SECONDS.checkValidIntValue(epochSecond);","179","            }","180","            throw new UnsupportedTemporalTypeException(\"Unsupported field: \" + field);","181","        }","182","        return range(field).checkValidIntValue(field.getFrom(this), field);","183","    }","184","","185","    @Override","186","    public <R> R query(final TemporalQuery<R> query) {","187","        if (query == TemporalQueries.precision()) {","188","            return (R) NANOS;","189","        }","190","        \/\/ inline TemporalAccessor.super.query(query) as an optimization","191","        if (query == TemporalQueries.chronology() ||","192","                query == TemporalQueries.zoneId() ||","193","                query == TemporalQueries.zone() ||","194","                query == TemporalQueries.offset() ||","195","                query == TemporalQueries.localDate() ||","196","                query == TemporalQueries.localTime()) {","197","            return null;","198","        }","199","        return query.queryFrom(this);","200","    }","201","","202","    @Override","233",""],"delete":["34","public class MutableInstant implements Instant, Serializable {"]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":[{"add":[],"delete":[]}],"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatterTest.java":[{"add":[],"delete":[]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":[{"add":["21","import org.apache.logging.log4j.layout.template.json.util.InstantFormatter;","210","                : createPatternResolver(config);","213","    private static final class PatternResolverContext {","215","        private final InstantFormatter formatter;","217","        private final StringBuilder lastFormattedInstantBuffer = new StringBuilder();","219","        private Instant lastFormattedInstant;","221","        private PatternResolverContext(","222","                final String pattern,","224","                final Locale locale) {","225","            this.formatter = InstantFormatter","226","                    .newBuilder()","227","                    .setPattern(pattern)","228","                    .setTimeZone(timeZone)","229","                    .setLocale(locale)","230","                    .build();","233","        private static PatternResolverContext fromConfig(","235","            final String pattern = readPattern(config);","238","            return new PatternResolverContext(pattern, timeZone, locale);","241","        private static String readPattern(final TemplateResolverConfig config) {","243","            return format != null","244","                    ? format","245","                    : JsonTemplateLayoutDefaults.getTimestampFormatPattern();","269","    private static final class PatternResolver implements EventResolver {","271","        private final PatternResolverContext patternResolverContext;","273","        private PatternResolver(final PatternResolverContext patternResolverContext) {","274","            this.patternResolverContext = patternResolverContext;","283","            if (patternResolverContext.lastFormattedInstant == null ||","284","                    !patternResolverContext.formatter.isInstantMatching(","285","                            patternResolverContext.lastFormattedInstant,","286","                            logEvent.getInstant())) {","289","                patternResolverContext.lastFormattedInstantBuffer.setLength(0);","290","                patternResolverContext.lastFormattedInstant = logEvent.getInstant();","291","                patternResolverContext.formatter.format(","292","                        patternResolverContext.lastFormattedInstant,","293","                        patternResolverContext.lastFormattedInstantBuffer);","298","                jsonWriter.writeString(patternResolverContext.lastFormattedInstantBuffer);","301","                patternResolverContext.lastFormattedInstantBuffer.setLength(0);","302","                patternResolverContext.lastFormattedInstantBuffer.append(","312","                        patternResolverContext.lastFormattedInstantBuffer);","319","    private static EventResolver createPatternResolver(","321","        final PatternResolverContext patternResolverContext =","322","                PatternResolverContext.fromConfig(config);","323","        return new PatternResolver(patternResolverContext);"],"delete":["20","import org.apache.logging.log4j.core.util.datetime.FastDateFormat;","24","import java.util.Calendar;","211","                : createFormatResolver(config);","214","    \/**","215","     * Context for GC-free formatted timestamp resolver.","216","     *\/","217","    private static final class FormatResolverContext {","219","        private final FastDateFormat timestampFormat;","221","        private final Calendar calendar;","223","        private final StringBuilder formattedTimestampBuilder;","225","        private FormatResolverContext(","227","                final Locale locale,","228","                final FastDateFormat timestampFormat) {","229","            this.timestampFormat = timestampFormat;","230","            this.formattedTimestampBuilder = new StringBuilder();","231","            this.calendar = Calendar.getInstance(timeZone, locale);","234","        private static FormatResolverContext fromConfig(","236","            final String format = readFormat(config);","239","            final FastDateFormat fastDateFormat =","240","                    FastDateFormat.getInstance(format, timeZone, locale);","241","            return new FormatResolverContext(timeZone, locale, fastDateFormat);","244","        private static String readFormat(final TemplateResolverConfig config) {","246","            if (format == null) {","247","                return JsonTemplateLayoutDefaults.getTimestampFormatPattern();","248","            }","249","            try {","250","                FastDateFormat.getInstance(format);","251","            } catch (final IllegalArgumentException error) {","252","                throw new IllegalArgumentException(","253","                        \"invalid timestamp format: \" + config,","254","                        error);","255","            }","256","            return format;","280","    \/**","281","     * GC-free formatted timestamp resolver.","282","     *\/","283","    private static final class FormatResolver implements EventResolver {","285","        private final FormatResolverContext formatResolverContext;","287","        private FormatResolver(final FormatResolverContext formatResolverContext) {","288","            this.formatResolverContext = formatResolverContext;","297","            final long timestampMillis = logEvent.getTimeMillis();","298","            if (formatResolverContext.formattedTimestampBuilder.length() == 0 || formatResolverContext.calendar.getTimeInMillis() != timestampMillis) {","301","                formatResolverContext.formattedTimestampBuilder.setLength(0);","302","                formatResolverContext.calendar.setTimeInMillis(timestampMillis);","303","                formatResolverContext.timestampFormat.format(","304","                        formatResolverContext.calendar,","305","                        formatResolverContext.formattedTimestampBuilder);","310","                jsonWriter.writeString(formatResolverContext.formattedTimestampBuilder);","313","                formatResolverContext.formattedTimestampBuilder.setLength(0);","314","                formatResolverContext.formattedTimestampBuilder.append(","324","                        formatResolverContext.formattedTimestampBuilder);","331","    private static EventResolver createFormatResolver(","333","        final FormatResolverContext formatResolverContext =","334","                FormatResolverContext.fromConfig(config);","335","        return new FormatResolver(formatResolverContext);","492","    \/**","493","     * Visible for tests","494","     *\/","495","    Calendar getCalendar() {","496","        return ((FormatResolver) internalResolver).formatResolverContext.calendar;","497","    }","498",""]}]}},"ab05c04f26ff83c0d044f1bb6215307ea9c19a41":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStackTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerThreadContextTest.java":"ADD","log4j-core\/src\/test\/resources\/AsyncLoggerThreadContextTest.xml":"ADD","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/ThreadContext.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStackTest.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStack.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStack.java":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStackTest.java":[{"add":["204","        final String[] expecteds = { \"msg1\", \"msg2\", \"msg3\" };","212","        final String[] expecteds = { \"msg1\", \"msg2\", \"msg3\" };","213","        final String[] result = new String[3];","289","","290","    @Test","291","    public void testIsFrozenIsFalseByDefault() {","292","        assertFalse(new MutableThreadContextStack().isFrozen());","293","        assertFalse(createStack().isFrozen());","294","    }","295","","296","    @Test","297","    public void testIsFrozenIsTrueAfterCallToFreeze() {","298","        final MutableThreadContextStack stack = new MutableThreadContextStack();","299","        assertFalse(stack.isFrozen());","300","        stack.freeze();","301","        assertTrue(stack.isFrozen());","302","    }","303","","304","    @Test(expected = UnsupportedOperationException.class)","305","    public void testAddAllOnFrozenStackThrowsException() {","306","        final MutableThreadContextStack stack = new MutableThreadContextStack();","307","        stack.freeze();","308","        stack.addAll(Arrays.asList(\"a\", \"b\", \"c\"));","309","    }","310","","311","    @Test(expected = UnsupportedOperationException.class)","312","    public void testAddOnFrozenStackThrowsException() {","313","        final MutableThreadContextStack stack = new MutableThreadContextStack();","314","        stack.freeze();","315","        stack.add(\"a\");","316","    }","317","","318","    @Test(expected = UnsupportedOperationException.class)","319","    public void testClearOnFrozenStackThrowsException() {","320","        final MutableThreadContextStack stack = new MutableThreadContextStack();","321","        stack.freeze();","322","        stack.clear();","323","    }","324","","325","    @Test(expected = UnsupportedOperationException.class)","326","    public void testPopOnFrozenStackThrowsException() {","327","        final MutableThreadContextStack stack = new MutableThreadContextStack();","328","        stack.freeze();","329","        stack.pop();","330","    }","331","","332","    @Test(expected = UnsupportedOperationException.class)","333","    public void testPushOnFrozenStackThrowsException() {","334","        final MutableThreadContextStack stack = new MutableThreadContextStack();","335","        stack.freeze();","336","        stack.push(\"a\");","337","    }","338","","339","    @Test(expected = UnsupportedOperationException.class)","340","    public void testRemoveOnFrozenStackThrowsException() {","341","        final MutableThreadContextStack stack = new MutableThreadContextStack();","342","        stack.freeze();","343","        stack.remove(\"a\");","344","    }","345","","346","    @Test(expected = UnsupportedOperationException.class)","347","    public void testRemoveAllOnFrozenStackThrowsException() {","348","        final MutableThreadContextStack stack = new MutableThreadContextStack();","349","        stack.freeze();","350","        stack.removeAll(Arrays.asList(\"a\", \"b\"));","351","    }","352","","353","    @Test(expected = UnsupportedOperationException.class)","354","    public void testRetainAllOnFrozenStackThrowsException() {","355","        final MutableThreadContextStack stack = new MutableThreadContextStack();","356","        stack.freeze();","357","        stack.retainAll(Arrays.asList(\"a\", \"b\"));","358","    }","359","","360","    @Test(expected = UnsupportedOperationException.class)","361","    public void testTrimOnFrozenStackThrowsException() {","362","        final MutableThreadContextStack stack = new MutableThreadContextStack();","363","        stack.freeze();","364","        stack.trim(3);","365","    }"],"delete":["204","        final String[] expecteds = {\"msg1\", \"msg2\", \"msg3\"};","212","        final String[] expecteds = {\"msg1\", \"msg2\", \"msg3\"};","213","        final String[] result = new String[3] ;"]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-705\" dev=\"rpopma\" type=\"fix\">","25","        Fixed issue where Async Logger does not log thread context stack data.","26","        API change: added method getImmutableStackOrNull() to ThreadContext.ContextStack interface.","27","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerThreadContextTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/AsyncLoggerThreadContextTest.xml":[{"add":[],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/ThreadContext.java":[{"add":["144","        @Override","145","        public ContextStack getImmutableStackOrNull() {","146","            return this;","147","        }","175","    \/\/ ironically, this annotation gives an \"unsupported @SuppressWarnings\" warning in Eclipse","176","    @SuppressWarnings(\"PublicStaticCollectionField\") \/\/ I like irony, so I won't delete it...","182","    \/\/ ironically, this annotation gives an \"unsupported @SuppressWarnings\" warning in Eclipse","360","        ContextStack result = contextStack.getImmutableStackOrNull();","361","        return result == null ? EMPTY_STACK : result;","536","         * @return a copy of the ContextStack.","539","","540","        \/**","541","         * Returns a ContextStack with the same contents as this ContextStack or {@code null}.","542","         * Attempts to modify the returned stack may or may not throw an exception, but will not affect the contents","543","         * of this ContextStack.","544","         * @return a ContextStack with the same contents as this ContextStack or {@code null}.","545","         *\/","546","        ContextStack getImmutableStackOrNull();"],"delete":["171","    @SuppressWarnings(\"PublicStaticCollectionField\")","354","        return contextStack;","529","         * @return a copy of the ContextStack.s"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStackTest.java":[{"add":["21","import org.apache.logging.log4j.ThreadContext.ContextStack;","22","import org.junit.Before;","29","    @Before","30","    public void before() {","31","        \/\/ clear the thread-local map","32","        new DefaultThreadContextMap(true).clear();","33","    }","34","","63","    public void testImmutableOrNullReturnsNullIfUseStackIsFalse() {","64","        final DefaultThreadContextStack stack = new DefaultThreadContextStack(false);","65","        stack.clear();","66","        assertEquals(null, stack.getImmutableStackOrNull());","67","    }","68","","69","    @Test","70","    public void testImmutableOrNullReturnsNullIfStackIsEmpty() {","71","        final DefaultThreadContextStack stack = new DefaultThreadContextStack(true);","72","        stack.clear();","73","        assertTrue(stack.isEmpty());","74","        assertEquals(null, stack.getImmutableStackOrNull());","75","    }","76","","77","    @Test","78","    public void testImmutableOrNullReturnsCopyOfContents() {","79","        final DefaultThreadContextStack stack = createStack();","80","        assertTrue(!stack.isEmpty());","81","        final ContextStack actual = stack.getImmutableStackOrNull();","82","        assertNotNull(actual);","83","        assertEquals(stack, actual);","84","    }","85","","86","    @Test(expected = UnsupportedOperationException.class)","87","    public void testModifyingImmutableOrNullThrowsException() {","88","        final DefaultThreadContextStack stack = createStack();","89","        final int originalSize = stack.size();","90","        assertTrue(originalSize > 0);","91","        final ContextStack actual = stack.getImmutableStackOrNull();","92","        assertEquals(originalSize, actual.size());","93","","94","        actual.pop();","253","        final String[] expecteds = { \"msg1\", \"msg2\", \"msg3\" };","261","        final String[] expecteds = { \"msg1\", \"msg2\", \"msg3\" };","262","        final String[] result = new String[3];"],"delete":["55","    public void testHashCodeVsMutable() {","56","        final DefaultThreadContextStack stack1 = createStack();","57","        final MutableThreadContextStack stack2 = MutableThreadContextStackTest.createStack();","58","        assertEquals(stack1.hashCode(), stack2.hashCode());","217","        final String[] expecteds = {\"msg1\", \"msg2\", \"msg3\"};","225","        final String[] expecteds = {\"msg1\", \"msg2\", \"msg3\"};","226","        final String[] result = new String[3] ;"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStack.java":[{"add":["24","import org.apache.logging.log4j.ThreadContext.ContextStack;","35","    private static final ThreadLocal<MutableThreadContextStack> stack = new ThreadLocal<MutableThreadContextStack>();","42","    ","43","    private MutableThreadContextStack getNonNullStackCopy() {","44","        final MutableThreadContextStack values = stack.get();","45","        return (MutableThreadContextStack) (values == null ? new MutableThreadContextStack() : values.copy());","46","    }","53","        final MutableThreadContextStack copy = getNonNullStackCopy();","55","        copy.freeze();","56","        stack.set(copy);","65","        final MutableThreadContextStack copy = getNonNullStackCopy();","67","        copy.freeze();","68","        stack.set(copy);","74","        final MutableThreadContextStack values = stack.get();","75","        if (values == null) {","78","        return values.asList();","88","        final MutableThreadContextStack values = stack.get();","89","        return values != null && values.contains(o);","98","        final MutableThreadContextStack values = stack.get();","99","        return values != null && values.containsAll(objects);","104","        MutableThreadContextStack values = null;","105","        if (!useStack || (values = stack.get()) == null) {","106","            return new MutableThreadContextStack();","108","        return values.copy();","129","        final MutableThreadContextStack values = stack.get();","130","        if (values == null) {","131","            return other == null;","133","        return values.equals(other);","138","        final MutableThreadContextStack values = stack.get();","139","        return values == null ? 0 : values.getDepth();","144","        final MutableThreadContextStack values = stack.get();","148","        result = prime * result + ((values == null) ? 0 : values.hashCode());","154","        final MutableThreadContextStack values = stack.get();","155","        return values == null || values.isEmpty();","160","        final MutableThreadContextStack values = stack.get();","161","        if (values == null) {","165","        return values.iterator();","170","        final MutableThreadContextStack values = stack.get();","171","        if (values == null || values.size() == 0) {","174","        return values.peek();","182","        final MutableThreadContextStack values = stack.get();","183","        if (values == null || values.size() == 0) {","186","        final MutableThreadContextStack copy = (MutableThreadContextStack) values.copy();","187","        final String result = copy.pop();","188","        copy.freeze();","189","        stack.set(copy);","206","        final MutableThreadContextStack values = stack.get();","207","        if (values == null || values.size() == 0) {","210","        final MutableThreadContextStack copy = (MutableThreadContextStack) values.copy();","212","        copy.freeze();","213","        stack.set(copy);","222","        final MutableThreadContextStack values = stack.get();","223","        if (values == null || values.isEmpty()) {","226","        final MutableThreadContextStack copy = (MutableThreadContextStack) values.copy();","228","        copy.freeze();","229","        stack.set(copy);","238","        final MutableThreadContextStack values = stack.get();","239","        if (values == null || values.isEmpty()) {","242","        final MutableThreadContextStack copy = (MutableThreadContextStack) values.copy();","244","        copy.freeze();","245","        stack.set(copy);","251","        final MutableThreadContextStack values = stack.get();","252","        return values == null ? 0 : values.size();","257","        final MutableThreadContextStack result = stack.get();","266","        final MutableThreadContextStack result = stack.get();","278","        final MutableThreadContextStack values = stack.get();","279","        return values == null ? \"[]\" : values.toString();","287","        final MutableThreadContextStack values = stack.get();","288","        if (values == null) {","291","        final MutableThreadContextStack copy = (MutableThreadContextStack) values.copy();","292","        copy.trim(depth);","293","        copy.freeze();","296","","297","    \/* (non-Javadoc)","298","     * @see org.apache.logging.log4j.ThreadContext.ContextStack#getImmutableStackOrNull()","299","     *\/","300","    @Override","301","    public ContextStack getImmutableStackOrNull() {","302","        return stack.get();","303","    }"],"delete":["18","import java.util.ArrayList;","35","    private static final ThreadLocal<List<String>> stack = new ThreadLocal<List<String>>();","48","        final List<String> list = stack.get();","49","        final List<String> copy = list == null ? new ArrayList<String>() : new ArrayList<String>(list);","51","        stack.set(Collections.unmodifiableList(copy));","60","        final List<String> list = stack.get();","61","        final List<String> copy = list == null ? new ArrayList<String>() : new ArrayList<String>(list);","63","        stack.set(Collections.unmodifiableList(copy));","69","        final List<String> list = stack.get();","70","        if (list == null) {","73","        return list;","83","        final List<String> result = stack.get();","84","        return result != null && result.contains(o);","93","        final List<String> list = stack.get();","94","        return list != null && list.containsAll(objects);","99","        List<String> result = null;","100","        if (!useStack || (result = stack.get()) == null) {","101","            return new MutableThreadContextStack(new ArrayList<String>());","103","        return new MutableThreadContextStack(result);","124","        final List<String> otherAsList = other.asList();","125","        final List<String> list = stack.get();","126","        if (list == null) {","127","            if (otherAsList != null) {","128","                return false;","129","            }","130","        } else if (!list.equals(otherAsList)) {","131","            return false;","133","        return true;","138","        final List<String> list = stack.get();","139","        return list == null ? 0 : list.size();","144","        final List<String> list = stack.get();","148","        result = prime * result + ((list == null) ? 0 : list.hashCode());","154","        final List<String> result = stack.get();","155","        return result == null || result.isEmpty();","160","        final List<String> immutable = stack.get();","161","        if (immutable == null) {","165","        return immutable.iterator();","170","        final List<String> list = stack.get();","171","        if (list == null || list.size() == 0) {","174","        final int last = list.size() - 1;","175","        return list.get(last);","183","        final List<String> list = stack.get();","184","        if (list == null || list.size() == 0) {","187","        final List<String> copy = new ArrayList<String>(list);","188","        final int last = copy.size() - 1;","189","        final String result = copy.remove(last);","190","        stack.set(Collections.unmodifiableList(copy));","207","        final List<String> list = stack.get();","208","        if (list == null || list.size() == 0) {","211","        final List<String> copy = new ArrayList<String>(list);","213","        stack.set(Collections.unmodifiableList(copy));","222","        final List<String> list = stack.get();","223","        if (list == null || list.isEmpty()) {","226","        final List<String> copy = new ArrayList<String>(list);","228","        stack.set(Collections.unmodifiableList(copy));","237","        final List<String> list = stack.get();","238","        if (list == null || list.isEmpty()) {","241","        final List<String> copy = new ArrayList<String>(list);","243","        stack.set(Collections.unmodifiableList(copy));","249","        final List<String> result = stack.get();","250","        return result == null ? 0 : result.size();","255","        final List<String> result = stack.get();","264","        final List<String> result = stack.get();","276","        final List<String> list = stack.get();","277","        return list == null ? \"[]\" : list.toString();","285","        final List<String> list = stack.get();","286","        if (list == null) {","289","        final List<String> copy = new ArrayList<String>();","290","        final int count = Math.min(depth, list.size());","291","        for (int i = 0; i < count; i++) {","292","            copy.add(list.get(i));","293","        }"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStack.java":[{"add":["23","import org.apache.logging.log4j.ThreadContext.ContextStack;","24","","36","    private boolean frozen;","37","","38","    \/**","39","     * Constructs an empty MutableThreadContextStack.","40","     *\/","41","    public MutableThreadContextStack() {","42","        this(new ArrayList<String>());","43","    }","53","    private void checkInvariants() {","54","        if (frozen) {","55","            throw new UnsupportedOperationException(\"context stack has been frozen\");","56","        }","57","    }","58","","61","        checkInvariants();","81","        checkInvariants();","97","        checkInvariants();","120","        checkInvariants();","156","        checkInvariants();","162","        checkInvariants();","173","        checkInvariants();","179","        checkInvariants();","185","        checkInvariants();","224","","225","    @Override","226","    public ContextStack getImmutableStackOrNull() {","227","        return copy();","228","    }","229","","230","    \/**","231","     * \"Freezes\" this context stack so it becomes immutable: all mutator methods will throw an exception from now on.","232","     *\/","233","    public void freeze() {","234","        frozen = true;","235","    }","236","    ","237","    public boolean isFrozen() {","238","        return frozen;","239","    }"],"delete":[]}]}}}