{"55ed92eab3439e13a3e7afe18ae35d10e85194a3":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/SerializedLayoutTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/SerializedLayout.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractOutputStreamAppender.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TCPSocketManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LogEventTest.java":"ADD","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsynchAppenderTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/SerializedLayoutTest.java":[{"add":["20","import org.apache.logging.log4j.LoggingException;","67","        \"Logger=root Level=ERROR Message=finished mdc pattern test\",","68","        \"Logger=root Level=ERROR Message=Throwing an exception\"","102","        Exception parent = new IllegalStateException(\"Test\");","103","        Throwable child = new LoggingException(\"This is a test\", parent);","104","","105","        root.error(\"Throwing an exception\", child);","106",""],"delete":["66","        \"Logger=root Level=ERROR Message=finished mdc pattern test\""]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/SerializedLayout.java":[{"add":["61","                oos.reset();"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractOutputStreamAppender.java":[{"add":["111","            byte[] bytes = getLayout().toByteArray(event);","112","            if (bytes.length > 0) {","113","                manager.write(bytes);","114","                if (this.immediateFlush) {","115","                    manager.flush();","116","                }"],"delete":["111","            manager.write(getLayout().toByteArray(event));","112","            if (this.immediateFlush) {","113","                manager.flush();"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderTest.java":[{"add":["20","import org.apache.logging.log4j.LoggingException;","79","        list.clear();","92","        list.clear();","107","        Exception parent = new IllegalStateException(\"Test\");","108","        Throwable child = new LoggingException(\"This is a test\");","109","        root.error(\"Throwing an exception\", child);","110","        root.debug(\"This is another test message\");","111","        Thread.sleep(250);","112","        LogEvent event = list.poll(3, TimeUnit.SECONDS);","116","        event = list.poll(3, TimeUnit.SECONDS);","117","        assertNotNull(\"No event retrieved\", event);","118","        assertTrue(\"Incorrect event\", event.getMessage().getFormattedMessage().equals(\"Throwing an exception\"));","119","        assertTrue(\"Message not delivered via TCP\", tcpCount > 1);","134","        root.debug(\"This is a udp message\");","137","        assertTrue(\"Incorrect event\", event.getMessage().getFormattedMessage().equals(\"This is a udp message\"));"],"delete":["104","        final LogEvent event = list.poll(3, TimeUnit.SECONDS);","122","        root.debug(\"This is a test message\");","125","        assertTrue(\"Incorrect event\", event.getMessage().getFormattedMessage().equals(\"This is a test message\"));"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TCPSocketManager.java":[{"add":[],"delete":["111","            socket.setSendBufferSize(length);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-142\" dev=\"rgoers\" type=\"fix\">","26","        Serialized LogEvents were not reset in the output stream causing them to deserialize incorrectly.","27","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LogEventTest.java":[{"add":[],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsynchAppenderTest.java":[{"add":["20","import org.apache.logging.log4j.LoggingException;","27","import org.junit.After;","66","    @After","67","    public void after() {","68","        app.clear();","69","    }","70","","87","","88","    @Test","89","    public void testException() throws Exception {","90","        final Logger logger = LogManager.getLogger(AsynchAppender.class);","91","        Exception parent = new IllegalStateException(\"Test\");","92","        Throwable child = new LoggingException(\"This is a test\", parent);","93","        logger.error(\"This is a test\", child);","94","        Thread.sleep(100);","95","        final List<String> list = app.getMessages();","96","        assertNotNull(\"No events generated\", list);","97","        assertTrue(\"Incorrect number of events. Expected 1, got \" + list.size(), list.size() == 1);","98","        String msg = list.get(0);","99","        assertTrue(\"No parent exception\", msg.contains(\"java.lang.IllegalStateException\"));","100","    }"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["47","    private final ThrowableProxy proxyCause;","50","    private final String name;","51","","65","        super(throwable.getMessage(), null);","66","        this.name = throwable.getClass().getName();","69","        super.setStackTrace(throwable.getStackTrace());","71","        this.proxyCause = (throwable.getCause() == null) ? null :","85","        super(cause.getMessage(), null);","86","        this.name = cause.getClass().getName();","87","        super.setStackTrace(cause.getStackTrace());","89","        this.proxyCause = (cause.getCause() == null) ? null :","90","            new ThrowableProxy(parent, stack, map, cause.getCause());","91","        setSuppressed(cause);","102","        return proxyCause;","112","        String msg = getMessage();","113","        return msg != null ? name + \": \" + msg : name;","121","    \/*","124","        return callerData;","125","    } *\/","142","        if (proxyCause != null) {","143","            formatWrapper(sb, proxyCause);","146","        sb.append(toString());","148","        formatElements(sb, 0, getStackTrace(), callerPackageData, packages);","170","            formatWrapper(sb, cause.proxyCause);","191","        final StringBuilder sb = new StringBuilder(name);","192","        String msg = getMessage();","193","        if (msg != null) {","194","            sb.append(\": \").append(getMessage());","195","        }","197","        formatElements(sb, 0, getStackTrace(), callerPackageData, packages);","198","        if (proxyCause != null) {","199","            formatCause(sb, proxyCause, packages);","224","            formatCause(sb, cause.proxyCause, packages);"],"delete":["22","import java.io.PrintStream;","23","import java.io.PrintWriter;","49","    private final Throwable throwable;","50","    private final ThrowableProxy cause;","66","        this.throwable = throwable;","70","        this.cause = (throwable.getCause() == null) ? null :","84","        this.throwable = cause;","86","        this.cause = (throwable.getCause() == null) ? null :","87","            new ThrowableProxy(parent, stack, map, throwable.getCause());","88","        setSuppressed(throwable);","98","    public String getMessage() {","99","        return throwable.getMessage();","100","    }","101","","102","    @Override","103","    public String getLocalizedMessage() {","104","        return throwable.getLocalizedMessage();","105","    }","106","","107","    @Override","109","        return cause;","119","        return throwable.toString();","120","    }","121","","122","    @Override","123","    public void printStackTrace() {","124","        throwable.printStackTrace();","125","    }","126","","127","    @Override","128","    public void printStackTrace(final PrintStream printStream) {","129","        throwable.printStackTrace(printStream);","130","    }","131","","132","    @Override","133","    public void printStackTrace(final PrintWriter printWriter) {","134","        throwable.printStackTrace(printWriter);","144","        return throwable.getStackTrace();","145","    }","162","        if (cause != null) {","163","            formatWrapper(sb, cause);","166","        sb.append(throwable.toString());","168","        formatElements(sb, 0, throwable.getStackTrace(), callerPackageData, packages);","190","            formatWrapper(sb, cause.cause);","211","        final StringBuilder sb = new StringBuilder(throwable.toString());","213","        formatElements(sb, 0, throwable.getStackTrace(), callerPackageData, packages);","214","        if (cause != null) {","215","            formatCause(sb, cause, packages);","240","            formatCause(sb, cause.cause, packages);"]}]}},"9704558ab78ef15c27222ba1186b5799a70e7cc0":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SyslogAppenderTest.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketMessageLossTest.java":"ADD","core\/src\/test\/resources\/log4j-socket2.xml":"ADD","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServer.java":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SyslogAppenderTest.java":[{"add":["269","            while (!shutdown) {","270","                try {","271","                    byte[] buffer = new byte[4096];","273","                    socket.setSoLinger(true, 0);","293","                } catch (Exception ex) {","294","                    if (!shutdown) {","295","                        System.out.println(\"Caught exception: \" + ex.getMessage());","296","                    }","299",""],"delete":["269","            try {","270","                byte[] buffer = new byte[4096];","271","                while (!shutdown) {","292","                }","293","            } catch (Exception ex) {","294","                if (!shutdown) {","295","                    throw new RuntimeException(ex);"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketMessageLossTest.java":[{"add":[],"delete":[]}],"core\/src\/test\/resources\/log4j-socket2.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-122\" dev=\"rgoers\" type=\"update\">","26","        Add unit test to verify exceptions are thrown when the socket connection fails.","27","      <\/action>","28","      <action issue=\"LOG4J2-125\" dev=\"rgoers\" type=\"fix\">","29","        JMSQueue and JMSTopic Appenders did not allow name to be specified.","30","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServer.java":[{"add":["127","                clientSocket.setSoLinger(true, 0);"],"delete":[]}]}},"eb565b59b4f4abd1769128e96234b1b769b5ffe8":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationException.java":"MODIFY","log4j12-api\/src\/test\/java\/org\/apache\/log4j\/LevelTest.java":"MODIFY","slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLoggingException.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AppenderRuntimeException.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/SimplePerfTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAvroManager.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/UnexpectedFormatException.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/XMLEvents.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/DateLookupTest.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/Timer.java":"MODIFY","flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationException.java":[{"add":["23","    \/**","24","     * Generated serial version ID.","25","     *\/","26","    private static final long serialVersionUID = -2413951820300775294L;","27",""],"delete":[]}],"log4j12-api\/src\/test\/java\/org\/apache\/log4j\/LevelTest.java":[{"add":["94","         * Generated serial version ID.","95","         *\/","96","        private static final long serialVersionUID = -6931920872225831135L;","97","","98","        \/**"],"delete":[]}],"slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLoggingException.java":[{"add":["24","    \/**","25","     * Generated serial version ID.","26","     *\/","27","    private static final long serialVersionUID = -1618650972455089998L;","28",""],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AppenderRuntimeException.java":[{"add":["25","    \/**","26","     * Generated serial version ID.","27","     *\/","28","    private static final long serialVersionUID = 6545990597472958303L;","29",""],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/SimplePerfTest.java":[{"add":["132","        \/**","133","         * Generated serial version ID.","134","         *\/","135","        private static final long serialVersionUID = 3517002855516031846L;"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-145\" dev=\"ggregory\" type=\"fix\">","26","        Add missing serial version IDs.","27","      <\/action>"],"delete":[]}],"flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAvroManager.java":[{"add":["261","        \/**","262","         * Generated serial version ID.","263","         *\/","264","        private static final long serialVersionUID = -1599817377315957495L;","265",""],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/UnexpectedFormatException.java":[{"add":["21","  \/**","22","     * Generated serial version ID.","23","     *\/","24","    private static final long serialVersionUID = -5322323184538975579L;","25","","26","public UnexpectedFormatException(final String msg) {"],"delete":["21","  public UnexpectedFormatException(final String msg) {"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/XMLEvents.java":[{"add":["58","        \/**","59","         * Generated serial version ID.","60","         *\/","61","        private static final long serialVersionUID = -4334703653495359785L;","62",""],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/DateLookupTest.java":[{"add":["46","        \/**","47","         * Generated serial version ID.","48","         *\/","49","        private static final long serialVersionUID = -2663819677970643109L;","50",""],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/Timer.java":[{"add":["26","    \/**","27","     * Generated serial version ID.","28","     *\/","29","    private static final long serialVersionUID = 1313460139390794926L;"],"delete":[]}],"flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":[{"add":["43","    \/**","44","     * Generated serial version ID.","45","     *\/","46","    private static final long serialVersionUID = -8988674608627854140L;","47",""],"delete":[]}]}},"52e3c58d6ba4be5638b734a38367f503b8a3d29d":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractWriterAppender.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractOutputStreamAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AppenderControl.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractWriterAppender.java":[{"add":["86","            error(\"Unable to write \" + manager.getName() + \" for appender \" + getName(), event, ex);\r"],"delete":["86","            error(\"Unable to write \" + manager.getName() + \" for appender \" + getName() + \": \" + ex);\r"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractOutputStreamAppender.java":[{"add":["162","            error(\"Unable to write to stream \" + manager.getName() + \" for appender \" + getName(), event, ex);"],"delete":["162","            error(\"Unable to write to stream \" + manager.getName() + \" for appender \" + getName() + \": \" + ex);"]}],"src\/changes\/changes.xml":[{"add":["60","      <action issue=\"LOG4J2-2444\" dev=\"ckozak\" type=\"fix\">","61","        ErrorHandler is invoked with a LogEvent and Throwable when possible, where previously only a string was used.","62","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AppenderControl.java":[{"add":["157","            handleAppenderError(event, ex);","159","            handleAppenderError(event, new AppenderLoggingException(ex));","163","    private void handleAppenderError(final LogEvent event, final RuntimeException ex) {","164","        appender.getHandler().error(createErrorMsg(\"An exception occurred processing Appender \"), event, ex);"],"delete":["157","            handleAppenderError(ex);","159","            handleAppenderError(new AppenderLoggingException(ex));","163","    private void handleAppenderError(final RuntimeException ex) {","164","        appender.getHandler().error(createErrorMsg(\"An exception occurred processing Appender \"), ex);"]}]}},"7f391872ce40fc08abbfcdb5541d3a8507317c7a":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/Priority.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/PriorityTest.java":"ADD"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/Priority.java":[{"add":["45","        return (facility.getCode() << 3) + Severity.getSeverity(level).getCode();"],"delete":["45","        return facility.getCode() << 3 + Severity.getSeverity(level).getCode();"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-102\" dev=\"rgoers\" type=\"fix\" due-to=\"Emanuele Colombo\">","26","        The Facility value was being improperly calculated.","27","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/PriorityTest.java":[{"add":[],"delete":[]}]}},"4195c7b365f0bba71f5a8aec59bf32dd90cc1f20":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultRootLoggerComponentBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultLoggerComponentBuilder.java":"MODIFY","log4j-core\/src\/test\/resources\/RollingRandomAccessFileAppenderLocationPropsTest.properties":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppenderTests.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/api\/ConfigurationBuilder.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":[{"add":["205","        return new DefaultLoggerComponentBuilder(this, name, level.toString(), \"AsyncLogger\", false);","206","    }","207","","208","    @Override","209","    public LoggerComponentBuilder newAsyncLogger(final String name, final Level level, boolean includeLocation) {","210","        return new DefaultLoggerComponentBuilder(this, name, level.toString(), \"AsyncLogger\", includeLocation);","215","        return new DefaultLoggerComponentBuilder(this, name, level, \"AsyncLogger\", false);","216","    }","217","","218","    @Override","219","    public LoggerComponentBuilder newAsyncLogger(final String name, final String level, boolean includeLocation) {","225","        return new DefaultRootLoggerComponentBuilder(this, level.toString(), \"AsyncRoot\", false);","226","    }","227","","228","    @Override","229","    public RootLoggerComponentBuilder newAsyncRootLogger(final Level level, boolean includeLocation) {","230","        return new DefaultRootLoggerComponentBuilder(this, level.toString(), \"AsyncRoot\", includeLocation);","235","        return new DefaultRootLoggerComponentBuilder(this, level, \"AsyncRoot\", false);","236","    }","237","","238","    @Override","239","    public RootLoggerComponentBuilder newAsyncRootLogger(final String level, boolean includeLocation) {","240","        return new DefaultRootLoggerComponentBuilder(this, level, \"AsyncRoot\", includeLocation);","285","        return new DefaultLoggerComponentBuilder(this, name, level.toString(), true);","286","    }","287","","288","    @Override","289","    public LoggerComponentBuilder newLogger(final String name, final Level level, boolean includeLocation) {","290","        return new DefaultLoggerComponentBuilder(this, name, level.toString(), includeLocation);","295","        return new DefaultLoggerComponentBuilder(this, name, level, true);","296","    }","297","","298","    @Override","299","    public LoggerComponentBuilder newLogger(final String name, final String level, boolean includeLocation) {","300","        return new DefaultLoggerComponentBuilder(this, name, level, includeLocation);","305","        return new DefaultRootLoggerComponentBuilder(this, level.toString(), true);","306","    }","307","","308","    @Override","309","    public RootLoggerComponentBuilder newRootLogger(final Level level, boolean includeLocation) {","310","        return new DefaultRootLoggerComponentBuilder(this, level.toString(), includeLocation);","315","        return new DefaultRootLoggerComponentBuilder(this, level, true);","316","    }","317","","318","    @Override","319","    public RootLoggerComponentBuilder newRootLogger(final String level, boolean includeLocation) {","320","        return new DefaultRootLoggerComponentBuilder(this, level, includeLocation);"],"delete":["205","        return new DefaultLoggerComponentBuilder(this, name, level.toString(), \"AsyncLogger\");","215","        return new DefaultRootLoggerComponentBuilder(this, level.toString(), \"AsyncRoot\");","220","        return new DefaultRootLoggerComponentBuilder(this, level, \"AsyncRoot\");","265","        return new DefaultLoggerComponentBuilder(this, name, level.toString());","270","        return new DefaultLoggerComponentBuilder(this, name, level);","275","        return new DefaultRootLoggerComponentBuilder(this, level.toString());","280","        return new DefaultRootLoggerComponentBuilder(this, level);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1363\" dev=\"rgoers\" type=\"fix\">","27","        Properties Configuration did not support includeLocation attribute on Loggers.","28","      <\/action>","29","      <action issue=\"LOG4J2-1263\" dev=\"rgoers\" type=\"fix\">","30","        The ConfigurationSource was not saved for BuiltConfigurations so monitor interval had no effect.","31","      <\/action>"],"delete":["1267","      <action issue=\"LOG4J2-1263\" dev=\"rgoers\" type=\"fix\">","1268","        The ConfigurationSource was not saved for BuiltConfigurations so monitor interval had no effect.","1269","      <\/action>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultRootLoggerComponentBuilder.java":[{"add":["44","     * @param includeLocation","45","     *\/","46","    public DefaultRootLoggerComponentBuilder(final DefaultConfigurationBuilder<? extends Configuration> builder,","47","            final String level, final boolean includeLocation) {","48","        super(builder, \"\", \"Root\");","49","        addAttribute(\"level\", level);","50","        addAttribute(\"includeLocation\", includeLocation);","51","    }","52","","53","    \/**","54","     * Configure the root logger.","55","     * @param builder","56","     * @param level","65","","66","    \/**","67","     * Configure the root logger.","68","     * @param builder","69","     * @param level","70","     * @param type","71","     *\/","72","    public DefaultRootLoggerComponentBuilder(final DefaultConfigurationBuilder<? extends Configuration> builder,","73","            final String level, final String type, final boolean includeLocation) {","74","        super(builder, \"\", type);","75","        addAttribute(\"level\", level);","76","        addAttribute(\"includeLocation\", includeLocation);","77","    }","78",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultLoggerComponentBuilder.java":[{"add":["46","     * @param includeLocation","47","     *\/","48","    public DefaultLoggerComponentBuilder(final DefaultConfigurationBuilder<? extends Configuration> builder, final String name,","49","            final String level, boolean includeLocation) {","50","        super(builder, name, \"Logger\");","51","        addAttribute(\"level\", level);","52","        addAttribute(\"includeLocation\", includeLocation);","53","    }","54","","55","    \/**","56","     * Configure a logger.","57","     * @param builder","58","     * @param name","59","     * @param level","68","    \/**","69","     * Configure a logger.","70","     * @param builder","71","     * @param name","72","     * @param level","73","     * @param type","74","     * @param includeLocation","75","     *\/","76","    public DefaultLoggerComponentBuilder(final DefaultConfigurationBuilder<? extends Configuration> builder, final String name,","77","            final String level, final String type, boolean includeLocation) {","78","        super(builder, name, type);","79","        addAttribute(\"level\", level);","80","        addAttribute(\"includeLocation\", includeLocation);","81","    }","82",""],"delete":[]}],"log4j-core\/src\/test\/resources\/RollingRandomAccessFileAppenderLocationPropsTest.properties":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":[{"add":["205","        final String location = (String) properties.remove(\"includeLocation\");","212","        boolean includeLocation;","215","                if (location != null) {","216","                    includeLocation = Boolean.parseBoolean(location);","217","                    loggerBuilder = builder.newAsyncLogger(name, level, includeLocation);","218","                } else {","219","                    loggerBuilder = builder.newAsyncLogger(name, level);","220","                }","225","            if (location != null) {","226","                includeLocation = Boolean.parseBoolean(location);","227","                loggerBuilder = builder.newLogger(name, level, includeLocation);","228","            } else {","229","                loggerBuilder = builder.newLogger(name, level);","230","            }","244","        final String location = (String) properties.remove(\"includeLocation\");","245","        final boolean includeLocation;","249","                if (location != null) {","250","                    includeLocation = Boolean.parseBoolean(location);","251","                    loggerBuilder = builder.newAsyncRootLogger(level, includeLocation);","252","                } else {","253","                    loggerBuilder = builder.newAsyncRootLogger(level);","254","                }","259","            if (location != null) {","260","                includeLocation = Boolean.parseBoolean(location);","261","                loggerBuilder = builder.newRootLogger(level, includeLocation);","262","            } else {","263","                loggerBuilder = builder.newRootLogger(level);","264","            }"],"delete":["213","                loggerBuilder = builder.newAsyncLogger(name, level);","218","            loggerBuilder = builder.newLogger(name, level);","235","                loggerBuilder = builder.newAsyncRootLogger(level);","240","            loggerBuilder = builder.newRootLogger(level);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppenderTests.java":[{"add":["44","    @Parameterized.Parameters(name = \"{0}, locationEnabled={1}, type={2}\")","48","                        { \"RandomAccessFileAppenderTest\", false, \".xml\" },","49","                        { \"RandomAccessFileAppenderLocationTest\", true, \".xml\" },","50","                        { \"RollingRandomAccessFileAppenderTest\", false, \".xml\" },","51","                        { \"RollingRandomAccessFileAppenderLocationTest\", true, \".xml\" },","52","                        { \"RollingRandomAccessFileAppenderLocationPropsTest\", false, \".properties\" }","66","    public RandomAccessFileAppenderTests(final String testName, final boolean locationEnabled, final String type) {","67","        this.init = new LoggerContextRule(testName + type);"],"delete":["44","    @Parameterized.Parameters(name = \"{0}, locationEnabled={1}\")","48","                        { \"RandomAccessFileAppenderTest\", false },","49","                        { \"RandomAccessFileAppenderLocationTest\", true },","50","                        { \"RollingRandomAccessFileAppenderTest\", false },","51","                        { \"RollingRandomAccessFileAppenderLocationTest\", true }","65","    public RandomAccessFileAppenderTests(final String testName, final boolean locationEnabled) {","66","        this.init = new LoggerContextRule(testName + \".xml\");"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/api\/ConfigurationBuilder.java":[{"add":["143","     * @param includeLocation If true include location information.","144","     * @return A new LoggerComponentBuilder.","145","     *\/","146","    LoggerComponentBuilder newAsyncLogger(String name, Level level, boolean includeLocation);","147","","148","    \/**","149","     * Returns a builder for creating Async Loggers.","150","     * @param name The name of the Logger.","151","     * @param level The logging Level to be assigned to the Logger.","157","     * Returns a builder for creating Async Loggers.","158","     * @param name The name of the Logger.","159","     * @param level The logging Level to be assigned to the Logger.","160","     * @param includeLocation If true include location information.","161","     * @return A new LoggerComponentBuilder.","162","     *\/","163","    LoggerComponentBuilder newAsyncLogger(String name, String level, boolean includeLocation);","164","","165","    \/**","172","","173","    \/**","174","     * Returns a builder for creating the async root Logger.","175","     * @param level The logging Level to be assigned to the root Logger.","176","     * @param includeLocation If true include location information.","177","     * @return A new RootLoggerComponentBuilder.","178","     *\/","179","    RootLoggerComponentBuilder newAsyncRootLogger(Level level, boolean includeLocation);","180","","188","","189","    \/**","190","     * Returns a builder for creating the async root Logger.","191","     * @param level The logging Level to be assigned to the root Logger.","192","     * @param includeLocation If true include location information.","193","     * @return A new RootLoggerComponentBuilder.","194","     *\/","195","    RootLoggerComponentBuilder newAsyncRootLogger(String level, boolean includeLocation);","196","","270","     * @param includeLocation If true include location information.","271","     * @return A new LoggerComponentBuilder.","272","     *\/","273","    LoggerComponentBuilder newLogger(String name, Level level, boolean includeLocation);","274","","275","    \/**","276","     * Returns a builder for creating Loggers.","277","     * @param name The name of the Logger.","278","     * @param level The logging Level to be assigned to the Logger.","284","     * Returns a builder for creating Loggers.","285","     * @param name The name of the Logger.","286","     * @param level The logging Level to be assigned to the Logger.","287","     * @param includeLocation If true include location information.","288","     * @return A new LoggerComponentBuilder.","289","     *\/","290","    LoggerComponentBuilder newLogger(String name, String level, boolean includeLocation);","291","","292","    \/**","302","     * @param includeLocation If true include location information.","303","     * @return A new RootLoggerComponentBuilder.","304","     *\/","305","    RootLoggerComponentBuilder newRootLogger(Level level, boolean includeLocation);","306","","307","    \/**","308","     * Returns a builder for creating the root Logger.","309","     * @param level The logging Level to be assigned to the root Logger.","310","     *","316","     * Returns a builder for creating the root Logger.","317","     * @param level The logging Level to be assigned to the root Logger.","318","     *","319","     * @return A new RootLoggerComponentBuilder.","320","     *\/","321","    RootLoggerComponentBuilder newRootLogger(String level, boolean includeLocation);","322","","323","    \/**","326","     * @param includeLocation If true include location information."],"delete":[]}]}},"36585cf45e0925fb50f6cb469f9bf49cad793369":{"changes":{"log4j-jpl\/src\/test\/java\/org\/apache\/logging\/log4j\/jpl\/Log4jSystemLoggerTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-jpl\/src\/main\/java\/org\/apache\/logging\/log4j\/jpl\/Log4jSystemLogger.java":"MODIFY"},"diff":{"log4j-jpl\/src\/test\/java\/org\/apache\/logging\/log4j\/jpl\/Log4jSystemLoggerTest.java":[{"add":["24","import static org.junit.Assert.assertSame;","89","    public void testParameterizedLogging() {","90","        logger.log(Logger.Level.INFO, \"Hello, {0}!\", \"World\");","91","        final List<LogEvent> events = eventAppender.getEvents();","92","        assertThat(events, hasSize(1));","93","        final LogEvent event = events.get(0);","94","        assertThat(event, instanceOf(Log4jLogEvent.class));","95","        assertEquals(Level.INFO, event.getLevel());","96","        assertEquals(LOGGER_NAME, event.getLoggerName());","97","        assertEquals(\"Hello, World!\", event.getMessage().getFormattedMessage());","98","        assertEquals(Log4jSystemLogger.class.getName(), event.getLoggerFqcn());","99","    }","100","","101","    @Test","102","    public void testParameterizedLoggingWithThrowable() {","103","        Throwable throwable = new RuntimeException();","104","        logger.log(Logger.Level.INFO, \"Hello, {0}!\", \"World\", throwable);","105","        final List<LogEvent> events = eventAppender.getEvents();","106","        assertThat(events, hasSize(1));","107","        final LogEvent event = events.get(0);","108","        assertThat(event, instanceOf(Log4jLogEvent.class));","109","        assertEquals(Level.INFO, event.getLevel());","110","        assertEquals(LOGGER_NAME, event.getLoggerName());","111","        assertEquals(\"Hello, World!\", event.getMessage().getFormattedMessage());","112","        assertEquals(Log4jSystemLogger.class.getName(), event.getLoggerFqcn());","113","        assertSame(throwable, event.getThrown());","114","    }","115","","116","    @Test"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3345\" dev=\"ckozak\">","34","        log4j-jpl formats message parameters correctly using MessageFormat.","35","      <\/action>"],"delete":[]}],"log4j-jpl\/src\/main\/java\/org\/apache\/logging\/log4j\/jpl\/Log4jSystemLogger.java":[{"add":["25","import org.apache.logging.log4j.message.Message;","26","import org.apache.logging.log4j.message.MessageFormatMessage;","27","import org.apache.logging.log4j.message.SimpleMessage;","58","        log(level, (ResourceBundle) null, msg, (Throwable) null);","65","            log(level, (ResourceBundle) null, msgSupplier.get(), (Throwable) null);","73","            log(level, (ResourceBundle) null, obj.toString(), (Throwable) null);","102","        Message message = createMessage(getResource(bundle, format), params);","103","        logger.logIfEnabled(FQCN, getLevel(level), null, message, message.getThrowable());","104","    }","105","","106","    private static Message createMessage(final String format, final Object... params) {","107","        if (params == null || params.length == 0) {","108","            return new SimpleMessage(format);","109","        }","110","        return new MessageFormatMessage(format, params);"],"delete":["55","        log(level, (ResourceBundle) null, msg, (Object[]) null);","62","            log(level, (ResourceBundle) null, msgSupplier.get(), (Object[]) null);","70","            log(level, (ResourceBundle) null, obj.toString(), (Object[]) null);","99","        logger.logIfEnabled(FQCN, getLevel(level), null, getResource(bundle, format), params);"]}]}},"543ff58f0a03e077c21382da6e359de051b5fdd2":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSQueueAppender.java":"MODIFY","src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSTopicAppender.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppender.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSQueueAppender.java":[{"add":["68","     * @param layout The layout to use (defaults to SerializedLayout)."],"delete":["68","     * @param layout The layout to use (defaults to SerlializedLayout)."]}],"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["1610","      <SerializedLayout \/>"],"delete":["1610","      <SerlializedLayout \/>"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-140\" dev=\"ggregory\" type=\"fix\" due-to=\"Joern Huxhorn\">","26","        Typo in documentation of SocketAppender.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSTopicAppender.java":[{"add":["68","     * @param layout The layout to use (defaults to SerializedLayout)."],"delete":["68","     * @param layout The layout to use (defaults to SerlializedLayout)."]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppender.java":[{"add":["57","     * @param layout The layout to use (defaults to SerializedLayout)."],"delete":["57","     * @param layout The layout to use (defaults to SerlializedLayout)."]}]}},"aef15ce651d171d17a8274d2a2d01740bb866eaa":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-144\" dev=\"ggregory\" type=\"fix\">","26","        NullPointerException in RFC5424Layout.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":[{"add":["477","            } ","481","            if (charsetName != null) {","482","                LOGGER.error(\"Charset \" + charsetName + \" is not supported for layout, using \" + charset.displayName());","483","            }","485","        "],"delete":["477","            } else {","478","                LOGGER.error(\"Charset \" + charsetName + \" is not supported for layout, using \" + charset.displayName());","479","            }","484",""]}]}},"a8a2435732da968f95f0cf0adb40ea9fbef9525b":{"changes":{"log4j-1.2-api\/pom.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/VelocityTest.java":"ADD","log4j-1.2-api\/src\/test\/resources\/hello.vm":"ADD","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/PatternLayout.java":"MODIFY"},"diff":{"log4j-1.2-api\/pom.xml":[{"add":["54","    <dependency>","55","      <groupId>org.apache.velocity<\/groupId>","56","      <artifactId>velocity<\/artifactId>","57","      <version>1.7<\/version>","58","      <scope>test<\/scope>","59","    <\/dependency>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-368\" dev=\"rgoers\" type=\"fix\">","24","        Add PatternLayout constructor to Log4j 1.2 bridge for Velocity.","25","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/VelocityTest.java":[{"add":[],"delete":[]}],"log4j-1.2-api\/src\/test\/resources\/hello.vm":[{"add":[],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/PatternLayout.java":[{"add":["25","    public PatternLayout(String pattern) {","26","","27","    }","28",""],"delete":[]}]}},"731c84b5390eed18bfffb78914a76e2c1e62d75a":{"changes":{"log4j-core\/src\/test\/resources\/AsyncLoggerConfigAutoFlushTest.xml":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigAutoFlushTest.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompactFileAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompleteFileAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlFileAppenderTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/resources\/AsyncLoggerConfigAutoFlushTest.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["153","        final Set<LoggerConfig> alreadyStarted = new HashSet<LoggerConfig>();","156","            alreadyStarted.add(logger);","161","        if (!alreadyStarted.contains(root)) { \/\/ LOG4J2-392","162","            root.start(); \/\/ LOG4J2-336","163","        }","191","        final Set<LoggerConfig> alreadyStopped = new HashSet<LoggerConfig>();"],"delete":["159","        root.start(); \/\/ LOG4J2-336","187","        Set<LoggerConfig> alreadyStopped = new HashSet<LoggerConfig>();"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigAutoFlushTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompactFileAppenderTest.java":[{"add":[],"delete":["27","import org.junit.Ignore;","43","    @Ignore \/\/ stopgap solution for broken build in revision 1602598 (LOG4J2-392)"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompleteFileAppenderTest.java":[{"add":[],"delete":["27","import org.junit.Ignore;","43","    @Ignore \/\/ stopgap solution for broken build in revision 1602598 (LOG4J2-392)"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlFileAppenderTest.java":[{"add":[],"delete":["27","import org.junit.Ignore;","43","    @Ignore \/\/ stopgap solution for broken build in revision 1602598 (LOG4J2-392)"]}]}},"e2a6a6dd18fcd9d320fad369bd3a5214d20d6e69":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsAppender.java":[{"add":["87","        @PluginBuilderAttribute"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["111","      <action issue=\"LOG4J2-2497\" dev=\"ggregory\" type=\"fix\">","112","        JmsAppender reconnectIntervalMillis cannot be set from a configuration file.","113","      <\/action>"],"delete":[]}]}},"fc5401d40dcb8eddbabe67147f6b3e242478fc47":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderH2FactoryMethodTest.java":"MODIFY","log4j-jdbc-dbcp2\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/PoolingDriverConnectionSourceTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcH2TestHelper.java":"MODIFY","log4j-core\/src\/test\/resources\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/log4j2-dm-column-mapping-literal.xml":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/DriverManagerConnectionSourceTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderColumnMappingLiteralTest.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderH2DataSourceTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderMapMessageDataSourceTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderColumnMappingPatternTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcDatabaseManager.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderH2FactoryMethodTest.java":[{"add":["28","        super(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE_MEM,","36","        return JdbcH2TestHelper.getConnectionMem();"],"delete":["28","        super(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE,","36","        return JdbcH2TestHelper.getConnection();"]}],"log4j-jdbc-dbcp2\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/PoolingDriverConnectionSourceTest.java":[{"add":["38","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)","54","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)","65","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)","86","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)"],"delete":["38","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)","54","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)","65","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)","86","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcH2TestHelper.java":[{"add":["22","import org.apache.commons.lang3.SystemUtils;","23","","29","\tstatic final String CONNECTION_STRING_MEM = \"jdbc:h2:mem:Log4j\";","31","\t\/**","32","\t * A JDBC connection string for an H2 database in the Java temporary directory.","33","\t *\/","34","\tstatic final String CONNECTION_STRING_TMPDIR = \"jdbc:h2:\" + SystemUtils.JAVA_IO_TMPDIR","35","\t\t\t+ \"\/h2\/test_log4j;TRACE_LEVEL_SYSTEM_OUT=0\";","36","","37","\tstatic final String USER_NAME = \"sa\";","38","\tstatic final String PASSWORD = \"\";","39","","40","\tpublic static ConnectionSource TEST_CONFIGURATION_SOURCE_MEM = new AbstractConnectionSource() {","41","\t\t@Override","42","\t\tpublic Connection getConnection() throws SQLException {","43","\t\t\treturn JdbcH2TestHelper.getConnectionMem();","44","\t\t}","45","\t};","46","","47","\tpublic static ConnectionSource TEST_CONFIGURATION_SOURCE_TMPDIR = new AbstractConnectionSource() {","48","\t\t@Override","49","\t\tpublic Connection getConnection() throws SQLException {","50","\t\t\treturn JdbcH2TestHelper.getConnectionTmpDir();","51","\t\t}","52","\t};","53","","54","\tpublic static Connection getConnectionMem() throws SQLException {","55","\t\treturn DriverManager.getConnection(CONNECTION_STRING_MEM, USER_NAME, PASSWORD);","56","\t}","57","","58","\tpublic static Connection getConnectionTmpDir() throws SQLException {","59","\t\treturn DriverManager.getConnection(CONNECTION_STRING_TMPDIR, USER_NAME, PASSWORD);","60","\t}"],"delete":["27","    static final String CONNECTION_STRING = \"jdbc:h2:mem:Log4j\";","28","    static final String USER_NAME = \"sa\";","29","    static final String PASSWORD = \"\";","30","    ","31","    public static ConnectionSource TEST_CONFIGURATION_SOURCE = new AbstractConnectionSource() {","32","        @Override","33","        public Connection getConnection() throws SQLException {","34","            return JdbcH2TestHelper.getConnection();","35","        }","36","    };","38","    public static Connection getConnection() throws SQLException {","39","        return DriverManager.getConnection(CONNECTION_STRING, USER_NAME, PASSWORD);","40","    }"]}],"log4j-core\/src\/test\/resources\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/log4j2-dm-column-mapping-literal.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/DriverManagerConnectionSourceTest.java":[{"add":["38","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)","51","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING_MEM)"],"delete":["38","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)","51","            .setConnectionString(JdbcH2TestHelper.CONNECTION_STRING)"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderColumnMappingLiteralTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderH2DataSourceTest.java":[{"add":["25","        super(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE_MEM,"],"delete":["25","        super(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE,"]}],"src\/changes\/changes.xml":[{"add":["81","      <action issue=\"LOG4J2-2413\" dev=\"ggregory\" type=\"fix\" due-to=\"Andres Luuk, Gary Gregory\">","84","      <action issue=\"LOG4J2-2466\" dev=\"ggregory\" type=\"fix\" due-to=\"Paolo Bonanomi, Gary Gregory\">","85","        ColumnMapping literal not working.","86","      <\/action>"],"delete":["81","      <action issue=\"LOG4J2-2472\" dev=\"ggregory\" type=\"fix\">"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderMapMessageDataSourceTest.java":[{"add":["56","        this(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE_MEM,"],"delete":["56","        this(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE,"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcAppenderColumnMappingPatternTest.java":[{"add":["45","\t\tthis(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE_MEM,"],"delete":["45","\t\tthis(new JdbcRule(JdbcH2TestHelper.TEST_CONFIGURATION_SOURCE,"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/JdbcDatabaseManager.java":[{"add":["29","import java.util.Arrays;","84","\tprotected void startupInternal() throws Exception {","85","\t\tthis.connection = this.connectionSource.getConnection();","86","\t\ttry {","87","\t\t\tfinal DatabaseMetaData metaData = this.connection.getMetaData();","88","\t\t\tthis.isBatchSupported = metaData.supportsBatchUpdates();","89","\t\t} finally {","90","\t\t\tlogger().debug(\"Closing Connection {}\", this.connection);","91","\t\t\tCloser.closeSilently(this.connection);","92","\t\t}","93","\t}","222","                    int[] result = this.statement.executeBatch();","223","                    logger().debug(\"Batch result: {}\", Arrays.toString(result));","377","                } else if (Strings.isNotEmpty(mapping.getParameter())) {"],"delete":["83","    protected void startupInternal() throws Exception {","84","        this.connection = this.connectionSource.getConnection();","85","        final DatabaseMetaData metaData = this.connection.getMetaData();","86","        this.isBatchSupported = metaData.supportsBatchUpdates();","87","        logger().debug(\"Closing Connection {}\", this.connection);","88","        Closer.closeSilently(this.connection);","89","    }","218","                    this.statement.executeBatch();","372","                }","373","                if (Strings.isNotEmpty(mapping.getParameter())) {"]}]}},"b38e8c6a7282100abf4b59c0c8248b2b67c42506":{"changes":{"api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessageTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessageTest.java":[{"add":["35","        final LocalizedMessage msg = new LocalizedMessage(\"MF\", new Locale(\"en\", \"US\"), \"msg1\", new Object[] {\"1\", \"Test\"});","44","        final LocalizedMessage msg = new LocalizedMessage(\"SF\", new Locale(\"en\", \"US\"), \"msg1\", new Object[] {\"1\", \"Test\"});"],"delete":["35","        final LocalizedMessage msg = new LocalizedMessage(\"MF\", new Locale(\"en_US\"), \"msg1\", new Object[] {\"1\", \"Test\"});","44","        final LocalizedMessage msg = new LocalizedMessage(\"SF\", new Locale(\"en_US\"), \"msg1\", new Object[] {\"1\", \"Test\"});"]}],"src\/changes\/changes.xml":[{"add":["24","    <release version=\"2.0-beta4\" date=\"2012-01-??\" description=\"Bug fixes and enhancements\">","25","      <action issue=\"LOG4J2-156\" dev=\"ggregory\" type=\"fix\" due-to=\"Andreas Born\">","26","        LocalizedMessageTest fails on linux system.","27","      <\/action>"],"delete":["24","    <release version=\"2.0-beta4\" date=\"2012-01-20\" description=\"Bug fixes and enhancements\">"]}]}},"c2987fcd347bd39835c043a1ebe57b809ba8e0e9":{"changes":{"src\/changes\/changes.xml":"MODIFY","flume-ng\/src\/test\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAppenderTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":"MODIFY","flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-115\" dev=\"rgoers\" type=\"fix\">","26","        ThreadContext Map elements with null values are now ignored when constructing a Flume event and in the","27","        RFC5424 Layout.","28","      <\/action>"],"delete":[]}],"flume-ng\/src\/test\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAppenderTest.java":[{"add":["32","import org.apache.logging.log4j.EventLogger;","35","import org.apache.logging.log4j.ThreadContext;","39","import org.apache.logging.log4j.message.StructuredDataMessage;","55","import java.util.UUID;","154","    @Test","155","    public void testStructured() throws InterruptedException, IOException {","156","        Agent[] agents = new Agent[] {Agent.createAgent(\"localhost\", testPort)};","157","        FlumeAppender avroAppender = FlumeAppender.createAppender(agents, null, \"false\", null, \"100\", \"3\", \"avro\",","158","            \"false\", null, null, null, null, null, \"true\", \"1\", null, null, null);","159","        avroAppender.start();","160","        Logger eventLogger = (Logger) LogManager.getLogger(\"EventLogger\");","161","        Assert.assertNotNull(eventLogger);","162","        eventLogger.addAppender(avroAppender);","163","        eventLogger.setLevel(Level.ALL);","164","","165","        StructuredDataMessage msg = new StructuredDataMessage(\"Transer\", \"Success\", \"Audit\");","166","        msg.put(\"memo\", \"This is a memo\");","167","        msg.put(\"acct\", \"12345\");","168","        msg.put(\"amount\", \"100.00\");","169","        ThreadContext.put(\"id\", UUID.randomUUID().toString());","170","        ThreadContext.put(\"memo\", null);","171","        ThreadContext.put(\"test\", \"123\");","172","","173","        EventLogger.logEvent(msg);","174","","175","        Transaction transaction = channel.getTransaction();","176","        transaction.begin();","177","","178","        Event event = channel.take();","179","        Assert.assertNotNull(event);","180","        Assert.assertTrue(\"Channel contained event, but not expected message\",","181","            getBody(event).endsWith(\"Success\"));","182","        transaction.commit();","183","        transaction.close();","184","","185","        eventSource.stop();","186","        eventLogger.removeAppender(avroAppender);","187","        avroAppender.stop();","188","    }","189","","190",""],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":[{"add":["372","            if (checker.check(entry.getKey()) && entry.getValue() != null) {"],"delete":["372","            if (checker.check(entry.getKey())) {"]}],"flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":[{"add":["145","            if (entry.getKey() != null && entry.getValue() != null) {","146","                fields.put(prefix + entry.getKey(), entry.getValue());","147","            }"],"delete":["145","            fields.put(prefix + entry.getKey(), entry.getValue());"]}]}},"aa7582b57a13a15e64f348913f60489b921eaeb2":{"changes":{"\/dev\/null":"DELETE","flume-ng\/pom.xml":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"flume-ng\/pom.xml":[{"add":["34","    <flumeVersion>1.2.0<\/flumeVersion>"],"delete":["34","    <flumeVersion>1.3.1<\/flumeVersion>"]}]}},"e4d9b0d65218291b0eaf60e980fe368892ab5aca":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2252\" dev=\"rpopma\" type=\"update\" due-to=\"Carter Kozak\">","34","        Reusable LogEvents now pass the original format string to downstream components like layouts and filters.","35","      <\/action>"],"delete":[]}]}},"b4f73bc8f801bec8e6e2fa5123def7a2ad75c6ad":{"changes":{"log4j-jul\/src\/main\/java\/org\/apache\/logging\/log4j\/jul\/CoreLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-jul\/src\/main\/java\/org\/apache\/logging\/log4j\/jul\/CoreLogger.java":[{"add":["46","        super.doSetLevel(level); \/\/ checks permissions"],"delete":["47","        super.doSetLevel(level);"]}],"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1110\" dev=\"ggregory\" type=\"fix\">","51","        org.apache.logging.log4j.jul.CoreLogger.setLevel() checks for security permission too late.","52","      <\/action>"],"delete":[]}]}},"f0ed39a2cff5246728838a61486541524486b976":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongo\/MongoDBConnection.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongo\/MongoDBProvider.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-358\" dev=\"nickwilliams\" type=\"fix\">","24","        NoSQLAppender using MongoDB provider ignores username and password attributes","25","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongo\/MongoDBConnection.java":[{"add":["19","import org.apache.logging.log4j.Logger;","23","import org.apache.logging.log4j.status.StatusLogger;","40","    private static final Logger LOGGER = StatusLogger.getLogger();","41","","97","","98","    \/**","99","     * To prevent class loading issues during plugin discovery, this code cannot live within MongoDBProvider. This","100","     * is because of how Java treats references to Exception classes different from references to other classes. When","101","     * Java loads a class, it normally won't load that class's dependent classes until and unless A) they are used, B)","102","     * the class being loaded extends or implements those classes, or C) those classes are the types of static members","103","     * in the class. However, exceptions that a class uses are always loaded when the class is loaded, even before","104","     * they are actually used.","105","     *","106","     * @param database The database to authenticate","107","     * @param username The username to authenticate with","108","     * @param password The password to authenticate with","109","     *\/","110","    static void authenticate(final DB database, final String username, final String password) {","111","        try {","112","            if (!database.authenticate(username, password.toCharArray())) {","113","                LOGGER.error(\"Failed to authenticate against MongoDB server. Unknown error.\");","114","            }","115","        } catch (final MongoException e) {","116","            LOGGER.error(\"Failed to authenticate against MongoDB: \" + e.getMessage(), e);","117","        } catch (final IllegalStateException e) {","118","            LOGGER.error(\"Factory-supplied MongoDB database connection already authenticated with different\" +","119","                    \"credentials but lost connection.\");","120","        }","121","    }"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongo\/MongoDBProvider.java":[{"add":["182","                MongoDBConnection.authenticate(database, username, password);"],"delete":[]}]}},"fb6f73d48b85c8248ad7576468f77bbbb7acf670":{"changes":{"log4j-core-its\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/net\/SecureSocketAppenderConnectReConnectIT.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketOptions.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":"MODIFY"},"diff":{"log4j-core-its\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/net\/SecureSocketAppenderConnectReConnectIT.java":[{"add":["23","import org.apache.logging.log4j.core.net.SocketOptions;","69","    \/\/@Ignore","73","        server = SecureTcpSocketServer.createJsonServer(port, sslConfiguration);","79","                .withConnectTimeoutMillis(1000)","80","                .withSocketOptions(SocketOptions.newBuilder().setSoTimeout(1000))"],"delete":["68","    @Ignore","72","        server = TcpSocketServer.createJsonSocketServer(port);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketOptions.java":[{"add":["169","    public SocketOptions setKeepAlive(final boolean keepAlive) {","171","        return this;","174","    public SocketOptions setOobInline(final boolean oobInline) {","176","        return this;","179","    public SocketOptions setPerformancePreferences(final SocketPerformancePreferences performancePreferences) {","181","        return this;","184","    public SocketOptions setReceiveBufferSize(final int receiveBufferSize) {","186","        return this;","189","    public SocketOptions setReuseAddress(final boolean reuseAddress) {","191","        return this;","194","    public SocketOptions setRfc1349TrafficClass(final Rfc1349TrafficClass trafficClass) {","196","        return this;","199","    public SocketOptions setSendBufferSize(final int sendBufferSize) {","201","        return this;","204","    public SocketOptions setSoLinger(final int soLinger) {","206","        return this;","209","    public SocketOptions setSoTimeout(final int soTimeout) {","211","        return this;","214","    public SocketOptions setTcpNoDelay(final boolean tcpNoDelay) {","216","        return this;","219","    public SocketOptions setTrafficClass(final int trafficClass) {","221","        return this;"],"delete":["169","    public void setKeepAlive(final boolean keepAlive) {","173","    public void setOobInline(final boolean oobInline) {","177","    public void setPerformancePreferences(final SocketPerformancePreferences performancePreferences) {","181","    public void setReceiveBufferSize(final int receiveBufferSize) {","185","    public void setReuseAddress(final boolean reuseAddress) {","189","    public void setRfc1349TrafficClass(final Rfc1349TrafficClass trafficClass) {","193","    public void setSendBufferSize(final int sendBufferSize) {","197","    public void setSoLinger(final int soLinger) {","201","    public void setSoTimeout(final int soTimeout) {","205","    public void setTcpNoDelay(final boolean tcpNoDelay) {","209","    public void setTrafficClass(final int trafficClass) {"]}],"src\/changes\/changes.xml":[{"add":["39","      <action issue=\"LOG4J2-2013\" dev=\"ggregory\" type=\"fix\" due-to=\"Taylor Patton, Gary Gregory\">","40","        SslSocketManager does not apply SSLContext on TCP reconnect.","41","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":[{"add":["35","import org.apache.logging.log4j.core.net.TcpSocketManager.FactoryData;","36","import org.apache.logging.log4j.core.net.TcpSocketManager.TcpSocketManagerFactory;","55","    private static final TcpSocketManagerFactory<TcpSocketManager, FactoryData> FACTORY = new TcpSocketManagerFactory<>();","345","            final Socket sock = createSocket(inetAddress.getHostName(), port);","371","    protected Socket createSocket(final String host, final int port) throws IOException {","372","        return createSocket(host, port, socketOptions, connectTimeoutMillis);","375","    protected static Socket createSocket(final String host, final int port, final SocketOptions socketOptions,","376","            final int connectTimeoutMillis) throws IOException {","377","        LOGGER.debug(\"Creating socket {}:{}\", host, port);","379","        if (socketOptions != null) {","380","            \/\/ Not sure which options must be applied before or after the connect() call.","381","            socketOptions.apply(newSocket);","382","        }","385","            \/\/ Not sure which options must be applied before or after the connect() call.","427","     * ","428","     * @param <M>","429","     *            The manager type.","430","     * @param <T>","431","     *            The factory data type.","433","    protected static class TcpSocketManagerFactory<M extends TcpSocketManager, T extends FactoryData>","434","            implements ManagerFactory<M, T> {","438","        public M createManager(final String name, final T data) {","452","                return createManager(name, os, socket, inetAddress, data);","461","            return createManager(name, os, null, inetAddress, data);","464","        @SuppressWarnings(\"unchecked\")","465","        M createManager(final String name, OutputStream os, Socket socket, InetAddress inetAddress, final T data) {","466","            return (M) new TcpSocketManager(name, os, socket, inetAddress, data.host, data.port,","467","                    data.connectTimeoutMillis, data.reconnectDelayMillis, data.immediateFail, data.layout,","468","                    data.bufferSize, data.socketOptions);","469","        }","470","","471","        Socket createSocket(final T data) throws IOException {","472","            return TcpSocketManager.createSocket(data.host, data.port, data.socketOptions, data.connectTimeoutMillis);","495","    @Override","496","    public String toString() {","497","        return \"TcpSocketManager [reconnectionDelayMillis=\" + reconnectionDelayMillis + \", reconnector=\" + reconnector","498","                + \", socket=\" + socket + \", socketOptions=\" + socketOptions + \", retry=\" + retry + \", immediateFail=\"","499","                + immediateFail + \", connectTimeoutMillis=\" + connectTimeoutMillis + \", inetAddress=\" + inetAddress","500","                + \", host=\" + host + \", port=\" + port + \", layout=\" + layout + \", byteBuffer=\" + byteBuffer + \", count=\"","501","                + count + \"]\";","502","    }","503",""],"delete":["53","    private static final TcpSocketManagerFactory FACTORY = new TcpSocketManagerFactory();","343","            final Socket sock = createSocket(inetAddress, port);","369","    protected Socket createSocket(final InetAddress host, final int port) throws IOException {","370","        return createSocket(host.getHostName(), port);","373","    protected Socket createSocket(final String host, final int port) throws IOException {","419","    protected static class TcpSocketManagerFactory implements ManagerFactory<TcpSocketManager, FactoryData> {","423","        public TcpSocketManager createManager(final String name, final FactoryData data) {","424","","438","                return new TcpSocketManager(name, os, socket, inetAddress, data.host, data.port,","439","                        data.connectTimeoutMillis, data.reconnectDelayMillis, data.immediateFail, data.layout,","440","                        data.bufferSize, data.socketOptions);","449","            return new TcpSocketManager(name, os, null, inetAddress, data.host, data.port, data.connectTimeoutMillis,","450","                    data.reconnectDelayMillis, data.immediateFail, data.layout, data.bufferSize, data.socketOptions);","453","        static Socket createSocket(final FactoryData data) throws IOException, SocketException {","454","            final Socket socket = new Socket();","455","            socket.connect(new InetSocketAddress(data.host, data.port), data.connectTimeoutMillis);","456","            final SocketOptions socketOptions = data.socketOptions;","457","            if (socketOptions != null) {","458","                socketOptions.apply(socket);","459","            }","460","            return socket;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":[{"add":["92","                final int connectTimeoutMillis, final int reconnectDelayMillis, final boolean immediateFail,","93","                final Layout<? extends Serializable> layout, final int bufferSize, final SocketOptions socketOptions) {","98","","99","        @Override","100","        public String toString() {","101","            return \"SslFactoryData [sslConfiguration=\" + sslConfiguration + \", host=\" + host + \", port=\" + port","102","                    + \", connectTimeoutMillis=\" + connectTimeoutMillis + \", reconnectDelayMillis=\"","103","                    + reconnectDelayMillis + \", immediateFail=\" + immediateFail + \", layout=\" + layout + \", bufferSize=\"","104","                    + bufferSize + \", socketOptions=\" + socketOptions + \"]\";","105","        }","130","        final String name = \"TLS:\" + host + ':' + port;","131","        return (SslSocketManager) getManager(name, new SslFactoryData(sslConfig, host, port, connectTimeoutMillis,","132","                reconnectDelayMillis, immediateFail, layout, bufferSize, socketOptions), FACTORY);","157","    private static class SslSocketManagerFactory extends TcpSocketManagerFactory<SslSocketManager, SslFactoryData> {","160","        SslSocketManager createManager(final String name, OutputStream os, Socket socket, InetAddress inetAddress,","161","                final SslFactoryData data) {","166","        ","167","        @Override","168","        Socket createSocket(final SslFactoryData data) throws IOException {","169","            return SslSocketManager.createSocket(data.host, data.port, data.connectTimeoutMillis, data.sslConfiguration,","170","                    data.socketOptions);","172","    }","174","    static Socket createSocket(final String host, int port, int connectTimeoutMillis,","175","            final SslConfiguration sslConfiguration, SocketOptions socketOptions) throws IOException {","176","        final SSLSocketFactory socketFactory = createSslSocketFactory(sslConfiguration);","177","        final SSLSocket socket = (SSLSocket) socketFactory.createSocket();","178","        if (socketOptions != null) {","179","            \/\/ Not sure which options must be applied before or after the connect() call.","180","            socketOptions.apply(socket);","182","        socket.connect(new InetSocketAddress(host, port), connectTimeoutMillis);","183","        if (socketOptions != null) {","184","            \/\/ Not sure which options must be applied before or after the connect() call.","185","            socketOptions.apply(socket);","187","        return socket;"],"delete":["18","import java.io.ByteArrayOutputStream;","25","import java.net.UnknownHostException;","30","import org.apache.logging.log4j.Level;","32","import org.apache.logging.log4j.core.appender.ManagerFactory;","34","import org.apache.logging.log4j.core.util.Closer;","97","                final int connectTimeoutMillis, final int reconnectDelayMillis, final int delayMillis,","98","                final boolean immediateFail, final Layout<? extends Serializable> layout, final int bufferSize,","99","                final SocketOptions socketOptions) {","128","        return (SslSocketManager) getManager(\"TLS:\" + host + ':' + port, new SslFactoryData(sslConfig, host, port,","129","                connectTimeoutMillis, 0, reconnectDelayMillis, immediateFail, layout, bufferSize, socketOptions), FACTORY);","154","    private static class SslSocketManagerFactory implements ManagerFactory<SslSocketManager, SslFactoryData> {","156","        private static class TlsSocketManagerFactoryException extends Exception {","157","","158","            private static final long serialVersionUID = 1L;","159","        }","160","","161","        @SuppressWarnings(\"resource\")","163","        public SslSocketManager createManager(final String name, final SslFactoryData data) {","164","            InetAddress inetAddress = null;","165","            OutputStream os = null;","166","            Socket socket = null;","167","            try {","168","                inetAddress = resolveAddress(data.host);","169","                socket = createSocket(data);","170","                os = socket.getOutputStream();","171","                checkDelay(data.reconnectDelayMillis, os);","172","            } catch (final IOException e) {","173","                LOGGER.error(\"SslSocketManager ({})\", name, e);","174","                os = new ByteArrayOutputStream();","175","            } catch (final TlsSocketManagerFactoryException e) {","176","                LOGGER.catching(Level.DEBUG, e);","177","                Closer.closeSilently(socket);","178","                return null;","179","            }","184","","185","        private InetAddress resolveAddress(final String hostName) throws TlsSocketManagerFactoryException {","186","            InetAddress address;","187","","188","            try {","189","                address = InetAddress.getByName(hostName);","190","            } catch (final UnknownHostException ex) {","191","                LOGGER.error(\"Could not find address of {}\", hostName, ex);","192","                throw new TlsSocketManagerFactoryException();","193","            }","194","","195","            return address;","198","        private void checkDelay(final int delay, final OutputStream os) throws TlsSocketManagerFactoryException {","199","            if (delay == 0 && os == null) {","200","                throw new TlsSocketManagerFactoryException();","201","            }","203","","204","        private Socket createSocket(final SslFactoryData data) throws IOException {","205","            SSLSocketFactory socketFactory;","206","            SSLSocket socket;","207","","208","            socketFactory = createSslSocketFactory(data.sslConfiguration);","209","            socket = (SSLSocket) socketFactory.createSocket();","210","            final SocketOptions socketOptions = data.socketOptions;","211","            if (socketOptions != null) {","212","                \/\/ Not sure which options must be applied before or after the connect() call.","213","                socketOptions.apply(socket);","214","            }","215","            socket.connect(new InetSocketAddress(data.host, data.port), data.connectTimeoutMillis);","216","            if (socketOptions != null) {","217","                \/\/ Not sure which options must be applied before or after the connect() call.","218","                socketOptions.apply(socket);","219","            }","220","            return socket;"]}]}},"ab0c23b88782c88c246462becb0821bd679a09a4":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSQueueAppender.java":"MODIFY","core\/src\/test\/resources\/log4j-jmsqueue.xml":"ADD","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueAppenderTest.java":"ADD","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSTopicAppender.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicTest.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSQueueAppender.java":[{"add":["57","     * @param name The name of the Appender.","75","    public static JMSQueueAppender createAppender(@PluginAttr(\"name\") String name,","76","                                                  @PluginAttr(\"factoryName\") String factoryName,","88","        if (name == null) {","89","            LOGGER.error(\"No name provided for JMSQueueAppender\");","90","            return null;","91","        }"],"delete":["74","    public static JMSQueueAppender createAppender(@PluginAttr(\"factoryName\") String factoryName,","86","","87","        String name = \"JMSQueue\" + factoryBindingName + '.' + queueBindingName;"]}],"core\/src\/test\/resources\/log4j-jmsqueue.xml":[{"add":[],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueAppenderTest.java":[{"add":[],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/JMSTopicAppender.java":[{"add":["57","     * @param name The name of the Appender.","75","    public static JMSTopicAppender createAppender(@PluginAttr(\"name\") String name,","76","                                                  @PluginAttr(\"factoryName\") String factoryName,","89","        if (name == null) {","90","            LOGGER.error(\"No name provided for JMSQueueAppender\");","91","            return null;","92","        }"],"delete":["74","    public static JMSTopicAppender createAppender(@PluginAttr(\"factoryName\") String factoryName,","87","        String name = \"JMSTopic\" + factoryBindingName + '.' + topicBindingName;"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicTest.java":[{"add":["98","        JMSTopicAppender appender = JMSTopicAppender.createAppender(\"Test\", null, null, null, null, null, FACTORY_NAME,"],"delete":["98","        JMSTopicAppender appender = JMSTopicAppender.createAppender(null, null, null, null, null, FACTORY_NAME,"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueTest.java":[{"add":["98","        JMSQueueAppender appender = JMSQueueAppender.createAppender(\"Test\", null, null, null, null, null, FACTORY_NAME,"],"delete":["98","        JMSQueueAppender appender = JMSQueueAppender.createAppender(null, null, null, null, null, FACTORY_NAME,"]}]}},"92d19c8da6591a706a2df9875c7e41f6fb20bd66":{"changes":{"pom.xml":"MODIFY"},"diff":{"pom.xml":[{"add":["219","    <revapi.plugin.version>0.11.1<\/revapi.plugin.version>","1628","  },","1629","  {","1630","    \"extension\": \"revapi.ignore\",","1631","    \"configuration\": [","1632","      {","1633","  \t\t\"code\": \"java.method.returnTypeTypeParametersChanged\",","1634","  \t\t\"old\": \"method org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1635","  \t\t\"new\": \"method <B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B>>> B org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1636","  \t\t\"justification\": \"The compiler erases types (https:\/\/docs.oracle.com\/javase\/specs\/jls\/se8\/html\/jls-4.html#jls-4.6)\"","1637","\t  },","1638","      {","1639","        \"code\": \"java.generics.elementNowParameterized\",","1640","        \"old\": \"method org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1641","        \"new\": \"method <B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B>>> B org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1642","        \"justification\": \"The compiler erases types (https:\/\/docs.oracle.com\/javase\/specs\/jls\/se8\/html\/jls-4.html#jls-4.6)\"","1643","      },","1644","      {","1645","        \"code\": \"java.generics.formalTypeParameterAdded\",","1646","        \"old\": \"method org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1647","        \"new\": \"method <B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B>>> B org.apache.logging.log4j.core.appender.OutputStreamAppender::newBuilder()\",","1648","        \"typeParameter\": \"B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B extends org.apache.logging.log4j.core.appender.OutputStreamAppender.Builder<B>>\",","1649","        \"justification\": \"The compiler erases types (https:\/\/docs.oracle.com\/javase\/specs\/jls\/se8\/html\/jls-4.html#jls-4.6)\"  ","1650","      }","1651","    ]"],"delete":["219","    <revapi.plugin.version>0.10.5<\/revapi.plugin.version>"]}]}},"17a77f5c27bda545de4b8eda46590401313e0be8":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/DefaultLookupResult.java":"ADD","log4j-core\/src\/test\/resources\/log4j-routing-purge.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/PropertiesLookup.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-routing3350.xml":"ADD","log4j-core\/revapi.json":"MODIFY","log4j-core\/src\/test\/resources\/log4j-routing2.json":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrLookup.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/PluginValue.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Property.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/AbstractLookup.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-routing.json":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/PropertiesPlugin.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/LookupResult.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/PropertiesLookupTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/ConfigurationStrSubstitutor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/RuntimeStrSubstitutor.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutorTest.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-routing.xml":"MODIFY","log4j-core\/src\/test\/resources\/log4j-routing.properties":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/PropertiesPluginTest.java":"ADD","log4j-core\/src\/test\/resources\/log4j-routing-2767.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/HttpURLConnectionManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutor.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginValueVisitor.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender3350Test.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/DefaultLookupResult.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-routing-purge.xml":[{"add":["19","  <Properties>","20","    <Property name=\"filename-idle\">target\/routing-purge-idle\/routingtest-$${sd:id}.log<\/Property>","21","    <Property name=\"filename-manual\">target\/routing-purge-manual\/routingtest-$${sd:id}.log<\/Property>","22","  <\/Properties>","36","          <File name=\"Routing-${sd:id}\" fileName=\"${filename-idle}\">","60","          <File name=\"Routing-${sd:id}\" fileName=\"${filename-manual}\">"],"delete":["32","          <File name=\"Routing-${sd:id}\" fileName=\"target\/routing-purge-idle\/routingtest-${sd:id}.log\">","56","          <File name=\"Routing-${sd:id}\" fileName=\"target\/routing-purge-manual\/routingtest-${sd:id}.log\">"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["156","        LookupResult result = evaluate(event, var);","157","        return result == null ? null : result.value();","158","    }","159","","160","    \/**","161","     * Resolves the specified variable. This implementation will try to extract","162","     * a variable prefix from the given variable name (the first colon (':') is","163","     * used as prefix separator). It then passes the name of the variable with","164","     * the prefix stripped to the lookup object registered for this prefix. If","165","     * no prefix can be found or if the associated lookup object cannot resolve","166","     * this variable, the default lookup object will be used.","167","     *","168","     * @param event The current LogEvent or null.","169","     * @param var the name of the variable whose value is to be looked up","170","     * @return the value of this variable or <b>null<\/b> if it cannot be","171","     * resolved","172","     *\/","173","    @Override","174","    public LookupResult evaluate(final LogEvent event, String var) {","187","            LookupResult value = null;","189","                value = event == null ? lookup.evaluate(name) : lookup.evaluate(event, name);","198","            return event == null ? defaultLookup.evaluate(var) : defaultLookup.evaluate(event, var);"],"delete":["168","            String value = null;","170","                value = event == null ? lookup.lookup(name) : lookup.lookup(event, name);","179","            return event == null ? defaultLookup.lookup(var) : defaultLookup.lookup(event, var);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/PropertiesLookup.java":[{"add":["19","import org.apache.logging.log4j.core.config.Property;","22","import java.util.HashMap;","24","import java.util.Objects;","34","    \/** Logger context properties. *\/","35","    private final Map<String, String> contextProperties;","36","","37","    \/** Configuration properties. *\/","38","    private final Map<String, ConfigurationPropertyResult> configurationProperties;","39","","40","    public PropertiesLookup(final Property[] configProperties, final Map<String, String> contextProperties) {","41","        this.contextProperties = contextProperties == null","42","                ? Collections.emptyMap()","43","                : contextProperties;","44","        this.configurationProperties = configProperties == null","45","                ? Collections.emptyMap()","46","                : createConfigurationPropertyMap(configProperties);","47","    }","55","        this(Property.EMPTY_ARRAY, properties);","74","        LookupResult result = evaluate(key);","75","        return result == null ? null : result.value();","76","    }","77","","78","    @Override","79","    public LookupResult evaluate(String key) {","80","        if (key == null) {","81","            return null;","82","        }","83","        LookupResult configResult = configurationProperties.get(key);","84","        if (configResult != null) {","85","            return configResult;","86","        }","87","        \/\/ Allow the context map to be mutated after this lookup has been initialized.","88","        String contextResult = contextProperties.get(key);","89","        return contextResult == null ? null : new ContextPropertyResult(contextResult);","90","    }","91","","92","    @Override","93","    public LookupResult evaluate(@SuppressWarnings(\"ignored\") final LogEvent event, final String key) {","94","        return evaluate(key);","99","        return \"PropertiesLookup{\" +","100","                \"contextProperties=\" + contextProperties +","101","                \", configurationProperties=\" + configurationProperties +","102","                '}';","105","    private static Map<String, ConfigurationPropertyResult> createConfigurationPropertyMap(Property[] props) {","106","        \/\/ The raw property values must be used without the substitution handled by the plugin framework","107","        \/\/ which calls this method, otherwise we risk re-interpolating through unexpected data.","108","        \/\/ The PropertiesLookup is unique in that results from this lookup support recursive evaluation.","109","        Map<String, ConfigurationPropertyResult> result = new HashMap<>(props.length);","110","        for (Property property : props) {","111","            result.put(property.getName(), new ConfigurationPropertyResult(property.getRawValue()));","112","        }","113","        return result;","114","    }","115","","116","    private static final class ConfigurationPropertyResult implements LookupResult {","117","","118","        private final String value;","119","","120","        ConfigurationPropertyResult(String value) {","121","            this.value = Objects.requireNonNull(value, \"value is required\");","122","        }","123","","124","        @Override","125","        public String value() {","126","            return value;","127","        }","128","","129","        \/**","130","         * Properties are a special case in which lookups contained","131","         * within the properties map are allowed for recursive evaluation.","132","         *\/","133","        @Override","134","        public boolean isLookupEvaluationAllowedInValue() {","135","            return true;","136","        }","137","","138","        @Override","139","        public String toString() {","140","            return \"ConfigurationPropertyResult{'\" + value + \"'}\";","141","        }","142","    }","143","","144","    private static final class ContextPropertyResult implements LookupResult {","145","","146","        private final String value;","147","","148","        ContextPropertyResult(String value) {","149","            this.value = Objects.requireNonNull(value, \"value is required\");","150","        }","151","","152","        @Override","153","        public String value() {","154","            return value;","155","        }","156","","157","        \/**","158","         * Unlike configuration properties, context properties are not built around lookup syntax.","159","         *\/","160","        @Override","161","        public boolean isLookupEvaluationAllowedInValue() {","162","            return false;","163","        }","164","","165","        @Override","166","        public String toString() {","167","            return \"ContextPropertyResult{'\" + value + \"'}\";","168","        }","169","    }"],"delete":["31","    \/**","32","     * Configuration from which to read properties.","33","     *\/","34","    private final Map<String, String> properties;","42","        this.properties = properties == null","43","                ? Collections.emptyMap()","44","                : properties;","45","    }","46","","47","    \/**","48","     * Gets the property map.","49","     *","50","     * @return the property map.","51","     *\/","52","    public Map<String, String> getProperties() {","53","        return properties;","72","        return key == null ? null : properties.get(key);","77","        return \"PropertiesLookup{properties=\" + properties + '}';"]}],"log4j-core\/src\/test\/resources\/log4j-routing3350.xml":[{"add":[],"delete":[]}],"log4j-core\/revapi.json":[{"add":["51","      },","52","      {","53","        \"code\": \"java.method.returnTypeChanged\",","54","        \"old\": \"method java.lang.String org.apache.logging.log4j.core.lookup.StrSubstitutor::resolveVariable(org.apache.logging.log4j.core.LogEvent, java.lang.String, java.lang.StringBuilder, int, int)\",","55","        \"new\": \"method org.apache.logging.log4j.core.lookup.LookupResult org.apache.logging.log4j.core.lookup.StrSubstitutor::resolveVariable(org.apache.logging.log4j.core.LogEvent, java.lang.String, java.lang.StringBuilder, int, int)\",","56","        \"justification\": \"LOG4J2-3317: Fix RoutingAppender backcompat while improving lookup security\"","57","      },","58","      {","59","        \"code\": \"java.annotation.removed\",","60","        \"old\": \"parameter org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(===java.lang.String===, java.lang.String)\",","61","        \"new\": \"parameter org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(===java.lang.String===, java.lang.String)\",","62","        \"annotation\": \"@org.apache.logging.log4j.core.config.plugins.PluginAttribute(\\\"name\\\")\",","63","        \"justification\": \"LOG4J2-3317: Fix RoutingAppender backcompat while improving lookup security\"","64","      },","65","      {","66","        \"code\": \"java.annotation.removed\",","67","        \"old\": \"parameter org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(java.lang.String, ===java.lang.String===)\",","68","        \"new\": \"parameter org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(java.lang.String, ===java.lang.String===)\",","69","        \"annotation\": \"@org.apache.logging.log4j.core.config.plugins.PluginValue(\\\"value\\\")\",","70","        \"justification\": \"LOG4J2-3317: Fix RoutingAppender backcompat while improving lookup security\"","71","      },","72","      {","73","        \"code\": \"java.annotation.removed\",","74","        \"old\": \"method org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(java.lang.String, java.lang.String)\",","75","        \"new\": \"method org.apache.logging.log4j.core.config.Property org.apache.logging.log4j.core.config.Property::createProperty(java.lang.String, java.lang.String)\",","76","        \"annotation\": \"@org.apache.logging.log4j.core.config.plugins.PluginFactory\",","77","        \"justification\": \"LOG4J2-3317: Fix RoutingAppender backcompat while improving lookup security\""],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-routing2.json":[{"add":["17","    \"properties\": {","18","      \"property\": { \"name\": \"filename\", \"value\" : \"target\/rolling1\/rollingtest-$${sd:type}.log\" }","19","    },","30","                  \"name\": \"Rolling-${sd:type}\", \"fileName\": \"${filename}\","],"delete":["27","                  \"name\": \"Rolling-${sd:type}\", \"fileName\": \"target\/rolling1\/rollingtest-${sd:type}.log\","]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrLookup.java":[{"add":["101","","102","    \/**","103","     * Same as {@link #lookup(String)}, but provides additional metadata describing the result.","104","     * Returns null if the key cannot be evaluated, otherwise a {@link LookupResult} wrapping the non-null string value.","105","     *\/","106","    default LookupResult evaluate(String key) {","107","        String value = lookup(key);","108","        return value == null","109","                ? null","110","                : new DefaultLookupResult(value);","111","    }","112","","113","    \/**","114","     * Same as {@link #lookup(LogEvent, String)}, but provides additional metadata describing the result.","115","     * Returns null if the key cannot be evaluated, otherwise a {@link LookupResult} wrapping the non-null string value.","116","     *\/","117","    default LookupResult evaluate(LogEvent event, String key) {","118","        String value = lookup(event, key);","119","        return value == null","120","                ? null","121","                : new DefaultLookupResult(value);","122","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/PluginValue.java":[{"add":["39","","40","    \/** If false, standard configuration value substitution is not done on the referenced value. *\/","41","    boolean substitute() default true;"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Property.java":[{"add":["25","import org.apache.logging.log4j.core.lookup.StrSubstitutor;","43","    private final String rawValue;","47","    private Property(final String name, final String rawValue, final String value) {","49","        this.rawValue = rawValue;","63","     * Returns the original raw property value without substitution.","64","     * @return the raw value of the property, or empty string if it is not set.","65","     *\/","66","    public String getRawValue() {","67","        return Objects.toString(rawValue, Strings.EMPTY);","68","    }","69","","70","    \/**","87","     * Evaluate this property with the provided substitutor. If {@link #isValueNeedsLookup()} is {@code false},","88","     * the {@link #getValue() value} is returned, otherwise the {@link #getRawValue() raw value} is evaluated","89","     * with the given substitutor.","90","     *\/","91","    public String evaluate(StrSubstitutor substitutor) {","92","        return valueNeedsLookup","93","                \/\/ Unescape the raw value first, handling '$${ctx:foo}' -> '${ctx:foo}'","94","                ? substitutor.replace(PropertiesPlugin.unescape(getRawValue()))","95","                : getValue();","96","    }","97","","98","    \/**","105","    public static Property createProperty(final String name, final String value) {","106","        if (name == null) {","107","            LOGGER.error(\"Property name cannot be null\");","108","        }","109","        return new Property(name, value, value);","110","    }","111","","112","    \/**","113","     * Creates a Property.","114","     *","115","     * @param name The key.","116","     * @param rawValue The value without any substitution applied.","117","     * @param value The value.","118","     * @return A Property.","119","     *\/","123","            @PluginValue(value = \"value\", substitute = false) final String rawValue,","128","        return new Property(name, rawValue, value);"],"delete":["45","    private Property(final String name, final String value) {","89","        return new Property(name, value);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/AbstractLookup.java":[{"add":["26","     * Calls {@code lookup(null, key)} in the implementation.","35","    \/**","36","     * Calls {@code evaluate(null, key)} in the implementation.","37","     *","38","     * @see StrLookup#evaluate(LogEvent, String)","39","     *\/","40","    @Override","41","    public LookupResult evaluate(final String key) {","42","        return evaluate(null, key);","43","    }","44",""],"delete":["26","     * Calls {@code lookup(null, key)} in the super class."]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":[{"add":["456","            final String value = prop.evaluate(config.getStrSubstitutor()); \/\/ since LOG4J2-1575","457","            results.add(Property.createProperty(prop.getName(), prop.getRawValue(), value));"],"delete":["456","            final String value = prop.isValueNeedsLookup() \/\/ since LOG4J2-1575","457","                    ? config.getStrSubstitutor().replace(event, prop.getValue()) \/\/","458","                    : prop.getValue();","459","            results.add(Property.createProperty(prop.getName(), value));"]}],"log4j-core\/src\/test\/resources\/log4j-routing.json":[{"add":["17","    \"properties\": {","18","      \"property\": { \"name\": \"filename\", \"value\" : \"target\/rolling1\/rollingtest-$${sd:type}.log\" }","19","    },","33","                \"name\": \"Rolling-${sd:type}\", \"fileName\": \"${filename}\","],"delete":["30","                \"name\": \"Rolling-${sd:type}\", \"fileName\": \"target\/rolling1\/rollingtest-${sd:type}.log\","]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/PropertiesPlugin.java":[{"add":["18","import org.apache.logging.log4j.core.LogEvent;","24","import org.apache.logging.log4j.core.lookup.LookupResult;","27","import org.apache.logging.log4j.core.lookup.StrSubstitutor;","35","    private static final StrSubstitutor UNESCAPING_SUBSTITUTOR = createUnescapingSubstitutor();","36","","49","        \/\/ For backwards compatibility, we unescape all escaped lookups when properties are parsed.","50","        \/\/ This matches previous behavior for escaped components which were meant to be executed later on.","51","        Property[] unescapedProperties = new Property[properties == null ? 0 : properties.length];","52","        for (int i = 0; i < unescapedProperties.length; i++) {","53","            unescapedProperties[i] = unescape(properties[i]);","55","        return new Interpolator(","56","                new PropertiesLookup(unescapedProperties, config.getProperties()),","57","                config.getPluginPackages());","58","    }","60","    private static Property unescape(Property input) {","61","        return Property.createProperty(","62","                input.getName(),","63","                unescape(input.getRawValue()),","64","                input.getValue());","65","    }","66","","67","    \/\/ Visible for testing","68","    static String unescape(String input) {","69","        return UNESCAPING_SUBSTITUTOR.replace(input);","70","    }","71","","72","    \/**","73","     * Creates a new {@link StrSubstitutor} which is configured with no lookups and does not handle","74","     * defaults. This allows it to unescape one level of escaped lookups without any further processing","75","     * or removing replacing {@code ${ctx:foo:-default}} with {@code default}.","76","     *\/","77","    private static StrSubstitutor createUnescapingSubstitutor() {","78","        StrSubstitutor substitutor = new StrSubstitutor(NullLookup.INSTANCE);","79","        substitutor.setValueDelimiter(null);","80","        substitutor.setValueDelimiterMatcher(null);","81","        return substitutor;","82","    }","83","","84","    private enum NullLookup implements StrLookup {","85","        INSTANCE;","86","","87","        @Override","88","        public String lookup(String key) {","89","            return null;","92","        @Override","93","        public String lookup(LogEvent event, String key) {","94","            return null;","95","        }","96","","97","        @Override","98","        public LookupResult evaluate(String key) {","99","            return null;","100","        }","101","","102","        @Override","103","        public LookupResult evaluate(LogEvent event, String key) {","104","            return null;","105","        }"],"delete":["18","import java.util.HashMap;","19","import java.util.Map;","20","","47","        if (properties == null) {","48","            return new Interpolator(config.getProperties());","50","        final Map<String, String> map = new HashMap<>(config.getProperties());","52","        for (final Property prop : properties) {","53","            map.put(prop.getName(), prop.getValue());","56","        return new Interpolator(new PropertiesLookup(map), config.getPluginPackages());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/LookupResult.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/PropertiesLookupTest.java":[{"add":["19","import static org.junit.jupiter.api.Assertions.assertEquals;","20","import static org.junit.jupiter.api.Assertions.assertFalse;","21","import static org.junit.jupiter.api.Assertions.assertNull;","22","import static org.junit.jupiter.api.Assertions.assertTrue;","24","import java.util.Collections;","26","import java.util.Map;","28","import org.apache.logging.log4j.core.config.Property;","37","    public void testLookupContextProperty() {","38","        final StrLookup propertiesLookup = new PropertiesLookup(","39","                Property.EMPTY_ARRAY, Collections.singletonMap(\"A\", \"1\"));","40","        assertEquals(\"1\", propertiesLookup.lookup(\"A\"));","41","        final LookupResult lookupResult = propertiesLookup.evaluate(\"A\");","42","        assertEquals(\"1\", lookupResult.value());","43","        assertFalse(lookupResult.isLookupEvaluationAllowedInValue());","44","    }","45","","46","    @Test","47","    public void testLookupConfigProperty() {","48","        final StrLookup propertiesLookup = new PropertiesLookup(","49","                new Property[] {Property.createProperty(\"A\", \"1\")},","50","                Collections.emptyMap());","51","        assertEquals(\"1\", propertiesLookup.lookup(\"A\"));","52","        final LookupResult lookupResult = propertiesLookup.evaluate(\"A\");","53","        assertEquals(\"1\", lookupResult.value());","54","        assertTrue(lookupResult.isLookupEvaluationAllowedInValue());","55","    }","56","","57","    @Test","58","    public void testConfigPropertiesPreferredOverContextProperties() {","59","        final StrLookup propertiesLookup = new PropertiesLookup(","60","                new Property[] {Property.createProperty(\"A\", \"1\")},","61","                Collections.singletonMap(\"A\", \"2\"));","62","        assertEquals(\"1\", propertiesLookup.lookup(\"A\"));","63","        final LookupResult lookupResult = propertiesLookup.evaluate(\"A\");","64","        assertEquals(\"1\", lookupResult.value());","65","        assertTrue(lookupResult.isLookupEvaluationAllowedInValue());","66","    }","67","","68","    @Test","69","    public void testEvaluateResultsSupportRecursiveEvaluation() {","70","        PropertiesLookup lookup = new PropertiesLookup(Collections.singletonMap(\"key\", \"value\"));","71","        assertFalse(lookup.evaluate(\"key\").isLookupEvaluationAllowedInValue());","72","    }","73","","74","    @Test","75","    public void testEvaluateReturnsNullWhenKeyIsNotFound() {","76","        PropertiesLookup lookup = new PropertiesLookup(Collections.emptyMap());","77","        assertNull(lookup.evaluate(\"key\"));","78","    }","79","","80","    @Test","81","    public void testEvaluateReturnsNullWhenKeyIsNull() {","82","        PropertiesLookup lookup = new PropertiesLookup(Collections.emptyMap());","83","        assertNull(lookup.evaluate(null));","84","    }","85","","86","    @Test","87","    public void testContextPropertiesAreMutable() {","88","        Map<String, String> contextProperties = new HashMap<>();","89","        PropertiesLookup lookup = new PropertiesLookup(Property.EMPTY_ARRAY, contextProperties);","90","        assertNull(lookup.evaluate(\"key\"));","91","        contextProperties.put(\"key\", \"value\");","92","        LookupResult result = lookup.evaluate(\"key\");","93","        assertEquals(\"value\", result.value());","94","        assertFalse(result.isLookupEvaluationAllowedInValue());"],"delete":["19","import static org.junit.Assert.assertEquals;","31","    public void testGetProperties() {","32","        final HashMap<String, String> properties = new HashMap<>();","33","        properties.put(\"A\", \"1\");","34","        assertEquals(properties, new PropertiesLookup(properties).getProperties());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/ConfigurationStrSubstitutor.java":[{"add":[],"delete":["48","    boolean isRecursiveEvaluationAllowed() {","49","        return true;","50","    }","51","","52","    @Override","53","    void setRecursiveEvaluationAllowed(final boolean recursiveEvaluationAllowed) {","54","        throw new UnsupportedOperationException(","55","                \"recursiveEvaluationAllowed cannot be modified within ConfigurationStrSubstitutor\");","56","    }","57","","58","    @Override"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/RuntimeStrSubstitutor.java":[{"add":[],"delete":["46","    boolean isRecursiveEvaluationAllowed() {","47","        return false;","48","    }","49","","50","    @Override","51","    void setRecursiveEvaluationAllowed(final boolean recursiveEvaluationAllowed) {","52","        throw new UnsupportedOperationException(","53","                \"recursiveEvaluationAllowed cannot be modified within RuntimeStrSubstitutor\");","54","    }","55","","56","    @Override"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutorTest.java":[{"add":["118","                new RecursiveLookup(valuesMap),","146","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","158","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","166","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(new HashMap<>()));","169","        assertEquals(\"j}\", subst.replace(infiniteSubstitution));","174","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(new HashMap<>()));","177","        assertEquals(\"j}\", subst.replace(null, new StringBuilder(infiniteSubstitution)));","184","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","204","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","233","        final StrLookup lookup = new Interpolator(new RecursiveLookup(map));","243","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","252","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","261","        final StrLookup lookup = new Interpolator(new RecursiveLookup(map));","271","        final StrLookup lookup = new Interpolator(new RecursiveLookup(map));","280","        final StrLookup lookup = new Interpolator(new RecursiveLookup(map));","289","        final StrLookup lookup = new Interpolator(new RecursiveLookup(map));","308","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","317","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","326","        final StrLookup lookup = new Interpolator(new NonRecursiveLookup(map));","330","","331","    @Test","332","    public void testNonRecursiveReferencesRecursive() {","333","        final StrLookup lookup = new StrLookup() {","334","            @Override","335","            public String lookup(final String key) {","336","                return \"unexpected\";","337","            }","338","","339","            @Override","340","            public String lookup(final LogEvent event, final String key) {","341","                return \"unexpected\";","342","            }","343","","344","            @Override","345","            public LookupResult evaluate(final String key) {","346","                return evaluate(null, key);","347","            }","348","","349","            @Override","350","            public LookupResult evaluate(final LogEvent event, final String key) {","351","                switch (key) {","352","                    case \"first\":","353","                        return new RecursiveLookupResult(\"${second}\");","354","                    case \"second\":","355","                        return new NonRecursiveLookupResult(\"${third}\");","356","                    default:","357","                        return new RecursiveLookupResult(\"should not be used: \" + key);","358","                }","359","            }","360","        };","361","        final StrSubstitutor subst = new StrSubstitutor(lookup);","362","        \/\/ First (recursive) expands to second, which is not recursive, so the literal '${third}' is used.","363","        assertEquals(\"${third}\", subst.replace(\"${first}\"));","364","    }","365","","366","    private static final class RecursiveLookup extends AbstractLookup {","367","","368","        private final Map<String, String> properties;","369","","370","        RecursiveLookup(Map<String, String> properties) {","371","            this.properties = properties;","372","        }","373","","374","        @Override","375","        public String lookup(LogEvent event, String key) {","376","            LookupResult result = evaluate(event, key);","377","            return result == null ? null : result.value();","378","        }","379","","380","        @Override","381","        public LookupResult evaluate(LogEvent event, String key) {","382","            String result = key == null ? null : properties.get(key);","383","            return result == null ? null : new RecursiveLookupResult(result);","384","        }","385","    }","386","","387","    private static final class RecursiveLookupResult implements LookupResult {","388","","389","        private final String value;","390","","391","        RecursiveLookupResult(String value) {","392","            this.value = value;","393","        }","394","        @Override","395","        public String value() {","396","            return value;","397","        }","398","","399","        @Override","400","        public boolean isLookupEvaluationAllowedInValue() {","401","            return true;","402","        }","403","    }","404","","405","    private static final class NonRecursiveLookup extends AbstractLookup {","406","","407","        private final Map<String, String> properties;","408","","409","        NonRecursiveLookup(Map<String, String> properties) {","410","            this.properties = properties;","411","        }","412","","413","        @Override","414","        public String lookup(LogEvent event, String key) {","415","            LookupResult result = evaluate(event, key);","416","            return result == null ? null : result.value();","417","        }","418","","419","        @Override","420","        public LookupResult evaluate(LogEvent event, String key) {","421","            String result = key == null ? null : properties.get(key);","422","            return result == null ? null : new NonRecursiveLookupResult(result);","423","        }","424","    }","425","","426","    private static final class NonRecursiveLookupResult implements LookupResult {","427","","428","        private final String value;","429","","430","        NonRecursiveLookupResult(String value) {","431","            this.value = value;","432","        }","433","        @Override","434","        public String value() {","435","            return value;","436","        }","437","","438","        @Override","439","        public boolean isLookupEvaluationAllowedInValue() {","440","            return false;","441","        }","442","    }"],"delete":["118","                new PropertiesLookup(valuesMap),","146","        final StrLookup lookup = new Interpolator(new MapLookup(map));","158","        final StrLookup lookup = new Interpolator(new MapLookup(map));","160","        subst.setRecursiveEvaluationAllowed(false);","167","        final StrLookup lookup = new Interpolator(new MapLookup(new HashMap<>()));","169","        subst.setRecursiveEvaluationAllowed(true);","171","        assertEquals(infiniteSubstitution, subst.replace(infiniteSubstitution));","176","        final StrLookup lookup = new Interpolator(new MapLookup(new HashMap<>()));","178","        subst.setRecursiveEvaluationAllowed(true);","180","        assertEquals(infiniteSubstitution, subst.replace(null, new StringBuilder(infiniteSubstitution)));","187","        final StrLookup lookup = new Interpolator(new MapLookup(map));","207","        final StrLookup lookup = new Interpolator(new MapLookup(map));","209","        subst.setRecursiveEvaluationAllowed(false);","230","        subst.setRecursiveEvaluationAllowed(false);","238","        final StrLookup lookup = new Interpolator(new MapLookup(map));","240","        subst.setRecursiveEvaluationAllowed(true);","249","        final StrLookup lookup = new Interpolator(new MapLookup(map));","251","        subst.setRecursiveEvaluationAllowed(false);","259","        final StrLookup lookup = new Interpolator(new MapLookup(map));","261","        subst.setRecursiveEvaluationAllowed(false);","269","        final StrLookup lookup = new Interpolator(new MapLookup(map));","271","        subst.setRecursiveEvaluationAllowed(true);","280","        final StrLookup lookup = new Interpolator(new MapLookup(map));","282","        subst.setRecursiveEvaluationAllowed(true);","290","        final StrLookup lookup = new Interpolator(new MapLookup(map));","292","        subst.setRecursiveEvaluationAllowed(true);","300","        final StrLookup lookup = new Interpolator(new MapLookup(map));","302","        subst.setRecursiveEvaluationAllowed(true);","320","        final StrLookup lookup = new Interpolator(new MapLookup(map));","322","        subst.setRecursiveEvaluationAllowed(false);","330","        final StrLookup lookup = new Interpolator(new MapLookup(map));","332","        subst.setRecursiveEvaluationAllowed(false);","340","        final StrLookup lookup = new Interpolator(new MapLookup(map));","342","        subst.setRecursiveEvaluationAllowed(false);"]}],"log4j-core\/src\/test\/resources\/log4j-routing.xml":[{"add":["19","  <Properties>","20","    <Property name=\"filename\">target\/routing1\/routingtest-$${sd:type}.log<\/Property>","21","  <\/Properties>","34","          <RollingFile name=\"Routing-${sd:type}\" fileName=\"${filename}\""],"delete":["31","          <RollingFile name=\"Routing-${sd:type}\" fileName=\"target\/routing1\/routingtest-${sd:type}.log\""]}],"log4j-core\/src\/test\/resources\/log4j-routing.properties":[{"add":["18","property.filename = target\/routing1\/routingtestProps-$${sd:type}.log","19","","35","appender.routing.routes.route1.rolling.fileName = ${filename}"],"delete":["33","appender.routing.routes.route1.rolling.fileName = target\/routing1\/routingtestProps-${sd:type}.log"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/PropertiesPluginTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-routing-2767.xml":[{"add":["19","  <Properties>","20","    <Property name=\"filename\">target\/routing1\/routingtest-$${sd:type}.log<\/Property>","21","  <\/Properties>","22","","30","          <RollingFile name=\"Routing-${sd:type}\" fileName=\"${filename}\""],"delete":["26","          <RollingFile name=\"Routing-${sd:type}\" fileName=\"target\/routing1\/routingtest-${sd:type}.log\""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/HttpURLConnectionManager.java":[{"add":["94","                header.evaluate(getConfiguration().getStrSubstitutor()));"],"delete":["94","                header.isValueNeedsLookup() ? getConfiguration().getStrSubstitutor().replace(event, header.getValue()) : header.getValue());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutor.java":[{"add":["1097","                            LookupResult resolvedResult = isCyclic ? null : resolveVariable(event, varName, buf, startPos, endPos);","1098","                            String varValue = resolvedResult == null ? null : resolvedResult.value();","1107","                                int change = resolvedResult != null && resolvedResult.isLookupEvaluationAllowedInValue()","1175","    protected LookupResult resolveVariable(final LogEvent event, final String variableName, final StringBuilder buf,","1182","            return resolver.evaluate(event, variableName);"],"delete":["211","    private boolean recursiveEvaluationAllowed;","212","","394","        this.recursiveEvaluationAllowed = other.isRecursiveEvaluationAllowed();","1100","                            String varValue = isCyclic ? null : resolveVariable(event, varName, buf, startPos, endPos);","1109","                                int change = isRecursiveEvaluationAllowed()","1177","    protected String resolveVariable(final LogEvent event, final String variableName, final StringBuilder buf,","1184","            return resolver.lookup(event, variableName);","1477","    boolean isRecursiveEvaluationAllowed() {","1478","        return recursiveEvaluationAllowed;","1479","    }","1480","","1481","    void setRecursiveEvaluationAllowed(final boolean recursiveEvaluationAllowed) {","1482","        this.recursiveEvaluationAllowed = recursiveEvaluationAllowed;","1483","    }","1484",""]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3317\" dev=\"ckozak\" type=\"fix\">","34","        Fix RoutingAppender backcompat and disallow recursive evaluation of lookup results outside of configuration properties.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["498","            final String value = prop.evaluate(privateConfig.config.getStrSubstitutor());"],"delete":["498","            final String value = prop.isValueNeedsLookup() \/\/","499","                    ? privateConfig.config.getStrSubstitutor().replace(event, prop.getValue()) \/\/","500","                    : prop.getValue();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginValueVisitor.java":[{"add":["51","        final String value = this.annotation.substitute()","52","                ? this.substitutor.replace(event, rawValue)","53","                : rawValue;"],"delete":["51","        final String value = this.substitutor.replace(event, rawValue);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender3350Test.java":[{"add":[],"delete":[]}]}},"ef8517e4fd7e4d70e330dcffe91bae958e407690":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["73","        lookups.put(\"date\", new DateLookup());","74","        lookups.put(\"ctx\", new ContextMapLookup());"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-378\" dev=\"rgoers\" type=\"fix\">","24","        Add DateLookup and ThreadContextLookup to default lookups.","25","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":[{"add":["22","import java.text.SimpleDateFormat;","23","import java.util.Date;","94","        value = lookup.lookup(\"date:yyyy-MM-dd\");","95","        assertNotNull(\"No Date\", value);","96","        SimpleDateFormat format = new SimpleDateFormat(\"yyyy-MM-dd\");","97","        String today = format.format(new Date());","98","        assertEquals(value, today);","99",""],"delete":[]}]}},"c17334167b466749f4df0cc80df6a4d0b15751bd":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Logger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Logger.java":[{"add":["529","   * Logs a message with the specific Marker at the {@link Level#INFO INFO} level."],"delete":["529","   * Logs a message with the specific Marker at the TRACE level."]}],"src\/changes\/changes.xml":[{"add":["218","      <action issue=\"LOG4J2-397\" dev=\"ggregory\" type=\"fix\" due-to=\"Yonatan Graber\">","219","        Logger.info(Message) Javadoc is incorrect.","220","      <\/action>"],"delete":[]}]}},"62c66644593b4cbaa39d11530ef658dc6c5fa529":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":["161","        if (isEnabled(Level.ERROR, CATCHING_MARKER, (Object) null, null)) {"],"delete":["161","        if (isEnabled(Level.DEBUG, CATCHING_MARKER, (Object) null, null)) {"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-132\" dev=\"ggregory\" type=\"fix\">","26","        AbstractLogger.catching(Throwable) checks for DEBUG level but logs at ERROR level.","27","      <\/action>"],"delete":[]}]}},"0b085168fd0ffadabdee50187627a823042a0c12":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["29","      <action issue=\"LOG4J2-1346\" type=\"fix\">","30","        Throw exception in Log4jServletContextListener preventing jetty-maven-plugin run-forked.","31","      <\/action>"],"delete":[]}]}},"68d0b80e354532666871e9c1df23d302b9beaa62":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsynchAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsynchAppender.java":[{"add":["228","                    Serializable s = queue.take();","229","                    if (s instanceof Log4jLogEvent) {","230","                        final Log4jLogEvent event = Log4jLogEvent.deserialize(s);","231","                        for (final AppenderControl control : appenders) {","232","                            control.callAppender(event);","233","                        }"],"delete":["228","                    final Log4jLogEvent event = Log4jLogEvent.deserialize(queue.take());","229","                    for (final AppenderControl control : appenders) {","230","                        control.callAppender(event);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-176\" dev=\"rgoers\" type=\"fix\" due-to=\"Remko Popma\">","26","        Avoid IllegalArgumentException in AsynchAppender.","27","      <\/action>"],"delete":[]}]}},"4aa719a5e689bb7ec83b53133d04f195e28d9bec":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["87","      <action issue=\"LOG4J2-2012\" dev=\"ggregory\" type=\"fix\" due-to=\"Benjamin Jaton\">","88","        No compression when using a separate drive in Linux.","89","      <\/action>"],"delete":[]}]}},"a19ecc9e3974c2fc48d99e453cde36d4750c5d35":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":[{"add":["27","import org.junit.After;","63","    @After","64","    public void cleanup() {","65","        System.clearProperty(ConfigurationFactory.CONFIGURATION_FILE_PROPERTY);","66","    }","67","","140","    public void testFromClassPathProperty() throws Exception {","141","        System.setProperty(ConfigurationFactory.CONFIGURATION_FILE_PROPERTY, \"classpath:log4j2-config.xml\");","142","        final LoggerContext ctx = Configurator.initialize(\"Test1\", null);","143","        LogManager.getLogger(\"org.apache.test.TestConfigurator\");","144","        Configuration config = ctx.getConfiguration();","145","        assertNotNull(\"No configuration\", config);","146","        assertEquals(\"Incorrect Configuration.\", CONFIG_NAME, config.getName());","147","        final Map<String, Appender> map = config.getAppenders();","148","        assertNotNull(\"Appenders map should not be null.\", map);","149","        assertTrue(\"Appenders map should not be empty.\", map.size() > 0);","150","        assertTrue(\"Wrong configuration\", map.containsKey(\"List\"));","151","        Configurator.shutdown(ctx);","152","        config = ctx.getConfiguration();","153","        assertEquals(\"Unexpected Configuration.\", NullConfiguration.NULL_NAME, config.getName());","154","    }","155","","156","    @Test"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["39","import org.apache.logging.log4j.core.lookup.Interpolator;","40","import org.apache.logging.log4j.core.lookup.StrSubstitutor;","108","    protected final StrSubstitutor substitutor = new StrSubstitutor(new Interpolator());","109","","368","                final String config = this.substitutor.replace(","369","                    PropertiesUtil.getProperties().getStringProperty(CONFIGURATION_FILE_PROPERTY));","371","                    ConfigurationSource source = null;","372","                    try {","373","                        source = getInputFromURI(new URI(config));","374","                    } catch (Exception ex) {","375","                        \/\/ Ignore the error and try as a String.","376","                    }","377","                    if (source == null) {","378","                        final ClassLoader loader = this.getClass().getClassLoader();","379","                        source = getInputFromString(config, loader);","380","                    }"],"delete":["364","                final String config = PropertiesUtil.getProperties().getStringProperty(CONFIGURATION_FILE_PROPERTY);","366","                    final ClassLoader loader = this.getClass().getClassLoader();","367","                    final ConfigurationSource source = getInputFromString(config, loader);"]}],"src\/changes\/changes.xml":[{"add":["42","      <action issue=\"LOG4J2-395\" dev=\"rgoers\" type=\"fix\" due-to=\"Abhinav Shah\">","43","        Allow classpath scheme when specifying configuration file location as a system property.","44","      <\/action>"],"delete":[]}]}},"6c546be1a2c8e57cfa385893e6ec6ee822454905":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2680\" dev=\"rgoers\" type=\"fix\" due-to=\"Guillermo Xavier Hurtado Garcia\">","33","        Set result of rename action to true if file was copied.","34","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":[{"add":["140","                                    result = true;"],"delete":[]}]}},"fb747abea62509294dc2060536f1f1b50318f3b4":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManagerTest.java":"ADD","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":[{"add":["108","        final String name = createManagerName(to, cc, bcc, from, replyTo, subject, protocol, host, port, username, isDebug, filterName);","116","    \/**","117","     * Creates a unique-per-configuration name for an smtp manager using the specified the parameters.<br>","118","     * Using such a name allows us to maintain singletons per unique configurations.","119","     *","120","     * @return smtp manager name","121","     *\/","122","    static String createManagerName(","131","            final int port,","162","        sb.append(protocol).append(':').append(host).append(':').append(port).append(':');","169","        return \"SMTP:\" + sb.toString();"],"delete":["51","import org.apache.logging.log4j.core.util.NameUtil;","109","        final String name = createManagerName(to, cc, bcc, from, replyTo, subject, protocol, host, username, password, isDebug, filterName);","117","    private static String createManagerName(","127","            final String password,","157","        sb.append(protocol).append(':').append(host).append(':').append(\"port\").append(':');","161","        sb.append(':');","162","        if (password != null) {","163","            sb.append(password);","164","        }","168","        final String hash = NameUtil.md5(sb.toString());","169","        return \"SMTP:\" + hash;","170",""]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManagerTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3107\" dev=\"vy\" type=\"fix\" due-to=\"Markus Spann\">","72","        SmtpManager.createManagerName ignores port.","73","      <\/action>"],"delete":[]}]}},"04ee75ff52276f02caa248a33bc8c0da7ded10ef":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["846","            return message.memento();"],"delete":["846","            return new SimpleMessage(message.getFormattedMessage());"]}]}},"cb95027f0e5d6726b271f9f5f539e4cbc5064006":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/script\/Script.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["130","      <action issue=\"LOG4J2-2210\" dev=\"ggregory\" type=\"update\" due-to=\"Bj?rn Kautler\">","131","        Fix error log message for Script which says ScriptFile instead.","132","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/script\/Script.java":[{"add":["27","@Plugin(name = Script.PLUGIN_NAME, category = Node.CATEGORY, printObject = true)","30","    private static final String ATTR_LANGUAGE = \"language\";","31","    private static final String ATTR_SCRIPT_TEXT = \"scriptText\";","32","    static final String PLUGIN_NAME = \"Script\";","33","","42","            @PluginAttribute(ATTR_LANGUAGE) String language,","43","            @PluginValue(ATTR_SCRIPT_TEXT) final String scriptText) {","46","            LOGGER.error(\"No '{}' attribute provided for {} plugin '{}'\", ATTR_LANGUAGE, PLUGIN_NAME, name);","50","            LOGGER.error(\"No '{}' attribute provided for {} plugin '{}'\", ATTR_SCRIPT_TEXT, PLUGIN_NAME, name);"],"delete":["27","@Plugin(name = \"Script\", category = Node.CATEGORY, printObject = true)","38","            @PluginAttribute(\"language\") String language,","39","            @PluginValue(\"scriptText\") final String scriptText) {","42","            LOGGER.info(\"No script language supplied, defaulting to {}\", DEFAULT_LANGUAGE);","46","            LOGGER.error(\"No scriptText attribute provided for ScriptFile {}\", name);"]}]}},"67f2dd7091f51543b2abb98d9b46c9114bead9f5":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/ConfigurationBuilderTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/ConfigurationBuilderTest.java":[{"add":["83","                INDENT + \"<ThresholdFilter onMatch=\\\"ACCEPT\\\" onMismatch=\\\"NEUTRAL\\\" level=\\\"DEBUG\\\"\/>\" + EOL +","87","                INDENT + INDENT + INDENT + \"<MarkerFilter onMatch=\\\"DENY\\\" onMismatch=\\\"NEUTRAL\\\" marker=\\\"FLOW\\\"\/>\" + EOL +"],"delete":["83","                INDENT + \"<ThresholdFilter onMatch=\\\"ACCEPT\\\" onMisMatch=\\\"NEUTRAL\\\" level=\\\"DEBUG\\\"\/>\" + EOL +","87","                INDENT + INDENT + INDENT + \"<MarkerFilter onMatch=\\\"DENY\\\" onMisMatch=\\\"NEUTRAL\\\" marker=\\\"FLOW\\\"\/>\" + EOL +"]}]}},"2a49f555a4a00bdc5a95c852716595a27a73f61b":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlLoggerPropsTest.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-loggerprops.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlLoggerPropsTest.java":[{"add":["69","                containsString(\"test4=test\"),","70","                containsString(\"test5=test\"),","80","                containsString(\"test4=test\"),","81","                containsString(\"test5=test\"),"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-loggerprops.xml":[{"add":["22","     <Property name=\"test5\">${sys:test3:-${sys:test}}<\/Property>","26","        <PatternLayout pattern=\"[%-5level] %c{1.} user=%X{user} phrasex=%X{phrasex} test=%X{test} test2=$${sys:test2} test3=$${sys:test3:-Unknown} test4=$${sys:test3:-${sys:test}} test5=${test5} attribKey=$${attribKey} duplicateKey=$${duplicateKey}%msg%n\" \/>"],"delete":["25","        <PatternLayout pattern=\"[%-5level] %c{1.} user=%X{user} phrasex=%X{phrasex} test=%X{test} test2=$${sys:test2} test3=$${sys:test3:-Unknown} attribKey=$${attribKey} duplicateKey=$${duplicateKey}%msg%n\" \/>"]}]}},"361a74b24dad33f527152f90c69924a82fd8a34f":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["23","import org.apache.logging.log4j.core.LogEvent;","24","import org.apache.logging.log4j.core.impl.Log4jLogEvent;","25","import org.apache.logging.log4j.core.lookup.StrSubstitutor;","174","     * @param subst The StrSubstitutor.","175","     * @param buf string buffer to which formatted file name is appended, may not be null.","176","     * @param obj object to be evaluated in formatting, may not be null.","177","     *\/","178","    public final void formatFileName(final StrSubstitutor subst, final StringBuilder buf, final Object obj) {","179","        final long time = prevFileTime == 0 ? System.currentTimeMillis() : prevFileTime;","180","        formatFileName(buf, new Date(time), obj);","181","        LogEvent event = new Log4jLogEvent(time);","182","        String fileName = subst.replace(event, buf);","183","        buf.setLength(0);","184","        buf.append(fileName);","185","    }","186","","187","    \/**","188","     * Format file name."],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["117","            manager.getPatternProcessor().formatFileName(subst, buf, fileIndex);","120","            String renameTo = buf.toString();"],"delete":["117","            manager.getPatternProcessor().formatFileName(buf, fileIndex);","120","            String renameTo = subst.replace(buf);"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-380\" dev=\"rgoers\" type=\"fix\">","24","        Use rollover date when substituting ${date} in the filePattern.","25","      <\/action>","27","        Renamed FastFileAppender and FastRollingFileAppender to RandomAccessFileAppender"],"delete":["24","        Renamed FastFileAppender and FastRollingFileAppender to RandomAccessFileAppender "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["57","     *","58","     *\/","59","    public Log4jLogEvent(final long timestamp) {","60","        this(\"\", null, \"\", null, null, (ThrowableProxy) null, null, null, null, null, timestamp);","61","    }","62","","63","    \/**"],"delete":[]}]}},"0acae29065a4943fb11a31a1192ea9624fc44e08":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["25","import java.util.HashMap;","88","    private Advertiser advertiser = new DefaultAdvertiser();","89","","90","    protected Map<String, String> advertisedConfiguration;","91","","92","    private Node advertiserNode = null;","93","","94","    private Object advertisement;","117","    protected PluginManager pluginManager;","118","","123","        pluginManager = new PluginManager(\"Core\");","138","        pluginManager.collectPlugins();","140","        setupAdvertisement();","168","        if (advertiser != null && advertisement != null)","169","        {","170","            advertiser.unadvertise(advertisement);","171","        }","192","    protected void createAdvertiser(String advertiserString, ConfigurationFactory.ConfigurationSource configSource,","193","                                    byte[] buffer, String contentType) {","194","        if (advertiserString != null) {","195","            Node node = new Node(null, advertiserString, null);","196","            Map<String, String> attributes = node.getAttributes();","197","            attributes.put(\"content\", new String(buffer));","198","            attributes.put(\"contentType\", contentType);","199","            attributes.put(\"name\", \"configuration\");","200","            if (configSource.getLocation() != null) {","201","                attributes.put(\"location\", configSource.getLocation());","202","            }","203","            advertiserNode = node;","204","        }","205","    }","206","","207","    private void setupAdvertisement() {","208","        if (advertiserNode != null)","209","        {","210","            String name = advertiserNode.getName();","211","            @SuppressWarnings(\"unchecked\")","212","            final PluginType<Advertiser> type = (PluginType<Advertiser>) pluginManager.getPluginType(name);","213","            if (type != null)","214","            {","215","                final Class<Advertiser> clazz = type.getPluginClass();","216","                try {","217","                    advertiser = clazz.newInstance();","218","                    advertisement = advertiser.advertise(advertiserNode.getAttributes());","219","                } catch (final InstantiationException e) {","220","                    System.err.println(\"InstantiationException attempting to instantiate advertiser: \" + name);","221","                } catch (final IllegalAccessException e) {","222","                    System.err.println(\"IllegalAccessException attempting to instantiate advertiser: \" + name);","223","                }","224","            }","225","        }","226","    }","227",""],"delete":["87","    protected Advertiser advertiser = new DefaultAdvertiser();","269","    protected PluginManager getPluginManager() {","270","        \/\/don't cache a pluginmanager instance - packages may be updated, requiring","271","        \/\/ re-discovery of plugins","272","        final PluginManager mgr = new PluginManager(\"Core\");","273","        mgr.collectPlugins();","274","        return mgr;","275","    }","276",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":[{"add":["124","                    createAdvertiser(getStrSubstitutor().replace(entry.getValue()), configSource, buffer,","125","                        \"application\/json\");","203","        final PluginType<?> type = pluginManager.getPluginType(name);","219","                        final PluginType<?> entryType = pluginManager.getPluginType(pluginType);"],"delete":["31","import java.util.HashMap;","41","import org.apache.logging.log4j.core.net.Advertiser;","61","    private Map<String, String> advertisedConfiguration;","62","","63","    private Object advertisement;","64","","130","                    final String advertiserString = getStrSubstitutor().replace(entry.getValue());","131","                    if (advertiserString != null)","132","                    {","133","                        @SuppressWarnings(\"unchecked\")","134","                        final PluginType<Advertiser> type = (PluginType<Advertiser>) getPluginManager().getPluginType(advertiserString);","135","                        if (type != null)","136","                        {","137","                            final Class<Advertiser> clazz = type.getPluginClass();","138","                            advertiser = clazz.newInstance();","139","                            advertisedConfiguration = new HashMap<String, String>();","140","                            advertisedConfiguration.put(\"content\", new String(buffer));","141","                            advertisedConfiguration.put(\"contentType\", \"application\/json\");","142","                            advertisedConfiguration.put(\"name\", \"configuration\");","143","                            if (configSource.getLocation() != null)","144","                            {","145","                                advertisedConfiguration.put(\"location\", configSource.getLocation());","146","                            }","147","                        }","148","                    }","186","        if (advertiser != null && advertisement != null)","187","        {","188","            advertiser.unadvertise(advertisement);","189","        }","213","        if (advertiser != null && advertisedConfiguration != null)","214","        {","215","            advertisement = advertiser.advertise(advertisedConfiguration);","216","        }","234","        final PluginType<?> type = getPluginManager().getPluginType(name);","250","                        final PluginType<?> entryType = getPluginManager().getPluginType(pluginType);"]}],"src\/changes\/changes.xml":[{"add":["42","      <action issue=\"LOG4J2-393\" dev=\"rgoers\" type=\"fix\">","43","        Initialize PluginManager once during configuration. Move advertisement setup into BaseConfiguration.","44","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":[{"add":["71","    private static final String[] VERBOSE_CLASSES = new String[] {ResolverUtil.class.getName()};","72","","73","    private static final String LOG4J_XSD = \"Log4j-config.xsd\";","74","","75","    private static final int BUF_SIZE = 16384;","76","","77","    private final List<Status> status = new ArrayList<Status>();","78","","79","    private Element rootElement;","80","","81","    private boolean strict;","82","","83","    private String schema;","84","","85","    private final File configFile;","86","","97","        return factory.newDocumentBuilder();","103","     * @param factory a DocumentBuilderFactory","135","            final List<String> messages = new ArrayList<String>();","192","                    createAdvertiser(getStrSubstitutor().replace(entry.getValue()), configSource, buffer, \"text\/xml\");","242","                    Validator validator = schema.newValidator();","299","                final PluginType<?> type = pluginManager.getPluginType(name);"],"delete":["31","import java.util.HashMap;","51","import org.apache.logging.log4j.core.net.Advertiser;","83","        final DocumentBuilder builder = factory.newDocumentBuilder();","84","        return builder;","90","     * @param factory","91","     *            a DocumentBuilderFactory","118","    private static final String[] VERBOSE_CLASSES = new String[] {ResolverUtil.class.getName()};","119","","120","    private static final String LOG4J_XSD = \"Log4j-config.xsd\";","121","","122","    private static final int BUF_SIZE = 16384;","123","","124","    private final List<Status> status = new ArrayList<Status>();","125","","126","    private Map<String, String> advertisedConfiguration;","127","","128","    private Object advertisement;","129","","130","    private Element rootElement;","131","","132","    private boolean strict;","133","","134","    private String schema;","135","","136","    private Validator validator;","137","","138","    private final List<String> messages = new ArrayList<String>();","139","","140","    private final File configFile;","141","","203","                    final String advertiserString = getStrSubstitutor().replace(entry.getValue());","204","                    if (advertiserString != null)","205","                    {","206","                        @SuppressWarnings(\"unchecked\")","207","                        final PluginType<Advertiser> type = (PluginType<Advertiser>) getPluginManager().getPluginType(advertiserString);","208","                        if (type != null)","209","                        {","210","                            final Class<Advertiser> clazz = type.getPluginClass();","211","                            try {","212","                                advertiser = clazz.newInstance();","213","                                advertisedConfiguration = new HashMap<String, String>();","214","                                advertisedConfiguration.put(\"content\", new String(buffer));","215","                                advertisedConfiguration.put(\"contentType\", \"text\/xml\");","216","                                advertisedConfiguration.put(\"name\", \"configuration\");","217","                                if (configSource.getLocation() != null)","218","                                {","219","                                    advertisedConfiguration.put(\"location\", configSource.getLocation());","220","                                }","221","                            } catch (final InstantiationException e) {","222","                                System.err.println(\"InstantiationException attempting to instantiate advertiser: \" + advertiserString);","223","                            } catch (final IllegalAccessException e) {","224","                                System.err.println(\"IllegalAccessException attempting to instantiate advertiser: \" + advertiserString);","225","                            }","226","                        }","227","                    }","277","                    validator = schema.newValidator();","295","    public void stop() {","296","        super.stop();","297","        if (advertiser != null && advertisement != null)","298","        {","299","            advertiser.unadvertise(advertisement);","300","        }","301","    }","302","","303","    @Override","317","        if (advertiser != null && advertisedConfiguration != null)","318","        {","319","            advertisement = advertiser.advertise(advertisedConfiguration);","320","        }","347","                PluginManager mgr = getPluginManager();","348","                final PluginType<?> type = mgr.getPluginType(name);"]}]}},"be6f48a9b4402eb1f40cb0749ef6f02755efe120":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-391\" dev=\"rgoers\" type=\"fix\" due-to=\"Kamal Bahadur\">","27","        FlumePersistentManager now handles LockConflictExceptions in Berkeley Db when sending a batch.","28","      <\/action>","67","      <\/action>","70","      <\/action>","73","      <\/action>","76","      <\/action>","77","    <\/release>","124","    <\/release>","128","      <\/action>","131","      <\/action>","134","      <\/action>","192","    <\/release>"],"delete":["64","      <\/action>      ","67","      <\/action>      ","70","      <\/action>      ","73","      <\/action>      ","74","    <\/release> ","121","    <\/release> ","125","      <\/action>      ","128","      <\/action>      ","131","      <\/action>      ","189","    <\/release> "]}],"log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":[{"add":["660","            Cursor cursor = null;","662","            \tfinal BatchEvent batch = new BatchEvent();","663","            \tfor (int retryIndex = 0; retryIndex < lockTimeoutRetryCount; ++retryIndex) {","664","            \t\ttry {","665","            \t\t\tcursor = database.openCursor(null, CursorConfig.DEFAULT);","666","            \t\t\tstatus = cursor.getFirst(key, data, null);","668","            \t\t\tfor (int i = 0; status == OperationStatus.SUCCESS && i < batchSize; ++i) {","669","            \t\t\t\tfinal SimpleEvent event = createEvent(data);","670","            \t\t\t\tif (event != null) {","671","            \t\t\t\t\tbatch.addEvent(event);","672","            \t\t\t\t}","673","            \t\t\t\tstatus = cursor.getNext(key, data, null);","674","            \t\t\t}","675","            \t\t\tbreak;","676","            \t\t} catch (final LockConflictException lce) {","677","            \t\t\tif (cursor != null) {","678","            \t\t\t\ttry {","679","                                cursor.close();","680","                                cursor = null;","681","                            } catch (final Exception ex) {","682","                                LOGGER.trace(\"Ignored exception closing cursor during lock conflict.\");","683","                            }","684","                        }","686","            \t}","687","","695","                \tif (cursor != null) {","696","\t                    cursor.close();","697","\t                    cursor = null;","698","                \t}"],"delete":["660","            Cursor cursor = database.openCursor(null, CursorConfig.DEFAULT);","662","                status = cursor.getFirst(key, data, null);","664","                final BatchEvent batch = new BatchEvent();","665","                for (int i = 0; status == OperationStatus.SUCCESS && i < batchSize; ++i) {","666","                    final SimpleEvent event = createEvent(data);","667","                    if (event != null) {","668","                        batch.addEvent(event);","670","                    status = cursor.getNext(key, data, null);","671","                }","679","                    cursor.close();","680","                    cursor = null;"]}]}},"b57cb2a4b4c8df3cc273f81b2e8c9e58fb9a21fc":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-133\" dev=\"ggregory\" type=\"add\">","26","        Allow custom message creation via a message factory.","27","      <\/action>"],"delete":[]}]}},"bb1793874d3fada1c55dfe265e7a9d7ed4aa4c74":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainLookupTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainMapLookup.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainInputArgumentsLookupApp.java":"ADD","\/dev\/null":"DELETE","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","src\/site\/xdoc\/manual\/lookups.xml":"MODIFY","src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutor.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainLookupTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainMapLookup.java":[{"add":["66","     * <li>{@code \"main:\\--file\"} = {@code \"path\/file.txt\"}<\/li>","67","     * <li>{@code \"main:\\-x\"} = {@code \"2\"}<\/li>","69","     *<p>Note: Many applications use leading dashes to identify command arguments. Specifying {@code \"main:--file}","70","     * would result in the lookup failing because it would look for a variable named \"main\" with a default","71","     * value of \"-file\". To avoid this the \":\" separating the Lookup name from the key must be followed by","72","     * a backslash as an escape character.<\/p>"],"delete":["66","     * <li>{@code \"main:--file\"} = {@code \"path\/file.txt\"}<\/li>","67","     * <li>{@code \"main:-x\"} = {@code \"2\"}<\/li>"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/MainInputArgumentsLookupApp.java":[{"add":[],"delete":[]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["38","    \/** Constant for the prefix separator. *\/","39","    public static final char PREFIX_SEPARATOR = ':';","40",""],"delete":["52","    \/** Constant for the prefix separator. *\/","53","    private static final char PREFIX_SEPARATOR = ':';","54",""]}],"src\/site\/xdoc\/manual\/lookups.xml":[{"add":["317","          Note: Many applications use leading dashes to identify command arguments. Specifying","318","          <code>${main:--file}<\/code> would result in the lookup failing because it would look for a variable","319","          named \"main\" with a default value of \"-file\". To avoid this the \":\" separating the Lookup name from the","320","          key must be followed by a backslash as an escape character as in <code>${main:\\--file}<\/code>","364","            <td>${main:\\--file}<\/td>","370","            <td>${main:\\-x}<\/td>","381","          <tr>","382","            <td>${main:\\--quiet:-true}<\/td>","383","            <td>","384","              <p><code>true<\/code><\/p>","385","            <\/td>","386","          <\/tr>"],"delete":["360","            <td>${main:--file}<\/td>","366","            <td>${main:-x}<\/td>"]}],"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["1075","          <p>","1076","            Default properties may also be specified in the Lookup by using the syntax <code>${dollar}{lookupName:key:-defaultValue}<\/code>.","1077","            In some cases the key might contain a leading '-'. When this is the case an escape character must be","1078","            included, such as <code>${dollar}{main:\\--file:-app.properties}<\/code>. This would use the","1079","            <code>MainMapLookup<\/code> for a key named <code>--file<\/code>. If the key is not found then","1080","            <code>app.properties<\/code> would be used as the default value.","1081","          <\/p>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/StrSubstitutor.java":[{"add":["160","    public static final String DEFAULT_VALUE_DELIMITER_STRING = \":-\";","161","    public static final StrMatcher DEFAULT_VALUE_DELIMITER = StrMatcher.stringMatcher(DEFAULT_VALUE_DELIMITER_STRING);","162","","163","    public static final String ESCAPE_DELIMITER_STRING = \":\\\\-\";","164","    public static final StrMatcher DEFAULT_VALUE_ESCAPE_DELIMITER = StrMatcher.stringMatcher(ESCAPE_DELIMITER_STRING);","186","    private String valueDelimiterString;","190","     * Escape string to avoid matching the value delimiter matcher;","191","     *\/","192","    private StrMatcher valueEscapeDelimiterMatcher;","193","","194","    \/**","335","        this(variableResolver, prefixMatcher, suffixMatcher, escape, DEFAULT_VALUE_DELIMITER,","336","                DEFAULT_VALUE_ESCAPE_DELIMITER);","337","        this.valueDelimiterString = DEFAULT_VALUE_DELIMITER_STRING;","350","    public StrSubstitutor(final StrLookup variableResolver, final StrMatcher prefixMatcher,","351","            final StrMatcher suffixMatcher, final char escape, final StrMatcher valueDelimiterMatcher) {","359","    \/**","360","     * Creates a new instance and initializes it.","361","     *","362","     * @param variableResolver  the variable resolver, may be null","363","     * @param prefixMatcher  the prefix for variables, not null","364","     * @param suffixMatcher  the suffix for variables, not null","365","     * @param escape  the escape character","366","     * @param valueDelimiterMatcher  the variable default value delimiter matcher, may be null","367","     * @param valueEscapeMatcher the matcher to escape defaulting, may be null.","368","     * @throws IllegalArgumentException if the prefix or suffix is null","369","     *\/","370","    public StrSubstitutor(final StrLookup variableResolver, final StrMatcher prefixMatcher,","371","            final StrMatcher suffixMatcher, final char escape, final StrMatcher valueDelimiterMatcher,","372","            final StrMatcher valueEscapeMatcher) {","373","        this.setVariableResolver(variableResolver);","374","        this.setVariablePrefixMatcher(prefixMatcher);","375","        this.setVariableSuffixMatcher(suffixMatcher);","376","        this.setEscapeChar(escape);","377","        this.setValueDelimiterMatcher(valueDelimiterMatcher);","378","        valueEscapeDelimiterMatcher = valueEscapeMatcher;","379","    }","380","","996","                                        if (valueEscapeDelimiterMatcher != null) {","997","                                            int matchLen = valueEscapeDelimiterMatcher.isMatch(varNameExprChars, i);","998","                                            if (matchLen != 0) {","999","                                                String varNamePrefix = varNameExpr.substring(0, i) + Interpolator.PREFIX_SEPARATOR;","1000","                                                varName = varNamePrefix + varNameExpr.substring(i + matchLen - 1);","1001","                                                for (int j = i + matchLen; j < varNameExprChars.length; ++j){","1002","                                                    if ((valueDelimiterMatchLen = valueDelimiterMatcher.isMatch(varNameExprChars, j)) != 0) {","1003","                                                        varName = varNamePrefix + varNameExpr.substring(i + matchLen, j);","1004","                                                        varDefaultValue = varNameExpr.substring(j + valueDelimiterMatchLen);","1005","                                                        break;","1006","                                                    }","1007","                                                }","1008","                                                break;","1009","                                            } else {","1010","                                                if ((valueDelimiterMatchLen = valueDelimiterMatcher.isMatch(varNameExprChars, i)) != 0) {","1011","                                                    varName = varNameExpr.substring(0, i);","1012","                                                    varDefaultValue = varNameExpr.substring(i + valueDelimiterMatchLen);","1013","                                                    break;","1014","                                                }","1015","                                            }","1016","                                        } else {","1017","                                            if ((valueDelimiterMatchLen = valueDelimiterMatcher.isMatch(varNameExprChars, i)) != 0) {","1018","                                                varName = varNameExpr.substring(0, i);","1019","                                                varDefaultValue = varNameExpr.substring(i + valueDelimiterMatchLen);","1020","                                                break;","1021","                                            }","1352","        String escapeValue = valueDelimiter.substring(0, valueDelimiter.length() - 1) + \"\\\\\"","1353","                + valueDelimiter.substring(valueDelimiter.length() - 1);","1354","        valueEscapeDelimiterMatcher = StrMatcher.stringMatcher(escapeValue);"],"delete":["160","    public static final StrMatcher DEFAULT_VALUE_DELIMITER = StrMatcher.stringMatcher(\":-\");","325","        this(variableResolver, prefixMatcher, suffixMatcher, escape, DEFAULT_VALUE_DELIMITER);","338","    public StrSubstitutor(","339","            final StrLookup variableResolver, final StrMatcher prefixMatcher, final StrMatcher suffixMatcher, final char escape, final StrMatcher valueDelimiterMatcher) {","962","                                        if ((valueDelimiterMatchLen = valueDelimiterMatcher.isMatch(varNameExprChars, i)) != 0) {","963","                                            varName = varNameExpr.substring(0, i);","964","                                            varDefaultValue = varNameExpr.substring(i + valueDelimiterMatchLen);","965","                                            break;"]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2211\" dev=\"rgoers\" type=\"fix\">","33","        Allow Lookup keys with leading dashes by using a slash as an escape character.","34","      <\/action>"],"delete":[]}]}},"3b12e13d1138dbe4590754d3550957fcc004f5c7":{"changes":{"\/dev\/null":"DELETE","core\/src\/main\/resources\/META-INF\/log4j-provider.properties":"ADD","api\/src\/main\/java\/org\/apache\/logging\/log4j\/LogManager.java":"MODIFY","api\/src\/test\/resources\/META-INF\/log4j-provider.properties":"ADD","src\/changes\/changes.xml":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"core\/src\/main\/resources\/META-INF\/log4j-provider.properties":[{"add":[],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/LogManager.java":[{"add":["41","    private static final String LOGGER_RESOURCE = \"META-INF\/log4j-provider.properties\";","97","                        props.load(url.openStream());"],"delete":["41","    private static final String LOGGER_RESOURCE = \"META-INF\/log4j-provider.xml\";","97","                        props.loadFromXML(url.openStream());"]}],"api\/src\/test\/resources\/META-INF\/log4j-provider.properties":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-104\" dev=\"rgoers\" type=\"fix\">","26","        Convert LogManager binding to use \"regular\" java properties instead of XML properties to workaround a","27","        bug in Oracle's xmlparserv2 jar.","28","      <\/action>"],"delete":[]}]}},"c9e7a9fdf3118c3c719ec5d6165cb00e77e19103":{"changes":{"src\/site\/xdoc\/manual\/layouts.xml.vm":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/layouts.xml.vm":[{"add":["709","\t\t\t\t<p>For example:","710","                  <pre>%style{%d{ISO8601}}{black} %style{[%t]}{blue} %style{%-5level:}{yellow} %style{%msg%n%throwable}{green}<\/pre>","711","                <\/p>","712","\t\t\t\t<p>You can also combine styles:","713","                  <pre>%d %highlight{%p} %style{%logger}{bright,cyan} %C{1.} %msg%n<\/pre>","714","                <\/p>","715","\t\t\t\t<p>You can also use <code>%<\/code> with a color like <code>%black<\/code>, <code>%blue<\/code>, <code>%cyan<\/code>, and so on. For example:","716","                  <pre>%black{%d{ISO8601}} %blue{[%t]} %yellow{%-5level:} %green{%msg%n%throwable}<\/pre>","717","\t\t\t\t<\/p>"],"delete":[]}]}},"879d320335f7dcf6e17c1d8837403576e80e9a75":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-135\" dev=\"ggregory\" type=\"fix\" due-to=\"Ingo Feltes\">"],"delete":["25","      <action issue=\"LOG4J2-135\" dev=\"ggregory\" type=\"add\">"]}]}},"8fea321a302aee65ac58960194f82a2080eb743b":{"changes":{"log4j-layout-template-json\/revapi.json":"MODIFY"},"diff":{"log4j-layout-template-json\/revapi.json":[{"add":["7","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.template\\\\.json\\\\.resolver\\\\.TemplateResolverConfig\",","8","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.template\\\\.json\\\\.resolver\\\\.TemplateResolverContext\",","9","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.template\\\\.json\\\\.resolver\\\\.TemplateResolverFactory\""],"delete":["7","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.json\\\\.template\\\\.resolver\\\\.TemplateResolverConfig\",","8","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.json\\\\.template\\\\.resolver\\\\.TemplateResolverContext\",","9","            \"org\\\\.apache\\\\.logging\\\\.log4j\\\\.layout\\\\.json\\\\.template\\\\.resolver\\\\.TemplateResolverFactory\""]}]}},"8777af527862596b0adeaf148896d1085e69d191":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["1286","                If a factoryName is specified without a providerURL a warning message will be logged as this is","1416","          To map your Log4j <code>MapMessage<\/code>s to JMS <code>javax.jms.MapMessage<\/code>s, set the","1434","","2528","              <td>logger<\/td>","2550","      <LoggerNameLevelRewritePolicy logger=\"com.foo.bar\">","3646","        \t<IfFileName glob=\"*.gz\" \/>"],"delete":["1286","                If a factoryName is specified without a providerURL a warning message will be logged as this is ","1416","          To map your Log4j <code>MapMessage<\/code>s to JMS <code>javax.jms.MapMessage<\/code>s, set the ","1434","        ","2528","              <td>loggerName<\/td>","2550","      <LoggerNameLevelRewritePolicy loggerName=\"com.foo.bar\">","3646","        \t<IfFileName glob=\"*.gz\" \/> "]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2018\" dev=\"rpopma\" type=\"fix\">","34","        Fix incorrect documentation for LoggerNameLevelRewritePolicy.","35","      <\/action>"],"delete":[]}]}},"145592c69002c721b60fa5e5637a983988f8966f":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["212","      <action issue=\"LOG4J2-1104\" dev=\"ggregory\" type=\"update\">","213","        Update Apache Commons Compress from 1.9 to 1.10.","214","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["687","        <version>1.10<\/version>"],"delete":["687","        <version>1.9<\/version>"]}]}},"52461585ed34153dc1470acbf2d43aac9bc81944":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["231","        testFirstConverter(\"%N\", NanoTimePatternConverter.class);","236","        testFirstConverter(\"%nano\", NanoTimePatternConverter.class);","343","    }","345","    @Test","346","    public void testMissingClosingBracket() {","347","        testFirstConverter(\"%d{\", DatePatternConverter.class);","348","    }","349","","350","    @Test","351","    public void testClosingBracketButWrongPlace() {","352","        final List<PatternFormatter> formatters = parser.parse(\"}%d{\");","353","        assertNotNull(formatters);","354","        assertEquals(2, formatters.size());","355","","356","        validateConverter(formatters, 0, \"Literal\");","357","        validateConverter(formatters, 1, \"Date\");"],"delete":["163","","232","        final List<PatternFormatter> formatters = parser.parse(\"%N\");","233","        assertNotNull(formatters);","234","        assertEquals(1, formatters.size());","235","        assertTrue(formatters.get(0).getConverter() instanceof NanoTimePatternConverter);","240","        final List<PatternFormatter> formatters = parser.parse(\"%nano\");","241","        assertNotNull(formatters);","242","        assertEquals(1, formatters.size());","243","        assertTrue(formatters.get(0).getConverter() instanceof NanoTimePatternConverter);"]}],"src\/changes\/changes.xml":[{"add":["64","      <action issue=\"LOG4J2-1216\" dev=\"ggregory\" type=\"fix\" due-to=\"Thies Wellpott, Barna Zsombor Klara, GFriedrich\">"],"delete":["64","      <action issue=\"LOG4J2-1216\" dev=\"ggregory\" type=\"fix\" due-to=\"Thies Wellpott, Barna Zsombor Klara\">"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["289","                i = pattern.lastIndexOf('}');","290","                if (i == -1 || i < start) {","291","                    \/\/ if no closing bracket could be found or there is no closing bracket behind the starting","292","                    \/\/ character of our parsing process continue parsing after the first opening bracket","293","                    return begin;","294","                }","295","                return i + 1;"],"delete":["289","                return pattern.indexOf('}', start) + 1;"]}]}},"381144c2c72dfa1329b7191e5a754312c597863f":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["68","      <action issue=\"LOG4J2-1117\" dev=\"ggregory\" type=\"fix\" due-to=\"Marcus Thiesen\">","69","        OutputStreamManager in ConsoleAppender leaking managers.","70","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["103","        return new ConsoleAppender(name, layout, filter, getManager(target, isFollow, layout), ignoreExceptions);","108","        return new ConsoleAppender(\"Console\", layout, null, getManager(DEFAULT_TARGET, false, layout), true);","171","            return new ConsoleAppender(name, layout, filter, getManager(target, follow, layout), ignoreExceptions);","175","    private static OutputStreamManager getManager(final Target target, final boolean follow, final Layout<? extends Serializable> layout) {","177","        final String managerName = target.name() + '.' + follow;","178","        return OutputStreamManager.getManager(managerName, new FactoryData(os, managerName, layout), factory);"],"delete":["103","        return new ConsoleAppender(name, layout, filter, getManager(isFollow, target, layout), ignoreExceptions);","108","        return new ConsoleAppender(\"Console\", layout, null, getManager(false, DEFAULT_TARGET, layout), true);","171","            return new ConsoleAppender(name, layout, filter, getManager(follow, target, layout), ignoreExceptions);","175","    private static OutputStreamManager getManager(final boolean follow, final Target target, final Layout<? extends Serializable> layout) {","176","        final String type = target.name();","178","        return OutputStreamManager.getManager(type + '.' + follow, new FactoryData(os, type, layout), factory);"]}]}},"e3c3d9ee8fe624255d06451835c33fba02a14ff8":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rewrite\/MapRewritePolicyTest.java":"ADD"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["105","        this.throwable = (t == null ? null : (t instanceof ThrowableProxy ? (ThrowableProxy)t : new ThrowableProxy(t)));"],"delete":["105","        this.throwable = t == null ? null : new ThrowableProxy(t);"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-103\" dev=\"rgoers\" type=\"fix\" due-to=\"Das Archive\">","26","        The LogEvent was wrapping a ThrowableProxy with another ThrowableProxy when deserializing.","27","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rewrite\/MapRewritePolicyTest.java":[{"add":[],"delete":[]}]}},"e2c1b6637475ce0c1d0335c6d947100deeaab0a7":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LifeCycle.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/JmsServer.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/CompositeTriggeringPolicy.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilterable.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/DefaultShutdownCallbackRegistry.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/CompositeFilter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LifeCycle2.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractLifeCycle.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LifeCycle.java":[{"add":["30"," *","34","","52","","55","     *","61",""],"delete":["30"," * ","34","    ","52","    ","55","     * ","61","    ","66","    \/**","67","     * Blocks until all tasks have completed execution after a shutdown request, or the timeout occurs, or the current","68","     * thread is interrupted, whichever happens first.","69","     * ","70","     * @param timeout the maximum time to wait","71","     * @param timeUnit the time unit of the timeout argument","72","     * @return true if the receiver was stopped cleanly and normally, false otherwise.","73","     *\/","74","    boolean stop(long timeout, TimeUnit timeUnit);","75",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/JmsServer.java":[{"add":["33","import org.apache.logging.log4j.core.LifeCycle2;\r","44","public class JmsServer extends LogEventListener implements MessageListener, LifeCycle2 {\r","100","    @Override\r","104","\r"],"delete":["33","import org.apache.logging.log4j.core.LifeCycle;\r","44","public class JmsServer extends LogEventListener implements MessageListener, LifeCycle {\r","100","    @Override    \r","104","    \r"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/CompositeTriggeringPolicy.java":[{"add":["22","import org.apache.logging.log4j.core.LifeCycle2;","86","            if (triggeringPolicy instanceof LifeCycle2) {","87","                stopped &= ((LifeCycle2) triggeringPolicy).stop(timeout, timeUnit);","88","            } else if (triggeringPolicy instanceof LifeCycle) {","89","                ((LifeCycle) triggeringPolicy).stop();","90","                stopped &= true;","96",""],"delete":["85","            if (triggeringPolicy instanceof LifeCycle) {","86","                stopped &= ((LifeCycle) triggeringPolicy).stop(timeout, timeUnit);","92","    "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["327","            if (prev instanceof LifeCycle2) {","328","                ((LifeCycle2) prev).stop(timeout, timeUnit);","329","            } else {","330","                prev.stop();","331","            }","665","     *","674","     *"],"delete":["327","            prev.stop(timeout, timeUnit);","661","     *  ","670","     *  "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilterable.java":[{"add":["23","import org.apache.logging.log4j.core.LifeCycle2;","33","     * Subclasses can extend this abstract Builder.","34","     *","57","","161","            if (filter instanceof LifeCycle2) {","162","                stopped = ((LifeCycle2) filter).stop(timeout, timeUnit);","163","            } else {","164","                filter.stop();","165","                stopped = true;","166","            }"],"delete":["32","     * Subclasses can extend this abstract Builder. ","33","     * ","56","    ","160","            stopped = filter.stop(timeout, timeUnit);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/DefaultShutdownCallbackRegistry.java":[{"add":["31","import org.apache.logging.log4j.core.LifeCycle2;","40","public class DefaultShutdownCallbackRegistry implements ShutdownCallbackRegistry, LifeCycle2, Runnable {","153","    @Override"],"delete":["31","import org.apache.logging.log4j.core.LifeCycle;","40","public class DefaultShutdownCallbackRegistry implements ShutdownCallbackRegistry, LifeCycle, Runnable {","153","    @Override    "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/CompositeFilter.java":[{"add":["28","import org.apache.logging.log4j.core.LifeCycle2;","139","            if (filter instanceof LifeCycle2) {","140","                ((LifeCycle2) filter).stop(timeout, timeUnit);","141","            } else {","142","                filter.stop();","143","            }"],"delete":["138","            filter.stop(timeout, timeUnit);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["42","import org.apache.logging.log4j.core.LifeCycle2;","129","","329","                if (appender instanceof LifeCycle2) {","330","                    ((LifeCycle2) appender).stop(timeout, timeUnit);","331","                } else {","332","                    appender.stop();","333","                }","347","                if (array[i] instanceof LifeCycle2) {","348","                    ((LifeCycle2) array[i]).stop(timeout, timeUnit);","349","                } else {","350","                    array[i].stop();","351","                }","811",""],"delete":["128","    ","328","                appender.stop(timeout, timeUnit);","342","                array[i].stop(timeout, timeUnit);","802","    "]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1591\" dev=\"rpopma\" type=\"fix\">","27","        Introduced new interface LifeCycle2 with stop(long,TimeUnit) method to avoid breaking backwards compatibility with new Configurator.shutdown(LoggerContext, long, TimeUnit) API.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LifeCycle2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["31","import org.apache.logging.log4j.core.LifeCycle2;","181","        if (triggeringPolicy instanceof LifeCycle2) {","182","            stopped &= ((LifeCycle2) triggeringPolicy).stop(timeout, timeUnit);","183","        } else if (triggeringPolicy instanceof LifeCycle) {","184","            ((LifeCycle) triggeringPolicy).stop();","185","            stopped &= true;","189","","383","                final Layout<? extends Serializable> layout, final int bufferSize, final boolean immediateFlush,","475",""],"delete":["180","        if (triggeringPolicy instanceof LifeCycle) {","181","            stopped &= ((LifeCycle) triggeringPolicy).stop(timeout, timeUnit);","185","    ","379","                final Layout<? extends Serializable> layout, final int bufferSize, final boolean immediateFlush, ","471","                "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":[{"add":["29","import org.apache.logging.log4j.core.LifeCycle2;","54","","59","","63","","64","        @PluginElement(\"Routes\")","66","","67","        @PluginConfiguration","69","","70","        @PluginElement(\"RewritePolicy\")","72","","73","        @PluginElement(\"PurgePolicy\")","75","","125","","136","","143","","152","","216","            final Appender appender = entry.getValue().getAppender();","217","            if (!map.containsKey(appender.getName())) {","218","                if (appender instanceof LifeCycle2) {","219","                    ((LifeCycle2) appender).stop(timeout, timeUnit);","220","                } else {","221","                    appender.stop();","222","                }"],"delete":["53","    ","58","                ","62","        ","63","        @PluginElement(\"Routes\") ","65","        ","66","        @PluginConfiguration ","68","        ","69","        @PluginElement(\"RewritePolicy\") ","71","        ","72","        @PluginElement(\"PurgePolicy\") ","74","        ","124","        ","135","    ","142","    ","151","    ","215","            final String name = entry.getValue().getAppender().getName();","216","            if (!map.containsKey(name)) {","217","                entry.getValue().getAppender().stop(timeout, timeUnit);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractLifeCycle.java":[{"add":["29","public class AbstractLifeCycle implements LifeCycle2 {","139",""],"delete":["29","public class AbstractLifeCycle implements LifeCycle {","139","    "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":[{"add":["37"," * <p>","38"," * Custom implementations are recommended to extend {@link AbstractConfiguration}.","39"," * <\/p>","40"," *","41"," * @see AbstractConfiguration","42"," * @see org.apache.logging.log4j.core.LifeCycle2","200","     *"],"delete":["194","     * "]}]}},"99809b488fee56935b2dbe0e241e8bff04426840":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["319","    \/**","320","     * Updates the RollingFileManager's data during a reconfiguration. This method should be considered private.","321","     * It is not thread safe and calling it outside of a reconfiguration may lead to errors. This method may be","322","     * made protected in a future release.","323","     * @param data The data to update.","324","     *\/","330","        setTriggeringPolicy(factoryData.getTriggeringPolicy());"],"delete":["323","        setTriggeringPolicy(factoryData.getTriggeringPolicy());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractManager.java":[{"add":["128","    \/**","129","     * Used by Log4j to update the Manager during reconfiguration. This method should be considered private.","130","     * Implementations may not be thread safe. This method may be made protected in a future release.","131","     * @param data The data to update.","132","     *\/"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["54","    private final FileExtension fileExtension;","89","        this.fileExtension = FileExtension.lookupForFile(pattern);","133","    public FileExtension getFileExtension() {","134","        return fileExtension;","135","    }","136",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2766\" dev=\"rgoers\" type=\"fix\">","33","        Initialize pattern processor before triggering policy during reconriguration.","34","      <\/action>","35","      <action issue=\"LOG4J2-2457\" dev=\"rgoers\" type=\"update\">","36","        Allow the file extension in the file pattern to be modified during reconfiguration.","37","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["146","        this.triggeringPolicy = triggeringPolicy;","147","        this.rolloverStrategy = rolloverStrategy;","226","        return patternProcessor.getFileExtension();","623","    \/**","624","     * Updates the RollingFileManager's data during a reconfiguration. This method should be considered private.","625","     * It is not thread safe and calling it outside of a reconfiguration may lead to errors. This method may be","626","     * made protected in a future release.","627","     * @param data The data to update.","628","     *\/","634","        setTriggeringPolicy(factoryData.getTriggeringPolicy());"],"delete":["72","    private final FileExtension fileExtension;","113","        this.fileExtension = FileExtension.lookupForFile(pattern);","131","        this.fileExtension = FileExtension.lookupForFile(pattern);","147","        this.triggeringPolicy = triggeringPolicy;","148","        this.rolloverStrategy = rolloverStrategy;","153","        this.fileExtension = FileExtension.lookupForFile(pattern);","230","        return fileExtension;","631","        setTriggeringPolicy(factoryData.getTriggeringPolicy());"]}]}},"e5ec31c070467da7f2598aafbca088864e122cd6":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/helpers\/UUIDUtil.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/helpers\/UUIDUtil.java":[{"add":["53","    private static long uuidSequence = PropertiesUtil.getProperties().getLongProperty(UUID_SEQUENCE, 0);"],"delete":["53","    private static long uuidSequence = Long.getLong(UUID_SEQUENCE, 0);"]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":[{"add":["73","","74","    public int getIntegerProperty(final String name, final int defaultValue) {","75","        String prop = null;","76","        try {","77","            prop = System.getProperty(name);","78","        } catch (final SecurityException e) {","79","            \/\/ Ignore","80","        }","81","        if (prop == null) {","82","            prop = props.getProperty(name);","83","        }","84","        if (prop != null) {","85","            try {","86","                return Integer.parseInt(prop);","87","            } catch (Exception ex) {","88","                return defaultValue;","89","            }","90","        }","91","        return defaultValue;","92","    }","93","","94","","95","    public long getLongProperty(final String name, final long defaultValue) {","96","        String prop = null;","97","        try {","98","            prop = System.getProperty(name);","99","        } catch (final SecurityException e) {","100","            \/\/ Ignore","101","        }","102","        if (prop == null) {","103","            prop = props.getProperty(name);","104","        }","105","        if (prop != null) {","106","            try {","107","                return Long.parseLong(prop);","108","            } catch (Exception ex) {","109","                return defaultValue;","110","            }","111","        }","112","        return defaultValue;","113","    }","114",""],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":[{"add":["47","    private static final PropertiesUtil props = new PropertiesUtil(\"log4j2.StatusLogger.properties\");","48","","49","    private static final int MAX_ENTRIES = props.getIntegerProperty(MAX_STATUS_ENTRIES, 200);"],"delete":["47","    private static final int MAX_ENTRIES = Integer.getInteger(MAX_STATUS_ENTRIES, 200);","62","        final PropertiesUtil props = new PropertiesUtil(\"log4j2.StatusLogger.properties\");"]}]}},"9bb3f8d187ea518dce4ea2e85635f60047864079":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-1103\" dev=\"rgoers\" type=\"fix\" due-to=\"Sen Dunne\">\r","33","        FailoverAppender was failing with ERROR appender Failover has no parameter that matches element Failovers.\r","34","      <\/action>\r"],"delete":[]}]}},"b16ed726379fa1faf8bf6607af10ca5e6a679487":{"changes":{"log4j-core\/src\/test\/resources\/LOG4J2-1100\/log4j2-good.yaml":"ADD"},"diff":{"log4j-core\/src\/test\/resources\/LOG4J2-1100\/log4j2-good.yaml":[{"add":[],"delete":[]}]}},"7c2ce5cffbf6c35458f1e8737ba09972cbec0cdf":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessorTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessorTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["104","        cal.set(Calendar.MONTH, currentCal.get(Calendar.MONTH));","113","            cal.set(Calendar.WEEK_OF_YEAR, currentCal.get(Calendar.WEEK_OF_YEAR));","115","            cal.set(Calendar.DAY_OF_WEEK, currentCal.getFirstDayOfWeek());","129","        cal.set(Calendar.HOUR_OF_DAY, currentCal.get(Calendar.HOUR_OF_DAY));","131","            increment(cal, Calendar.HOUR_OF_DAY, increment, modulus);","133","            cal.add(Calendar.HOUR_OF_DAY, -1);","153","        cal.set(Calendar.MILLISECOND, currentCal.get(Calendar.MILLISECOND));"],"delete":["126","        cal.set(Calendar.HOUR, currentCal.get(Calendar.HOUR));","128","            increment(cal, Calendar.HOUR, increment, modulus);","130","            cal.add(Calendar.HOUR, -1);"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-385\" dev=\"rpopma\" type=\"fix\" due-to=\"Ace Funk, Porfirio Partida\">","24","        Fixed issues with time-based file rollover (monthly, weekly, hourly and every minute).","25","      <\/action>"],"delete":[]}]}},"a0e46ffc85bae7c4d0e622e79396cd71edd007a0":{"changes":{"log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/CoreLoggerTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":"MODIFY"},"diff":{"log4j-jul\/src\/test\/java\/org\/apache\/logging\/log4j\/jul\/CoreLoggerTest.java":[{"add":["27","import org.apache.logging.log4j.util.Strings;","65","    public void testRootSetLevelToNull() throws Exception {","66","        final Logger rootLogger = Logger.getLogger(Strings.EMPTY);","67","        assertThat(rootLogger.getLevel(), equalTo(Level.SEVERE));","68","        assertThat(rootLogger.isLoggable(Level.SEVERE), is(true));","69","        \/\/ null test","70","        rootLogger.setLevel(null);","71","        assertThat(rootLogger.getLevel(), equalTo(null));","72","        assertThat(rootLogger.isLoggable(Level.SEVERE), is(true));","73","        \/\/ now go back to a different one","74","        rootLogger.setLevel(Level.INFO);","75","        assertThat(rootLogger.getLevel(), equalTo(Level.INFO));","76","        assertThat(rootLogger.isLoggable(Level.FINE), is(false));","77","    }","78","","79","    @Test","91","        assertThat(childLogger.isLoggable(Level.ALL), is(false));"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":[{"add":["109","        Level actualLevel;","110","        if (level != null) {","111","            actualLevel = level;","112","        } else {","113","            final Logger parent = getParent();","114","            actualLevel = parent != null ? parent.getLevel() : config.level;","115","        }"],"delete":["109","        final Level actualLevel = level != null ? level : getParent().getLevel();"]}]}},"287d2c6b861b2f938d0bb9dcebd897681bfb3520":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/JacksonFactory.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/JacksonFactory.java":[{"add":["146","     * &lt;Events&gt; created using {@link XmlLayout#getHeader()} and {@link XmlLayout#getFooter()} methods.","147","     * <p>","153","     * <\/p>"],"delete":["146","     * &lt;Events&gt; created using {@link #getHeader()} and {@link #getFooter()} methods.<br\/>"]}]}},"bb02fa151637552016790c1f090f209233f27ade":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManagerHeaderFooterTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/test\/resources\/RollingRandomAccessFileAppenderHeaderFooterTest.xml":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":[{"add":["30","    protected final Layout<?> layout;","67","        writeFooter();","68","        close();","69","    }","70","","71","    \/**","72","     * Writes the footer.","73","     *\/","74","    protected void writeFooter() {","75","        if (layout == null) {","76","            return;","77","        }"],"delete":["30","","31","    private final Layout<?> layout;","72","        close();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["57","        writeHeader();","58","    }","59","","60","    \/**","61","     * Writes the layout's header to the file if it exists.","62","     *\/","63","    private void writeHeader() {","64","        if (layout == null) {","65","            return;","66","        }","67","        byte[] header = layout.getHeader();","68","        if (header == null) {","69","            return;","70","        }","71","        try {","72","            \/\/ write to the file, not to the buffer: the buffer may not be empty","73","            randomAccessFile.write(header, 0, header.length);","74","        } catch (final IOException ioe) {","75","            LOGGER.error(\"Unable to write header\", ioe);","76","        }","121","        writeHeader();"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManagerHeaderFooterTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-675\" dev=\"rpopma\" type=\"add\">","25","        RollingFile and RollingRandomAccessFile now write the layout footer before rollover.","26","      <\/action>","27","      <action issue=\"LOG4J2-581\" dev=\"rpopma\" type=\"fix\" due-to=\"Alexander Khokhlov\">","28","        RollingRandomAccessFile now writes the layout header after rollover.","29","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["169","                writeFooter();"],"delete":[]}],"log4j-core\/src\/test\/resources\/RollingRandomAccessFileAppenderHeaderFooterTest.xml":[{"add":[],"delete":[]}]}},"360304a66d850ee16ea9b6f3314657a5672a98e0":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["35","      <action issue=\"LOG4J2-1354\" dev=\"ggregory\" type=\"fix\" due-to=\"Arkadiusz Adolph\">","36","        No configuration reload is triggered under Windows when replacing the configuration file with one that has older last modified date.","37","      <\/action>"],"delete":[]}]}},"6c2f05c9461a4909437dd2fbdf4c05955d7bc0cd":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/filters.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-123\" dev=\"rgoers\" type=\"fix\" due-to=\"Olivier Lamy\">","26","        The example for ThreadContextMapFilter was incorrect.","27","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/filters.xml":[{"add":["573","  <ThreadContextMapFilter onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\" operator=\"or\">","575","    <KeyValuePair key=\"User2\" value=\"WARN\"\/>","576","  <\/ThreadContextMapFilter>","594","          <p>","595","            The ThreadContextMapFilter can also be applied to a logger for filtering:","596","            <source><![CDATA[<?xml version=\"1.0\" encoding=\"UTF-8\"?>","597","<configuration status=\"warn\" name=\"MyApp\" packages=\"\">","598","  <appenders>","599","    <RollingFile name=\"RollingFile\" fileName=\"logs\/app.log\"","600","                 filePattern=\"logs\/app-%d{MM-dd-yyyy}.log.gz\">","601","      <BurstFilter level=\"INFO\" rate=\"16\" maxBurst=\"100\"\/>","602","      <PatternLayout>","603","        <pattern>%d %p %C{1.} [%t] %m%n<\/pattern>","604","      <\/PatternLayout>","605","      <TimeBasedTriggeringPolicy \/>","606","    <\/RollingFile>","607","  <\/appenders>","608","  <loggers>","609","    <root level=\"error\">","610","      <appender-ref ref=\"RollingFile\"\/>","611","      <ThreadContextMapFilter onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\" operator=\"or\">","612","        <KeyValuePair key=\"foo\" value=\"bar\"\/>","613","        <KeyValuePair key=\"User2\" value=\"WARN\"\/>","614","      <\/ThreadContextMapFilter>","615","    <\/root>","616","  <\/loggers>","617","<\/configuration>","618","  ]]><\/source>","619","          <\/p>"],"delete":["573","  <DynamicThresholdFilter key=\"loginId\" defaultThreshold=\"ERROR\"","574","                          onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\">","576","  <\/DynamicThresholdFilter>"]}]}},"b70766fc19310a0f1b607c68244286f6b6fc4366":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":[{"add":["230","            throw new ConfigurationException(\"No type attribute provided for Filter \" + key);"],"delete":["230","            throw new ConfigurationException(\"No type attribute provided for Appender \" + key);"]}]}},"8f8371e72aee06e7f1f86eaf04e31efb6ce9cf46":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/CronTriggeringPolicy.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderCronTest.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-cron2.xml":"ADD","log4j-core\/src\/test\/resources\/log4j-rolling-cron.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/CronTriggeringPolicy.java":[{"add":["69","    public CronExpression getCronExpression() {","70","        return cronExpression;","71","    }","72",""],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderCronTest.java":[{"add":["19","import org.apache.logging.log4j.core.appender.RollingFileAppender;","20","import org.apache.logging.log4j.core.util.CronExpression;","29","import java.io.FileOutputStream;","30","import java.io.OutputStream;","31","import java.nio.file.FileSystems;","32","import java.nio.file.Files;","33","import java.nio.file.Path;","39","import static org.junit.Assert.*;","69","        boolean succeeded = false;","73","                succeeded = true;","74","                break;","79","        if (!succeeded) {","80","            fail(\"No compressed files found\");","81","        }","82","        Path src = FileSystems.getDefault().getPath(\"target\/test-classes\/log4j-rolling-cron2.xml\");","83","        OutputStream os = new FileOutputStream(\"target\/test-classes\/log4j-rolling-cron.xml\");","84","        Files.copy(src, os);","85","        Thread.sleep(5000);","86","        \/\/ force a reconfiguration","87","        for (int i = 0; i < MAX_TRIES; ++i) {","88","            logger.debug(\"Adding new event {}\", i);","89","        }","90","        Thread.sleep(1000);","91","        RollingFileAppender app = (RollingFileAppender) ctx.getContext().getConfiguration().getAppender(\"RollingFile\");","92","        TriggeringPolicy policy = app.getManager().getTriggeringPolicy();","93","        assertNotNull(\"No triggering policy\", policy);","94","        assertTrue(\"Incorrect policy type\", policy instanceof CronTriggeringPolicy);","95","        CronExpression expression = ((CronTriggeringPolicy) policy).getCronExpression();","96","        assertTrue(\"Incorrect triggering policy\", expression.getCronExpression().equals(\"* * * ? * *\"));","97",""],"delete":["32","import static org.junit.Assert.assertTrue;","33","import static org.junit.Assert.fail;","66","                return; \/\/ test succeeded","71","        fail(\"No compressed files found\");"]}],"log4j-core\/src\/test\/resources\/log4j-rolling-cron2.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-rolling-cron.xml":[{"add":["18","<Configuration status=\"ERROR\" name=\"RollingCronTest\" monitorInterval=\"1\">"],"delete":["18","<Configuration status=\"ERROR\" name=\"RollingCronTest\">"]}]}},"2e100e0a5e0212b706c81da3f5d410acdcd65049":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["55","    private static final Configuration NULL_CONFIGURATION = new NullConfiguration();","211","            config = NULL_CONFIGURATION;"],"delete":["210","            config = new NullConfiguration();"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-377\" dev=\"rpopma\" type=\"fix\" due-to=\"Roland Weiglhofer, Matt Sicker\">","24","        (OSGi) Fix NPE during shutdown.","25","      <\/action>"],"delete":[]}]}},"afb72074094471f1f7ce9fd0db443ed5f4d2416d":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ParameterizedNoReferenceMessageFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ParameterizedNoReferenceMessageFactory.java":[{"add":["35","     * Message implementation that only keeps a reference to the error text and the error (if any), not to the","36","     * message parameters, in order to avoid memory leaks. This addresses LOG4J2-1368.","37","     * @since 2.6","38","     *\/","39","    static class StatusMessage implements Message {","40","        private final String formattedMessage;","41","        private final Throwable throwable;","42","","43","        public StatusMessage(final String formattedMessage, final Throwable throwable) {","44","            this.formattedMessage = formattedMessage;","45","            this.throwable = throwable;","46","        }","47","","48","        @Override","49","        public String getFormattedMessage() {","50","            return formattedMessage;","51","        }","52","","53","        @Override","54","        public String getFormat() {","55","            return formattedMessage;","56","        }","57","","58","        @Override","59","        public Object[] getParameters() {","60","            return null;","61","        }","62","","63","        @Override","64","        public Throwable getThrowable() {","65","            return throwable;","66","        }","67","    }","68","","69","    \/**","95","        final ParameterizedMessage msg = new ParameterizedMessage(message, params);","96","        return new StatusMessage(msg.getFormattedMessage(), msg.getThrowable());"],"delete":["60","        final String formatted = new ParameterizedMessage(message, params).getFormattedMessage();","61","        return new SimpleMessage(formatted);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1368\" dev=\"rpopma\" type=\"fix\">","27","        (Log4j-internal) StatusLogger dropped exceptions when logging parameterized messages.","28","      <\/action>"],"delete":[]}]}},"1b491d0cef49cda8b804c30ff461558b5aea60ee":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":[{"add":[],"delete":["99","    \/**","100","     * All levels, from most specific to least specific.","101","     *\/","102","    public static final Level[] ALL_LEVELS = {OFF, FATAL, ERROR, WARN, INFO, DEBUG, TRACE, ALL};","103",""]}]}},"b94ed19097b96a5cc8585db50d5d7643c3bce2c7":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketTest.java":"ADD","core\/src\/test\/resources\/log4j-socket.xml":"ADD","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TCPSocketManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketTest.java":[{"add":[],"delete":[]}],"core\/src\/test\/resources\/log4j-socket.xml":[{"add":[],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TCPSocketManager.java":[{"add":["22","import java.io.ByteArrayOutputStream;","27","import java.net.InterfaceAddress;","30","import java.util.concurrent.CountDownLatch;","71","        if (sock == null) {","72","            connector = new Reconnector(this);","73","            connector.setDaemon(true);","74","            connector.setPriority(Thread.MIN_PRIORITY);","75","            connector.start();","76","        }","101","        if (socket == null) {","102","            if (connector != null) {","103","                connector.latch();","104","            }","105","            if (socket == null) {","106","                String msg = \"Error writing to \" + getName() + \" socket not available\";","107","                throw new AppenderRuntimeException(msg);","108","            }","109","        }","142","        public CountDownLatch latch = new CountDownLatch(1);","143","","150","        public void latch()  {","151","            try {","152","                latch.await();","153","            } catch (InterruptedException ex) {","154","                \/\/ Ignore the exception.","155","            }","156","        }","157","","179","                        shutdown = true;","188","                } finally {","189","                    latch.countDown();","216","","217","            InetAddress address;","218","            OutputStream os = null;","220","                address = InetAddress.getByName(data.host);","223","                return null;","224","            }","225","            try {","226","                Socket socket = new Socket(data.host, data.port);","227","                os = socket.getOutputStream();","228","                return new TCPSocketManager(name, os, socket, address, data.host, data.port, data.delay);","231","                os = new ByteArrayOutputStream();","233","            if (data.delay == 0) {","234","                return null;","235","            }","236","            return new TCPSocketManager(name, os, null, address, data.host, data.port, data.delay);"],"delete":["186","                InetAddress address = InetAddress.getByName(data.host);","187","                Socket socket = new Socket(data.host, data.port);","188","                OutputStream os = socket.getOutputStream();","189","                return new TCPSocketManager(name, os, socket, address, data.host, data.port, data.delay);","195","            return null;"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-120\" dev=\"rgoers\" type=\"fix\">","26","        TCPSocketManager would fail if the initial connection could not be established.","27","      <\/action>","28","      <action issue=\"LOG4J2-119\" dev=\"rgoers\" type=\"fix\">","29","        A broken socket connection would cause the TCPSocketManager to continuously reconnect.","30","      <\/action>"],"delete":[]}]}},"84d7077b9d5e37a6e32b20587100ff975edacabb":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":[{"add":["98","            return; \/\/ commons compress cannot deflate zip and xz? TODO test decompressing these formats"],"delete":["98","            return; \/\/ commons compress cannot deflate zip and xy? TODO test decompressing these formats"]}]}},"3542dae359052b5b0db75c4e4a7217ba7c910a4e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerDisruptor.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerDisruptor.java":[{"add":["181","            LOGGER.warn(\"Ignoring log event after log4j was shut down\");\r","195","            LOGGER.warn(\"[{}] Ignoring log event after log4j was shut down.\", contextName);\r"],"delete":["181","            LOGGER.error(\"Ignoring log event after log4j was shut down\");\r","195","            LOGGER.error(\"[{}] Ignoring log event after log4j was shut down.\", contextName);\r"]}]}},"ee2d6dcf28fe07f88ad930e039d7255db50bf2b8":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RootThrowablePatternConverter.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["1040","      <action issue=\"LOG4J2-2195\" dev=\"ggregory\" type=\"fix\" due-to=\"Raman Gupta, Gary Gregory\">","1043","      <action issue=\"LOG4J2-2221\" dev=\"ggregory\" type=\"fix\" due-to=\"Raman Gupta, Gary Gregory\">","1044","        RootThrowablePatternConverter does not use TextRenderer or line separator options.","1045","      <\/action>"],"delete":["1040","      <action issue=\"LOG4J2-2195\" dev=\"ggregory\" type=\"add\" due-to=\"Raman Gupta, Gary Gregory\">"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RootThrowablePatternConverter.java":[{"add":["70","            final String trace = proxy.getCauseStackTraceAsString(options.getIgnorePackages(), options.getTextRenderer(), getSuffix(event), options.getSeparator());"],"delete":["70","            final String suffix = getSuffix(event);","71","            final String trace = proxy.getCauseStackTraceAsString(options.getIgnorePackages(), suffix);"]}]}},"16e73c9f44e3a673cea61a7644f51362bd91dd31":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/EventParameterMemoryLeakTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/ReusableParameterizedMessageMemoryLeakTest.java":"ADD","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ReusableParameterizedMessage.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/GarbageCollectionHelper.java":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/EventParameterMemoryLeakTest.java":[{"add":[],"delete":["18","import com.google.common.io.ByteStreams;","26","import java.io.Closeable;","29","import java.io.IOException;","30","import java.io.OutputStream;","33","import java.util.concurrent.atomic.AtomicBoolean;","120","","121","    private static final class GarbageCollectionHelper implements Closeable, Runnable {","122","        private static final OutputStream sink = ByteStreams.nullOutputStream();","123","        public final AtomicBoolean running = new AtomicBoolean();","124","        private final CountDownLatch latch = new CountDownLatch(1);","125","        private final Thread gcThread = new Thread(new Runnable() {","126","            @Override","127","            public void run() {","128","                try {","129","                    while (running.get()) {","130","                        \/\/ Allocate data to help suggest a GC","131","                        try {","132","                            \/\/ 1mb of heap","133","                            sink.write(new byte[1024 * 1024]);","134","                        } catch (IOException ignored) {","135","                        }","136","                        \/\/ May no-op depending on the jvm configuration","137","                        System.gc();","138","                    }","139","                } finally {","140","                    latch.countDown();","141","                }","142","            }","143","        });","144","","145","        @Override","146","        public void run() {","147","            if (running.compareAndSet(false, true)) {","148","                gcThread.start();","149","            }","150","        }","151","","152","        @Override","153","        public void close() {","154","            running.set(false);","155","            try {","156","                assertTrue(\"GarbageCollectionHelper did not shut down cleanly\",","157","                        latch.await(10, TimeUnit.SECONDS));","158","            } catch (InterruptedException e) {","159","                throw new RuntimeException(e);","160","            }","161","        }","162","    }"]}],"src\/changes\/changes.xml":[{"add":["45","      <action issue=\"LOG4J2-2201\" dev=\"ckozak\" type=\"fix\">","46","        Fix memory leak in ReusableParameterizedMessage.","47","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/ReusableParameterizedMessageMemoryLeakTest.java":[{"add":[],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ReusableParameterizedMessage.java":[{"add":["75","                    \/\/ Do not retain references to objects in the reusable params array.","76","                    for (int i = 0; i < argCount; i++) {","77","                        params[i] = null;","78","                    }"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/GarbageCollectionHelper.java":[{"add":[],"delete":[]}]}},"1f27d85de74ee364ecd96957fce029dc968ab177":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ReusableParameterizedMessage.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ReusableParameterizedMessage.java":[{"add":["35","    private transient ThreadLocal<StringBuilder> buffer; \/\/ non-static: LOG4J2-1583"],"delete":["35","    private ThreadLocal<StringBuilder> buffer; \/\/ non-static: LOG4J2-1583"]}]}},"05734e0baee08f679378de43278c868d1c44d323":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppenderTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/Route.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":"MODIFY","core\/src\/test\/resources\/log4j-routing.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Node.java":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppenderTest.java":[{"add":["79","        msg = new StructuredDataMessage(\"Test\", \"This is a test\", \"Alert\");","81","        File file = new File(\"target\/routing1\/routingtest-Alert.log\");","82","        assertTrue(\"Alert file was not created\", file.exists());","83","        msg = new StructuredDataMessage(\"Test\", \"This is a test\", \"Activity\");","84","        EventLogger.logEvent(msg);","85","        file = new File(\"target\/routing1\/routingtest-Activity.log\");","86","        assertTrue(\"Activity file was not created\", file.exists());"],"delete":["79","        msg = new StructuredDataMessage(\"Test\", \"This is a test\", \"Unknown\");","81","        File file = new File(\"target\/rolling1\/rollingtest-Unknown.log\");","82","        assertTrue(\"File was not created\", file.exists());"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/Route.java":[{"add":["73","        } else if (node != null) {","74","            sb.append(\"dynamic - type=\").append(node.getName());","76","            sb.append(\"invalid Route\");"],"delete":["74","            sb.append(\"dynamic\");"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-129\" dev=\"rgoers\" type=\"fix\">","26","        RoutingAppender was only creating a single appender for the default Route.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/routing\/RoutingAppender.java":[{"add":["48","    private final Route defaultRoute;","59","        Route defRoute = null;","60","        for (Route route : routes.getRoutes()) {","61","            if (route.getKey() == null) {","62","                if (defRoute == null) {","63","                    defRoute = route;","64","                } else {","65","                    error(\"Multiple default routes. Route \" + route.toString() + \" will be ignored\");","66","                }","67","            }","68","        }","69","        defaultRoute = defRoute;","75","        \/\/ Register all the static routes.","80","                    String key = route == defaultRoute ? DEFAULT_KEY : route.getKey();","81","                    appenders.put(key, new AppenderControl(appender, null, null));","96","            if (!map.containsKey(name)) {","126","            route = defaultRoute;","144","                Node appNode = new Node(node);","145","                config.createConfiguration(appNode, event);","146","                if (appNode.getObject() instanceof Appender) {","147","                    Appender app = (Appender) appNode.getObject();","149","                    return app;"],"delete":["67","                    String key = route.getKey() == null ? DEFAULT_KEY : route.getKey();","68","                    if (appenders.containsKey(key)) {","69","                        if (DEFAULT_KEY.equals(key)) {","70","                            LOGGER.error(\"Multiple default routes. Only the first will be used\");","71","                        } else {","72","                            LOGGER.error(\"Duplicate route \" + key + \" is ignored\");","73","                        }","74","                    } else {","75","                        appenders.put(key, new AppenderControl(appender, null, null));","76","                    }","91","            if (!DEFAULT_KEY.equals(entry.getKey()) && !map.containsKey(name)) {","110","        boolean defaultRoute = false;","122","            control = appenders.get(DEFAULT_KEY);","123","            if (control != null) {","124","                return control;","125","            }","126","            for (Route r : routes.getRoutes()) {","127","                if (r.getAppenderRef() == null && r.getKey() == null) {","128","                    route = r;","129","                    defaultRoute = true;","130","                    break;","131","                }","132","            }","141","            if (defaultRoute) {","142","                appenders.put(DEFAULT_KEY, control);","143","            }","153","                config.createConfiguration(node, event);","154","                if (node.getObject() instanceof Appender) {","155","                    Appender app = (Appender) node.getObject();","157","                    return (Appender) node.getObject();"]}],"core\/src\/test\/resources\/log4j-routing.xml":[{"add":["20","    <property name=\"filename\">target\/routing1\/routingtest-$${sd:type}.log<\/property>","34","          <RollingFile name=\"Routing-${sd:type}\" fileName=\"${filename}\"","35","                       filePattern=\"target\/routing1\/test1-${sd:type}.%i.log.gz\">"],"delete":["20","    <property name=\"filename\">target\/rolling1\/rollingtest-$${sd:type}.log<\/property>","34","          <RollingFile name=\"Rolling-${sd:type}\" fileName=\"${filename}\"","35","                       filePattern=\"target\/rolling1\/test1-${sd:type}.%i.log.gz\">"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Node.java":[{"add":["59","    public Node(Node node) {","60","        this.parent = node.parent;","61","        this.name = node.name;","62","        this.type = node.type;","63","        this.attributes.putAll(node.getAttributes());","64","        this.value = node.getValue();","65","        this.children.addAll(node.getChildren());","66","        this.object = node.object;","67","    }","68",""],"delete":[]}]}},"9f7acbc4fcdc186b9fe5a7bb2c487e8b1ea910a9":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":"MODIFY","core\/src\/test\/resources\/log4j-test2.xml":"MODIFY","jcl-bridge\/src\/test\/resources\/log4j-test1.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RootThrowablePatternConverter.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LiteralPatternConverter.java":"MODIFY","src\/site\/xdoc\/manual\/layouts.xml.vm":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ThrowablePatternConverter.java":"MODIFY","slf4j-impl\/src\/test\/resources\/log4j-test1.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ExtendedThrowablePatternConverter.java":[{"add":["47","    private ExtendedThrowablePatternConverter(final String[] options) {","98","        if (throwable != null && lines > 0) {","109","            if (lines != Integer.MAX_VALUE) {","112","                int limit = lines > array.length ? array.length : lines;","113","                for (int i = 0; i < limit; ++i) {"],"delete":["47","    private ExtendedThrowablePatternConverter(final String[] options) {        ","98","        if (throwable != null) {","109","            if (lines > 0) {","112","                for (int i = 0; i < lines; ++i) {"]}],"core\/src\/test\/resources\/log4j-test2.xml":[{"add":["49","    <List name=\"NoThrowable\">","50","      <PatternLayout pattern=\"%d %p %C{1.} [%t] %m%n%ex{0}\"\/>","51","    <\/List>","66","","67","    <logger name=\"org.apache.logging.log4j.nothrown\" level=\"debug\" additivity=\"false\">","68","      <appender-ref ref=\"NoThrowable\"\/>","69","    <\/logger>","70","","71",""],"delete":[]}],"jcl-bridge\/src\/test\/resources\/log4j-test1.xml":[{"add":["20","      <PatternLayout pattern=\"%C{1.} %m MDC%X%n%ex{0}\"\/>"],"delete":["20","      <PatternLayout pattern=\"%C{1.} %m MDC%X%n\"\/>"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-130\" dev=\"rgoers\" type=\"fix\">","26","        PatternLayout should format throwables without requiring a converter.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/RootThrowablePatternConverter.java":[{"add":["99","        if (throwable != null && lines > 0) {","110","            if (lines != Integer.MAX_VALUE) {","113","                int limit = lines > array.length ? array.length : lines;","114","                for (int i = 0; i < limit; ++i) {"],"delete":["99","        if (throwable != null) {","110","            if (lines > 0) {","113","                for (int i = 0; i < lines; ++i) {"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":[{"add":["105","        formatters = parser.parse((pattern == null) ? DEFAULT_CONVERSION_PATTERN : pattern, true);"],"delete":["82","    \/**","83","     * True if any element in pattern formats information from exceptions.","84","     *\/","85","    private boolean handlesExceptions;","109","        formatters = parser.parse((pattern == null) ? DEFAULT_CONVERSION_PATTERN : pattern);","110","        handlesExceptions = parser.handlesExceptions();","127","        handlesExceptions = parser.handlesExceptions();"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LiteralPatternConverter.java":[{"add":["69","","70","    public String getLiteral() {","71","        return literal;","72","    }"],"delete":[]}],"src\/site\/xdoc\/manual\/layouts.xml.vm":[{"add":["107","          <p>","108","            If the pattern string does not contain a specifier to handle a Throwable being logged, parsing of the","109","            pattern will act as if the \"%xEx\" specifier had be added to the end of the string. To suppress","110","            formatting of the Throwable completely simply add \"%ex{0}\" as a specifier in the pattern string.","111","          <\/p>","277","                <b>ex<\/b>{[\"none\"|\"short\"|\"full\"|depth]}<br \/>","278","                <b>exception<\/b>{[\"none\"|\"short\"|\"full\"|depth]}<br \/>","279","                <b>throwable<\/b>{[\"none\"|\"short\"|\"full\"|depth]}","288","                  the first n lines of the stacktrace will be printed. Specifying <b>%throwable{none}<\/b>","289","                  or <b>%throwable{0}<\/b> will suppress printing of the exception.","578","                <b>rEx<\/b>[\"none\"|\"short\"|\"full\"|depth],[filters(packages)}<br \/>","579","                <b>rException<\/b>[\"none\"|\"short\"|\"full\"|depth],[filters(packages)}<br \/>","580","                <b>rThrowable<\/b>[\"none\"|\"short\"|\"full\"|depth],[filters(packages)}","591","                  be suppressed from stack traces. Specifying <b>%rEx{none}<\/b>","592","                  or <b>%rEx{0}<\/b> will suppress printing of the exception.","784","                <b>xEx<\/b>{\"none\"|\"short\"|\"full\"|depth],[filters(packages)}<br \/>","785","                <b>xException<\/b>[\"none\"|\"short\"|\"full\"|depth],[filters(packages)}<br \/>","786","                <b>xThrowable<\/b>[\"none\"|\"short\"|\"full\"|depth],[filters(packages)}","801","                  be suppressed from stack traces. Specifying <b>%xEx{none}<\/b>","802","                  or <b>%xEx{0}<\/b> will suppress printing of the exception."],"delete":["107","","273","                <b>ex<\/b>{[\"short\"|\"full\"|depth]}<br \/>","274","                <b>exception<\/b>{[\"short\"|\"full\"|depth]}<br \/>","275","                <b>throwable<\/b>{[\"short\"|\"full\"|depth]}","284","                  the first n lines of the stacktrace will be printed.","573","                <b>rEx<\/b>[\"short\"|\"full\"|depth],[filters(packages)}<br \/>","574","                <b>rException<\/b>[\"short\"|\"full\"|depth],[filters(packages)}<br \/>","575","                <b>rThrowable<\/b>[\"short\"|\"full\"|depth],[filters(packages)}","586","                  be suppressed from stack traces.","778","                <b>xEx<\/b>{[\"short\"|\"full\"|depth],[filters(packages)}<br \/>","779","                <b>xException<\/b>[\"short\"|\"full\"|depth],[filters(packages)}<br \/>","780","                <b>xThrowable<\/b>[\"short\"|\"full\"|depth],[filters(packages)}","795","                  be suppressed from stack traces."]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerTest.java":[{"add":["54","    private static ListAppender noThrown;","78","            } else if (entry.getKey().equals(\"NoThrowable\")) {","79","                noThrown = (ListAppender) entry.getValue();","194","    public void testImpliedThrowable() {","195","        final org.apache.logging.log4j.Logger testLogger = LogManager.getLogger(\"org.apache.logging.log4j.hosttest\");","196","        testLogger.debug(\"This is a test\", new Throwable(\"Testing\"));","197","        final List<String> msgs = host.getMessages();","198","        assertTrue(\"Incorrect number of messages. Expected 1, actual \" + msgs.size(), msgs.size() == 1);","199","        String expected = \"java.lang.Throwable: Testing\";","200","        assertTrue(\"Incorrect message data\", msgs.get(0).contains(expected));","201","    }","202","","203","","204","    @Test","205","    public void testSuppressedThrowable() {","206","        final org.apache.logging.log4j.Logger testLogger = LogManager.getLogger(\"org.apache.logging.log4j.nothrown\");","207","        testLogger.debug(\"This is a test\", new Throwable(\"Testing\"));","208","        final List<String> msgs = noThrown.getMessages();","209","        assertTrue(\"Incorrect number of messages. Expected 1, actual \" + msgs.size(), msgs.size() == 1);","210","        String suppressed = \"java.lang.Throwable: Testing\";","211","        assertTrue(\"Incorrect message data\", !msgs.get(0).contains(suppressed));","212","    }","213","","214","","215","    @Test"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/ThrowablePatternConverter.java":[{"add":["34","    protected static final String NONE = \"none\";","63","        int count = Integer.MAX_VALUE;","67","            } else if (option.equalsIgnoreCase(NONE)) {","68","                count = 0;","99","        if (t != null && lines > 0) {","106","            if (lines != Integer.MAX_VALUE) {","109","                int limit = lines > array.length ? array.length : lines;","110","                for (int i = 0; i < limit; ++i) {"],"delete":["62","        int count = 0;","96","        if (t != null) {","103","            if (lines > 0) {","106","                for (int i = 0; i < lines; ++i) {"]}],"slf4j-impl\/src\/test\/resources\/log4j-test1.xml":[{"add":["20","      <PatternLayout pattern=\"%C{1.} %m MDC%X%n%ex{0}\"\/>"],"delete":["20","      <PatternLayout pattern=\"%C{1.} %m MDC%X%n\"\/>"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["123","        return parse(pattern, false);","124","    }","125","","126","","127","    public List<PatternFormatter> parse(final String pattern, boolean handleExceptions) {","135","        boolean handlesExceptions = false;","154","        if (handleExceptions && !handlesExceptions) {","155","            LogEventPatternConverter pc = ExtendedThrowablePatternConverter.newInstance(null);","156","            list.add(new PatternFormatter(pc, FormattingInfo.getDefault()));","157","        }"],"delete":["80","    \/**","81","     * Does pattern process exceptions.","82","     *\/","83","    private boolean handlesExceptions;","84","","127","","157","    public boolean handlesExceptions() {","158","        return handlesExceptions;","159","    }","160",""]}]}},"50322a666422a89d9523e69b608f6ae3fa2245a2":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":[{"add":["151","        if ( url == null ) {","152","        \tthis.data = data;","153","        }"],"delete":[]}]}},"d69ca4375fe4581f3022a8c8fffaea349dab4a3a":{"changes":{"src\/site\/xdoc\/manual\/layouts.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverter.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverterTest.java":"ADD"},"diff":{"src\/site\/xdoc\/manual\/layouts.xml":[{"add":["259","                    <\/tr>","260","                  <\/table>","513","                <b>p{level name mapping}<\/b><br \/>","514","                <b>level{level name mapping}<\/b>","516","              <td>Outputs the level of the logging event. A level name mapping map be provided in the form","517","                \"level=value, level=value\" where level is the name of the Level and value is the value that","518","                should be displayed instead of the name of the Level.<\/td>"],"delete":["259","                    <\/tr>                    ","260","                  <\/table>                 ","513","                <b>p<\/b><br \/>","514","                <b>level<\/b>","516","              <td>Outputs the level of the logging event.<\/td>"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverter.java":[{"add":["22","import java.util.EnumMap;","23","","34","    private static final LevelPatternConverter INSTANCE = new LevelPatternConverter(null);","35","","36","    private final EnumMap<Level, String> levelMap;","41","    private LevelPatternConverter(EnumMap<Level, String> map) {","43","        this.levelMap = map;","49","     * @param options options, may be null. May contain a list of level names and","50","     * The value that should be displayed for the Level.","53","    public static LevelPatternConverter newInstance(final String[] options) {","54","        if (options == null || options.length == 0) {","55","            return INSTANCE;","56","        }","57","        EnumMap<Level, String> levelMap = new EnumMap<Level, String>(Level.class);","58","        String[] definitions = options[0].split(\",\");","59","        for (String def : definitions) {","60","            String[] pair = def.split(\"=\");","61","            if (pair == null || pair.length != 2) {","62","                LOGGER.error(\"Invalid option {}\", def);","63","                continue;","64","            }","65","            Level level = Level.toLevel(pair[0].trim().toUpperCase(), null);","66","            if (level == null) {","67","                LOGGER.error(\"Invalid Level {}\", pair[0].trim());","68","            }","69","            levelMap.put(level, pair[1].trim());","70","        }","71","        if (levelMap.size() == 0) {","72","            return INSTANCE;","73","        }","74","        for (Level level : Level.values()) {","75","            if (!levelMap.containsKey(level)) {","76","                levelMap.put(level, level.toString());","77","            }","78","        }","79","        return new LevelPatternConverter(levelMap);","87","        output.append(levelMap == null ? event.getLevel().toString() : levelMap.get(event.getLevel()));"],"delete":["32","    private static final LevelPatternConverter INSTANCE =","33","        new LevelPatternConverter();","38","    private LevelPatternConverter() {","45","     * @param options options, may be null.","48","    public static LevelPatternConverter newInstance(","49","        final String[] options) {","50","        return INSTANCE;","58","        output.append(event.getLevel().toString());"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-105\" dev=\"rgoers\" type=\"update\">","26","        Add ability to customize the names of the Levels in the LevelPatternConverter.","27","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverterTest.java":[{"add":[],"delete":[]}]}},"60bcf168d45eb930e84d3eee9d3ed11d2f2da2ef":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ParameterFormatter.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["158","      <action issue=\"LOG4J2-1599\" dev=\"ggregory\" type=\"fix\">","159","        NPE in org.apache.logging.log4j.message.ParameterFormatter.formatMessage3(StringBuilder, char[], int, Object[], int, int[]).","160","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ParameterFormatter.java":[{"add":["202","        if (messagePattern == null) {","203","            return;","204","        }","205","        if (arguments == null || argCount == 0) {"],"delete":["202","        if (messagePattern == null || arguments == null || argCount == 0) {"]}]}},"d2747d6bd188dcb34acf4db9102f98ecbed4e094":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["47","import org.apache.logging.log4j.core.async.DaemonThreadFactory;","176","            executorService = new ScheduledThreadPoolExecutor(1, new DaemonThreadFactory(\"Log4j2ConfigWatcher-\"));"],"delete":["175","            executorService = new ScheduledThreadPoolExecutor(1);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1166\" dev=\"rpopma\" type=\"fix\">","27","        AbstractConfiguration executor should use a DaemonThreadFactory.","28","      <\/action>","190","      <action issue=\"LOG4J2-1074\" dev=\"rpopma\" type=\"add\">"],"delete":["187","      <action issue=\"LOG4J2-1076\" dev=\"rpopma\" type=\"add\">"]}]}},"b9a6ccd02ca7b02ed96f342e11c3c422b7bd7c29":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppenderEventDispatcher.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppenderTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppenderEventDispatcher.java":[{"add":["52","        this.setDaemon(true);"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppenderTest.java":[{"add":["31","import java.util.stream.Collectors;","77","","78","        List<Thread> backgroundThreads = Thread.getAllStackTraces().keySet().stream()","79","                .filter(AsyncAppenderEventDispatcher.class::isInstance)","80","                .collect(Collectors.toList());","81","        assertFalse(backgroundThreads.isEmpty(), \"Failed to locate background thread\");","82","        for (Thread thread : backgroundThreads) {","83","            assertTrue(thread.isDaemon(), \"AsyncAppender should use daemon threads\");","84","        }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3102\" dev=\"ckozak\" type=\"fix\">","72","        Fix a regression in 2.14.1 which allowed the AsyncAppender background thread to keep the JVM alive because","73","        the daemon flag was not set.","74","      <\/action>"],"delete":[]}]}},"902dffe71b3cb3e7766a5b6db7951b9f02bcda8c":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3103\" dev=\"ckozak\" type=\"fix\" due-to=\"Mike Glazer\">","72","        Fix race condition which can result in ConcurrentModificationException on context.stop.","73","      <\/action>"],"delete":[]}]}},"219f5cde862ee4316ab24246e8c5723c5715e77a":{"changes":{"log4j-osgi\/pom.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-osgi\/core-osgi-legacy-api\/pom.xml":"ADD"},"diff":{"log4j-osgi\/pom.xml":[{"add":["0","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r","1","<!--\r","2"," Licensed to the Apache Software Foundation (ASF) under one or more\r","3"," contributor license agreements.  See the NOTICE file distributed with\r","4"," this work for additional information regarding copyright ownership.\r","5"," The ASF licenses this file to You under the Apache License, Version 2.0\r","6"," (the \"License\"); you may not use this file except in compliance with\r","7"," the License.  You may obtain a copy of the License at\r","8","\r","9","      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\r","10","\r","11"," Unless required by applicable law or agreed to in writing, software\r","12"," distributed under the License is distributed on an \"AS IS\" BASIS,\r","13"," WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r","14"," See the License for the specific language governing permissions and\r","15"," limitations under the License.\r","16","-->\r","17","<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/maven-v4_0_0.xsd\">\r","18","  <modelVersion>4.0.0<\/modelVersion>\r","19","  <parent>\r","20","    <groupId>org.apache.logging.log4j<\/groupId>\r","21","    <artifactId>log4j<\/artifactId>\r","22","    <version>2.0RC1-SNAPSHOT<\/version>\r","23","    <relativePath>..\/<\/relativePath>\r","24","  <\/parent>\r","25","  <groupId>org.apache.logging.log4j.osgi<\/groupId>\r","26","  <artifactId>log4j-osgi<\/artifactId>\r","27","  <packaging>pom<\/packaging>\r","28","  <name>Apache Log4J Core OSGi Bundles<\/name>\r","29","  <description>Apache Log4J OSGi Bundles<\/description>\r","30","  <properties>\r","31","    <log4jParentDir>${basedir}\/..<\/log4jParentDir>\r","32","    <docLabel>Core Documentation<\/docLabel>\r","33","    <projectDir>\/core<\/projectDir>\r","34","  <\/properties>\r","35","  <dependencies>\r","36","    <dependency>\r","37","      <groupId>org.apache.logging.log4j<\/groupId>\r","38","      <artifactId>log4j-core<\/artifactId>\r","39","    <\/dependency>\r","40","  <\/dependencies>\r","41","  <modules>\r","42","    <module>core-osgi-async<\/module>\r","43","    <module>core-osgi-jpa<\/module>\r","44","    <module>core-osgi-legacy-api<\/module>\r","45","    <module>core-osgi-net<\/module>\r","46","    <module>core-osgi-nosql-couch<\/module>\r","47","    <module>core-osgi-nosql-mongo<\/module>\r","48","    <module>core-osgi-reduced<\/module>\r","49","  <\/modules>\r","50","<\/project>\r","51","\r"],"delete":["0","<?xml version=\"1.0\" encoding=\"UTF-8\"?>","1","<!--","2"," Licensed to the Apache Software Foundation (ASF) under one or more","3"," contributor license agreements.  See the NOTICE file distributed with","4"," this work for additional information regarding copyright ownership.","5"," The ASF licenses this file to You under the Apache License, Version 2.0","6"," (the \"License\"); you may not use this file except in compliance with","7"," the License.  You may obtain a copy of the License at","8","","9","      http:\/\/www.apache.org\/licenses\/LICENSE-2.0","10","","11"," Unless required by applicable law or agreed to in writing, software","12"," distributed under the License is distributed on an \"AS IS\" BASIS,","13"," WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","14"," See the License for the specific language governing permissions and","15"," limitations under the License.","16","-->","17","<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/maven-v4_0_0.xsd\">","18","  <modelVersion>4.0.0<\/modelVersion>","19","  <parent>","20","    <groupId>org.apache.logging.log4j<\/groupId>","21","    <artifactId>log4j<\/artifactId>","22","    <version>2.0RC1-SNAPSHOT<\/version>","23","    <relativePath>..\/<\/relativePath>","24","  <\/parent>","25","  <groupId>org.apache.logging.log4j.osgi<\/groupId>","26","  <artifactId>log4j-osgi<\/artifactId>","27","  <packaging>pom<\/packaging>","28","  <name>Apache Log4J Core OSGi Bundles<\/name>","29","  <description>Apache Log4J OSGi Bundles<\/description>","30","  <properties>","31","    <log4jParentDir>${basedir}\/..<\/log4jParentDir>","32","    <docLabel>Core Documentation<\/docLabel>","33","    <projectDir>\/core<\/projectDir>","34","  <\/properties>","35","  <dependencies>","36","    <dependency>","37","      <groupId>org.apache.logging.log4j<\/groupId>","38","      <artifactId>log4j-core<\/artifactId>","39","    <\/dependency>","40","  <\/dependencies>","41","  <modules>","42","    <module>core-osgi-async<\/module>","43","    <module>core-osgi-jpa<\/module>","44","    <module>core-osgi-net<\/module>","45","    <module>core-osgi-nosql-couch<\/module>","46","    <module>core-osgi-nosql-mongo<\/module>","47","    <module>core-osgi-reduced<\/module>","48","  <\/modules>","49","<\/project>","50",""]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-345\" dev=\"rpopma\" type=\"fix\" due-to=\"Roland Weiglhofer, Matt Sicker\">","24","        (OSGi) logging.log4j-1.2-api doesn't export the log4j API 1.2. Dependent bundles can not be resolved.","25","      <\/action>"],"delete":[]}],"log4j-osgi\/core-osgi-legacy-api\/pom.xml":[{"add":[],"delete":[]}]}},"039dc629741c041e724eac399deb796856f16e9c":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/NetUtilsTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/NetUtilsTest.java":[{"add":["25","import org.junit.Assume;\r","30","    private static final boolean IS_WINDOWS = System.getProperty(\"os.name\").startsWith(\"Windows\");\r","31","\r","42","    public void testToUriWindowsWithBackslashes() throws URISyntaxException {\r","43","        Assume.assumeTrue(IS_WINDOWS);\r","53","        Assume.assumeTrue(IS_WINDOWS);\r"],"delete":["39","    public void testToUriWithBackslashes() throws URISyntaxException {\r"]}]}},"8d42a1a64ac79eca0644e660f1cbca39b1cc7320":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/DeletingVisitorTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/SortingVisitorTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/SortingVisitor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/DeletingVisitor.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/DeletingVisitorTest.java":[{"add":["20","import java.nio.file.FileVisitResult;","21","import java.nio.file.NoSuchFileException;","27","import java.util.Collections;","137","","138","    @Test","139","    public void testNoSuchFileFailure() throws IOException {","140","        final DeletingVisitorHelper visitor =","141","                new DeletingVisitorHelper(Paths.get(\"\/a\/b\/c\"), Collections.emptyList(), true);","142","        assertEquals(","143","                FileVisitResult.CONTINUE,","144","                visitor.visitFileFailed(Paths.get(\"doesNotExist\"), new NoSuchFileException(\"doesNotExist\")));","145","    }","146","","147","    @Test","148","    public void testIOException() {","149","        final DeletingVisitorHelper visitor =","150","                new DeletingVisitorHelper(Paths.get(\"\/a\/b\/c\"), Collections.emptyList(), true);","151","        IOException exception = new IOException();","152","        try {","153","            visitor.visitFileFailed(Paths.get(\"doesNotExist\"), exception);","154","            fail();","155","        } catch (IOException e) {","156","            assertSame(exception, e);","157","        }","158","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["35","      <action issue=\"LOG4J2-2677\" dev=\"ckozak\" type=\"fix\">","36","        Rollover handles parallel file deletion gracefully.","37","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/SortingVisitorTest.java":[{"add":["19","import java.io.IOException;","21","import java.nio.file.FileVisitResult;","23","import java.nio.file.NoSuchFileException;","25","import java.nio.file.Paths;","97","","98","    @Test","99","    public void testNoSuchFileFailure() throws IOException {","100","        SortingVisitor visitor = new SortingVisitor(new PathSortByModificationTime(false));","101","        assertEquals(","102","                FileVisitResult.CONTINUE,","103","                visitor.visitFileFailed(Paths.get(\"doesNotExist\"), new NoSuchFileException(\"doesNotExist\")));","104","    }","105","","106","    @Test","107","    public void testIOException() {","108","        SortingVisitor visitor = new SortingVisitor(new PathSortByModificationTime(false));","109","        IOException exception = new IOException();","110","        try {","111","            visitor.visitFileFailed(Paths.get(\"doesNotExist\"), exception);","112","            fail();","113","        } catch (IOException e) {","114","            assertSame(exception, e);","115","        }","116","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/SortingVisitor.java":[{"add":["19","import org.apache.logging.log4j.Logger;","20","import org.apache.logging.log4j.status.StatusLogger;","21","","24","import java.nio.file.NoSuchFileException;","38","    private static final Logger LOGGER = StatusLogger.getLogger();","58","    @Override","59","    public FileVisitResult visitFileFailed(Path file, IOException ioException) throws IOException {","60","        \/\/ LOG4J2-2677: Appenders may rollover and purge in parallel. SimpleVisitor rethrows exceptions from","61","        \/\/ failed attempts to load file attributes.","62","        if (ioException instanceof NoSuchFileException) {","63","            LOGGER.info(\"File {} could not be accessed, it has likely already been deleted\", file, ioException);","64","            return FileVisitResult.CONTINUE;","65","        } else {","66","            return super.visitFileFailed(file, ioException);","67","        }","68","    }","69",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/DeletingVisitor.java":[{"add":["22","import java.nio.file.NoSuchFileException;","78","    @Override","79","    public FileVisitResult visitFileFailed(Path file, IOException ioException) throws IOException {","80","        \/\/ LOG4J2-2677: Appenders may rollover and purge in parallel. SimpleVisitor rethrows exceptions from","81","        \/\/ failed attempts to load file attributes.","82","        if (ioException instanceof NoSuchFileException) {","83","            LOGGER.info(\"File {} could not be accessed, it has likely already been deleted\", file, ioException);","84","            return FileVisitResult.CONTINUE;","85","        } else {","86","            return super.visitFileFailed(file, ioException);","87","        }","88","    }","89",""],"delete":[]}]}},"19ffff4edb18d9071c48428575a71d73f66bf9b0":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":[{"add":["370","                if (attr.getName().equals(\"xml:base\")) {","371","                    continue;","372","                }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-342\" dev=\"rgoers\" type=\"fix\">","24","        Ignore xml:base attributes.","25","      <\/action>"],"delete":[]}]}},"dc5b6b912623a68828c31fc58d0dd9a79282e484":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginValueVisitor.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2693\" dev=\"mattsicker\" type=\"fix\">","33","        @PluginValue does not support attribute names besides \"value\".","34","      <\/action>","35","      <action issue=\"LOG4J2-2647\" dev=\"mattsicker\" type=\"fix\">","36","        Validation blocks definition of script in properties configuration.","37","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/visitors\/PluginValueVisitor.java":[{"add":["39","        final String attributeValue = node.getAttributes().get(name);","49","            rawValue = removeAttributeValue(node.getAttributes(), name);"],"delete":["39","        final String attributeValue = node.getAttributes().get(\"value\");","49","            rawValue = removeAttributeValue(node.getAttributes(), \"value\");"]}]}},"de53ede55de758ba164c5bc260b05a1adfde8d0d":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["114","      <action issue=\"LOG4J2-2499\" dev=\"ggregory\" type=\"fix\">","115","        JMS Appender may throw a NullPointerException when JMS is not up while the Appender is starting.","116","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsManager.java":[{"add":["452","                if (messageProducer == null) {","453","                    throw new AppenderLoggingException(","454","                            \"Error sending to JMS Manager '\" + getName() + \"': JMS message producer not available\");","455","                }","478","                                String.format(\"Error sending to %s after reestablishing JMS connection for %s\",","479","                                        getName(), configuration),"],"delete":["452","            }","453","            if (messageProducer == null) {","454","                throw new AppenderLoggingException(","455","                        \"Error sending to JMS Manager '\" + getName() + \"': JMS message producer not available\");","478","                                String.format(\"Error sending to %s after reestablishing JMS connection for %s\", getName(),","479","                                        configuration),"]}]}},"d24e0ee57501e50756e51f91618e6091d9bd5903":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424LayoutTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-158\" dev=\"rgoers\" due-to=\"Scott Severtson\">","26","        Add RFC 5424 compliant escaping rules to RFC5424Layout.","27","      <\/action>"],"delete":["25",""]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424LayoutTest.java":[{"add":["53","    private static final String lineEscaped3 = \"ATM - - [RequestContext@3692 escaped=\\\"Testing escaping #012 \\\\\\\" \\\\] \\\\\\\"\\\" loginId=\\\"JohnDoe\\\"] filled mdc\";","54","    private static final String lineEscaped4 = ","55","        \"ATM - Audit [Transfer@18060 Amount=\\\"200.00\\\" FromAccount=\\\"123457\\\" ToAccount=\\\"123456\\\"]\" +","56","        \"[RequestContext@18060 escaped=\\\"Testing escaping #012 \\\\\\\" \\\\] \\\\\\\"\\\" ipAddress=\\\"192.168.0.120\\\" loginId=\\\"JohnDoe\\\"] Transfer Complete\";","138","     * Test case for escaping newlines and other SD PARAM-NAME special characters.","139","     *\/","140","    @Test","141","    public void testEscape() throws Exception {","142","        for (final Appender appender : root.getAppenders().values()) {","143","            root.removeAppender(appender);","144","        }","145","        \/\/ set up appender","146","        final AbstractStringLayout layout = RFC5424Layout.createLayout(\"Local0\", \"Event\", \"3692\", \"true\", \"RequestContext\",","147","            \"true\", \"#012\", \"ATM\", null, \"key1, key2, locale\", null, \"loginId\", null, null, null);","148","        final ListAppender appender = new ListAppender(\"List\", null, layout, true, false);","149","","150","        appender.start();","151","","152","        \/\/ set appender on root and set level to debug","153","        root.addAppender(appender);","154","        root.setLevel(Level.DEBUG);","155","        ","156","        ThreadContext.put(\"loginId\", \"JohnDoe\");","157","","158","        \/\/ output starting message","159","        root.debug(\"starting mdc pattern test\");","160","","161","        root.debug(\"empty mdc\");","162","","163","        ThreadContext.put(\"escaped\", \"Testing escaping \\n \\\" ] \\\"\");","164","","165","        root.debug(\"filled mdc\");","166","","167","        ThreadContext.put(\"ipAddress\", \"192.168.0.120\");","168","        ThreadContext.put(\"locale\", Locale.US.getDisplayName());","169","        try {","170","            final StructuredDataMessage msg = new StructuredDataMessage(\"Transfer@18060\", \"Transfer Complete\", \"Audit\");","171","            msg.put(\"ToAccount\", \"123456\");","172","            msg.put(\"FromAccount\", \"123457\");","173","            msg.put(\"Amount\", \"200.00\");","174","            root.info(MarkerManager.getMarker(\"EVENT\"), msg);","175","","176","            List<String> list = appender.getMessages();","177","","178","            assertTrue(\"Expected line 1 to end with: \" + line1 + \" Actual \" + list.get(0), list.get(0).endsWith(line1));","179","            assertTrue(\"Expected line 2 to end with: \" + line2 + \" Actual \" + list.get(1), list.get(1).endsWith(line2));","180","            assertTrue(\"Expected line 3 to end with: \" + lineEscaped3 + \" Actual \" + list.get(2), list.get(2).endsWith(lineEscaped3));","181","            assertTrue(\"Expected line 4 to end with: \" + lineEscaped4 + \" Actual \" + list.get(3), list.get(3).endsWith(lineEscaped4));","182","","183","            appender.clear();","184","","185","            ThreadContext.remove(\"loginId\");","186","","187","            root.debug(\"This is a test\");","188","","189","            list = appender.getMessages();","190","            assertTrue(\"No messages expected, found \" + list.size(), list.size() == 0);","191","        } finally {","192","            root.removeAppender(appender);","193","            ThreadContext.clear();","194","","195","            appender.stop();","196","        }","197","","198","    }","199","","200","    \/**"],"delete":["171",""]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424Layout.java":[{"add":["67","    \/**","68","     * Match characters which require escaping","69","     *\/","70","    public static final Pattern PARAM_VALUE_ESCAPE_PATTERN = Pattern.compile(\"[\\\\\\\"\\\\]\\\\\\\\]\");","236","                Map<String, String> map = event.getContextMap();","238","                    checkRequired(map);","243","                formatStructuredElement(mdcSDID, map, buf, checker);","392","                sb","393","                        .append(\" \")","394","                        .append(escapeNewlines(","395","                        \t\tescapeSDParams(","396","                        \t\t\t\tentry.getKey()),","397","                                escapeNewLine))","398","                        .append(\"=\\\"\")","399","                        .append(","400","                                escapeNewlines(","401","                                        escapeSDParams(","402","                                                entry.getValue()),","403","                                        escapeNewLine))","404","                        .append(\"\\\"\");","409","    private String escapeSDParams(String value)","410","    {","411","        return PARAM_VALUE_ESCAPE_PATTERN.matcher(value).replaceAll(\"\\\\\\\\$0\");","412","    }","413",""],"delete":["233","                    checkRequired(event.getContextMap());","238","                formatStructuredElement(mdcSDID, event.getContextMap(), buf, checker);","387","                sb.append(\" \");","388","                sb.append(entry.getKey()).append(\"=\\\"\").append(entry.getValue()).append(\"\\\"\");"]}]}},"2c966ad9fe344954c98041246496c389e6578e54":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerDateTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/resources\/log4j-date.xml":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["245","        if (rootNode.hasChildren() && rootNode.getChildren().get(0).getName().equalsIgnoreCase(\"Properties\")) {","246","            Node first = rootNode.getChildren().get(0);","247","            createConfiguration(first, null);","248","            if (first.getObject() != null) {","249","                subst.setVariableResolver((StrLookup) first.getObject());","251","        } else {","252","            final Map<String, String> map = (Map<String, String>) componentMap.get(CONTEXT_PROPERTIES);","253","            final StrLookup lookup = map == null ? null : new MapLookup(map);","254","            subst.setVariableResolver(new Interpolator(lookup));","255","        }","256","","257","        for (final Node child : rootNode.getChildren()) {","263","            }","264","            createConfiguration(child, null);","265","            if (child.getObject() == null) {","266","                continue;"],"delete":["245","        for (final Node child : rootNode.getChildren()) {","246","            createConfiguration(child, null);","247","            if (child.getObject() == null) {","248","                continue;","252","                    subst.setVariableResolver((StrLookup) child.getObject());","253","                } else {","257","            } else if (tempLookup == subst.getVariableResolver()) {","258","                final Map<String, String> map = (Map<String, String>) componentMap.get(CONTEXT_PROPERTIES);","259","                final StrLookup lookup = map == null ? null : new MapLookup(map);","260","                subst.setVariableResolver(new Interpolator(lookup));"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerDateTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-398\" dev=\"rgoers\" type=\"fix\">","24","        Configure properties and setup Interpolator before processing rest of configuration.","25","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-date.xml":[{"add":[],"delete":[]}]}},"33956aa616ad73b5dc951e4cd5e358390d61e8f9":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MarkerFilter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultFilterComponentBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultCompositeFilterComponentBuilder.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/MarkerFilter.java":[{"add":["157","            @PluginAttribute(AbstractFilterBuilder.ATTR_ON_MATCH) final Result match,","158","            @PluginAttribute(AbstractFilterBuilder.ATTR_ON_MISMATCH) final Result mismatch) {"],"delete":["39","    public static final String ATTR_ON_MATCH = \"onMatch\";","40","    public static final String ATTR_ON_MISMATCH = \"onMismatch\";","41","    ","160","            @PluginAttribute(ATTR_ON_MATCH) final Result match,","161","            @PluginAttribute(ATTR_ON_MISMATCH) final Result mismatch) {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":[{"add":["24","import org.apache.logging.log4j.core.config.plugins.PluginBuilderAttribute;","40","    public static abstract class AbstractFilterBuilder<B extends AbstractFilterBuilder<B>>  {","41","","42","        public static final String ATTR_ON_MISMATCH = \"onMismatch\";","43","        public static final String ATTR_ON_MATCH = \"onMatch\";","44","","45","        @PluginBuilderAttribute(ATTR_ON_MATCH)","46","        private Result onMatch = Result.NEUTRAL;","47","","48","        @PluginBuilderAttribute(ATTR_ON_MISMATCH)","49","        private Result onMismatch = Result.DENY;","50","","51","        public Result getOnMatch() {","52","            return onMatch;","53","        }","54","","55","        public Result getOnMismatch() {","56","            return onMismatch;","57","        }","58","","59","        \/**","60","         * Sets the Result to return when the filter matches. Defaults to Result.NEUTRAL.","61","         * @param onMatch the Result to return when the filter matches.","62","         * @return this","63","         *\/","64","        public B setOnMatch(final Result onMatch) {","65","            this.onMatch = onMatch;","66","            return asBuilder();","67","        }","68","","69","        \/**","70","         * Sets the Result to return when the filter does not match. The default is Result.DENY.","71","         * @param onMismatch the Result to return when the filter does not match. ","72","         * @return this","73","         *\/","74","        public B setOnMismatch(final Result onMismatch) {","75","            this.onMismatch = onMismatch;","76","            return asBuilder();","77","        }","78","        ","79","        @SuppressWarnings(\"unchecked\")","80","        public B asBuilder() {","81","            return (B) this;","82","        }","83","","84","    }","85","    "],"delete":[]}],"src\/changes\/changes.xml":[{"add":["151","      <action issue=\"LOG4J2-2219\" dev=\"ggregory\" type=\"update\" due-to=\"Kilian, Gary Gregory\">","152","        Configuration builder classes should look for \"onMismatch\", not \"onMisMatch\".","153","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultFilterComponentBuilder.java":[{"add":["20","import org.apache.logging.log4j.core.filter.AbstractFilter.AbstractFilterBuilder;","31","        addAttribute(AbstractFilterBuilder.ATTR_ON_MATCH, onMatch);","32","        addAttribute(AbstractFilterBuilder.ATTR_ON_MISMATCH, onMismatch);"],"delete":["30","        addAttribute(\"onMatch\", onMatch);","31","        addAttribute(\"onMisMatch\", onMismatch);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":[{"add":["292","    public static class Builder extends AbstractFilterBuilder<Builder> implements org.apache.logging.log4j.core.util.Builder<BurstFilter> {","305","         * @param level the logging level to use. ","306","         * @return this","314","         * Sets the average number of events per second to allow.","315","         * @param rate the average number of events per second to allow. This must be a positive number. ","316","         * @return this","325","         * @param maxBurst Sets the maximum number of events that can occur before events are filtered for exceeding the average rate.","327","         * @return this","342","            return new BurstFilter(this.level, this.rate, this.maxBurst, this.getOnMatch(), this.getOnMismatch());"],"delete":["292","    public static class Builder implements org.apache.logging.log4j.core.util.Builder<BurstFilter> {","303","        @PluginBuilderAttribute","304","        private Result onMatch = Result.NEUTRAL;","305","","306","        @PluginBuilderAttribute","307","        private Result onMismatch = Result.DENY;","308","","318","         * Sets the average number of events per second to allow. This must be a positive number.","334","        \/**","335","         * Sets the Result to return when the filter matches. Defaults to Result.NEUTRAL.","336","         *\/","337","        public Builder setOnMatch(final Result onMatch) {","338","            this.onMatch = onMatch;","339","            return this;","340","        }","341","","342","        \/**","343","         * Sets the Result to return when the filter does not match. The default is Result.DENY.","344","         *\/","345","        public Builder setOnMismatch(final Result onMismatch) {","346","            this.onMismatch = onMismatch;","347","            return this;","348","        }","349","","358","            return new BurstFilter(this.level, this.rate, this.maxBurst, this.onMatch, this.onMismatch);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":[{"add":["42","import org.apache.logging.log4j.core.filter.AbstractFilter.AbstractFilterBuilder;","232","        final String onMatch = (String) properties.remove(AbstractFilterBuilder.ATTR_ON_MATCH);","233","        final String onMismatch = (String) properties.remove(AbstractFilterBuilder.ATTR_ON_MISMATCH);"],"delete":["42","import org.apache.logging.log4j.core.filter.MarkerFilter;","232","        final String onMatch = (String) properties.remove(MarkerFilter.ATTR_ON_MATCH);","233","        final String onMismatch = (String) properties.remove(MarkerFilter.ATTR_ON_MISMATCH);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultCompositeFilterComponentBuilder.java":[{"add":["21","import org.apache.logging.log4j.core.filter.AbstractFilter.AbstractFilterBuilder;","33","        addAttribute(AbstractFilterBuilder.ATTR_ON_MATCH, onMatch);","34","        addAttribute(AbstractFilterBuilder.ATTR_ON_MISMATCH, onMismatch);"],"delete":["32","        addAttribute(\"onMatch\", onMatch);","33","        addAttribute(\"onMisMatch\", onMismatch);"]}]}},"24ecad5b997a93ce8da584f3cb1041e2564855c9":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/pom.xml":"MODIFY","pom.xml":"MODIFY","log4j-core\/pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2254\" dev=\"rgoers\" type=\"fix\">","34","        Incorrect automatics module name header was being included in manifests.","35","      <\/action>"],"delete":[]}],"log4j-api\/pom.xml":[{"add":["167","            <configuration combine.self=\"override\">"],"delete":["167","            <configuration>"]}],"pom.xml":[{"add":["978","        <plugin>","979","          <groupId>org.apache.maven.plugins<\/groupId>","980","          <artifactId>maven-jar-plugin<\/artifactId>","981","          <version>3.0.2<\/version>","982","          <executions>","983","            <execution>","984","              <id>default-jar<\/id>","985","              <goals>","986","                <goal>jar<\/goal>","987","              <\/goals>","988","              <configuration>","989","                <archive>","990","                  <manifestFile>${manifestfile}<\/manifestFile>","991","                  <manifestEntries>","992","                    <Specification-Title>${project.name}<\/Specification-Title>","993","                    <Specification-Version>${project.version}<\/Specification-Version>","994","                    <Specification-Vendor>${project.organization.name}<\/Specification-Vendor>","995","                    <Implementation-Title>${project.name}<\/Implementation-Title>","996","                    <Implementation-Version>${project.version}<\/Implementation-Version>","997","                    <Implementation-Vendor>${project.organization.name}<\/Implementation-Vendor>","998","                    <Implementation-Vendor-Id>org.apache<\/Implementation-Vendor-Id>","999","                    <X-Compile-Source-JDK>${maven.compiler.source}<\/X-Compile-Source-JDK>","1000","                    <X-Compile-Target-JDK>${maven.compiler.target}<\/X-Compile-Target-JDK>","1001","                    <Automatic-Module-Name>${module.name}<\/Automatic-Module-Name>","1002","                  <\/manifestEntries>","1003","                <\/archive>","1004","              <\/configuration>","1005","            <\/execution>","1006","          <\/executions>","1007","","1008","        <\/plugin>"],"delete":["990","        <groupId>org.apache.maven.plugins<\/groupId>","991","        <artifactId>maven-jar-plugin<\/artifactId>","992","        <version>3.0.2<\/version>","993","        <configuration>","994","          <archive>","995","            <manifestFile>${manifestfile}<\/manifestFile>","996","            <manifestEntries>","997","              <Specification-Title>${project.name}<\/Specification-Title>","998","              <Specification-Version>${project.version}<\/Specification-Version>","999","              <Specification-Vendor>${project.organization.name}<\/Specification-Vendor>","1000","              <Implementation-Title>${project.name}<\/Implementation-Title>","1001","              <Implementation-Version>${project.version}<\/Implementation-Version>","1002","              <Implementation-Vendor>${project.organization.name}<\/Implementation-Vendor>","1003","              <Implementation-Vendor-Id>org.apache<\/Implementation-Vendor-Id>","1004","              <X-Compile-Source-JDK>${maven.compiler.source}<\/X-Compile-Source-JDK>","1005","              <X-Compile-Target-JDK>${maven.compiler.target}<\/X-Compile-Target-JDK>","1006","              <Automatic-Module-Name>${module.name}<\/Automatic-Module-Name>","1007","            <\/manifestEntries>","1008","          <\/archive>","1009","        <\/configuration>","1010","      <\/plugin>","1011","      <plugin>"]}],"log4j-core\/pom.xml":[{"add":["439","            <configuration combine.self=\"override\">"],"delete":["439","            <configuration>"]}]}},"c008dd0d0b8e5b25bf9e30069a1f0ab9fae5064b":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicManager.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/AbstractJMSManager.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractServer.java":"MODIFY","core\/src\/test\/resources\/log4j-jmstopic-failover.xml":"ADD","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rewrite\/PropertiesRewritePolicy.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueManager.java":"MODIFY","core\/src\/test\/resources\/log4j-jmsqueue-failover.xml":"ADD","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicFailoverTest.java":"ADD","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServerTest.java":"MODIFY","flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueFailoverTest.java":"ADD"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicManager.java":[{"add":["38","    private TopicInfo info;","39","    private final String factoryBindingName;","40","    private final String topicBindingName;","41","    private final String userName;","42","    private final String password;","43","    private final Context context;","47","     * @param context The context.","48","     * @param factoryBindingName The factory binding name.","49","     * @param topicBindingName The queue binding name.","50","     * @param userName The user name.","51","     * @param password The credentials for the user.","52","     * @param info The Queue connection info.","54","    protected JMSTopicManager(String name, Context context, String factoryBindingName, String topicBindingName,","55","                              String userName, String password, TopicInfo info) {","57","        this.context = context;","58","        this.factoryBindingName = factoryBindingName;","59","        this.topicBindingName = topicBindingName;","60","        this.userName = userName;","61","        this.password = password;","62","        this.info = info;","101","        if (info == null) {","102","            info = connect(context, factoryBindingName, topicBindingName, userName, password, false);","103","        }","104","        super.send(object, info.session, info.publisher);","110","            if (info != null) {","111","                info.session.close();","112","                info.conn.close();","148","    private static TopicInfo connect(Context context, String factoryBindingName, String queueBindingName,","149","                                     String userName, String password, boolean suppress) throws Exception {","150","        try {","151","            TopicConnectionFactory factory = (TopicConnectionFactory) lookup(context, factoryBindingName);","152","            TopicConnection conn;","153","            if (userName != null) {","154","                conn = factory.createTopicConnection(userName, password);","155","            } else {","156","                conn = factory.createTopicConnection();","157","            }","158","            TopicSession sess = conn.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);","159","            Topic topic = (Topic) lookup(context, queueBindingName);","160","            TopicPublisher publisher = sess.createPublisher(topic);","161","            conn.start();","162","            return new TopicInfo(conn, sess, publisher);","163","        } catch (NamingException ex) {","164","            LOGGER.warn(\"Unable to locate connection factory \" + factoryBindingName, ex);","165","            if (!suppress) {","166","                throw ex;","167","            }","168","        } catch (JMSException ex) {","169","            LOGGER.warn(\"Unable to create connection to queue \" + queueBindingName, ex);","170","            if (!suppress) {","171","                throw ex;","172","            }","173","        }","174","        return null;","175","    }","176","","177","    private static class TopicInfo {","178","        private final TopicConnection conn;","179","        private final TopicSession session;","180","        private final TopicPublisher publisher;","181","","182","        public TopicInfo(TopicConnection conn, TopicSession session, TopicPublisher publisher) {","183","            this.conn = conn;","184","            this.session = session;","185","            this.publisher = publisher;","186","        }","187","    }","188","","190","     * Factory to create the JMSQueueManager.","197","                    data.securityPrincipalName, data.securityCredentials);","198","                TopicInfo info = connect(ctx, data.factoryBindingName, data.topicBindingName, data.userName,","199","                    data.password, true);","200","                return new JMSTopicManager(name, ctx, data.factoryBindingName, data.topicBindingName,","201","                    data.userName, data.password, info);","203","                LOGGER.error(\"Unable to locate resource\", ex);","204","            } catch (Exception ex) {","205","                LOGGER.error(\"Unable to connect\", ex);"],"delete":["38","    private final TopicConnection topicConnection;","39","    private final TopicSession topicSession;","40","    private final TopicPublisher topicPublisher;","41","","45","     * @param conn The TopicConnection.","46","     * @param sess The TopicSession.","47","     * @param pub The TopicPublisher.","49","    public JMSTopicManager(String name, TopicConnection conn, TopicSession sess, TopicPublisher pub) {","51","        this.topicConnection = conn;","52","        this.topicSession = sess;","53","        this.topicPublisher = pub;","92","        super.send(object, topicSession, topicPublisher);","98","            if (topicSession != null) {","99","                topicSession.close();","100","            }","101","            if (topicConnection != null) {","102","                topicConnection.close();","139","     * Factory to create a JMSTopicManager.","146","                                            data.securityPrincipalName, data.securityCredentials);","147","                TopicConnectionFactory factory = (TopicConnectionFactory) lookup(ctx, data.factoryBindingName);","148","                TopicConnection conn;","149","                if (data.userName != null) {","150","                    conn = factory.createTopicConnection(data.userName, data.password);","151","                } else {","152","                    conn = factory.createTopicConnection();","153","                }","154","                TopicSession sess = conn.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);","155","                Topic topic = (Topic) lookup(ctx, data.topicBindingName);","156","                TopicPublisher pub = sess.createPublisher(topic);","157","                conn.start();","158","                return new JMSTopicManager(name, conn, sess, pub);","160","                LOGGER.error(\"Bad Name \" + data.topicBindingName, ex);","161","            } catch (JMSException jmsex) {","162","                LOGGER.error(\"Unable to create publisher \", jmsex);"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/AbstractJMSManager.java":[{"add":["77","            LOGGER.warn(\"Could not find name [\" + name + \"].\");"],"delete":["77","            LOGGER.error(\"Could not find name [\" + name + \"].\");"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/AbstractServer.java":[{"add":["28","        context = (LoggerContext) LogManager.getContext(false);"],"delete":["28","        context = (LoggerContext) LogManager.getContext();"]}],"core\/src\/test\/resources\/log4j-jmstopic-failover.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-126\" dev=\"rgoers\" type=\"fix\">","26","        Allow JMS appenders to recover if the queue or topic is unavailable.","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rewrite\/PropertiesRewritePolicy.java":[{"add":["67","            props.put(prop.getName(), entry.getValue() ?","68","                config.getSubst().replace(prop.getValue()) : prop.getValue());"],"delete":["67","            if (!props.containsKey(prop.getName())) {","68","                props.put(prop.getName(), entry.getValue() ?","69","                    config.getSubst().replace(prop.getValue()) : prop.getValue());","70","            }"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueManager.java":[{"add":["38","    private QueueInfo info;","39","    private final String factoryBindingName;","40","    private final String queueBindingName;","41","    private final String userName;","42","    private final String password;","43","    private final Context context;","48","     * @param context The context.","49","     * @param factoryBindingName The factory binding name.","50","     * @param queueBindingName The queue binding name.","51","     * @param userName The user name.","52","     * @param password The credentials for the user.","53","     * @param info The Queue connection info.","55","    protected JMSQueueManager(String name, Context context, String factoryBindingName, String queueBindingName,","56","                              String userName, String password, QueueInfo info) {","58","        this.context = context;","59","        this.factoryBindingName = factoryBindingName;","60","        this.queueBindingName = queueBindingName;","61","        this.userName = userName;","62","        this.password = password;","63","        this.info = info;","100","    public synchronized void send(Serializable object) throws Exception {","101","        if (info == null) {","102","            info = connect(context, factoryBindingName, queueBindingName, userName, password, false);","103","        }","104","        super.send(object, info.session, info.sender);","110","            if (info != null) {","111","                info.session.close();","112","                info.conn.close();","116","        } finally {","117","            info = null;","150","    private static QueueInfo connect(Context context, String factoryBindingName, String queueBindingName,","151","                                     String userName, String password, boolean suppress) throws Exception {","152","        try {","153","            QueueConnectionFactory factory = (QueueConnectionFactory) lookup(context, factoryBindingName);","154","            QueueConnection conn;","155","            if (userName != null) {","156","                conn = factory.createQueueConnection(userName, password);","157","            } else {","158","                conn = factory.createQueueConnection();","159","            }","160","            QueueSession sess = conn.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);","161","            Queue queue = (Queue) lookup(context, queueBindingName);","162","            QueueSender sender = sess.createSender(queue);","163","            conn.start();","164","            return new QueueInfo(conn, sess, sender);","165","        } catch (NamingException ex) {","166","            LOGGER.warn(\"Unable to locate connection factory \" + factoryBindingName, ex);","167","            if (!suppress) {","168","                throw ex;","169","            }","170","        } catch (JMSException ex) {","171","            LOGGER.warn(\"Unable to create connection to queue \" + queueBindingName, ex);","172","            if (!suppress) {","173","                throw ex;","174","            }","175","        }","176","        return null;","177","    }","178","","179","    private static class QueueInfo {","180","        private final QueueConnection conn;","181","        private final QueueSession session;","182","        private final QueueSender sender;","183","","184","        public QueueInfo(QueueConnection conn, QueueSession session, QueueSender sender) {","185","            this.conn = conn;","186","            this.session = session;","187","            this.sender = sender;","188","        }","189","    }","190","","200","                QueueInfo info = connect(ctx, data.factoryBindingName, data.queueBindingName, data.userName,","201","                    data.password, true);","202","                return new JMSQueueManager(name, ctx, data.factoryBindingName, data.queueBindingName,","203","                    data.userName, data.password, info);","206","            } catch (Exception ex) {","207","                LOGGER.error(\"Unable to connect\", ex);"],"delete":["38","    private final QueueConnection queueConnection;","39","    private final QueueSession queueSession;","40","    private final QueueSender queueSender;","45","     * @param conn The QueueConnection.","46","     * @param sess The QueueSession.","47","     * @param sender The QueueSender.","49","    protected JMSQueueManager(String name, QueueConnection conn, QueueSession sess, QueueSender sender) {","51","        this.queueConnection = conn;","52","        this.queueSession = sess;","53","        this.queueSender = sender;","90","    public void send(Serializable object) throws Exception {","91","        super.send(object, queueSession, queueSender);","97","            if (queueSession != null) {","98","                queueSession.close();","99","            }","100","            if (queueConnection != null) {","101","                queueConnection.close();","146","                QueueConnectionFactory factory = (QueueConnectionFactory) lookup(ctx, data.factoryBindingName);","147","                QueueConnection conn;","148","                if (data.userName != null) {","149","                    conn = factory.createQueueConnection(data.userName, data.password);","150","                } else {","151","                    conn = factory.createQueueConnection();","152","                }","153","                QueueSession sess = conn.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);","154","                Queue queue = (Queue) lookup(ctx, data.queueBindingName);","155","                QueueSender sender = sess.createSender(queue);","156","                conn.start();","157","                return new JMSQueueManager(name, conn, sess, sender);","158","","161","            } catch (JMSException jmsex) {","162","                LOGGER.error(\"Unable to establish connection\", jmsex);"]}],"core\/src\/test\/resources\/log4j-jmsqueue-failover.xml":[{"add":[],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicFailoverTest.java":[{"add":[],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServerTest.java":[{"add":["57","    LoggerContext ctx = (LoggerContext) LogManager.getContext(false);","62","        ((LoggerContext) LogManager.getContext(false)).reconfigure();"],"delete":["57","    LoggerContext ctx = (LoggerContext) LogManager.getContext();","62","        ((LoggerContext) LogManager.getContext()).reconfigure();"]}],"flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeEvent.java":[{"add":["32","import java.util.ArrayList;","89","                    str = str.trim();","98","                List<String> list = new ArrayList<String>(array.length);","99","                for (String value : array) {","100","                    list.add(value.trim());","101","                }","116","                    str = str.trim();"],"delete":["96","                List<String> list = Arrays.asList(array);"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSQueueFailoverTest.java":[{"add":[],"delete":[]}]}},"bc4ff4413c8395e0531d910326bd44a2c835c604":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfig.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY","core\/src\/test\/resources\/AsyncLoggerConfigTest2.xml":"ADD","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":"MODIFY","core\/src\/test\/resources\/AsyncLoggerConfigTest.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest2.java":"ADD"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfig.java":[{"add":["123","        } else {","124","            AsyncLoggerConfigHelper.claim(); \/\/ LOG4J2-336","131","        AsyncLoggerConfigHelper.release();"],"delete":["129","        \/* only stop disruptor if shutting down logging subsystem","130","        if (LogManager.getContext() instanceof LoggerContext) {","131","            if (((LoggerContext) LogManager.getContext()).getStatus() != Status.STOPPING) {","132","                return;","133","            }","134","        } *\/","135","        helper.shutdown();"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["135","        root.startFilter(); \/\/ LOG4J2-336"],"delete":["135",""]}],"core\/src\/test\/resources\/AsyncLoggerConfigTest2.xml":[{"add":[],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":[{"add":["20","import java.util.concurrent.ThreadFactory;","65","    private static ThreadFactory threadFactory = new DaemonThreadFactory(","66","            \"AsyncLoggerConfig-\");","68","    private static ExecutorService executor;","100","        claim();","105","            LOGGER.trace(\"AsyncLoggerConfigHelper not starting new disruptor, using existing object. Ref count is {}.\", count);","108","        LOGGER.trace(\"AsyncLoggerConfigHelper creating new disruptor. Ref count is {}.\", count);","111","        executor = Executors.newSingleThreadExecutor(threadFactory);","116","        final ExceptionHandler errorHandler = getExceptionHandler();","117","        disruptor.handleExceptionsWith(errorHandler);","121","                \"Starting AsyncLoggerConfig disruptor with ringbuffer size={}, waitStrategy={}, exceptionHandler={}...\",","122","                disruptor.getRingBuffer().getBufferSize(), waitStrategy.getClass().getSimpleName(), errorHandler);","230","    \/**","231","     * Increases the reference count and creates and starts a new Disruptor and","232","     * associated thread if none currently exists.","233","     * ","234","     * @see #release()","235","     *\/","236","    synchronized static void claim() {","237","        count++;","238","        initDisruptor();","239","    }","240","","241","    \/**","242","     * Decreases the reference count. If the reference count reached zero, the","243","     * Disruptor and its associated thread are shut down and their references","244","     * set to {@code null}.","245","     *\/","246","    synchronized static void release() {","248","            LOGGER.trace(\"AsyncLoggerConfigHelper: not shutting down disruptor: ref count is {}.\", count);","253","            LOGGER.trace(\"AsyncLoggerConfigHelper: disruptor already shut down: ref count is {}.\", count);","256","        LOGGER.trace(\"AsyncLoggerConfigHelper: shutting down disruptor: ref count is {}.\", count);","277","        executor = null; \/\/ release reference to allow GC"],"delete":["65","    private static ExecutorService executor = Executors","66","            .newSingleThreadExecutor(new DaemonThreadFactory(","67","                    \"AsyncLoggerConfig-\"));","99","        initDisruptor();","103","        ++count;","113","        disruptor.handleExceptionsWith(getExceptionHandler());","117","                \"Starting AsyncLoggerConfig disruptor with ringbuffer size {}...\",","118","                disruptor.getRingBuffer().getBufferSize());","127","            LOGGER.debug(\"disruptor event handler uses SleepingWaitStrategy\");","130","            LOGGER.debug(\"disruptor event handler uses YieldingWaitStrategy\");","133","            LOGGER.debug(\"disruptor event handler uses BlockingWaitStrategy\");","136","        LOGGER.debug(\"disruptor event handler uses SleepingWaitStrategy\");","165","            LOGGER.debug(\"No AsyncLoggerConfig.ExceptionHandler specified\");","173","            LOGGER.debug(\"AsyncLoggerConfig.ExceptionHandler=\" + result);","232","    public synchronized void shutdown() {"]}],"core\/src\/test\/resources\/AsyncLoggerConfigTest.xml":[{"add":["3","    <File name=\"File\" ","4","          fileName=\"target\/AsyncLoggerConfigTest.log\" ","5","          bufferedIO=\"false\" ","6","          immediateFlush=\"true\" ","7","          append=\"false\">"],"delete":["3","    <File name=\"File\" fileName=\"target\/AsyncLoggerConfigTest.log\" bufferedIO=\"false\" immediateFlush=\"true\" append=\"false\">"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest.java":[{"add":["42","        assertTrue(\"Deleted old file before test\", !f.exists() || f.delete());","43","        "],"delete":["42","        \/\/ System.out.println(f.getAbsolutePath());","43","        f.delete();","63",""]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-336\" dev=\"rpopma\" type=\"fix\" due-to=\"Andre Bogus\">","24","        AsyncLogger errors after multiple calls to LoggerContext.reconfigure().","25","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest2.java":[{"add":[],"delete":[]}]}},"53b1fc7282e86a4eb06dd1c42acecf5811c071df":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2453\" dev=\"rgoers\" type=\"fix\" due-to=\"theit\">","34","        Add Log4j-slf4j18-impl dependency to bom pom.","35","      <\/action>"],"delete":[]}]}},"e407d18efba1694f94fcf9c8eecf15b6b56fbd90":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppenderBuilderTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AbstractAppender.java":[{"add":["246","            return;"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["57","      <action issue=\"LOG4J2-2441\" dev=\"ckozak\" type=\"fix\">","58","        Setting a null ErrorHandler on AbstractAppender is not allowed and will no-op as expected.","59","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppenderBuilderTest.java":[{"add":["20","import org.apache.logging.log4j.core.ErrorHandler;","49","    \/**","50","     * Tests https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-2441","51","     *\/","52","    @Test","53","    public void testSetNullErrorHandlerIsNotAllowed() {","54","        final ConsoleAppender appender = ConsoleAppender.newBuilder().withName(\"test\").build();","55","        ErrorHandler handler = appender.getHandler();","56","        Assert.assertNotNull(handler);","57","        \/\/ This could likely be allowed to throw, but we're just testing that","58","        \/\/ setting null does not actually set a null handler.","59","        appender.setHandler(null);","60","        Assert.assertSame(handler, appender.getHandler());","61","    }"],"delete":[]}]}},"50e1924726c060d8ce3f4e9eae4419c420c9e11b":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppender.java":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderTest.java":[{"add":["124","    @Test","125","    public void testDefaultProtocol() throws Exception {","126","","127","        final SocketAppender appender = SocketAppender.createAppender(\"localhost\", PORT, null, \"-1\",","128","            \"false\", \"Test\", null, null, null, null, null, null);","129","        assertNotNull(appender);","130","    }","131","","132",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-139\" dev=\"rgoers\" type=\"fix\">","26","        Fix NullPointerException (regression due to fix for LOG4J2-228)","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppender.java":[{"add":["117","        final Protocol p = EnglishEnums.valueOf(Protocol.class, protocol != null ? protocol : Protocol.TCP.name());"],"delete":["117","        final String prot = protocol != null ? protocol : Protocol.TCP.name();","118","        final Protocol p = EnglishEnums.valueOf(Protocol.class, protocol);"]}]}},"2696745dbc8fcdd07c14bba91a313a1719e7a2b1":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["47","      <action issue=\"LOG4J2-1138\" dev=\"ggregory\" type=\"update\">","48","        Do not use Jackson deprecated methods.","49","      <\/action>      "],"delete":[]}]}},"4a652a51ceb082240ddda60f5c2f1ef20919d194":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderSizeTest.java":[{"add":["58","        return Arrays.asList(new Object[][] { \/\/","59","                \/\/ @formatter:off","60","                {\"log4j-rolling-gz.xml\", \".gz\"}, \/\/","61","                {\"log4j-rolling-zip.xml\", \".zip\"}, \/\/","63","                {\"log4j-rolling-bzip2.xml\", \".bz2\"}, \/\/","64","                {\"log4j-rolling-deflate.xml\", \".deflate\"}, \/\/","65","                {\"log4j-rolling-pack200.xml\", \".pack200\"}, \/\/","66","                {\"log4j-rolling-xy.xml\", \".xy\"},});","67","                \/\/ @formatter:on","115","                        assertTrue(line","116","                                .contains(\"DEBUG o.a.l.l.c.a.r.RollingAppenderSizeTest [main] This is test message number\"));"],"delete":["58","        return Arrays.asList(new Object[][] { {\"log4j-rolling-gz.xml\", \".gz\"}, {\"log4j-rolling-zip.xml\", \".zip\"},","60","                {\"log4j-rolling-bzip2.xml\", \".bz2\"}, {\"log4j-rolling-deflate.xml\", \".deflate\"},","61","                {\"log4j-rolling-pack200.xml\", \".pack200\"}, {\"log4j-rolling-xy.xml\", \".xy\"},});","109","                        assertTrue(line.contains(\"DEBUG o.a.l.l.c.a.r.RollingAppenderSizeTest [main] This is test message number\"));"]}]}},"463bafc9203ee211b9c5828c8e705fa436ecd1df":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J-2672\" dev=\"rgoers\" type=\"fix\" due-to=\"Stephen Colebourne\">","33","        Add automatic module names where missing.","34","      <\/action>","38","      <action issue=\"LOG4J2-2673\" dev=\"ggregory\" type=\"fix\" due-to=\"Yuichi Sugimura\">"],"delete":["35","      <action issue=\"LOG4J2-2673\" dev=\"ggregory\" type=\"fix\" due-to=\"Yuichi Sugimura, Gary Gregory\">"]}]}},"89887c6eb998bbd99ea976cb0529cee7a9d7dd32":{"changes":{"src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["941","            provided by setting the \"Log4jDefaultStatusLevel\" system property.  Valid values of the status attribute are","942","            \"trace\", \"debug\", \"info\", \"warn\", \"error\" and \"fatal\". The following"],"delete":["941","            provided by setting the \"Log4jDefaultStatusLevel\" system property. The following"]}]}},"029e79dabcea538b37db76b03248db623b5f0721":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":["1159","            log(marker, FQCN, Level.ERROR, msg, null);","1356","            log(marker, FQCN, Level.FATAL, msg, null);"],"delete":["1159","            log(null, FQCN, Level.ERROR, msg, null);","1356","            log(null, FQCN, Level.FATAL, msg, null);"]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":[{"add":["68","        new LogEvent(marker, simple, null),","110","        currentEvent = events[14];","111","        trace(MarkerManager.getMarker(\"TEST\"), simple);","152","        currentEvent = events[14];","153","        debug(MarkerManager.getMarker(\"TEST\"), simple);","194","        currentEvent = events[14];","195","        info(MarkerManager.getMarker(\"TEST\"), simple);","236","        currentEvent = events[14];","237","        warn(MarkerManager.getMarker(\"TEST\"), simple);","278","        currentEvent = events[14];","279","        error(MarkerManager.getMarker(\"TEST\"), simple);","320","        currentEvent = events[14];","321","        fatal(MarkerManager.getMarker(\"TEST\"), simple);"],"delete":[]}]}},"fead16dc30dbf493ee3019ef09601372a5caa866":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/JMSTopicManager.java":[{"add":[],"delete":["106","        super.send(object, info.session, info.publisher);"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-367\" dev=\"ggregory\" type=\"fix\" due-to=\"David Parry\">","24","        JMS appenders send two messages for one append.","25","      <\/action>"],"delete":[]}]}},"1729608908b9691ad9f68bd53da3b0479fa46138":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilter.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilterTest.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilter.java":[{"add":["98","            match = value.equals(ThreadContext.get(key));"],"delete":["98","            match = key.equals(ThreadContext.get(key));"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-147\" dev=\"rgoers\" type=\"fix\" due-to=\"William Burns\">","26","        ThreadContextMapFilter was matching on the key instead of the value of the key.","27","      <\/action>"],"delete":[]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/ThreadContextMapFilterTest.java":[{"add":["59","        final KeyValuePair[] single = new KeyValuePair[] {new KeyValuePair(\"userid\", \"testuser\")};","60","        filter = ThreadContextMapFilter.createFilter(single, null, null, null);","61","        filter.start();","62","        assertTrue(filter.isStarted());","63","        assertTrue(filter.filter(null, Level.DEBUG, null, null, (Throwable)null) == Filter.Result.NEUTRAL);"],"delete":[]}]}},"49b73d45277b4c02ca29c9185873f71137763584":{"changes":{"log4j-osgi\/log4j-to-slf4j\/pom.xml":"ADD","log4j-osgi\/slf4j-to-log4j\/pom.xml":"ADD","log4j-osgi\/pom.xml":"MODIFY"},"diff":{"log4j-osgi\/log4j-to-slf4j\/pom.xml":[{"add":[],"delete":[]}],"log4j-osgi\/slf4j-to-log4j\/pom.xml":[{"add":[],"delete":[]}],"log4j-osgi\/pom.xml":[{"add":["0","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r","1","<!--\r","2"," Licensed to the Apache Software Foundation (ASF) under one or more\r","3"," contributor license agreements.  See the NOTICE file distributed with\r","4"," this work for additional information regarding copyright ownership.\r","5"," The ASF licenses this file to You under the Apache License, Version 2.0\r","6"," (the \"License\"); you may not use this file except in compliance with\r","7"," the License.  You may obtain a copy of the License at\r","8","\r","9","      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\r","10","\r","11"," Unless required by applicable law or agreed to in writing, software\r","12"," distributed under the License is distributed on an \"AS IS\" BASIS,\r","13"," WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r","14"," See the License for the specific language governing permissions and\r","15"," limitations under the License.\r","16","-->\r","17","<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/maven-v4_0_0.xsd\">\r","18","  <modelVersion>4.0.0<\/modelVersion>\r","19","  <parent>\r","20","    <groupId>org.apache.logging.log4j<\/groupId>\r","21","    <artifactId>log4j<\/artifactId>\r","22","    <version>2.0-rc2-SNAPSHOT<\/version>\r","23","    <relativePath>..\/<\/relativePath>\r","24","  <\/parent>\r","25","  <groupId>org.apache.logging.log4j.osgi<\/groupId>\r","26","  <artifactId>log4j-osgi<\/artifactId>\r","27","  <packaging>pom<\/packaging>\r","28","  <name>Apache Log4J Core OSGi Bundles<\/name>\r","29","  <description>Apache Log4J OSGi Bundles<\/description>\r","30","  <properties>\r","31","    <log4jParentDir>${basedir}\/..<\/log4jParentDir>\r","32","    <docLabel>Core Documentation<\/docLabel>\r","33","    <projectDir>\/core<\/projectDir>\r","34","  <\/properties>\r","35","  <dependencies>\r","36","    <dependency>\r","37","      <groupId>org.apache.logging.log4j<\/groupId>\r","38","      <artifactId>log4j-core<\/artifactId>\r","39","    <\/dependency>\r","40","  <\/dependencies>\r","41","  <modules>\r","42","    <module>core-osgi-async<\/module>\r","43","    <module>core-osgi-jpa<\/module>\r","44","    <module>core-osgi-legacy-api<\/module>\r","45","    <module>core-osgi-net<\/module>\r","46","    <module>core-osgi-nosql-couchdb<\/module>\r","47","    <module>core-osgi-nosql-mongodb<\/module>\r","48","    <module>core-osgi-reduced<\/module>\r","49","    <module>log4j-to-slf4j<\/module>\r","50","    <module>slf4j-to-log4j<\/module>\r","51","  <\/modules>\r","52","<\/project>\r","53","\r"],"delete":["0","<?xml version=\"1.0\" encoding=\"UTF-8\"?>","1","<!--","2"," Licensed to the Apache Software Foundation (ASF) under one or more","3"," contributor license agreements.  See the NOTICE file distributed with","4"," this work for additional information regarding copyright ownership.","5"," The ASF licenses this file to You under the Apache License, Version 2.0","6"," (the \"License\"); you may not use this file except in compliance with","7"," the License.  You may obtain a copy of the License at","8","","9","      http:\/\/www.apache.org\/licenses\/LICENSE-2.0","10","","11"," Unless required by applicable law or agreed to in writing, software","12"," distributed under the License is distributed on an \"AS IS\" BASIS,","13"," WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","14"," See the License for the specific language governing permissions and","15"," limitations under the License.","16","-->","17","<project xmlns=\"http:\/\/maven.apache.org\/POM\/4.0.0\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/maven.apache.org\/POM\/4.0.0 http:\/\/maven.apache.org\/maven-v4_0_0.xsd\">","18","  <modelVersion>4.0.0<\/modelVersion>","19","  <parent>","20","    <groupId>org.apache.logging.log4j<\/groupId>","21","    <artifactId>log4j<\/artifactId>","22","    <version>2.0-rc2-SNAPSHOT<\/version>","23","    <relativePath>..\/<\/relativePath>","24","  <\/parent>","25","  <groupId>org.apache.logging.log4j.osgi<\/groupId>","26","  <artifactId>log4j-osgi<\/artifactId>","27","  <packaging>pom<\/packaging>","28","  <name>Apache Log4J Core OSGi Bundles<\/name>","29","  <description>Apache Log4J OSGi Bundles<\/description>","30","  <properties>","31","    <log4jParentDir>${basedir}\/..<\/log4jParentDir>","32","    <docLabel>Core Documentation<\/docLabel>","33","    <projectDir>\/core<\/projectDir>","34","  <\/properties>","35","  <dependencies>","36","    <dependency>","37","      <groupId>org.apache.logging.log4j<\/groupId>","38","      <artifactId>log4j-core<\/artifactId>","39","    <\/dependency>","40","  <\/dependencies>","41","  <modules>","42","    <module>core-osgi-async<\/module>","43","    <module>core-osgi-jpa<\/module>","44","    <module>core-osgi-legacy-api<\/module>","45","    <module>core-osgi-net<\/module>","46","    <module>core-osgi-nosql-couchdb<\/module>","47","    <module>core-osgi-nosql-mongodb<\/module>","48","    <module>core-osgi-reduced<\/module>","49","  <\/modules>","50","<\/project>","51",""]}]}},"3791207d5a6a87b8e019d83583dc4410455d5e23":{"changes":{"log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/mongodb\/MongoDbConnection.java":"MODIFY","log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/couchdb\/CouchDbConnection.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-nosql\/src\/test\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/MongoDbTest.java":"MODIFY","log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/AbstractNoSqlConnection.java":"ADD"},"diff":{"log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/mongodb\/MongoDbConnection.java":[{"add":["21","import org.apache.logging.log4j.nosql.appender.AbstractNoSqlConnection;\r","37","public final class MongoDbConnection extends AbstractNoSqlConnection<BasicDBObject, MongoDbObject> {\r","82","    public void closeImpl() {\r","83","        \/\/ there's no need to call this.mongo.close() since that literally closes the connection.\r","84","        \/\/ MongoDBClient uses internal connection pooling.\r","85","        \/\/ For more details, see LOG4J2-591.\r"],"delete":["30","import com.mongodb.Mongo;\r","37","public final class MongoDbConnection implements NoSqlConnection<BasicDBObject, MongoDbObject> {\r","54","    private final Mongo mongo;\r","58","        this.mongo = database.getMongo();\r","84","    public void close() {\r","85","        \/\/ there's no need to call this.mongo.close() since that literally\r","86","        \/\/ closes the connection\r","87","        \/\/ MongoDBClient uses internal connection pooling\r","88","        \/\/ for more details, see LOG4J2-591\r","91","    @Override\r","92","    public boolean isClosed() {\r","93","        return !this.mongo.getConnector().isOpen();\r","94","    }\r"]}],"log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/couchdb\/CouchDbConnection.java":[{"add":["0","\/*\r","1"," * Licensed to the Apache Software Foundation (ASF) under one or more\r","2"," * contributor license agreements. See the NOTICE file distributed with\r","3"," * this work for additional information regarding copyright ownership.\r","4"," * The ASF licenses this file to You under the Apache license, Version 2.0\r","5"," * (the \"License\"); you may not use this file except in compliance with\r","6"," * the License. You may obtain a copy of the License at\r","7"," *\r","8"," *      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\r","9"," *\r","10"," * Unless required by applicable law or agreed to in writing, software\r","11"," * distributed under the License is distributed on an \"AS IS\" BASIS,\r","12"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r","13"," * See the license for the specific language governing permissions and\r","14"," * limitations under the license.\r","15"," *\/\r","16","package org.apache.logging.log4j.nosql.appender.couchdb;\r","17","\r","18","import java.util.Map;\r","19","\r","20","import org.apache.logging.log4j.core.appender.AppenderLoggingException;\r","21","import org.apache.logging.log4j.nosql.appender.AbstractNoSqlConnection;\r","22","import org.apache.logging.log4j.nosql.appender.DefaultNoSqlObject;\r","23","import org.apache.logging.log4j.nosql.appender.NoSqlConnection;\r","24","import org.apache.logging.log4j.nosql.appender.NoSqlObject;\r","25","import org.apache.logging.log4j.util.Strings;\r","26","import org.lightcouch.CouchDbClient;\r","27","import org.lightcouch.Response;\r","28","\r","29","\/**\r","30"," * The Apache CouchDB implementation of {@link NoSqlConnection}.\r","31"," *\/\r","32","public final class CouchDbConnection extends AbstractNoSqlConnection<Map<String, Object>, DefaultNoSqlObject> {\r","33","    private final CouchDbClient client;\r","34","\r","35","    public CouchDbConnection(final CouchDbClient client) {\r","36","        this.client = client;\r","37","    }\r","38","\r","39","    @Override\r","40","    public DefaultNoSqlObject createObject() {\r","41","        return new DefaultNoSqlObject();\r","42","    }\r","43","\r","44","    @Override\r","45","    public DefaultNoSqlObject[] createList(final int length) {\r","46","        return new DefaultNoSqlObject[length];\r","47","    }\r","48","\r","49","    @Override\r","50","    public void insertObject(final NoSqlObject<Map<String, Object>> object) {\r","51","        try {\r","52","            final Response response = this.client.save(object.unwrap());\r","53","            if (Strings.isNotEmpty(response.getError())) {\r","54","                throw new AppenderLoggingException(\r","55","                        \"Failed to write log event to CouchDB due to error: \" + response.getError() + '.');\r","56","            }\r","57","        } catch (final Exception e) {\r","58","            throw new AppenderLoggingException(\"Failed to write log event to CouchDB due to error: \" + e.getMessage(),\r","59","                    e);\r","60","        }\r","61","    }\r","62","\r","63","    @Override\r","64","    protected void closeImpl() {\r","65","        this.client.shutdown();\r","66","    }\r","67","\r","68","}\r"],"delete":["0","\/*","1"," * Licensed to the Apache Software Foundation (ASF) under one or more","2"," * contributor license agreements. See the NOTICE file distributed with","3"," * this work for additional information regarding copyright ownership.","4"," * The ASF licenses this file to You under the Apache license, Version 2.0","5"," * (the \"License\"); you may not use this file except in compliance with","6"," * the License. You may obtain a copy of the License at","7"," *","8"," *      http:\/\/www.apache.org\/licenses\/LICENSE-2.0","9"," *","10"," * Unless required by applicable law or agreed to in writing, software","11"," * distributed under the License is distributed on an \"AS IS\" BASIS,","12"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","13"," * See the license for the specific language governing permissions and","14"," * limitations under the license.","15"," *\/","16","package org.apache.logging.log4j.nosql.appender.couchdb;","17","","18","import java.util.Map;","19","import java.util.concurrent.atomic.AtomicBoolean;","20","","21","import org.apache.logging.log4j.core.appender.AppenderLoggingException;","22","import org.apache.logging.log4j.nosql.appender.DefaultNoSqlObject;","23","import org.apache.logging.log4j.nosql.appender.NoSqlConnection;","24","import org.apache.logging.log4j.nosql.appender.NoSqlObject;","25","import org.apache.logging.log4j.util.Strings;","26","import org.lightcouch.CouchDbClient;","27","import org.lightcouch.Response;","28","","29","\/**","30"," * The Apache CouchDB implementation of {@link NoSqlConnection}.","31"," *\/","32","public final class CouchDbConnection implements NoSqlConnection<Map<String, Object>, DefaultNoSqlObject> {","33","    private final CouchDbClient client;","34","    private final AtomicBoolean closed = new AtomicBoolean(false);","35","","36","    public CouchDbConnection(final CouchDbClient client) {","37","        this.client = client;","38","    }","39","","40","    @Override","41","    public DefaultNoSqlObject createObject() {","42","        return new DefaultNoSqlObject();","43","    }","44","","45","    @Override","46","    public DefaultNoSqlObject[] createList(final int length) {","47","        return new DefaultNoSqlObject[length];","48","    }","49","","50","    @Override","51","    public void insertObject(final NoSqlObject<Map<String, Object>> object) {","52","        try {","53","            final Response response = this.client.save(object.unwrap());","54","            if (Strings.isNotEmpty(response.getError())) {","55","                throw new AppenderLoggingException(\"Failed to write log event to CouchDB due to error: \" +","56","                        response.getError() + '.');","57","            }","58","        } catch (final Exception e) {","59","            throw new AppenderLoggingException(\"Failed to write log event to CouchDB due to error: \" + e.getMessage(),","60","                    e);","61","        }","62","    }","63","","64","    @Override","65","    public void close() {","66","        if (this.closed.compareAndSet(false, true)) {","67","            this.client.shutdown();","68","        }","69","    }","70","","71","    @Override","72","    public boolean isClosed() {","73","        return this.closed.get();","74","    }","75","}"]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-1132\" dev=\"ggregory\" type=\"fix\">","33","        Do not use MongoDB driver 2.13.3 deprecated methods.","34","      <\/action>","35","      <action issue=\"LOG4J2-1040\" dev=\"ggregory\" type=\"update\">","36","        Update MongoDB driver from 2.13.3 to 3.0.4.","37","      <\/action>"],"delete":[]}],"log4j-nosql\/src\/test\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/MongoDbTest.java":[{"add":["25","\/\/@Ignore(\"Requires a running MongoDB server\")\r","29","    public static LoggerContextRule context = new LoggerContextRule(\"log4j2-mongodb-auth.xml\");\r"],"delete":["25","@Ignore(\"Requires a running MongoDB server\")\r","29","    public static LoggerContextRule context = new LoggerContextRule(\"log4j2-mongodb.xml\");\r"]}],"log4j-nosql\/src\/main\/java\/org\/apache\/logging\/log4j\/nosql\/appender\/AbstractNoSqlConnection.java":[{"add":[],"delete":[]}]}},"4db2f5ab14e149e7d2db5e75ca36fc10980af168":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/AbstractFilter.java":[{"add":["30"," * <p>","31"," * Garbage-free note: the methods with unrolled varargs by default delegate to the","32"," * {@link #filter(Logger, Level, Marker, String, Object...) filter method with vararg parameters}.","33"," * Subclasses that want to be garbage-free should override these methods to implement the appropriate filtering","34"," * without creating a vararg array.","35"," * <\/p>","150","     * @since 2.7","167","     * @since 2.7","185","     * @since 2.7","204","     * @since 2.7","224","     * @since 2.7","246","     * @since 2.7","269","     * @since 2.7","293","     * @since 2.7","319","     * @since 2.7","346","     * @since 2.7"],"delete":[]}]}},"0176c88bcd7d0b849efd37d532cee031bd695f0e":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Activator.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Activator.java":[{"add":["47","    \/\/ until we have at least one Provider, we'll lock ProviderUtil which locks LogManager.<clinit> by extension.","48","    \/\/ this variable needs to be reset once the lock has been released","49","    private boolean lockingProviderUtil;","50","","81","        ProviderUtil.STARTUP_LOCK.lock();","82","        lockingProviderUtil = true;","93","        unlockIfReady();","94","    }","95","","96","    private void unlockIfReady() {","97","        if (lockingProviderUtil && !ProviderUtil.PROVIDERS.isEmpty()) {","98","            ProviderUtil.STARTUP_LOCK.unlock();","99","            lockingProviderUtil = false;","100","        }","106","        unlockIfReady();","114","                unlockIfReady();"],"delete":["98","                \/\/ FIXME: LogManager won't see this update if it happens after LogManager is loaded"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":[{"add":["22","import java.util.HashSet;","24","import java.util.concurrent.locks.Lock;","25","import java.util.concurrent.locks.ReentrantLock;","48","    protected static final Collection<Provider> PROVIDERS = new HashSet<Provider>();","49","    protected static final Lock STARTUP_LOCK = new ReentrantLock();","50","    \/\/ STARTUP_LOCK guards INSTANCE for lazy initialization; this allows the OSGi Activator to pause the startup and","51","    \/\/ wait for a Provider to be installed. See LOG4J2-373","52","    private static volatile ProviderUtil INSTANCE;","93","        lazyInit();","98","        lazyInit();","102","    protected static void lazyInit() {","103","        \/\/noinspection DoubleCheckedLocking","104","        if (INSTANCE == null) {","105","            try {","106","                STARTUP_LOCK.lockInterruptibly();","107","                if (INSTANCE == null) {","108","                    INSTANCE = new ProviderUtil();","109","                }","110","            } catch (final InterruptedException e) {","111","                LOGGER.fatal(\"Interrupted before Log4j Providers could be loaded.\", e);","112","                Thread.currentThread().interrupt();","113","            } finally {","114","                STARTUP_LOCK.unlock();","115","            }","116","        }","117","    }","118",""],"delete":["23","import java.util.concurrent.CopyOnWriteArraySet;","46","    private static final Collection<Provider> PROVIDERS = new CopyOnWriteArraySet<Provider>();","49","    }","50","","51","    static {"]}]}},"8dead3bbd15c0e8ad0229ec09ce444130394f752":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jServletContainerInitializer.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jServletContainerInitializerTest.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["165","      <action issue=\"LOG4J2-344\" dev=\"nickwilliams\" type=\"fix\" due-to=\"Keir Lawson, Tomasz Wladzinski\">","166","        Changed the Servlet 3.0 auto-initializer to add the filter by class to get around a WebLogic bug.","167","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jServletContainerInitializer.java":[{"add":["43","                    servletContext.addFilter(\"log4jServletFilter\", Log4jServletFilter.class);"],"delete":["43","                    servletContext.addFilter(\"log4jServletFilter\", new Log4jServletFilter());"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/web\/Log4jServletContainerInitializerTest.java":[{"add":["77","        final Capture<Class<? extends Filter>> filterCapture = new Capture<Class<? extends Filter>>();","103","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue());","110","        final Capture<Class<? extends Filter>> filterCapture = new Capture<Class<? extends Filter>>();","125","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue());","136","        final Capture<Class<? extends Filter>> filterCapture = new Capture<Class<? extends Filter>>();","158","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue());"],"delete":["77","        final Capture<Filter> filterCapture = new Capture<Filter>();","103","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue().getClass());","110","        final Capture<Filter> filterCapture = new Capture<Filter>();","125","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue().getClass());","136","        final Capture<Filter> filterCapture = new Capture<Filter>();","158","        assertSame(\"The filter is not correct.\", Log4jServletFilter.class, filterCapture.getValue().getClass());"]}]}},"d6c8ab0863c551cdf0f8a5b1966ab45e3cddf572":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3304\" dev=\"rgoers\" type=\"fix\" due-to=\"francis-FY\">","34","        Flag LogManager as initiialized if the LoggerFactory is provided as a property.","35","      <\/action>"],"delete":[]}]}},"7df06cfa975f131ebc5058a7c007f30b42f99c79":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfigTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfigTest.java":[{"add":["56","        assertEquals(\"map and list contents equal\", new HashSet<>(list),","57","        \t\t     new HashSet<>(loggerConfig.getPropertyList()));","81","        assertEquals(\"map and list contents equal\", new HashSet<>(list), ","82","        \t\t     new HashSet<>(loggerConfig.getPropertyList()));"],"delete":["56","        assertEquals(\"map and list contents equal\", new HashSet<Property>(list),","57","        \t\t     new HashSet<Property>(loggerConfig.getPropertyList()));","81","        assertEquals(\"map and list contents equal\", new HashSet<Property>(list), ","82","        \t\t     new HashSet<Property>(loggerConfig.getPropertyList()));"]}]}},"583df1af9b46ab537cd2a0e657276d814c26618c":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":[{"add":["593","    @Test  \/\/ LOG4J2-2749","594","    public void testEmptyValuesAreIgnored() {","595","        final AbstractJacksonLayout layout = JsonLayout.newBuilder()","596","                .setAdditionalFields(new KeyValuePair[] {","597","                    new KeyValuePair(\"empty\", \"${ctx:empty:-}\")","598","                })","599","                .setConfiguration(ctx.getConfiguration())","600","                .build();","601","","602","        final String str = layout.toSerializable(LogEventFixtures.createLogEvent());","603","        assertFalse(str, str.contains(\"\\\"empty\\\"\"));","604","    }","605",""],"delete":[]}]}}}