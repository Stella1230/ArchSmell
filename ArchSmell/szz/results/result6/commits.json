{"2c5008bea17160f17b6c4909c7e8c51fa5aa1c12":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncQueueFullPolicyFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/FactoryMethodConnectionSource.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ContextDataFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ContextDataInjectorFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/DisruptorUtil.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/OptionConverter.java":"MODIFY","log4j-api\/pom.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Loader.java":"MODIFY","log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/AbstractLoadBundleTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/CompositeConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ReliabilityStrategyFactory.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncQueueFullPolicyFactory.java":[{"add":["20","import org.apache.logging.log4j.core.util.Loader;","83","            final Class<? extends AsyncQueueFullPolicy> cls = Loader.loadClass(router).asSubclass(AsyncQueueFullPolicy.class);"],"delete":["21","import org.apache.logging.log4j.util.LoaderUtil;","83","            final Class<? extends AsyncQueueFullPolicy> cls = LoaderUtil.loadClass(router).asSubclass(AsyncQueueFullPolicy.class);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/jdbc\/FactoryMethodConnectionSource.java":[{"add":["29","import org.apache.logging.log4j.core.util.Loader;","81","            final Class<?> factoryClass = Loader.loadClass(className);"],"delete":["22","","31","import org.apache.logging.log4j.util.LoaderUtil;","82","            final Class<?> factoryClass = LoaderUtil.loadClass(className);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["44","import org.apache.logging.log4j.core.util.Loader;","67","            Loader.loadClass(ExecutorServices.class.getName());","680","    private void initApiModule() {"],"delete":["52","import org.apache.logging.log4j.util.LoaderUtil;","67","            LoaderUtil.loadClass(ExecutorServices.class.getName());","680","    private void initApiModule() {        "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ContextDataFactory.java":[{"add":["26","import org.apache.logging.log4j.core.util.Loader;","67","            return Loader.loadClass(className).asSubclass(IndexedStringMap.class);"],"delete":["27","import org.apache.logging.log4j.util.LoaderUtil;","67","            return LoaderUtil.loadClass(className).asSubclass(IndexedStringMap.class);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ContextDataInjectorFactory.java":[{"add":["21","import org.apache.logging.log4j.core.util.Loader;","69","            final Class<? extends ContextDataInjector> cls = Loader.loadClass(className).asSubclass("],"delete":["25","import org.apache.logging.log4j.util.LoaderUtil;","69","            final Class<? extends ContextDataInjector> cls = LoaderUtil.loadClass(className).asSubclass("]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/DisruptorUtil.java":[{"add":["25","import com.lmax.disruptor.BlockingWaitStrategy;","26","import com.lmax.disruptor.BusySpinWaitStrategy;","27","import com.lmax.disruptor.ExceptionHandler;","28","import com.lmax.disruptor.SleepingWaitStrategy;","29","import com.lmax.disruptor.TimeoutBlockingWaitStrategy;","30","import com.lmax.disruptor.WaitStrategy;","31","import com.lmax.disruptor.YieldingWaitStrategy;","35","import org.apache.logging.log4j.core.util.Loader;","109","                (Class<? extends ExceptionHandler<RingBufferLogEvent>>) Loader.loadClass(cls);","125","                    (Class<? extends ExceptionHandler<AsyncLoggerConfigDisruptor.Log4jEventWrapper>>) Loader.loadClass(cls);"],"delete":["25","import com.lmax.disruptor.*;","30","import org.apache.logging.log4j.util.LoaderUtil;","103","                (Class<? extends ExceptionHandler<RingBufferLogEvent>>) LoaderUtil.loadClass(cls);","119","                    (Class<? extends ExceptionHandler<AsyncLoggerConfigDisruptor.Log4jEventWrapper>>) LoaderUtil.loadClass(cls);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/OptionConverter.java":[{"add":["227","                final Class<?> classObj = Loader.loadClass(className);"],"delete":["23","import org.apache.logging.log4j.util.LoaderUtil;","228","                final Class<?> classObj = LoaderUtil.loadClass(className);"]}],"log4j-api\/pom.xml":[{"add":[],"delete":["224","              org.apache.logging.log4j.core.osgi;resolution:=optional,","225","              org.apache.logging.log4j.core.util;resolution:=optional,","226","              org.apache.logging.log4j.core.async;resolution:=optional,"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["29","import org.apache.logging.log4j.core.util.Loader;","34","import java.io.*;","35","import java.lang.reflect.Constructor;","36","import java.nio.charset.Charset;","37","import java.util.concurrent.atomic.AtomicInteger;","38","","262","            final Class<?> clazz = Loader.loadClass(JANSI_CLASS);"],"delete":["18","import java.io.FileDescriptor;","19","import java.io.FileOutputStream;","20","import java.io.IOException;","21","import java.io.OutputStream;","22","import java.io.PrintStream;","23","import java.io.Serializable;","24","import java.io.UnsupportedEncodingException;","25","import java.lang.reflect.Constructor;","26","import java.nio.charset.Charset;","27","import java.util.concurrent.atomic.AtomicInteger;","28","","42","import org.apache.logging.log4j.util.LoaderUtil;","268","            final Class<?> clazz = LoaderUtil.loadClass(JANSI_CLASS);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Loader.java":[{"add":["25","import org.apache.logging.log4j.util.PropertiesUtil;","241","    }","242","","271","    @SuppressWarnings(\"unchecked\")","272","    public static <T> T newInstanceOf(final String className)","273","        throws ClassNotFoundException,","274","        IllegalAccessException,","275","        InstantiationException,","276","        NoSuchMethodException,","277","        InvocationTargetException {","278","        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();","279","        try {","280","            Thread.currentThread().setContextClassLoader(getClassLoader());","281","            return LoaderUtil.newInstanceOf(className);","282","        } finally {","283","            Thread.currentThread().setContextClassLoader(contextClassLoader);","284","        }","302","        throws ClassNotFoundException,","303","        NoSuchMethodException,","304","        IllegalAccessException,","305","        InvocationTargetException,","306","        InstantiationException {","307","        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();","308","        try {","309","            Thread.currentThread().setContextClassLoader(getClassLoader());","310","            return LoaderUtil.newCheckedInstanceOf(className, clazz);","311","        } finally {","312","            Thread.currentThread().setContextClassLoader(contextClassLoader);","313","        }","314","    }","315","","316","    \/**","317","     * Loads and instantiates a class given by a property name.","318","     *","319","     * @param propertyName The property name to look up a class name for.","320","     * @param clazz        The class to cast it to.","321","     * @param <T>          The type to cast it to.","322","     * @return new instance of the class given in the property or {@code null} if the property was unset.","323","     * @throws ClassNotFoundException    if the class isn't available to the usual ClassLoaders","324","     * @throws IllegalAccessException    if the class can't be instantiated through a public constructor","325","     * @throws InstantiationException    if there was an exception whilst instantiating the class","326","     * @throws NoSuchMethodException     if there isn't a no-args constructor on the class","327","     * @throws InvocationTargetException if there was an exception whilst constructing the class","328","     * @throws ClassCastException        if the constructed object isn't type compatible with {@code T}","329","     *\/","330","    public static <T> T newCheckedInstanceOfProperty(final String propertyName, final Class<T> clazz)","331","        throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException,","332","        IllegalAccessException {","333","        final String className = PropertiesUtil.getProperties().getStringProperty(propertyName);","334","        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();","335","        try {","336","            Thread.currentThread().setContextClassLoader(getClassLoader());","337","            return LoaderUtil.newCheckedInstanceOfProperty(propertyName, clazz);","338","        } finally {","339","            Thread.currentThread().setContextClassLoader(contextClassLoader);","340","        }","350","        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();","351","        try {","352","            Thread.currentThread().setContextClassLoader(getClassLoader());","353","            return LoaderUtil.isClassAvailable(className);","354","        } finally {","355","            Thread.currentThread().setContextClassLoader(contextClassLoader);","356","        }","363","    \/**","364","     * Loads a class by name. This method respects the {@link #IGNORE_TCCL_PROPERTY} Log4j property. If this property is","365","     * specified and set to anything besides {@code false}, then the default ClassLoader will be used.","366","     *","367","     * @param className The class name.","368","     * @return the Class for the given name.","369","     * @throws ClassNotFoundException if the specified class name could not be found","370","     *\/","371","    public static Class<?> loadClass(final String className) throws ClassNotFoundException {","372","","373","        ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();","374","        try {","375","            Thread.currentThread().setContextClassLoader(getClassLoader());","376","            return LoaderUtil.loadClass(className);","377","        } finally {","378","            Thread.currentThread().setContextClassLoader(contextClassLoader);","379","        }","380","    }"],"delete":["240","    }    ","241","    ","270","    public static Object newInstanceOf(final String className)","271","            throws ClassNotFoundException,","272","                   IllegalAccessException,","273","                   InstantiationException,","274","                   NoSuchMethodException,","275","                   InvocationTargetException {","276","        return LoaderUtil.newInstanceOf(className);","294","            throws ClassNotFoundException,","295","                   NoSuchMethodException,","296","                   IllegalAccessException,","297","                   InvocationTargetException,","298","                   InstantiationException {","299","        return LoaderUtil.newCheckedInstanceOf(className, clazz);","309","        return LoaderUtil.isClassAvailable(className);"]}],"log4j-osgi\/src\/test\/java\/org\/apache\/logging\/log4j\/osgi\/tests\/AbstractLoadBundleTest.java":[{"add":["234","    public void testLoadingOfConfigurableCoreClasses() throws BundleException, ReflectiveOperationException {","251","        \/\/ org.apache.logging.log4j.core.osgi.BundleContextSelector cannot be found by org.apache.logging.log4j.api","252","        final boolean result = baos.toString().contains(\"BundleContextSelector cannot be found\");","253","        Assert.assertFalse(\"Core class BundleContextSelector cannot be loaded in OSGI setup\", result);"],"delete":["234","    public void testMissingImportOfCoreOsgiPackage() throws BundleException, ReflectiveOperationException {","251","        final boolean result = baos.toString().contains(","252","            \"ERROR StatusLogger Unable to create context org.apache.logging.log4j.core.osgi.BundleContextSelector\");","253","        Assert.assertFalse(","254","            \"org.apache.logging.log4j.core.osgi;resolution:=optional is missing in Import-Package in the POM\", result);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":[{"add":["50","import org.apache.logging.log4j.core.util.Loader;","83","                final Class<?> clazz = Loader.loadClass(factory);"],"delete":["51","import org.apache.logging.log4j.util.LoaderUtil;","83","                final Class<?> clazz = LoaderUtil.loadClass(factory);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["41","import org.apache.logging.log4j.core.util.Loader;","176","            addFactory(list, Loader.loadClass(factoryClass).asSubclass(ConfigurationFactory.class));"],"delete":["175","            addFactory(list, LoaderUtil.loadClass(factoryClass).asSubclass(ConfigurationFactory.class));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":[{"add":["35","import org.apache.logging.log4j.core.util.Loader;","98","            final ContextSelector selector = Loader.newCheckedInstanceOfProperty(Constants.LOG4J_CONTEXT_SELECTOR,","111","            final ShutdownCallbackRegistry registry = Loader.newCheckedInstanceOfProperty("],"delete":["97","            final ContextSelector selector = LoaderUtil.newCheckedInstanceOfProperty(Constants.LOG4J_CONTEXT_SELECTOR,","110","            final ShutdownCallbackRegistry registry = LoaderUtil.newCheckedInstanceOfProperty("]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/CompositeConfiguration.java":[{"add":["37","import org.apache.logging.log4j.core.util.Loader;","71","            mergeStrategy = Loader.newInstanceOf(mergeStrategyClassName);"],"delete":["70","            mergeStrategy = LoaderUtil.newInstanceOf(mergeStrategyClassName);"]}],"src\/changes\/changes.xml":[{"add":["99","      <action issue=\"LOG4J2-2482\" dev=\"ggregory\" type=\"fix\" due-to=\"Rob Gansevles\">","100","        BasicContextSelector cannot be used in a OSGI application.","101","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ReliabilityStrategyFactory.java":[{"add":["19","import org.apache.logging.log4j.core.util.Loader;","60","            final Class<? extends ReliabilityStrategy> cls = Loader.loadClass(strategy).asSubclass("],"delete":["20","import org.apache.logging.log4j.util.LoaderUtil;","60","            final Class<? extends ReliabilityStrategy> cls = LoaderUtil.loadClass(strategy).asSubclass("]}]}},"cb631914cef1cd27a2bba38bb13977f02a1bb5be":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["44","import org.apache.logging.log4j.core.util.ReflectionUtil;","46","import org.apache.logging.log4j.util.LoaderUtil;","167","            addFactory(list, (Class<ConfigurationFactory>) LoaderUtil.loadClass(factoryClass));","176","            list.add(ReflectionUtil.instantiate(factoryClass));","253","            final ClassLoader loader = LoaderUtil.getThreadContextClassLoader();","393","                        final ClassLoader loader = LoaderUtil.getThreadContextClassLoader();","447","            final ClassLoader loader = LoaderUtil.getThreadContextClassLoader();"],"delete":["165","            addFactory(list, (Class<ConfigurationFactory>) Loader.loadClass(factoryClass));","174","            list.add(factoryClass.getConstructor().newInstance());","251","            final ClassLoader loader = Loader.getThreadContextClassLoader();","391","                        final ClassLoader loader = this.getClass().getClassLoader();","445","            final ClassLoader loader = this.getClass().getClassLoader();"]}]}},"f151e0cd9b4c684cc2e76e20b02ed4d94d2a4ec1":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["34","        Fix substitutions when programmatic configuration is used"],"delete":["34","        log4j-jpl formats message parameters correctly using MessageFormat."]}]}},"bf222249d54b6958e0bee4006958e661a25dfa97":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongodb\/MongoDBConnection.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/nosql\/mongodb\/MongoDBConnection.java":[{"add":["91","        \/\/ there's no need to call this.mongo.close() since that literally closes the connection","92","        \/\/ MongoDBClient uses internal connection pooling","93","        \/\/ for more details, see LOG4J2-591"],"delete":["91","        this.mongo.close();"]}]}},"3f1e0fdc886d65c552bdce3e9d0065cf7f5a1eab":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SMTPAppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SMTPManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-310\" dev=\"rpopma\" type=\"fix\" due-to=\"Olivier Lemasle\">","24","        Fixed issue where SMTPAppender did not send mails with error or fatal level without prior info event.","25","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SMTPAppenderTest.java":[{"add":["18","import static org.junit.Assert.*;","19","","20","import java.util.Iterator;","21","","27","import org.apache.logging.dumbster.smtp.SimpleSmtpServer;","28","import org.apache.logging.dumbster.smtp.SmtpMessage;","54","            array = new Address[] { addr };","59","        assertArrayEquals(new Address[] { new InternetAddress(address) },","60","                builder.getMimeMessage().getFrom());","74","        assertArrayEquals(InternetAddress.parse(addresses), builder","75","                .getMimeMessage().getReplyTo());","83","        assertNull(builder.getMimeMessage().getRecipients(","84","                Message.RecipientType.TO));","87","        assertNull(builder.getMimeMessage().getRecipients(","88","                Message.RecipientType.TO));","91","        assertArrayEquals(InternetAddress.parse(addresses), builder","92","                .getMimeMessage().getRecipients(Message.RecipientType.TO));","111","        final CyclicBuffer<Integer> buffer = new CyclicBuffer<Integer>(","112","                Integer.class, 3);","132","        final SMTPAppender appender = SMTPAppender.createAppender(\"Test\",","133","                \"to@example.com\", \"cc@example.com\", \"bcc@example.com\",","134","                \"from@example.com\", \"replyTo@example.com\", \"Subject\", null,","135","                HOST, PORT, null, null, \"false\", \"3\", null, null, \"true\");","150","        root.error(\"Error with exception\", new RuntimeException(","151","                \"Exception message\"));","152","        root.error(\"Error message #2\");","155","        assertTrue(server.getReceivedEmailSize() == 2);","156","        final Iterator<SmtpMessage> messages = server.getReceivedEmail();","157","        final SmtpMessage email = messages.next();","175","        assertFalse(body.contains(\"Error message #2\"));","176","","177","        final SmtpMessage email2 = (SmtpMessage) messages.next();","178","        final String body2 = email2.getBody();","179","        assertFalse(body2.contains(\"Debug message #4\"));","180","        assertFalse(body2.contains(\"Error with exception\"));","181","        assertTrue(body2.contains(\"Error message #2\"));"],"delete":["31","import org.apache.logging.dumbster.smtp.SimpleSmtpServer;","32","import org.apache.logging.dumbster.smtp.SmtpMessage;","33","","34","import static org.junit.Assert.assertEquals;","35","import static org.junit.Assert.assertNull;","36","import static org.junit.Assert.assertTrue;","37","import static org.junit.Assert.assertFalse;","38","import static org.junit.Assert.assertArrayEquals;","39","","57","            array = new Address[] {addr};","62","        assertArrayEquals(new Address[] { new InternetAddress(address) }, builder.getMimeMessage().getFrom());","76","        assertArrayEquals(InternetAddress.parse(addresses), builder.getMimeMessage().getReplyTo());","84","        assertNull(builder.getMimeMessage().getRecipients(Message.RecipientType.TO));","87","        assertNull(builder.getMimeMessage().getRecipients(Message.RecipientType.TO));","90","        assertArrayEquals(InternetAddress.parse(addresses), builder.getMimeMessage().getRecipients(Message.RecipientType.TO));","109","        final CyclicBuffer<Integer> buffer = new CyclicBuffer<Integer>(Integer.class, 3);","127","","130","        final SMTPAppender appender = SMTPAppender.createAppender(\"Test\", \"to@example.com\", \"cc@example.com\", \"bcc@example.com\", \"from@example.com\",","131","            \"replyTo@example.com\", \"Subject\", null, HOST, PORT, null, null, \"false\", \"3\", null, null,","132","            \"true\");","147","        root.error(\"Error with exception\", new RuntimeException(\"Exception message\"));","150","        assertTrue(server.getReceivedEmailSize() == 1);","151","        final SmtpMessage email = server.getReceivedEmail().next();","171",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SMTPManager.java":[{"add":["138","            \/\/ LOG4J-310: log appendEvent even if priorEvents is empty","139","            "],"delete":["138","            if (priorEvents == null || priorEvents.length == 0) {","139","                return; \/\/ nothing to do, another thread already took all events","140","            }"]}]}},"4ab8b807217c01c737dde985b417e492989325f7":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManagerTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManagerTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["152","        this.directWrite = rolloverStrategy instanceof DirectFileRolloverStrategy;"],"delete":["152","        this.directWrite = rolloverStrategy instanceof DirectWriteRolloverStrategy;"]}]}},"5e052c903bcbc29c8f4be5e7b08413c1e121312a":{"changes":{"log4j-core\/src\/test\/resources\/log4j-set-level.xml":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfiguratorSetLevelTest.java":"ADD"},"diff":{"log4j-core\/src\/test\/resources\/log4j-set-level.xml":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfiguratorSetLevelTest.java":[{"add":[],"delete":[]}]}},"88641f4938789e63aea84289998b6c443fe0f5f9":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["57","    private static String nestedPattern =","58","        \"%highlight{%d{dd MMM yyyy HH:mm:ss,SSS}{GMT+0} [%t] %-5level: %msg%n%throwable}\";","107","        String expected = \"INFO  [PatternParserTest        :98  ] - Hello, world\" + LINE_SEP;","111","    @Test","112","    public void testNestedPattern() {","113","        List<PatternFormatter> formatters = parser.parse(nestedPattern);","114","        assertNotNull(formatters);","115","        Throwable t = new Throwable();","116","        StackTraceElement[] elements = t.getStackTrace();","117","        LogEvent event = new Log4jLogEvent(\"org.apache.logging.log4j.PatternParserTest\", MarkerManager.getMarker(\"TEST\"),","118","            Logger.class.getName(), Level.INFO, new SimpleMessage(\"Hello, world\"), null,","119","            null, null, \"Thread1\", elements[0], System.currentTimeMillis());","120","        StringBuilder buf = new StringBuilder();","121","        for (PatternFormatter formatter : formatters) {","122","            formatter.format(event, buf);","123","        }","124","        String str = buf.toString();","125","        String expected = \"] INFO : Hello, world\\n\\u001B[m\";","126","        assertTrue(\" Expected to end with: \" + expected + \". Actual: \" + str, str.endsWith(expected));","127","    }"],"delete":["105","        String expected = \"INFO  [PatternParserTest        :96  ] - Hello, world\" + LINE_SEP;"]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-107\" dev=\"rgoers\" type=\"fix\">","26","        PatternParser was not properly handling adjacent nested options","27","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["212","            int begin = i++;","218","                    int next = pattern.indexOf(\"{\", i);"],"delete":["212","            int begin = i;","218","                    int next = pattern.indexOf(\"{\", i + 1);"]}]}},"5e246db53458fc6ea26e47b07aba60f5189eef4e":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverterTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverterTest.java":[{"add":["78","        final TimeZone tz = TimeZone.getTimeZone(\"UTC\");","79","        final SimpleDateFormat sdf = new SimpleDateFormat(converter.getPattern());","80","        sdf.setTimeZone(tz);","81","        final long adjusted = event.getTimeMillis() + tz.getDSTSavings();","82","        final String expected = sdf.format(new Date(adjusted));","83","        \/\/ final String expected = \"2011-12-30T09:56:35,987\";"],"delete":["78","        final String expected = \"2011-12-30T09:56:35,987\";"]}]}},"90e2de3d46eebc3dd6b8a0cee3c8f2a041131374":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/MarkerManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["97","      <action issue=\"LOG4J2-3159\" dev=\"ckozak\" type=\"fix\">","98","        Fixed an unlikely race condition in Log4jMarker.getParents() volatile access.","99","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/MarkerManager.java":[{"add":["233","            Marker[] parentsSnapshot = parents;","234","            if (parentsSnapshot == null) {","237","            return Arrays.copyOf(parentsSnapshot, parentsSnapshot.length);"],"delete":["233","            if (this.parents == null) {","236","            return Arrays.copyOf(this.parents, this.parents.length);"]}]}},"5f99a5d05254dc81a8c9c649e944f991f94529fa":{"changes":{"log4j-api\/src\/main\/resources\/Log4j-charsets.properties":"MODIFY"},"diff":{"log4j-api\/src\/main\/resources\/Log4j-charsets.properties":[{"add":["31","cp57009 = x-ISCII91","32","cp708 = ISO-8859-6"],"delete":["31","cp57009 = x-ISCII91"]}]}},"798e625147ef90514cc99a7d1ffdec1b38167a0a":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManagerTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManager.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManagerTest.java":[{"add":["24","import static org.mockito.Mockito.*;","119","        final LogEvent event1copy = mock(LogEvent.class);","120","        final LogEvent event2copy = mock(LogEvent.class);","121","        final LogEvent event3copy = mock(LogEvent.class);","122","        final LogEvent event4copy = mock(LogEvent.class);","123","","124","        when(event1.toImmutable()).thenReturn(event1copy);","125","        when(event2.toImmutable()).thenReturn(event2copy);","126","        when(event3.toImmutable()).thenReturn(event3copy);","127","        when(event4.toImmutable()).thenReturn(event4copy);","128","","138","        then(manager).should().writeInternal(same(event1copy));","139","        then(manager).should().writeInternal(same(event2copy));","140","        then(manager).should().writeInternal(same(event3copy));","141","        then(manager).should().writeInternal(same(event4copy));","154","        final LogEvent event1copy = mock(LogEvent.class);","155","        final LogEvent event2copy = mock(LogEvent.class);","156","        final LogEvent event3copy = mock(LogEvent.class);","157","","158","        when(event1.toImmutable()).thenReturn(event1copy);","159","        when(event2.toImmutable()).thenReturn(event2copy);","160","        when(event3.toImmutable()).thenReturn(event3copy);","161","","171","        then(manager).should().writeInternal(same(event1copy));","172","        then(manager).should().writeInternal(same(event2copy));","173","        then(manager).should().writeInternal(same(event3copy));","186","        final LogEvent event1copy = mock(LogEvent.class);","187","        final LogEvent event2copy = mock(LogEvent.class);","188","        final LogEvent event3copy = mock(LogEvent.class);","189","","190","        when(event1.toImmutable()).thenReturn(event1copy);","191","        when(event2.toImmutable()).thenReturn(event2copy);","192","        when(event3.toImmutable()).thenReturn(event3copy);","193","","203","        then(manager).should().writeInternal(same(event1copy));","204","        then(manager).should().writeInternal(same(event2copy));","205","        then(manager).should().writeInternal(same(event3copy));"],"delete":["24","import static org.mockito.Mockito.mock;","25","import static org.mockito.Mockito.reset;","26","import static org.mockito.Mockito.spy;","130","        then(manager).should().writeInternal(same(event1));","131","        then(manager).should().writeInternal(same(event2));","132","        then(manager).should().writeInternal(same(event3));","133","        then(manager).should().writeInternal(same(event4));","155","        then(manager).should().writeInternal(same(event1));","156","        then(manager).should().writeInternal(same(event2));","157","        then(manager).should().writeInternal(same(event3));","179","        then(manager).should().writeInternal(same(event1));","180","        then(manager).should().writeInternal(same(event2));","181","        then(manager).should().writeInternal(same(event3));"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2060\" dev=\"rpopma\" type=\"fix\">","34","        AbstractDatabaseManager should make a copy of LogEvents before holding references to them: AsyncLogger log events are mutable.","35","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["181","    <springVersion>3.2.18.RELEASE<\/springVersion>"],"delete":["181","    <springVersion>4.3.12.RELEASE<\/springVersion>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/db\/AbstractDatabaseManager.java":[{"add":["164","            this.buffer.add(event.toImmutable());\r"],"delete":["164","            this.buffer.add(event);\r"]}]}},"ca161e7e86df696629d5a9404b342ef80a0fcf94":{"changes":{"\/dev\/null":"DELETE","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationTest.java":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":[],"delete":["23","import java.util.Properties;","97","     * Create a limited Interpolator.","98","     *\/","99","    public Interpolator(final Properties properties) {","100","        Map<String, String> defaultProps = new HashMap<>();","101","        if (properties != null) {","102","            properties.forEach((key, value) -> defaultProps.put(key.toString(), value.toString()));","103","        }","104","        this.defaultLookup = new PropertiesLookup(defaultProps);","105","        strLookupMap.put(\"sys\", new SystemPropertiesLookup());","106","        strLookupMap.put(\"env\", new EnvironmentLookup());","107","    }","108","","109","    \/**"]}],"src\/changes\/changes.xml":[{"add":[],"delete":["211","      <action issue=\"LOG4J2-3394\" dev=\"rgoers\" type=\"fix\">","212","        Allow substitution of system properties and environment variables in shorthand variables introduced in LOG4J2-3341.","213","      <\/action>"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/lookup\/InterpolatorTest.java":[{"add":[],"delete":["23","import java.util.Properties;","49","    private static final String TESTKEY3 = \"TestKey3\";","50","    private static final String TESTKEY4 = \"TestKey4\";","51","    private static final String TESTVAL3 = \"${sys:TestKey4:-default}\";","52","    private static final String TESTVAL4 = \"TestVal4\";","63","            System.setProperty(TESTKEY3, TESTVAL3);","64","            System.setProperty(TESTKEY4, TESTVAL4);","72","            System.clearProperty(TESTKEY3);","73","            System.clearProperty(TESTKEY4);","188","","189","    @Test","190","    public void testLimited() {","191","        Interpolator interpolator = new Interpolator((Properties) null);","192","        String original = \"${sys:TestKey3}\";","193","        String result = new StrSubstitutor(interpolator).replace(original);","194","        assertEquals(TESTVAL3, result);","195","    }"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":[{"add":["199","    private static void useSyntheticLevelAndAppenderRefs(final String propertyName, final Properties loggerProps, final Properties context) {","200","        final String propertyValue = (String) context.remove(propertyName);"],"delete":["40","import org.apache.logging.log4j.core.lookup.Interpolator;","41","import org.apache.logging.log4j.core.lookup.StrSubstitutor;","73","    private final StrSubstitutor subst = new StrSubstitutor(new Interpolator((Properties) null));","202","    private void useSyntheticLevelAndAppenderRefs(final String propertyName, final Properties loggerProps, final Properties context) {","203","        String propertyValue = (String) context.remove(propertyName);","205","            propertyValue = subst.replace(propertyValue);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationTest.java":[{"add":[],"delete":["33","import org.junitpioneer.jupiter.SetSystemProperty;","133","","134","    @Test","135","    @LoggerContextSource(\"LoggerLevelAppenderTestWithSubst.properties\")","136","    void testLoggerLevelAppenderWithSubst(final LoggerContext context, @Named final ListAppender first, @Named final ListAppender second) {","137","        context.getLogger(getClass()).atInfo().log(\"message\");","138","        final List<LogEvent> firstEvents = first.getEvents();","139","        final List<LogEvent> secondEvents = second.getEvents();","140","        assertEquals(firstEvents, secondEvents);","141","        assertEquals(1, firstEvents.size());","142","    }","143","","144","    @SetSystemProperty(key = \"core.config.logger\", value = \"DEBUG , second\")","145","    @Test","146","    @LoggerContextSource(\"LoggerLevelAppenderTestWithSubst.properties\")","147","    void testLoggerLevelAppenderWithSysSubst(final LoggerContext context, @Named final ListAppender first, @Named final ListAppender second) {","148","        context.getLogger(getClass()).atInfo().log(\"message\");","149","        final List<LogEvent> firstEvents = first.getEvents();","150","        final List<LogEvent> secondEvents = second.getEvents();","151","        assertEquals(0, firstEvents.size());","152","        assertEquals(1, secondEvents.size());","153","    }"]}]}},"54dcbf7b26e677760fff3e79508da1f4a0cd09a5":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/TimeBasedTriggeringPolicy.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-999\" dev=\"rpopma\" type=\"fix\" due-to=\"Joan Balaguer¨®\">","27","        RollingFileAppender should also roll over when log event time is equal to rollover time, not only when later.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/TimeBasedTriggeringPolicy.java":[{"add":["74","        if (nowMillis >= nextRolloverMillis) {"],"delete":["74","        if (nowMillis > nextRolloverMillis) {"]}]}},"f9dc92b52b17b5033452e862ea0c2ab0e187117c":{"changes":{"log4j-kubernetes\/src\/main\/java\/org\/apache\/logging\/log4j\/kubernetes\/KubernetesLookup.java":"MODIFY"},"diff":{"log4j-kubernetes\/src\/main\/java\/org\/apache\/logging\/log4j\/kubernetes\/KubernetesLookup.java":[{"add":["57","    private static final Lock initLock = new ReentrantLock();","58","    private static final boolean isSpringIncluded =","59","            LoaderUtil.isClassAvailable(\"org.apache.logging.log4j.spring.cloud.config.client.SpringEnvironmentHolder\")","60","                    || LoaderUtil.isClassAvailable(\"org.apache.logging.log4j.spring.boot.SpringEnvironmentHolder\");","94","                                namespace = client.namespaces().withName(info.namespace).get();"],"delete":["57","    private static Lock initLock = new ReentrantLock();","58","    private static boolean isSpringIncluded =","59","            LoaderUtil.isClassAvailable(\"org.apache.logging.log4j.spring.cloud.config.client.SpringEnvironmentHolder\");","93","                                namespace = namespace = client.namespaces().withName(info.namespace).get();"]}]}},"fc31b44b629d9fe46bd96bfd02382519dfdb5f40":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/ExecutorServices.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThreadContextDataInjector.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/ExecutorServices.java":[{"add":["80","    \/** no-op method which can be invoked to ensure this class has been initialized per jls-12.4.2. *\/","81","    public static void ensureInitialized() {}"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThreadContextDataInjector.java":[{"add":["20","import java.util.Collections;","63","    private static final List<ContextDataProvider> SERVICE_PROVIDERS = getServiceProviders();","65","    \/**","66","     * Previously this method allowed ContextDataProviders to be loaded eagerly, now they","67","     * are loaded when this class is initialized.","68","     *","69","     * @deprecated no-op","70","     *\/","71","    @Deprecated","72","    public static void initServiceProviders() {}","87","        return Collections.unmodifiableList(providers);","278","        final List<ContextDataProvider> providers =","279","                new ArrayList<>(contextDataProviders.size() + SERVICE_PROVIDERS.size());","280","        providers.addAll(contextDataProviders);","281","        providers.addAll(SERVICE_PROVIDERS);"],"delete":["25","import java.util.concurrent.locks.Lock;","26","import java.util.concurrent.locks.ReentrantLock;","64","    private static volatile List<ContextDataProvider> serviceProviders = null;","65","    private static final Lock providerLock = new ReentrantLock();","67","    public static void initServiceProviders() {","68","        if (serviceProviders == null) {","69","            providerLock.lock();","70","            try {","71","                if (serviceProviders == null) {","72","                    serviceProviders = getServiceProviders();","73","                }","74","            } finally {","75","                providerLock.unlock();","76","            }","77","        }","78","    }","93","        return providers;","284","        initServiceProviders();","285","        final List<ContextDataProvider> providers = new ArrayList<>(contextDataProviders);","286","        if (serviceProviders != null) {","287","            providers.addAll(serviceProviders);","288","        }"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["293","                \/\/ LOG4J2-1642 preload ExecutorServices as it is used in shutdown hook","294","                ExecutorServices.ensureInitialized();"],"delete":["43","import org.apache.logging.log4j.core.impl.ThreadContextDataInjector;","47","import org.apache.logging.log4j.core.util.Loader;","70","    static {","71","        try {","72","            \/\/ LOG4J2-1642 preload ExecutorServices as it is used in shutdown hook","73","            Loader.loadClass(ExecutorServices.class.getName());","74","        } catch (final Exception e) {","75","            LOGGER.error(\"Failed to preload ExecutorServices class.\", e);","76","        }","77","    }","78","","137","        Thread runner = new Thread(new ThreadContextDataTask(), \"Thread Context Data Task\");","138","        runner.setDaemon(true);","139","        runner.start();","168","        Thread runner = new Thread(new ThreadContextDataTask(), \"Thread Context Data Task\");","169","        runner.setDaemon(true);","170","        runner.start();","788","","789","    private class ThreadContextDataTask implements Runnable {","790","","791","        @Override","792","        public void run() {","793","            LOGGER.debug(\"Initializing Thread Context Data Service Providers\");","794","            ThreadContextDataInjector.initServiceProviders();","795","            LOGGER.debug(\"Thread Context Data Service Provider initialization complete\");","796","        }","797","    }"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3333\" dev=\"ckozak\" type=\"fix\">","34","        Fix ThreadContextDataInjector initialization deadlock","35","      <\/action>"],"delete":[]}]}},"1a96e1bbb78e2453279c9d831e78d2d117fb479d":{"changes":{"src\/changes\/changes.xml":"MODIFY","flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-300\" dev=\"rgoers\" type=\"fix\">","24","        WriterThread was ending when no agents are available which caused an OutOfMemoryError.","25","      <\/action>"],"delete":[]}],"flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":[{"add":["33","import java.util.concurrent.locks.AbstractQueuedSynchronizer;","84","    private final Gate gate = new Gate();","114","        this.worker = new WriterThread(database, environment, this, gate, batchSize, secretKey);","134","    public static FlumePersistentManager getManager(final String name, final Agent[] agents,","135","                                                    final Property[] properties, int batchSize, final int retries,","136","                                                    final int connectionTimeout, final int requestTimeout,","137","                                                    final int delay, final String dataDir) {","186","            final Future<Integer> future = threadPool.submit(new BDBWriter(keyData, eventData, environment, database,","187","                gate));","247","        private final Gate gate;","249","        public BDBWriter(final byte[] keyData, final byte[] eventData, final Environment environment,","250","                         final Database database, final Gate gate) {","255","            this.gate = gate;","266","                gate.open();","408","        private final Gate gate;","412","        public WriterThread(final Database database, final Environment environment,","413","                            final FlumePersistentManager manager, final Gate gate, final int batchsize, final SecretKey secretKey) {","417","            this.gate = gate;","426","            gate.open();","446","                        gate.close();","465","                                    errors = true;","467","                                if (!errors) {","468","                                    cursor.close();","469","                                    cursor = null;","470","                                    final Transaction txn = environment.beginTransaction(null, null);","471","                                    try {","472","                                        for (final Event event : batch.getEvents()) {","473","                                            try {","474","                                                final Map<String, String> headers = event.getHeaders();","475","                                                key = new DatabaseEntry(headers.get(FlumeEvent.GUID).getBytes(UTF8));","476","                                                database.delete(txn, key);","477","                                            } catch (final Exception ex) {","478","                                                LOGGER.error(\"Error deleting key from database\", ex);","479","                                            }","481","                                        txn.commit();","482","                                    } catch (final Exception ex) {","483","                                        LOGGER.error(\"Unable to commit transaction\", ex);","484","                                        if (txn != null) {","485","                                            txn.abort();","486","                                        }","551","                            gate.waitForOpen(interval, TimeUnit.MILLISECONDS);","626","    }","628","    private static class Gate {","629","        private static class Synchronizer extends AbstractQueuedSynchronizer {","630","            boolean isSignalled() { return getState() != 0; }","631","","632","            protected int tryAcquireShared(int ignore) {","633","                return isSignalled()? 1 : -1;","634","            }","635","","636","            protected boolean tryReleaseShared(int state) {","637","                setState(state);","638","                return true;","639","            }","640","        }","641","","642","        private final Synchronizer sync = new Synchronizer();","643","        public boolean isSignalled() { return sync.isSignalled(); }","644","        public void open()         { sync.releaseShared(1); }","645","        public void close()        { sync.releaseShared(0); }","646","        public void waitForOpen(long timeout, TimeUnit timeUnit) throws InterruptedException {","647","            sync.tryAcquireSharedNanos(1, timeUnit.toNanos(timeout));","648","        }"],"delete":["30","import java.util.concurrent.LinkedBlockingQueue;","34","","85","    private final LinkedBlockingQueue<byte []> queue = new LinkedBlockingQueue<byte[]>();","115","        this.worker = new WriterThread(database, environment, this, queue, batchSize, secretKey);","135","    public static FlumePersistentManager getManager(final String name, final Agent[] agents, final Property[] properties,","136","                                                    int batchSize, final int retries, final int connectionTimeout,","137","                                                    final int requestTimeout, final int delay, final String dataDir) {","186","            final Future<Integer> future = threadPool.submit(new BDBWriter(keyData, eventData, environment, database, queue));","246","        private final LinkedBlockingQueue<byte[]> queue;","248","        public BDBWriter(final byte[] keyData, final byte[] eventData, final Environment environment, final Database database,","249","                         final LinkedBlockingQueue<byte[]> queue) {","254","            this.queue = queue;","265","                queue.add(keyData);","407","        private final LinkedBlockingQueue<byte[]> queue;","411","        public WriterThread(final Database database, final Environment environment, final FlumePersistentManager manager,","412","                            final LinkedBlockingQueue<byte[]> queue, final int batchsize, final SecretKey secretKey) {","416","            this.queue = queue;","425","            if (queue.size() == 0) {","426","                queue.add(SHUTDOWN.getBytes(UTF8));","427","            }","447","                        queue.clear();","466","                                    break;","468","                                cursor.close();","469","                                cursor = null;","470","                                final Transaction txn = environment.beginTransaction(null, null);","471","                                try {","472","                                    for (final Event event : batch.getEvents()) {","473","                                        try {","474","                                            final Map<String, String> headers = event.getHeaders();","475","                                            key = new DatabaseEntry(headers.get(FlumeEvent.GUID).getBytes(UTF8));","476","                                            database.delete(txn, key);","477","                                        } catch (final Exception ex) {","478","                                            LOGGER.error(\"Error deleting key from database\", ex);","480","                                    }","481","                                    txn.commit();","482","                                } catch (final Exception ex) {","483","                                    LOGGER.error(\"Unable to commit transaction\", ex);","484","                                    if (txn != null) {","485","                                        txn.abort();","550","                            queue.poll(interval, TimeUnit.MILLISECONDS);"]}]}},"9f5e78dc87f7fa9bc9ff2a4cfce5fc4ddf3f3585":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["194","            if (child.getName().equalsIgnoreCase(\"Properties\")) {","206","            if (child.getName().equalsIgnoreCase(\"Appenders\")) {","210","            } else if (child.getName().equalsIgnoreCase(\"Loggers\")) {"],"delete":["194","            if (child.getName().equalsIgnoreCase(\"properties\")) {","206","            if (child.getName().equalsIgnoreCase(\"appenders\")) {","210","            } else if (child.getName().equalsIgnoreCase(\"loggers\")) {"]}]}},"a169132835ec26f3ee66528a41219c1425ade332":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/TestLoggerContext.java":"MODIFY","log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/Log4jTaglibLoggerContext.java":"MODIFY","log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLoggerContext.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":"ADD","log4j-taglib\/src\/test\/java\/org\/apache\/logging\/log4j\/taglib\/LoggerAwareTagSupportTest.java":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigUseAfterShutdownTest.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/EventLogger.java":"MODIFY","log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/Log4jTaglibLogger.java":"MODIFY","log4j-jcl\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/LogFactoryImpl.java":"MODIFY","log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLogger.java":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLogger.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLoggerContext.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLogger.java":"ADD","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/TestLogger.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-jcl\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/Log4jLog.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLoggerWrapper.java":"ADD","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContext.java":"MODIFY","\/dev\/null":"DELETE","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerUseAfterShutdownTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/XmlLayoutTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":"MODIFY","log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/TagUtils.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/TestLoggerContext.java":[{"add":["23","import org.apache.logging.log4j.spi.ExtendedLogger;","29","    private final Map<String, ExtendedLogger> map = new HashMap<String, ExtendedLogger>();","32","    public ExtendedLogger getLogger(final String name) {","36","        final ExtendedLogger logger = new TestLogger(name);","42","    public ExtendedLogger getLogger(final String name, final MessageFactory messageFactory) {"],"delete":["23","import org.apache.logging.log4j.spi.LoggerProvider;","29","    private final Map<String, LoggerProvider> map = new HashMap<String, LoggerProvider>();","32","    public LoggerProvider getLogger(final String name) {","36","        final LoggerProvider logger = new TestLogger(name);","42","    public LoggerProvider getLogger(final String name, final MessageFactory messageFactory) {"]}],"log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/Log4jTaglibLoggerContext.java":[{"add":["24","import org.apache.logging.log4j.spi.AbstractLogger;","26","import org.apache.logging.log4j.spi.ExtendedLogger;","63","            AbstractLogger.checkMessageFactory(logger, factory);","71","                final ExtendedLogger original = factory == null ?"],"delete":["24","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","26","import org.apache.logging.log4j.spi.LoggerProvider;","63","            AbstractLoggerProvider.checkMessageFactory(logger, factory);","71","                final LoggerProvider original = factory == null ?"]}],"log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLoggerContext.java":[{"add":["23","import org.apache.logging.log4j.spi.ExtendedLogger;","38","    public ExtendedLogger getLogger(final String name) {","46","    public ExtendedLogger getLogger(final String name, final MessageFactory messageFactory) {"],"delete":["23","import org.apache.logging.log4j.spi.LoggerProvider;","38","    public LoggerProvider getLogger(final String name) {","46","    public LoggerProvider getLogger(final String name, final MessageFactory messageFactory) {"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/AbstractLogger.java":[{"add":[],"delete":[]}],"log4j-taglib\/src\/test\/java\/org\/apache\/logging\/log4j\/taglib\/LoggerAwareTagSupportTest.java":[{"add":["20","import org.apache.logging.log4j.spi.AbstractLogger;","76","        final AbstractLogger wrapped = (AbstractLogger)LogManager.getLogger(\"testGetLoggerWithTaglibLogger\");"],"delete":["20","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","76","        final AbstractLoggerProvider wrapped = (AbstractLoggerProvider)LogManager.getLogger(\"testGetLoggerWithTaglibLogger\");"]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":[{"add":["25","import org.apache.logging.log4j.spi.ExtendedLogger;","100","        public static ExtendedLogger getLogger(final String name) {"],"delete":["25","import org.apache.logging.log4j.spi.LoggerProvider;","100","        public static LoggerProvider getLogger(final String name) {"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigUseAfterShutdownTest.java":[{"add":["24","import org.apache.logging.log4j.spi.AbstractLogger;","43","        ((AbstractLogger) log).logMessage(\"com.foo.Bar\", Level.INFO, null, new SimpleMessage(\"msg\"), null);"],"delete":["24","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","43","        ((AbstractLoggerProvider) log).logMessage(\"com.foo.Bar\", Level.INFO, null, new SimpleMessage(\"msg\"), null);"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/EventLogger.java":[{"add":["19","import org.apache.logging.log4j.spi.ExtendedLogger;","35","    private static final ExtendedLogger LOGGER = LogManager.getContext(false).getLogger(NAME);"],"delete":["19","import org.apache.logging.log4j.spi.LoggerProvider;","35","    private static final LoggerProvider LOGGER = LogManager.getContext(false).getLogger(NAME);"]}],"log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/Log4jTaglibLogger.java":[{"add":["20","import org.apache.logging.log4j.spi.ExtendedLogger;","21","import org.apache.logging.log4j.spi.ExtendedLoggerWrapper;","29","class Log4jTaglibLogger extends ExtendedLoggerWrapper {","32","    public Log4jTaglibLogger(final ExtendedLogger logger, final String name, final MessageFactory messageFactory) {"],"delete":["20","import org.apache.logging.log4j.spi.LoggerProvider;","21","import org.apache.logging.log4j.spi.LoggerProviderWrapper;","29","class Log4jTaglibLogger extends LoggerProviderWrapper {","32","    public Log4jTaglibLogger(final LoggerProvider logger, final String name, final MessageFactory messageFactory) {"]}],"log4j-jcl\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/LogFactoryImpl.java":[{"add":["28","import org.apache.logging.log4j.spi.ExtendedLogger;","110","        public static ExtendedLogger getLogger(final String name) {"],"delete":["28","import org.apache.logging.log4j.spi.LoggerProvider;","110","        public static LoggerProvider getLogger(final String name) {"]}],"log4j-to-slf4j\/src\/main\/java\/org\/apache\/logging\/slf4j\/SLF4JLogger.java":[{"add":["23","import org.apache.logging.log4j.spi.AbstractLogger;","30","public class SLF4JLogger extends AbstractLogger {"],"delete":["23","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","30","public class SLF4JLogger extends AbstractLoggerProvider {"]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLogger.java":[{"add":["28","import org.apache.logging.log4j.spi.ExtendedLogger;","43","    private transient ExtendedLogger logger;","47","    public Log4jLogger(final ExtendedLogger logger, final String name) {"],"delete":["28","import org.apache.logging.log4j.spi.LoggerProvider;","43","    private transient LoggerProvider logger;","47","    public Log4jLogger(final LoggerProvider logger, final String name) {"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLoggerContext.java":[{"add":["27","import org.apache.logging.log4j.spi.AbstractLogger;","29","import org.apache.logging.log4j.spi.ExtendedLogger;","66","    private final ConcurrentMap<String, ExtendedLogger> loggers = new ConcurrentHashMap<String, ExtendedLogger>();","99","    public ExtendedLogger getLogger(final String name) {","104","    public ExtendedLogger getLogger(final String name, final MessageFactory messageFactory) {","106","            final ExtendedLogger logger = loggers.get(name);","107","            AbstractLogger.checkMessageFactory(logger, messageFactory);"],"delete":["27","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","29","import org.apache.logging.log4j.spi.LoggerProvider;","66","    private final ConcurrentMap<String, LoggerProvider> loggers = new ConcurrentHashMap<String, LoggerProvider>();","99","    public LoggerProvider getLogger(final String name) {","104","    public LoggerProvider getLogger(final String name, final MessageFactory messageFactory) {","106","            final LoggerProvider logger = loggers.get(name);","107","            AbstractLoggerProvider.checkMessageFactory(logger, messageFactory);"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLogger.java":[{"add":[],"delete":[]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/TestLogger.java":[{"add":["26","import org.apache.logging.log4j.spi.AbstractLogger;","31","public class TestLogger extends AbstractLogger {"],"delete":["26","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","31","public class TestLogger extends AbstractLoggerProvider {"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":[{"add":["34","import org.apache.logging.log4j.spi.AbstractLogger;","199","        this.checkContains(\"\\\"loggerFqcn\\\" : \\\"\" + AbstractLogger.class.getName() + \"\\\",\", list);","244","        this.checkContains(\"\\\"loggerFqcn\\\" : \\\"\" + AbstractLogger.class.getName() + \"\\\",\", list);"],"delete":["198","        this.checkContains(\"\\\"loggerFqcn\\\" : \\\"org.apache.logging.log4j.spi.AbstractLoggerProvider\\\",\", list);","243","        this.checkContains(\"\\\"loggerFqcn\\\" : \\\"org.apache.logging.log4j.spi.AbstractLoggerProvider\\\",\", list);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["44","import org.apache.logging.log4j.spi.AbstractLogger;","290","            AbstractLogger.checkMessageFactory(logger, messageFactory);"],"delete":["44","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","290","            AbstractLoggerProvider.checkMessageFactory(logger, messageFactory);"]}],"log4j-jcl\/src\/main\/java\/org\/apache\/logging\/log4j\/jcl\/Log4jLog.java":[{"add":["22","import org.apache.logging.log4j.spi.ExtendedLogger;","32","    private final ExtendedLogger logger;","34","    public Log4jLog(final ExtendedLogger logger) {"],"delete":["22","import org.apache.logging.log4j.spi.LoggerProvider;","32","    private final LoggerProvider logger;","34","    public Log4jLog(final LoggerProvider logger) {"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":[{"add":["30","import org.apache.logging.log4j.spi.AbstractLogger;","36","public class SimpleLogger extends AbstractLogger {"],"delete":["30","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","36","public class SimpleLogger extends AbstractLoggerProvider {"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/ExtendedLoggerWrapper.java":[{"add":[],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContext.java":[{"add":["36","    ExtendedLogger getLogger(String name);","45","    ExtendedLogger getLogger(String name, MessageFactory messageFactory);"],"delete":["36","    LoggerProvider getLogger(String name);","45","    LoggerProvider getLogger(String name, MessageFactory messageFactory);"]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/status\/StatusLogger.java":[{"add":["35","import org.apache.logging.log4j.spi.AbstractLogger;","42","public final class StatusLogger extends AbstractLogger {"],"delete":["35","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","42","public final class StatusLogger extends AbstractLoggerProvider {"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerUseAfterShutdownTest.java":[{"add":["25","import org.apache.logging.log4j.spi.AbstractLogger;","58","        ((AbstractLogger) log).logMessage(\"com.foo.Bar\", Level.INFO, null, new SimpleMessage(\"msg\"), null);"],"delete":["25","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","58","        ((AbstractLoggerProvider) log).logMessage(\"com.foo.Bar\", Level.INFO, null, new SimpleMessage(\"msg\"), null);"]}],"src\/changes\/changes.xml":[{"add":["142","          Introduce ExtendedLogger interface to facilitate implementing and extending Loggers."],"delete":["142","          Introduce LoggerProvider interface to facilitate implementing and extending Loggers."]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/XmlLayoutTest.java":[{"add":["37","import org.apache.logging.log4j.spi.AbstractLogger;","241","        this.checkContains(\"loggerFqcn=\\\"\" + AbstractLogger.class.getName() + \"\\\"\", list);"],"delete":["240","        this.checkContains(\"loggerFqcn=\\\"org.apache.logging.log4j.spi.AbstractLoggerProvider\\\"\", list);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/Logger.java":[{"add":["31","import org.apache.logging.log4j.spi.AbstractLogger;","40","public class Logger extends AbstractLogger {"],"delete":["31","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","40","public class Logger extends AbstractLoggerProvider {"]}],"log4j-taglib\/src\/main\/java\/org\/apache\/logging\/log4j\/taglib\/TagUtils.java":[{"add":["29","import org.apache.logging.log4j.spi.AbstractLogger;","77","            if (logger instanceof AbstractLogger) {","83","                final AbstractLogger original = (AbstractLogger) logger;"],"delete":["29","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","77","            if (logger instanceof AbstractLoggerProvider) {","83","                final AbstractLoggerProvider original = (AbstractLoggerProvider) logger;"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractLoggerTest.java":[{"add":["22","import org.apache.logging.log4j.spi.AbstractLogger;","30","public class AbstractLoggerTest extends AbstractLogger {","53","    private static Class<AbstractLogger> obj = AbstractLogger.class;"],"delete":["22","import org.apache.logging.log4j.spi.AbstractLoggerProvider;","30","public class AbstractLoggerTest extends AbstractLoggerProvider {","53","    private static Class<AbstractLoggerProvider> obj = AbstractLoggerProvider.class;"]}]}},"7a56e74b8dc4b1e0548a82b65fcb5675c5cd1735":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["109","      <action issue=\"LOG4J2-3110\" dev=\"rgoers\" type=\"fix\" due-to=\"Arturo Bernal\">","110","        Fix the number of {}-placeholders in the string literal argument does not match the number of other arguments","111","        to the logging call.","112","      <\/action>"],"delete":[]}]}},"2e2b2d9bb1cd20d35df2b1fa4ffc8ea8c5825b49":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/ConfigurationBuilderTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultRootLoggerComponentBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultLoggerComponentBuilder.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/api\/ConfigurationBuilder.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultConfigurationBuilder.java":[{"add":["358","    public LoggerComponentBuilder newAsyncLogger(String name) {","359","        return new DefaultLoggerComponentBuilder(this, name, null, \"AsyncLogger\");","360","    }","361","","362","    @Override","363","    public LoggerComponentBuilder newAsyncLogger(String name, boolean includeLocation) {","364","        return new DefaultLoggerComponentBuilder(this, name, null, \"AsyncLogger\", includeLocation);","365","    }","366","","367","    @Override","388","    public RootLoggerComponentBuilder newAsyncRootLogger() {","389","        return new DefaultRootLoggerComponentBuilder(this, \"AsyncRoot\");","390","    }","391","","392","    @Override","393","    public RootLoggerComponentBuilder newAsyncRootLogger(boolean includeLocation) {","394","        return new DefaultRootLoggerComponentBuilder(this, null, \"AsyncRoot\", includeLocation);","395","    }","396","","397","    @Override","465","    @Override","466","    public LoggerComponentBuilder newLogger(String name) {","467","        return new DefaultLoggerComponentBuilder(this, name, null);","468","    }","469","","470","    @Override","471","    public LoggerComponentBuilder newLogger(String name, boolean includeLocation) {","472","        return new DefaultLoggerComponentBuilder(this, name, null, includeLocation);","473","    }","496","    public RootLoggerComponentBuilder newRootLogger() {","497","        return new DefaultRootLoggerComponentBuilder(this, null);","498","    }","499","","500","    @Override","501","    public RootLoggerComponentBuilder newRootLogger(boolean includeLocation) {","502","        return new DefaultRootLoggerComponentBuilder(this, null, includeLocation);","503","    }","504","","505","    @Override"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/ConfigurationBuilderTest.java":[{"add":["62","        builder.add(builder.newLogger(\"org.apache.logging.log4j.core\").","63","                    add(builder.newAppenderRef(\"Stdout\")));","100","                INDENT + INDENT + \"<Logger name=\\\"org.apache.logging.log4j.core\\\">\" + EOL +","101","                INDENT + INDENT + INDENT + \"<AppenderRef ref=\\\"Stdout\\\"\/>\" + EOL +","102","                INDENT + INDENT + \"<\/Logger>\" + EOL +"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2002\" dev=\"mikes\" type=\"fix\" due-to=\"Paul Burrowes\">","34","        Avoid null attribute values in DefaultConfigurationBuilder.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultRootLoggerComponentBuilder.java":[{"add":["37","        if (level != null) {","38","            addAttribute(\"level\", level);","39","        }","51","        if (level != null) {","52","            addAttribute(\"level\", level);","53","        }","66","        if (level != null) {","67","            addAttribute(\"level\", level);","68","        }","81","        if (level != null) {","82","            addAttribute(\"level\", level);","83","        }"],"delete":["37","        addAttribute(\"level\", level);","49","        addAttribute(\"level\", level);","62","        addAttribute(\"level\", level);","75","        addAttribute(\"level\", level);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/impl\/DefaultLoggerComponentBuilder.java":[{"add":["38","        if (level != null) {","39","            addAttribute(\"level\", level);","40","        }","53","        if (level != null) {","54","            addAttribute(\"level\", level);","55","        }","69","        if (level != null) {","70","            addAttribute(\"level\", level);","71","        }","85","        if (level != null) {","86","            addAttribute(\"level\", level);","87","        }"],"delete":["38","        addAttribute(\"level\", level);","51","        addAttribute(\"level\", level);","65","        addAttribute(\"level\", level);","79","        addAttribute(\"level\", level);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/builder\/api\/ConfigurationBuilder.java":[{"add":["136","","137","    \/**","138","     * Returns a builder for creating Async Loggers.","139","     * @param name The name of the Logger.","140","     * @return A new LoggerComponentBuilder.","141","     *\/","142","    LoggerComponentBuilder newAsyncLogger(String name);","143","","144","    \/**","145","     * Returns a builder for creating Async Loggers.","146","     * @param name The name of the Logger.","147","     * @param includeLocation If true include location information.","148","     * @return A new LoggerComponentBuilder.","149","     *\/","150","    LoggerComponentBuilder newAsyncLogger(String name, boolean includeLocation);","151","","188","     * @return A new RootLoggerComponentBuilder.","189","     *\/","190","    RootLoggerComponentBuilder newAsyncRootLogger();","191","","192","","193","    \/**","194","     * Returns a builder for creating the async root Logger.","195","     * @param includeLocation If true include location information.","196","     * @return A new RootLoggerComponentBuilder.","197","     *\/","198","    RootLoggerComponentBuilder newAsyncRootLogger(boolean includeLocation);","199","","200","    \/**","201","     * Returns a builder for creating the async root Logger.","311","     * @return A new LoggerComponentBuilder.","312","     *\/","313","    LoggerComponentBuilder newLogger(String name);","314","","315","    \/**","316","     * Returns a builder for creating Loggers.","317","     * @param name The name of the Logger.","318","     * @param includeLocation If true include location information.","319","     * @return A new LoggerComponentBuilder.","320","     *\/","321","    LoggerComponentBuilder newLogger(String name, boolean includeLocation);","322","","323","    \/**","324","     * Returns a builder for creating Loggers.","325","     * @param name The name of the Logger.","359","     * @return A new RootLoggerComponentBuilder.","360","     *\/","361","    RootLoggerComponentBuilder newRootLogger();","362","","363","    \/**","364","     * Returns a builder for creating the root Logger.","365","     * @param includeLocation If true include location information.","366","     * @return A new RootLoggerComponentBuilder.","367","     *\/","368","    RootLoggerComponentBuilder newRootLogger(boolean includeLocation);","369","","370","    \/**","371","     * Returns a builder for creating the root Logger."],"delete":[]}]}},"e7db6425c61934e9f3f9f8781151e68bea3d7fa4":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/WriterManager.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/WriterManager.java":[{"add":[],"delete":[]}]}},"c539c17374ae4db612477e133ac59f7b1bf75fb1":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":[{"add":["240","     *        The character set. The platform default is used if not specified.","257","            \/\/ LOG4J2-783 use platform default by default, so do not specify defaultString for charset","258","            @PluginAttribute(value = \"charset\") final Charset charset,","398","            \/\/ LOG4J2-783 if null, use platform default by default","399","            if (charset != null) {","400","                this.charset = charset;","401","            }"],"delete":["240","     *        The character set.","257","            @PluginAttribute(value = \"charset\", defaultString = \"UTF-8\") final Charset charset,","397","            this.charset = charset;"]}]}},"f299e24c73e2d1891b2ef0cee0b255c2e0b3e0b7":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":[{"add":["20","import java.net.URL;","23","import org.apache.logging.log4j.Logger;","27"," * Helps access properties.","33","    private static final Logger LOGGER = StatusLogger.getLogger();","34","    ","41","\t\/**","42","\t * Loads and closes the given property input stream.","43","\t * If an error occurs, log to the status logger.","44","\t * ","45","\t * @param in","46","\t *            a property input stream.","47","\t * @param source","48","\t *            a source object describing the source, like a resource string","49","\t *            or a URL.","50","\t * @return a new Properties object","51","\t *\/","52","\tstatic Properties loadClose(InputStream in, Object source) {","53","\t\tProperties props = new Properties();","54","\t\tif (null != in) {","55","\t\t\ttry {","56","\t\t\t\tprops.load(in);","57","\t\t\t} catch (final IOException e) {","58","\t\t\t\tLOGGER.error(\"Unable to read \" + source, e);","59","\t\t\t} finally {","60","\t\t\t\ttry {","61","\t\t\t\t\tin.close();","62","\t\t\t\t} catch (final IOException e) {","63","\t\t\t\t\tLOGGER.error(\"Unable to close \" + source, e);","64","\t\t\t\t}","65","\t\t\t}","66","\t\t}","67","\t\treturn props;","68","\t}","69","    ","70","\tpublic PropertiesUtil(final String propsLocn) {","71","\t\tfinal ClassLoader loader = ProviderUtil.findClassLoader();","72","\t\tfinal InputStream in = loader.getResourceAsStream(propsLocn);","73","\t\tthis.props = loadClose(in, propsLocn);","74","\t}"],"delete":["25"," * Helps access System Properties.","37","    public PropertiesUtil(final String propsLocn) {","38","        this.props = new Properties();","39","        final ClassLoader loader = ProviderUtil.findClassLoader();","40","        final InputStream in = loader.getResourceAsStream(propsLocn);","41","        if (null != in) {","42","            try {","43","                this.props.load(in);","44","            } catch (final IOException e) {","45","                \/\/ ignored","46","            } finally {","47","                try {","48","                    in.close();","49","                } catch (final IOException e) {","50","                    \/\/ ignored","51","                }","52","            }","53","        }","54","    }"]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":[{"add":["61","                Properties props;","63","                    props = PropertiesUtil.loadClose(url.openStream(), url);","64","                    if (!validVersion(props.getProperty(API_VERSION))) {","65","                        continue;","66","                    }","67","                    PROVIDERS.add(new Provider(props, url));","69","                    LOGGER.error(\"Unable to open \" + url.toString(), ioe);"],"delete":["60","                final Properties props = new Properties();","63","                    props.load(url.openStream());","65","                    LOGGER.error(\"Unable to read \" + url.toString(), ioe);","67","                if (!validVersion(props.getProperty(API_VERSION))) {","68","                    continue;","69","                }","70","                PROVIDERS.add(new Provider(props, url));"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-320\" dev=\"ggregory\" type=\"fix\">","24","        JPAAppender stops logging because META-INF\/log4j-provider.properties is left open.","25","      <\/action>"],"delete":[]}]}},"5e5e598c09ce5f61153dd5a497d8d31f087f2d20":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["109","      <action issue=\"LOG4J2-3114\" dev=\"rgoers\" type=\"fix\" due-to=\"Barnabas Bodnar\">","110","        Enable immediate flush on RollingFileAppender when buffered i\/o is not enabled.","111","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":[{"add":["155","                    isIgnoreExceptions(), !isBufferedIo || isImmediateFlush(),","156","                    advertise ? getConfiguration().getAdvertiser() : null, getPropertyArray());"],"delete":["155","                    isIgnoreExceptions(), isImmediateFlush(), advertise ? getConfiguration().getAdvertiser() : null,","156","                    getPropertyArray());"]}]}},"33154952323debff4c7d4097e0029bcd9fecbbc4":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAvroManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-563\" dev=\"rgoers\" type=\"fix\" due-to=\"Michael Friedmann\">","25","        FlumeAvroManager now always uses a client type of default_failover.","26","      <\/action>"],"delete":[]}],"log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumeAvroManager.java":[{"add":["197","            props.put(\"client.type\", \"default_failover\");"],"delete":["197","            props.put(\"client.type\", agents.length > 1 ? \"default_failover\" : \"default\");"]}]}},"b50a2378784ae5e91cc44d8f8c81e2151d29cf57":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/DefaultMergeStrategy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/DefaultMergeStrategy.java":[{"add":["0","\/*","1"," * Licensed to the Apache Software Foundation (ASF) under one or more","2"," * contributor license agreements. See the NOTICE file distributed with","3"," * this work for additional information regarding copyright ownership.","4"," * The ASF licenses this file to You under the Apache license, Version 2.0","5"," * (the \"License\"); you may not use this file except in compliance with","6"," * the License. You may obtain a copy of the License at","7"," *","8"," *      http:\/\/www.apache.org\/licenses\/LICENSE-2.0","9"," *","10"," * Unless required by applicable law or agreed to in writing, software","11"," * distributed under the License is distributed on an \"AS IS\" BASIS,","12"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.","13"," * See the license for the specific language governing permissions and","14"," * limitations under the license.","15"," *\/","16","package org.apache.logging.log4j.core.config.composite;","17","","18","import java.util.HashMap;","19","import java.util.List;","20","import java.util.Map;","21","import java.util.Objects;","22","","23","import org.apache.logging.log4j.Level;","24","import org.apache.logging.log4j.core.Filter;","25","import org.apache.logging.log4j.core.config.AbstractConfiguration;","26","import org.apache.logging.log4j.core.config.Node;","27","import org.apache.logging.log4j.core.config.plugins.util.PluginManager;","28","import org.apache.logging.log4j.core.config.plugins.util.PluginType;","29","import org.apache.logging.log4j.core.filter.CompositeFilter;","30","","31","\/**","32"," * The default merge strategy for composite configurations.","33"," * <p>","34"," * The default merge strategy performs the merge according to the following rules:","35"," * <ol>","36"," * <li>Aggregates the global configuration attributes with those in later configurations replacing those in previous","37"," * configurations with the exception that the highest status level and the lowest monitorInterval greater than 0 will","38"," * be used.<\/li>","39"," * <li>Properties from all configurations are aggregated. Duplicate properties replace those in previous","40"," * configurations.<\/li>","41"," * <li>Filters are aggregated under a CompositeFilter if more than one Filter is defined. Since Filters are not named","42"," * duplicates may be present.<\/li>","43"," * <li>Scripts and ScriptFile references are aggregated. Duplicate definiations replace those in previous","44"," * configurations.<\/li>","45"," * <li>Appenders are aggregated. Appenders with the same name are replaced by those in later configurations, including","46"," * all of the Appender's subcomponents.<\/li>","47"," * <li>Loggers are all aggregated. Logger attributes are individually merged with duplicates being replaced by those","48"," * in later configurations. Appender references on a Logger are aggregated with duplicates being replaced by those in","49"," * later configurations. Filters on a Logger are aggregated under a CompositeFilter if more than one Filter is defined.","50"," * Since Filters are not named duplicates may be present. Filters under Appender references included or discarded","51"," * depending on whether their parent Appender reference is kept or discarded.<\/li>","52"," * <\/ol>","53"," *\/","54","public class DefaultMergeStrategy implements MergeStrategy {","55","","56","    private static final String APPENDERS = \"appenders\";","57","    private static final String PROPERTIES = \"properties\";","58","    private static final String LOGGERS = \"loggers\";","59","    private static final String SCRIPTS = \"scripts\";","60","    private static final String FILTERS = \"filters\";","61","    private static final String STATUS = \"status\";","62","    private static final String NAME = \"name\";","63","    private static final String REF = \"ref\";","64","","65","    \/**","66","     * Merge the root properties.","67","     * @param rootNode The composite root node.","68","     * @param configuration The configuration to merge.","69","     *\/","70","    @Override","71","    public void mergeRootProperties(final Node rootNode, final AbstractConfiguration configuration) {","72","        for (final Map.Entry<String, String> attribute : configuration.getRootNode().getAttributes().entrySet()) {","73","            boolean isFound = false;","74","            for (final Map.Entry<String, String> targetAttribute : rootNode.getAttributes().entrySet()) {","75","                if (targetAttribute.getKey().equalsIgnoreCase(attribute.getKey())) {","76","                    if (attribute.getKey().equalsIgnoreCase(STATUS)) {","77","                        final Level targetLevel = Level.getLevel(targetAttribute.getValue().toUpperCase());","78","                        final Level sourceLevel = Level.getLevel(attribute.getValue().toUpperCase());","79","                        if (targetLevel != null && sourceLevel != null) {","80","                            if (sourceLevel.isLessSpecificThan(targetLevel)) {","81","                                targetAttribute.setValue(attribute.getValue());","82","                            }","83","                        } else","84","                            if (sourceLevel != null) {","85","                                targetAttribute.setValue(attribute.getValue());","86","                            }","87","                    } else {","88","                        if (attribute.getKey().equalsIgnoreCase(\"monitorInterval\")) {","89","                            final int sourceInterval = Integer.parseInt(attribute.getValue());","90","                            final int targetInterval = Integer.parseInt(targetAttribute.getValue());","91","                            if (targetInterval == 0 || sourceInterval < targetInterval) {","92","                                targetAttribute.setValue(attribute.getValue());","93","                            }","94","                        } else {","95","                            targetAttribute.setValue(attribute.getValue());","96","                        }","97","                    }","98","                    isFound = true;","99","                }","100","            }","101","            if (!isFound) {","102","                rootNode.getAttributes().put(attribute.getKey(), attribute.getValue());","103","            }","104","        }","105","    }","106","","107","    \/**","108","     * Merge the source Configuration into the target Configuration.","109","     *","110","     * @param target        The target node to merge into.","111","     * @param source        The source node.","112","     * @param pluginManager The PluginManager.","113","     *\/","114","    @Override","115","    public void mergConfigurations(final Node target, final Node source, final PluginManager pluginManager) {","116","        for (final Node sourceChildNode : source.getChildren()) {","117","            final boolean isFilter = isFilterNode(sourceChildNode);","118","            boolean isMerged = false;","119","            for (final Node targetChildNode : target.getChildren()) {","120","                if (isFilter) {","121","                    if (isFilterNode(targetChildNode)) {","122","                        updateFilterNode(target, targetChildNode, sourceChildNode, pluginManager);","123","                        isMerged = true;","124","                        break;","125","                    }","126","                    continue;","127","                }","128","","129","                if (!targetChildNode.getName().equalsIgnoreCase(sourceChildNode.getName())) {","130","                    continue;","131","                }","132","","133","                switch (targetChildNode.getName().toLowerCase()) {","134","                    case PROPERTIES:","135","                    case SCRIPTS:","136","                    case APPENDERS: {","137","                        for (final Node node : sourceChildNode.getChildren()) {","138","                            for (final Node targetNode : targetChildNode.getChildren()) {","139","                                if (Objects.equals(targetNode.getAttributes().get(NAME), node.getAttributes().get(NAME))) {","140","                                    targetChildNode.getChildren().remove(targetNode);","141","                                    break;","142","                                }","143","                            }","144","                            targetChildNode.getChildren().add(node);","145","                        }","146","                        isMerged = true;","147","                        break;","148","                    }","149","                    case LOGGERS: {","150","                        final Map<String, Node> targetLoggers = new HashMap<>();","151","                        for (final Node node : targetChildNode.getChildren()) {","152","                            targetLoggers.put(node.getName(), node);","153","                        }","154","                        for (final Node node : sourceChildNode.getChildren()) {","155","                            final Node targetNode = getLoggerNode(targetChildNode, node.getAttributes().get(NAME));","156","                            final Node loggerNode = new Node(targetChildNode, node.getName(), node.getType());","157","                            if (targetNode != null) {","158","                                targetNode.getAttributes().putAll(node.getAttributes());","159","                                for (final Node sourceLoggerChild : node.getChildren()) {","160","                                    if (isFilterNode(sourceLoggerChild)) {","161","                                        boolean foundFilter = false;","162","                                        for (final Node targetChild : targetNode.getChildren()) {","163","                                            if (isFilterNode(targetChild)) {","164","                                                updateFilterNode(loggerNode, targetChild, sourceLoggerChild,","165","                                                        pluginManager);","166","                                                foundFilter = true;","167","                                                break;","168","                                            }","169","                                        }","170","                                        if (!foundFilter) {","171","                                            final Node childNode = new Node(loggerNode, sourceLoggerChild.getName(),","172","                                                    sourceLoggerChild.getType());","173","                                            targetNode.getChildren().add(childNode);","174","                                        }","175","                                    } else {","176","                                        final Node childNode = new Node(loggerNode, sourceLoggerChild.getName(),","177","                                                sourceLoggerChild.getType());","178","                                        childNode.getAttributes().putAll(sourceLoggerChild.getAttributes());","179","                                        childNode.getChildren().addAll(sourceLoggerChild.getChildren());","180","                                        if (childNode.getName().equalsIgnoreCase(\"AppenderRef\")) {","181","                                            for (final Node targetChild : targetNode.getChildren()) {","182","                                                if (isSameReference(targetChild, childNode)) {","183","                                                    targetNode.getChildren().remove(targetChild);","184","                                                    break;","185","                                                }","186","                                            }","187","                                        } else {","188","                                            for (final Node targetChild : targetNode.getChildren()) {","189","                                                if (isSameName(targetChild, childNode)) {","190","                                                    targetNode.getChildren().remove(targetChild);","191","                                                    break;","192","                                                }","193","                                            }","194","                                        }","195","","196","                                        targetNode.getChildren().add(childNode);","197","                                    }","198","                                }","199","                            } else {","200","                                loggerNode.getAttributes().putAll(node.getAttributes());","201","                                loggerNode.getChildren().addAll(node.getChildren());","202","                                targetChildNode.getChildren().add(loggerNode);","203","                            }","204","                        }","205","                        isMerged = true;","206","                        break;","207","                    }","208","                    default: {","209","                        targetChildNode.getChildren().addAll(sourceChildNode.getChildren());","210","                        isMerged = true;","211","                        break;","212","                    }","213","","214","                }","215","            }","216","            if (!isMerged) {","217","                if (sourceChildNode.getName().equalsIgnoreCase(\"Properties\")) {","218","                    target.getChildren().add(0, sourceChildNode);","219","                } else {","220","                    target.getChildren().add(sourceChildNode);","221","                }","222","            }","223","        }","224","    }","225","","226","    private Node getLoggerNode(final Node parentNode, final String name) {","227","        for (final Node node : parentNode.getChildren()) {","228","            final String nodeName = node.getAttributes().get(NAME);","229","            if (name == null && nodeName == null) {","230","                return node;","231","            }","232","            if (nodeName != null && nodeName.equals(name)) {","233","                return node;","234","            }","235","        }","236","        return null;","237","    }","238","","239","    private void updateFilterNode(final Node target, final Node targetChildNode, final Node sourceChildNode,","240","            final PluginManager pluginManager) {","241","        if (CompositeFilter.class.isAssignableFrom(targetChildNode.getType().getPluginClass())) {","242","            final Node node = new Node(targetChildNode, sourceChildNode.getName(), sourceChildNode.getType());","243","            node.getChildren().addAll(sourceChildNode.getChildren());","244","            node.getAttributes().putAll(sourceChildNode.getAttributes());","245","            targetChildNode.getChildren().add(node);","246","        } else {","247","            final PluginType pluginType = pluginManager.getPluginType(FILTERS);","248","            final Node filtersNode = new Node(targetChildNode, FILTERS, pluginType);","249","            final Node node = new Node(filtersNode, sourceChildNode.getName(), sourceChildNode.getType());","250","            node.getAttributes().putAll(sourceChildNode.getAttributes());","251","            final List<Node> children = filtersNode.getChildren();","252","            children.add(targetChildNode);","253","            children.add(node);","254","            final List<Node> nodes = target.getChildren();","255","            nodes.remove(targetChildNode);","256","            nodes.add(filtersNode);","257","        }","258","    }","259","","260","    private boolean isFilterNode(final Node node) {","261","        return Filter.class.isAssignableFrom(node.getType().getPluginClass());","262","    }","263","","264","    private boolean isSameName(final Node node1, final Node node2) {","265","        final String value = node1.getAttributes().get(NAME);","266","        return value != null && value.toLowerCase().equals(node2.getAttributes().get(NAME).toLowerCase());","267","    }","268","","269","    private boolean isSameReference(final Node node1, final Node node2) {","270","        final String value = node1.getAttributes().get(REF);","271","        return value != null && value.toLowerCase().equals(node2.getAttributes().get(REF).toLowerCase());","272","    }","273","}"],"delete":["0","\/*\r","1"," * Licensed to the Apache Software Foundation (ASF) under one or more\r","2"," * contributor license agreements. See the NOTICE file distributed with\r","3"," * this work for additional information regarding copyright ownership.\r","4"," * The ASF licenses this file to You under the Apache license, Version 2.0\r","5"," * (the \"License\"); you may not use this file except in compliance with\r","6"," * the License. You may obtain a copy of the License at\r","7"," *\r","8"," *      http:\/\/www.apache.org\/licenses\/LICENSE-2.0\r","9"," *\r","10"," * Unless required by applicable law or agreed to in writing, software\r","11"," * distributed under the License is distributed on an \"AS IS\" BASIS,\r","12"," * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r","13"," * See the license for the specific language governing permissions and\r","14"," * limitations under the license.\r","15"," *\/\r","16","package org.apache.logging.log4j.core.config.composite;\r","17","\r","18","import java.util.HashMap;\r","19","import java.util.List;\r","20","import java.util.Map;\r","21","\r","22","import org.apache.logging.log4j.Level;\r","23","import org.apache.logging.log4j.core.Filter;\r","24","import org.apache.logging.log4j.core.config.AbstractConfiguration;\r","25","import org.apache.logging.log4j.core.config.Node;\r","26","import org.apache.logging.log4j.core.config.plugins.util.PluginManager;\r","27","import org.apache.logging.log4j.core.config.plugins.util.PluginType;\r","28","import org.apache.logging.log4j.core.filter.CompositeFilter;\r","29","\r","30","\/**\r","31"," * The default merge strategy for composite configurations.\r","32"," * <p>\r","33"," * The default merge strategy performs the merge according to the following rules:\r","34"," * <ol>\r","35"," * <li>Aggregates the global configuration attributes with those in later configurations replacing those in previous\r","36"," * configurations with the exception that the highest status level and the lowest monitorInterval greater than 0 will\r","37"," * be used.<\/li>\r","38"," * <li>Properties from all configurations are aggregated. Duplicate properties replace those in previous\r","39"," * configurations.<\/li>\r","40"," * <li>Filters are aggregated under a CompositeFilter if more than one Filter is defined. Since Filters are not named\r","41"," * duplicates may be present.<\/li>\r","42"," * <li>Scripts and ScriptFile references are aggregated. Duplicate definiations replace those in previous\r","43"," * configurations.<\/li>\r","44"," * <li>Appenders are aggregated. Appenders with the same name are replaced by those in later configurations, including\r","45"," * all of the Appender's subcomponents.<\/li>\r","46"," * <li>Loggers are all aggregated. Logger attributes are individually merged with duplicates being replaced by those\r","47"," * in later configurations. Appender references on a Logger are aggregated with duplicates being replaced by those in\r","48"," * later configurations. Filters on a Logger are aggregated under a CompositeFilter if more than one Filter is defined.\r","49"," * Since Filters are not named duplicates may be present. Filters under Appender references included or discarded\r","50"," * depending on whether their parent Appender reference is kept or discarded.<\/li>\r","51"," * <\/ol>\r","52"," *\/\r","53","public class DefaultMergeStrategy implements MergeStrategy {\r","54","\r","55","    private static final String APPENDERS = \"appenders\";\r","56","    private static final String PROPERTIES = \"properties\";\r","57","    private static final String LOGGERS = \"loggers\";\r","58","    private static final String SCRIPTS = \"scripts\";\r","59","    private static final String FILTERS = \"filters\";\r","60","    private static final String STATUS = \"status\";\r","61","    private static final String NAME = \"name\";\r","62","    private static final String REF = \"ref\";\r","63","\r","64","    \/**\r","65","     * Merge the root properties.\r","66","     * @param rootNode The composite root node.\r","67","     * @param configuration The configuration to merge.\r","68","     *\/\r","69","    @Override\r","70","    public void mergeRootProperties(final Node rootNode, final AbstractConfiguration configuration) {\r","71","        for (final Map.Entry<String, String> attribute : configuration.getRootNode().getAttributes().entrySet()) {\r","72","            boolean isFound = false;\r","73","            for (final Map.Entry<String, String> targetAttribute : rootNode.getAttributes().entrySet()) {\r","74","                if (targetAttribute.getKey().equalsIgnoreCase(attribute.getKey())) {\r","75","                    if (attribute.getKey().equalsIgnoreCase(STATUS)) {\r","76","                        final Level targetLevel = Level.getLevel(targetAttribute.getValue().toUpperCase());\r","77","                        final Level sourceLevel = Level.getLevel(attribute.getValue().toUpperCase());\r","78","                        if (targetLevel != null && sourceLevel != null) {\r","79","                            if (sourceLevel.isLessSpecificThan(targetLevel)) {\r","80","                                targetAttribute.setValue(attribute.getValue());\r","81","                            }\r","82","                        } else\r","83","                            if (sourceLevel != null) {\r","84","                                targetAttribute.setValue(attribute.getValue());\r","85","                            }\r","86","                    } else {\r","87","                        if (attribute.getKey().equalsIgnoreCase(\"monitorInterval\")) {\r","88","                            final int sourceInterval = Integer.parseInt(attribute.getValue());\r","89","                            final int targetInterval = Integer.parseInt(targetAttribute.getValue());\r","90","                            if (targetInterval == 0 || sourceInterval < targetInterval) {\r","91","                                targetAttribute.setValue(attribute.getValue());\r","92","                            }\r","93","                        } else {\r","94","                            targetAttribute.setValue(attribute.getValue());\r","95","                        }\r","96","                    }\r","97","                    isFound = true;\r","98","                }\r","99","            }\r","100","            if (!isFound) {\r","101","                rootNode.getAttributes().put(attribute.getKey(), attribute.getValue());\r","102","            }\r","103","        }\r","104","    }\r","105","\r","106","    \/**\r","107","     * Merge the source Configuration into the target Configuration.\r","108","     *\r","109","     * @param target        The target node to merge into.\r","110","     * @param source        The source node.\r","111","     * @param pluginManager The PluginManager.\r","112","     *\/\r","113","    @Override\r","114","    public void mergConfigurations(final Node target, final Node source, final PluginManager pluginManager) {\r","115","        for (final Node sourceChildNode : source.getChildren()) {\r","116","            final boolean isFilter = isFilterNode(sourceChildNode);\r","117","            boolean isMerged = false;\r","118","            for (final Node targetChildNode : target.getChildren()) {\r","119","                if (isFilter) {\r","120","                    if (isFilterNode(targetChildNode)) {\r","121","                        updateFilterNode(target, targetChildNode, sourceChildNode, pluginManager);\r","122","                        isMerged = true;\r","123","                        break;\r","124","                    }\r","125","                    continue;\r","126","                }\r","127","\r","128","                if (!targetChildNode.getName().equalsIgnoreCase(sourceChildNode.getName())) {\r","129","                    continue;\r","130","                }\r","131","\r","132","                switch (targetChildNode.getName().toLowerCase()) {\r","133","                    case PROPERTIES:\r","134","                    case SCRIPTS:\r","135","                    case APPENDERS: {\r","136","                        for (final Node node : sourceChildNode.getChildren()) {\r","137","                            for (final Node targetNode : targetChildNode.getChildren()) {\r","138","                                if (targetNode.getAttributes().get(NAME).equals(node.getAttributes().get(NAME))) {\r","139","                                    targetChildNode.getChildren().remove(targetNode);\r","140","                                    break;\r","141","                                }\r","142","                            }\r","143","                            targetChildNode.getChildren().add(node);\r","144","                        }\r","145","                        isMerged = true;\r","146","                        break;\r","147","                    }\r","148","                    case LOGGERS: {\r","149","                        final Map<String, Node> targetLoggers = new HashMap<>();\r","150","                        for (final Node node : targetChildNode.getChildren()) {\r","151","                            targetLoggers.put(node.getName(), node);\r","152","                        }\r","153","                        for (final Node node : sourceChildNode.getChildren()) {\r","154","                            final Node targetNode = getLoggerNode(targetChildNode, node.getAttributes().get(NAME));\r","155","                            final Node loggerNode = new Node(targetChildNode, node.getName(), node.getType());\r","156","                            if (targetNode != null) {\r","157","                                targetNode.getAttributes().putAll(node.getAttributes());\r","158","                                for (final Node sourceLoggerChild : node.getChildren()) {\r","159","                                    if (isFilterNode(sourceLoggerChild)) {\r","160","                                        boolean foundFilter = false;\r","161","                                        for (final Node targetChild : targetNode.getChildren()) {\r","162","                                            if (isFilterNode(targetChild)) {\r","163","                                                updateFilterNode(loggerNode, targetChild, sourceLoggerChild,\r","164","                                                        pluginManager);\r","165","                                                foundFilter = true;\r","166","                                                break;\r","167","                                            }\r","168","                                        }\r","169","                                        if (!foundFilter) {\r","170","                                            final Node childNode = new Node(loggerNode, sourceLoggerChild.getName(),\r","171","                                                    sourceLoggerChild.getType());\r","172","                                            targetNode.getChildren().add(childNode);\r","173","                                        }\r","174","                                    } else {\r","175","                                        final Node childNode = new Node(loggerNode, sourceLoggerChild.getName(),\r","176","                                                sourceLoggerChild.getType());\r","177","                                        childNode.getAttributes().putAll(sourceLoggerChild.getAttributes());\r","178","                                        childNode.getChildren().addAll(sourceLoggerChild.getChildren());\r","179","                                        if (childNode.getName().equalsIgnoreCase(\"AppenderRef\")) {\r","180","                                            for (final Node targetChild : targetNode.getChildren()) {\r","181","                                                if (isSameReference(targetChild, childNode)) {\r","182","                                                    targetNode.getChildren().remove(targetChild);\r","183","                                                    break;\r","184","                                                }\r","185","                                            }\r","186","                                        } else {\r","187","                                            for (final Node targetChild : targetNode.getChildren()) {\r","188","                                                if (isSameName(targetChild, childNode)) {\r","189","                                                    targetNode.getChildren().remove(targetChild);\r","190","                                                    break;\r","191","                                                }\r","192","                                            }\r","193","                                        }\r","194","\r","195","                                        targetNode.getChildren().add(childNode);\r","196","                                    }\r","197","                                }\r","198","                            } else {\r","199","                                loggerNode.getAttributes().putAll(node.getAttributes());\r","200","                                loggerNode.getChildren().addAll(node.getChildren());\r","201","                                targetChildNode.getChildren().add(loggerNode);\r","202","                            }\r","203","                        }\r","204","                        isMerged = true;\r","205","                        break;\r","206","                    }\r","207","                    default: {\r","208","                        targetChildNode.getChildren().addAll(sourceChildNode.getChildren());\r","209","                        isMerged = true;\r","210","                        break;\r","211","                    }\r","212","\r","213","                }\r","214","            }\r","215","            if (!isMerged) {\r","216","                if (sourceChildNode.getName().equalsIgnoreCase(\"Properties\")) {\r","217","                    target.getChildren().add(0, sourceChildNode);\r","218","                } else {\r","219","                    target.getChildren().add(sourceChildNode);\r","220","                }\r","221","            }\r","222","        }\r","223","    }\r","224","\r","225","    private Node getLoggerNode(final Node parentNode, final String name) {\r","226","        for (final Node node : parentNode.getChildren()) {\r","227","            final String nodeName = node.getAttributes().get(NAME);\r","228","            if (name == null && nodeName == null) {\r","229","                return node;\r","230","            }\r","231","            if (nodeName != null && nodeName.equals(name)) {\r","232","                return node;\r","233","            }\r","234","        }\r","235","        return null;\r","236","    }\r","237","\r","238","    private void updateFilterNode(final Node target, final Node targetChildNode, final Node sourceChildNode,\r","239","            final PluginManager pluginManager) {\r","240","        if (CompositeFilter.class.isAssignableFrom(targetChildNode.getType().getPluginClass())) {\r","241","            final Node node = new Node(targetChildNode, sourceChildNode.getName(), sourceChildNode.getType());\r","242","            node.getChildren().addAll(sourceChildNode.getChildren());\r","243","            node.getAttributes().putAll(sourceChildNode.getAttributes());\r","244","            targetChildNode.getChildren().add(node);\r","245","        } else {\r","246","            final PluginType pluginType = pluginManager.getPluginType(FILTERS);\r","247","            final Node filtersNode = new Node(targetChildNode, FILTERS, pluginType);\r","248","            final Node node = new Node(filtersNode, sourceChildNode.getName(), sourceChildNode.getType());\r","249","            node.getAttributes().putAll(sourceChildNode.getAttributes());\r","250","            final List<Node> children = filtersNode.getChildren();\r","251","            children.add(targetChildNode);\r","252","            children.add(node);\r","253","            final List<Node> nodes = target.getChildren();\r","254","            nodes.remove(targetChildNode);\r","255","            nodes.add(filtersNode);\r","256","        }\r","257","    }\r","258","\r","259","    private boolean isFilterNode(final Node node) {\r","260","        return Filter.class.isAssignableFrom(node.getType().getPluginClass());\r","261","    }\r","262","\r","263","    private boolean isSameName(final Node node1, final Node node2) {\r","264","        final String value = node1.getAttributes().get(NAME);\r","265","        return value != null && value.toLowerCase().equals(node2.getAttributes().get(NAME).toLowerCase());\r","266","    }\r","267","\r","268","    private boolean isSameReference(final Node node1, final Node node2) {\r","269","        final String value = node1.getAttributes().get(REF);\r","270","        return value != null && value.toLowerCase().equals(node2.getAttributes().get(REF).toLowerCase());\r","271","    }\r","272","}\r"]}]}},"7cee696b86e1b6631d59d0906f082277f45a606c":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["126","      <action dev=\"ggregory\" type=\"fix\" issue=\"LOG4J2-3328\" due-to=\"Gary Gregory\">","127","        Log4j 1.2 bridge does not support system properties in log4j.xml.","128","      <\/action>"],"delete":[]}]}},"afcf92eb27590ed80709dc2ba25118376eca7fc5":{"changes":{"src\/changes\/changes.xml":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/StructuredDataMessageTest.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/StructuredDataMessage.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","    <release version=\"2.0-beta4\" date=\"TBD\" description=\"Bug fixes and enhancements\">","25","      <action issue=\"LOG4J2-114\" dev=\"rgoers\" type=\"fix\" due-to=\"Arkin Yetis\">","26","        StructuredDataMessage was validating the length of the values in the event Map instead of the lengths","27","        of the keys.","28","      <\/action>","29","    <\/release>"],"delete":[]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/StructuredDataMessageTest.java":[{"add":["33","        msg.put(\"memo\", \"This is a very long test memo to prevent regression of LOG4J2-114\");","35","        String expected = \"Alert [MsgId@12345 memo=\\\"This is a very long test memo to prevent regression of LOG4J2-114\\\" message=\\\"Test message {}\\\" project=\\\"Log4j\\\"] Test message {}\";","38","","39","    @Test(expected=IllegalArgumentException.class)","40","    public void testMsgWithKeyTooLong() {","41","        String testMsg = \"Test message {}\";","42","        StructuredDataMessage msg = new StructuredDataMessage(\"MsgId@12345\", testMsg, \"Alert\");","43","        msg.put(\"This is a very long key that will violate the key length validation\", \"Testing\");","44","    }"],"delete":["34","        String expected = \"Alert [MsgId@12345 message=\\\"Test message {}\\\" project=\\\"Log4j\\\"] Test message {}\";"]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/StructuredDataMessage.java":[{"add":["190","        if (key.length() > MAX_LENGTH) {","191","            throw new IllegalArgumentException(\"Structured data keys are limited to 32 characters. key: \" + key +"],"delete":["190","        if (value.length() > MAX_LENGTH) {","191","            throw new IllegalArgumentException(\"Structured data values are limited to 32 characters. key: \" + key +"]}]}},"a07176b6a96eb062a92b6fd167332ea2bb22fbf4":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/SystemPropertiesPropertySource.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/SystemPropertiesPropertySourceTest.java":"ADD","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/SystemPropertiesPropertySource.java":[{"add":["18","import java.util.Objects;","19","import java.util.Properties;","29","    private static final int DEFAULT_PRIORITY = 100;","34","        return DEFAULT_PRIORITY;","39","        final Properties properties = System.getProperties();","40","        \/\/ Lock properties only long enough to get a thread-safe SAFE snapshot of its current keys, an array.","41","        final Object[] keySet;","42","        synchronized (properties) {","43","            keySet = properties.keySet().toArray();","44","        }","45","        \/\/ Then traverse for an unknown amount of time.","46","        \/\/ Some keys may now be absent, in which case, the value is null.","47","        for (final Object key : keySet) {","48","            final String keyStr = Objects.toString(key, null);","49","            action.accept(keyStr, properties.getProperty(keyStr));"],"delete":["18","import java.util.Map;","32","        return 100;","37","        for (final Map.Entry<Object, Object> entry : System.getProperties().entrySet()) {","38","            action.accept(((String) entry.getKey()), ((String) entry.getValue()));"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/SystemPropertiesPropertySourceTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["209","      <action issue=\"LOG4J2-2276\" dev=\"ggregory\" type=\"fix\" due-to=\"Sean Baxter\">","210","        ConcurrentModificationException from org.apache.logging.log4j.status.StatusLogger.&lt;clinit>(StatusLogger.java:71).","211","      <\/action>      "],"delete":[]}]}},"8c8657e9d36a9302afbbe2ea3451e88411b0087c":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["648","        return appenderName != null ? (T) appenders.get(appenderName) : null;","668","        if (appender != null) {","669","            appenders.putIfAbsent(appender.getName(), appender);","670","        }","711","        if (appender == null || logger == null) {","712","            return;","713","        }","789","        final Appender app = appenderName != null ? appenders.remove(appenderName) : null;"],"delete":["648","        return (T) appenders.get(appenderName);","668","        appenders.putIfAbsent(appender.getName(), appender);","784","        final Appender app = appenders.remove(appenderName);"]}],"src\/changes\/changes.xml":[{"add":["93","      <action issue=\"LOG4J2-2481\" dev=\"ggregory\" type=\"fix\">","94","      \tAvoid NullPointerExceptions in org.apache.logging.log4j.core.config.AbstractConfiguration for null arguments.","95","      <\/action>"],"delete":[]}]}},"0eb6ddfbf8d29577c41af5873046d5849a7688d1":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1159\" dev=\"rpopma\" type=\"fix\">","27","        Fixed a ThreadLocal memory leak in Tomcat8 that mentions AsyncLoggers when Async Loggers are not used.","28","      <\/action>"],"delete":[]}]}},"07467dcbc198c8e575d5177713df477cc608e576":{"changes":{"src\/site\/xdoc\/manual\/lookups.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/lookups.xml":[{"add":["277","          <p>The JNDI Lookup only supports the java protocol or no protocol (as shown in the example below).<\/p>"],"delete":["277","          <p>The JDNI Lookup only supports the java protocol or no protocol (as shown in the example below).<\/p>"]}]}},"acb6c6eb63c1770322f6ce536937eb81ca9785d8":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["72","      <action issue=\"LOG4J2-1394\" dev=\"mattsicker,mikes\" type=\"fix\">","73","        Fixed minor issues with the 2.6 web site.","74","      <\/action>"],"delete":[]}]}},"494c04d1db18a89efb57e768a3167948fd13fad1":{"changes":{"\/dev\/null":"DELETE","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTest.java":"MODIFY","log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerContext.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerDisruptor.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTestNanoTime.java":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTest.java":[{"add":["54","        final AsyncLogger log = (AsyncLogger) LogManager.getLogger(\"com.foo.Bar\");","72","        final AsyncLogger log = (AsyncLogger) LogManager.getLogger(\"com.foo.Bar\");","73","        assertTrue(log.getNanoClock() instanceof DummyNanoClock);"],"delete":["23","import org.apache.logging.log4j.Logger;","55","        final Logger log = LogManager.getLogger(\"com.foo.Bar\");","73","        assertTrue(AsyncLogger.getNanoClock() instanceof DummyNanoClock);"]}],"log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":[{"add":["31","import org.apache.logging.log4j.core.async.AsyncLoggerContext;\r","111","            if (this.loggerContext instanceof AsyncLoggerContext) {\r","112","                ((AsyncLoggerContext) this.loggerContext).setUseThreadLocals(false);\r","113","            }\r"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerContext.java":[{"add":["116","","117","    \/**","118","     * Signals this context whether it is allowed to use ThreadLocal objects for efficiency.","119","     * @param useThreadLocals whether this context is allowed to use ThreadLocal objects","120","     *\/","121","    public void setUseThreadLocals(final boolean useThreadLocals) {","122","        loggerDisruptor.setUseThreadLocals(useThreadLocals);","123","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerDisruptor.java":[{"add":["43","    private ExecutorService executor;\r","44","    private String contextName;\r","45","\r","46","    private boolean useThreadLocalTranslator;\r","47","    private long backgroundThreadId;\r","72","            LOGGER.trace(\r","73","                    \"[{}] AsyncLoggerDisruptor not starting new disruptor for this context, using existing object.\",\r","77","        LOGGER.trace(\"[{}] AsyncLoggerDisruptor creating new disruptor for this context.\", contextName);\r","81","        backgroundThreadId = DisruptorUtil.getExecutorThreadId(executor);\r","98","        LOGGER.trace(\"[{}] AsyncLoggers use a {} translator\", contextName, useThreadLocalTranslator ? \"threadlocal\"\r","99","                : \"vararg\");\r","109","            LOGGER.trace(\"[{}] AsyncLoggerDisruptor: disruptor for this context already shut down.\", contextName);\r","112","        LOGGER.debug(\"[{}] AsyncLoggerDisruptor: shutting down disruptor for this context.\", contextName);\r","128","        LOGGER.trace(\"[{}] AsyncLoggerDisruptor: shutting down disruptor executor.\", contextName);\r","141","    \/**\r","142","     * Creates and returns a new {@code RingBufferAdmin} that instruments the ringbuffer of the {@code AsyncLogger}.\r","143","     *\r","144","     * @param jmxContextName name of the {@code AsyncLoggerContext}\r","145","     * @return a new {@code RingBufferAdmin} that instruments the ringbuffer\r","146","     *\/\r","147","    public RingBufferAdmin createRingBufferAdmin(final String jmxContextName) {\r","148","        final RingBuffer<RingBufferLogEvent> ring = disruptor == null ? null : disruptor.getRingBuffer();\r","149","        return RingBufferAdmin.forAsyncLogger(ring, jmxContextName);\r","150","    }\r","151","\r","152","    \/**\r","153","     * Returns {@code true} if the current log event should be logged in the current thread, {@code false} if it should\r","154","     * be logged in a background thread. (LOG4J2-471)\r","155","     * \r","156","     * @return whether the current log event should be logged in the current thread\r","157","     *\/\r","158","    boolean shouldLogInCurrentThread() {\r","159","        return currentThreadIsAppenderThread() && isRingBufferFull();\r","160","    }\r","161","\r","162","    \/**\r","163","     * Returns {@code true} if the current thread is the Disruptor background thread, {@code false} otherwise.\r","164","     * \r","165","     * @return whether this thread is the Disruptor background thread.\r","166","     *\/\r","167","    private boolean currentThreadIsAppenderThread() {\r","168","        return Thread.currentThread().getId() == backgroundThreadId;\r","169","    }\r","170","\r","171","    \/**\r","172","     * Returns {@code true} if the Disruptor is {@code null} because it has been stopped, or if its Ringbuffer is full.\r","173","     * \r","174","     * @return {@code true} if the disruptor is currently not usable\r","175","     *\/\r","176","    private boolean isRingBufferFull() {\r","177","        final Disruptor<RingBufferLogEvent> theDisruptor = this.disruptor;\r","178","        return theDisruptor == null || theDisruptor.getRingBuffer().remainingCapacity() == 0;\r","179","    }\r","180","\r","181","    void enqueueLogMessageInfo(final RingBufferLogEventTranslator translator) {\r","182","        \/\/ LOG4J2-639: catch NPE if disruptor field was set to null in stop()\r","183","        try {\r","184","            \/\/ Note: we deliberately access the volatile disruptor field afresh here.\r","185","            \/\/ Avoiding this and using an older reference could result in adding a log event to the disruptor after it\r","186","            \/\/ was shut down, which could cause the publishEvent method to hang and never return.\r","187","            disruptor.publishEvent(translator);\r","188","        } catch (final NullPointerException npe) {\r","189","            LOGGER.fatal(\"[{}] Ignoring log event after log4j was shut down.\", contextName);\r","190","        }\r","191","    }\r","192","\r","193","    \/**\r","194","     * Returns whether it is allowed to store non-JDK classes in ThreadLocal objects for efficiency.\r","195","     * \r","196","     * @return whether AsyncLoggers are allowed to use ThreadLocal objects\r","197","     * @since 2.5\r","198","     * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-1172\">LOG4J2-1172<\/a>\r","199","     *\/\r","200","    public boolean isUseThreadLocals() {\r","201","        return useThreadLocalTranslator;\r","202","    }\r","203","\r","204","    \/**\r","205","     * Signals this AsyncLoggerDisruptor whether it is allowed to store non-JDK classes in ThreadLocal objects for\r","206","     * efficiency.\r","207","     * \r","208","     * @param allow whether AsyncLoggers are allowed to use ThreadLocal objects\r","209","     * @since 2.5\r","210","     * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-1172\">LOG4J2-1172<\/a>\r","211","     *\/\r","212","    public void setUseThreadLocals(final boolean allow) {\r","213","        useThreadLocalTranslator = allow;\r","214","    }\r"],"delete":["42","    private String contextName;\r","43","    private ExecutorService executor;\r","69","            LOGGER.trace(\"[{}] AsyncLoggerHelper not starting new disruptor for this context, using existing object.\",\r","73","        LOGGER.trace(\"[{}] AsyncLoggerHelper creating new disruptor for this context.\", contextName);\r","77","        Info.initExecutorThreadInstance(executor);\r","93","    }\r","95","    void enqueueLogMessageInfo(final RingBufferLogEventTranslator translator) {\r","96","        \/\/ LOG4J2-639: catch NPE if disruptor field was set to null in release()\r","97","        try {\r","98","            \/\/ Note: we deliberately access the volatile disruptor field afresh here.\r","99","            \/\/ Avoiding this and using an older reference could result in adding a log event to the disruptor after it\r","100","            \/\/ was shut down, which could cause the publishEvent method to hang and never return.\r","101","            disruptor.publishEvent(translator);\r","102","        } catch (final NullPointerException npe) {\r","103","            LOGGER.fatal(\"[{}] Ignoring log event after log4j was shut down.\", contextName);\r","104","        }\r","105","    }\r","106","\r","107","    \/**\r","108","     * Creates and returns a new {@code RingBufferAdmin} that instruments the ringbuffer of the {@code AsyncLogger}.\r","109","     *\r","110","     * @param jmxContextName name of the {@code AsyncLoggerContext}\r","111","     * @return a new {@code RingBufferAdmin} that instruments the ringbuffer\r","112","     *\/\r","113","    public RingBufferAdmin createRingBufferAdmin(final String jmxContextName) {\r","114","        final RingBuffer<RingBufferLogEvent> ring = disruptor == null ? null : disruptor.getRingBuffer();\r","115","        return RingBufferAdmin.forAsyncLogger(ring, jmxContextName);\r","125","            LOGGER.trace(\"[{}] AsyncLoggerHelper: disruptor for this context already shut down.\", contextName);\r","128","        LOGGER.debug(\"[{}] AsyncLoggerHelper: shutting down disruptor for this context.\", contextName);\r","144","        LOGGER.trace(\"[{}] AsyncLoggerHelper: shutting down disruptor executor.\", contextName);\r","147","        \/\/ Info.THREADLOCAL.remove(); \/\/ LOG4J2-323\r"]}],"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1172\" dev=\"rpopma\" type=\"fix\">","51","        Fixed ThreadLocal leak [AsyncLogger$Info] on Tomcat when using AsyncLoggerContextSelector.","52","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["23","import org.apache.logging.log4j.ThreadContext.ContextStack;","26","import org.apache.logging.log4j.core.config.Configuration;","34","import org.apache.logging.log4j.core.util.NanoClockFactory;","40","import com.lmax.disruptor.EventTranslatorVararg;","62","public class AsyncLogger extends Logger implements EventTranslatorVararg<RingBufferLogEvent> {","63","    \/\/ Implementation note: many methods in this class are tuned for performance. MODIFY WITH CARE!","64","    \/\/ Specifically, try to keep the hot methods to 35 bytecodes or less:","65","    \/\/ this is within the MaxInlineSize threshold and makes these methods candidates for","66","    \/\/ immediate inlining instead of waiting until they are designated \"hot enough\".","70","    private static final Clock CLOCK = ClockFactory.getClock(); \/\/ not reconfigurable","72","    private static final ThreadNameCachingStrategy THREAD_NAME_CACHING_STRATEGY = ThreadNameCachingStrategy.create();","73","","74","    private final ThreadLocal<RingBufferLogEventTranslator> threadLocalTranslator = new ThreadLocal<>();","77","    private volatile NanoClock nanoClock; \/\/ reconfigurable","78","","91","        nanoClock = NanoClockFactory.createNanoClock(); \/\/ based on initial configuration","92","    }","93","","94","    \/*","95","     * (non-Javadoc)","96","     * ","97","     * @see org.apache.logging.log4j.core.Logger#updateConfiguration(org.apache.logging.log4j.core.config.Configuration)","98","     *\/","99","    @Override","100","    protected void updateConfiguration(Configuration newConfig) {","101","        super.updateConfiguration(newConfig);","102","        nanoClock = NanoClockFactory.createNanoClock();","103","        LOGGER.trace(\"[{}] AsyncLogger {} uses {}.\", getContext().getName(), getName(), nanoClock);","104","    }","105","    ","106","    \/\/ package protected for unit tests","107","    NanoClock getNanoClock() {","108","        return nanoClock;","109","    }","110","","111","    private RingBufferLogEventTranslator getCachedTranslator() {","112","        RingBufferLogEventTranslator result = threadLocalTranslator.get();","113","        if (result == null) {","114","            result = new RingBufferLogEventTranslator();","115","            threadLocalTranslator.set(result);","116","        }","117","        return result;","124","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","125","","126","        if (loggerDisruptor.shouldLogInCurrentThread()) {","127","            logMessageInCurrentThread(fqcn, level, marker, message, thrown);","129","            logMessageInBackgroundThread(fqcn, level, marker, message, thrown);","145","    private void logMessageInCurrentThread(final String fqcn, final Level level, final Marker marker,","146","            final Message message, final Throwable thrown) {","147","        \/\/ bypass RingBuffer and invoke Appender directly","148","        final ReliabilityStrategy strategy = privateConfig.loggerConfig.getReliabilityStrategy();","149","        strategy.log(this, getName(), fqcn, marker, level, message, thrown);","162","    private void logMessageInBackgroundThread(final String fqcn, final Level level, final Marker marker,","165","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","166","","170","        logInBackground(fqcn, level, marker, message, thrown);","173","    \/**","174","     * Enqueues the specified log event data for logging in a background thread.","175","     * ","176","     * @param asyncLogger the {@code AsyncLogger} to call from the background thread","177","     * @param location location information or {@code null}","178","     * @param fqcn fully qualified name of the caller","179","     * @param level level at which the caller wants to log the message","180","     * @param marker message marker","181","     * @param message the log message","182","     * @param thrown a {@code Throwable} or {@code null}","183","     *\/","184","    private void logInBackground(final String fqcn, final Level level, final Marker marker, final Message message,","185","            final Throwable thrown) {","186","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","188","        if (loggerDisruptor.isUseThreadLocals()) {","189","            logWithThreadLocalTranslator(fqcn, level, marker, message, thrown);","190","        } else {","191","            \/\/ LOG4J2-1172: avoid storing non-JDK classes in ThreadLocals to avoid memory leaks in web apps","192","            logWithVarargTranslator(fqcn, level, marker, message, thrown);","193","        }","194","    }","195","","196","    \/**","197","     * Enqueues the specified log event data for logging in a background thread.","198","     * <p>","199","     * This re-uses a {@code RingBufferLogEventTranslator} instance cached in a {@code ThreadLocal} to avoid creating","200","     * unnecessary objects with each event.","201","     * ","202","     * @param fqcn fully qualified name of the caller","203","     * @param level level at which the caller wants to log the message","204","     * @param marker message marker","205","     * @param message the log message","206","     * @param thrown a {@code Throwable} or {@code null}","207","     *\/","208","    private void logWithThreadLocalTranslator(final String fqcn, final Level level, final Marker marker,","209","            final Message message, final Throwable thrown) {","210","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","211","","212","        final RingBufferLogEventTranslator translator = getCachedTranslator();","213","        initTranslator(translator, fqcn, level, marker, message, thrown);","214","        loggerDisruptor.enqueueLogMessageInfo(translator);","215","    }","216","","217","    private void initTranslator(final RingBufferLogEventTranslator translator, final String fqcn,","218","            final Level level, final Marker marker, final Message message, final Throwable thrown) {","219","","220","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","221","","222","        initTranslatorPart1(translator, fqcn, level, marker, message, thrown);","223","        initTranslatorPart2(translator, fqcn, message);","224","    }","225","","226","    private void initTranslatorPart1(final RingBufferLogEventTranslator translator, final String fqcn,","227","            final Level level, final Marker marker, final Message message, final Throwable thrown) {","228","        ","229","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","230","","231","        translator.setValuesPart1(this, getName(), marker, fqcn, level, message, \/\/","232","                \/\/ don't construct ThrowableProxy until required","233","                thrown);","234","    }","235","","236","    private void initTranslatorPart2(final RingBufferLogEventTranslator translator, final String fqcn,","237","            final Message message) {","238","        ","239","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","240","","241","        translator.setValuesPart2(","242","                \/\/ config properties are taken care of in the EventHandler thread","243","                \/\/ in the AsyncLogger#actualAsyncLog method","252","                THREAD_NAME_CACHING_STRATEGY.getThreadName(), \/\/","254","                \/\/ location (expensive to calculate)","263","        \/\/ Implementation note: this method is tuned for performance. MODIFY WITH CARE!","264","","265","        \/\/ System.currentTimeMillis());","266","        \/\/ CoarseCachedClock: 20% faster than system clock, 16ms gaps","267","        \/\/ CachedClock: 10% faster than system clock, smaller gaps","268","        \/\/ LOG4J2-744 avoid calling clock altogether if message has the timestamp","274","     * Enqueues the specified log event data for logging in a background thread.","275","     * <p>","276","     * This creates a new varargs Object array for each invocation, but does not store any non-JDK classes in a","277","     * {@code ThreadLocal} to avoid memory leaks in web applications (see LOG4J2-1172).","278","     * ","279","     * @param asyncLogger the {@code AsyncLogger} to call from the background thread","280","     * @param location location information or {@code null}","281","     * @param fqcn fully qualified name of the caller","282","     * @param level level at which the caller wants to log the message","283","     * @param marker message marker","284","     * @param message the log message","285","     * @param thrown a {@code Throwable} or {@code null}","286","     *\/","287","    private void logWithVarargTranslator(final String fqcn, final Level level, final Marker marker,","288","            final Message message, final Throwable thrown) {","289","        \/\/ Implementation note: candidate for optimization: exceeds 35 bytecodes.","290","        ","291","        final Disruptor<RingBufferLogEvent> disruptor = loggerDisruptor.getDisruptor();","292","        if (disruptor == null) {","293","            LOGGER.error(\"Ignoring log event after Log4j has been shut down.\");","294","            return;","295","        }","296","        \/\/ calls the translateTo method on this AsyncLogger","297","        disruptor.getRingBuffer().publishEvent(this, this, calcLocationIfRequested(fqcn), fqcn, level, marker, message,","298","                thrown);","299","    }","300","","301","    \/*","302","     * (non-Javadoc)","303","     * ","304","     * @see com.lmax.disruptor.EventTranslatorVararg#translateTo(java.lang.Object, long, java.lang.Object[])","305","     *\/","306","    @Override","307","    public void translateTo(final RingBufferLogEvent event, final long sequence, final Object... args) {","308","        \/\/ Implementation note: candidate for optimization: exceeds 35 bytecodes.","309","        final AsyncLogger asyncLogger = (AsyncLogger) args[0];","310","        final StackTraceElement location = (StackTraceElement) args[1];","311","        final String fqcn = (String) args[2];","312","        final Level level = (Level) args[3];","313","        final Marker marker = (Marker) args[4];","314","        final Message message = (Message) args[5];","315","        final Throwable thrown = (Throwable) args[6];","316","","317","        \/\/ needs shallow copy to be fast (LOG4J2-154)","318","        final Map<String, String> contextMap = ThreadContext.getImmutableContext();","319","","320","        \/\/ needs shallow copy to be fast (LOG4J2-154)","321","        final ContextStack contextStack = ThreadContext.getImmutableStack();","322","","323","        final String threadName = THREAD_NAME_CACHING_STRATEGY.getThreadName();","324","","325","        event.setValues(asyncLogger, asyncLogger.getName(), marker, fqcn, level, message, thrown, contextMap,","326","                contextStack, threadName, location, eventTimeMillis(message), nanoClock.nanoTime());","327","    }","328","","329","    \/**","336","        \/\/ location: very expensive operation. LOG4J2-153:","337","        \/\/ Only include if \"includeLocation=true\" is specified,","338","        \/\/ exclude if not specified or if \"false\" was specified.","340","        return includeLocation ? Log4jLogEvent.calcLocation(fqcn) : null;"],"delete":["19","import java.util.Objects;","32","import org.apache.logging.log4j.core.util.DummyNanoClock;","60","public class AsyncLogger extends Logger {","65","    private static final Clock CLOCK = ClockFactory.getClock();","66","    private static volatile NanoClock nanoClock = new DummyNanoClock();","87","        final Disruptor<RingBufferLogEvent> temp = loggerDisruptor.getDisruptor();","88","        if (temp == null) { \/\/ LOG4J2-639","89","            LOGGER.fatal(\"Ignoring log event after log4j was shut down\");","91","            logMessage0(temp, fqcn, level, marker, message, thrown);","92","        }","93","    }","94","","95","    private void logMessage0(final Disruptor<RingBufferLogEvent> theDisruptor, final String fqcn, final Level level,","96","            final Marker marker, final Message message, final Throwable thrown) {","97","        final Info info = Info.get();","98","        logMessageInAppropriateThread(info, theDisruptor, fqcn, level, marker, message, thrown);","99","    }","100","","101","    private void logMessageInAppropriateThread(final Info info, final Disruptor<RingBufferLogEvent> theDisruptor,","102","            final String fqcn, final Level level, final Marker marker, final Message message, final Throwable thrown) {","103","        if (!logMessageInCurrentThread(info, theDisruptor, fqcn, level, marker, message, thrown)) {","104","            logMessageInBackgroundThread(info, fqcn, level, marker, message, thrown);","112","     * @param info threadlocal information - used to determine if the current thread is the background appender thread","113","     * @param theDisruptor used to check if the buffer is full","122","    private boolean logMessageInCurrentThread(Info info, final Disruptor<RingBufferLogEvent> theDisruptor,","123","            final String fqcn, final Level level, final Marker marker, final Message message, final Throwable thrown) {","124","        if (info.isAppenderThread && theDisruptor.getRingBuffer().remainingCapacity() == 0) {","125","            \/\/ bypass RingBuffer and invoke Appender directly","126","            final ReliabilityStrategy strategy = privateConfig.loggerConfig.getReliabilityStrategy();","127","            strategy.log(this, getName(), fqcn, marker, level, message, thrown);","128","            return true;","129","        }","130","        return false;","143","    private void logMessageInBackgroundThread(Info info, final String fqcn, final Level level, final Marker marker,","149","        initLogMessageInfo(info, fqcn, level, marker, message, thrown);","150","        loggerDisruptor.enqueueLogMessageInfo(info.translator);","153","    private void initLogMessageInfo(Info info, final String fqcn, final Level level, final Marker marker,","154","            final Message message, final Throwable thrown) {","155","        info.translator.setValues(this, getName(), marker, fqcn, level, message, \/\/","156","                \/\/ don't construct ThrowableProxy until required","157","                thrown, \/\/","159","                \/\/ config properties are taken care of in the EventHandler","160","                \/\/ thread in the #actualAsyncLog method","169","                \/\/ info.cachedThreadName, \/\/","170","                info.threadName(), \/\/","172","                \/\/ location: very expensive operation. LOG4J2-153:","173","                \/\/ Only include if \"includeLocation=true\" is specified,","174","                \/\/ exclude if not specified or if \"false\" was specified.","177","                \/\/ System.currentTimeMillis());","178","                \/\/ CoarseCachedClock: 20% faster than system clock, 16ms gaps","179","                \/\/ CachedClock: 10% faster than system clock, smaller gaps","180","                \/\/ LOG4J2-744 avoid calling clock altogether if message has the timestamp","199","        return includeLocation ? location(fqcn) : null;","200","    }","201","","202","    private static StackTraceElement location(final String fqcnOfLogger) {","203","        return Log4jLogEvent.calcLocation(fqcnOfLogger);","217","","218","    \/**","219","     * Returns the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","220","     * ","221","     * @return the {@code NanoClock} to use for creating the nanoTime timestamp of log events","222","     *\/","223","    public static NanoClock getNanoClock() {","224","        return nanoClock;","225","    }","226","","227","    \/**","228","     * Sets the {@code NanoClock} to use for creating the nanoTime timestamp of log events.","229","     * <p>","230","     * FOR INTERNAL USE. This method may be called with a different {@code NanoClock} implementation when the","231","     * configuration changes.","232","     * ","233","     * @param nanoClock the {@code NanoClock} to use for creating the nanoTime timestamp of log events","234","     *\/","235","    public static void setNanoClock(NanoClock nanoClock) {","236","        AsyncLogger.nanoClock = Objects.requireNonNull(nanoClock, \"NanoClock must be non-null\");","237","    }"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerTestNanoTime.java":[{"add":["28","import org.apache.logging.log4j.core.util.NanoClockFactory;","29","import org.apache.logging.log4j.core.util.NanoClockFactory.Mode;","58","        final AsyncLogger log = (AsyncLogger) LogManager.getLogger(\"com.foo.Bar\");","61","        assertTrue(\"using SystemNanoClock\", log.getNanoClock() instanceof SystemNanoClock);","63","        NanoClockFactory.setMode(Mode.Dummy);","64","        final long DUMMYNANOTIME = 0;","65","        ","66","        \/\/ trigger a new nano clock lookup","67","        log.updateConfiguration(log.getContext().getConfiguration());","68","        ","70","        assertTrue(\"using SystemNanoClock\", log.getNanoClock() instanceof DummyNanoClock);"],"delete":["24","import org.apache.logging.log4j.Logger;","57","        final Logger log = LogManager.getLogger(\"com.foo.Bar\");","60","        assertTrue(\"using SystemNanoClock\", AsyncLogger.getNanoClock() instanceof SystemNanoClock);","62","        final long DUMMYNANOTIME = 123;","63","        AsyncLogger.setNanoClock(new DummyNanoClock(DUMMYNANOTIME));","65","        assertTrue(\"using SystemNanoClock\", AsyncLogger.getNanoClock() instanceof DummyNanoClock);"]}]}},"c886016594b2424b787521925c76df85801a0d41":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["87","      <action issue=\"LOG4J2-2478\" dev=\"ckozak\" type=\"fix\" due-to=\"Diego Elias Costa\">","88","        AbstractStringLayoutStringEncodingBenchmark returns the computed variables on each benchmark to avoid DCE.","89","      <\/action>"],"delete":[]}]}},"72bf5bda03c99ec052a81b501f64bbeb5229b334":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["143","            final String trimmedCompressionLevelStr = compressionLevelStr != null ? compressionLevelStr.trim() : compressionLevelStr;","144","            final int compressionLevel = Integers.parseInt(trimmedCompressionLevelStr, Deflater.DEFAULT_COMPRESSION);"],"delete":["143","            final int compressionLevel = Integers.parseInt(compressionLevelStr.trim(), Deflater.DEFAULT_COMPRESSION);"]}]}},"6df26b6c629e31b705337f84c335ebc687b71cde":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessageFactory.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessageFactory.java":[{"add":["19"," * Factory for the simplest possible implementation of Message, the Message String given as the constructor argument."],"delete":["19"," * Simplest message withou no arguments."]}]}},"f659f4ae13da2cc9feab7d4c7e9ab33be2ac55c9":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderDirectWriteStartupSizeTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-direct-startup-size.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderDirectWriteStartupSizeTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2485\" dev=\"rgoers\" type=\"fix\" due-to=\"Giovanni Matteo Fumarola\">","34","        SizeBasedTriggeringPolicy was not honored when using the DirectWriteRolloverStrategy if the machine restarts.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["158","            if (rolloverStrategy instanceof DirectFileRolloverStrategy) {","159","                \/\/ LOG4J2-2485: Initialize size from the most recently written file.","160","                File file = new File(getFileName());","161","                if (file.exists()) {","162","                    size = file.length();","163","                }","164","            }"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j-rolling-direct-startup-size.xml":[{"add":[],"delete":[]}]}},"168b5c1735f36cd7ef31ca031e8d2669f726e146":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["63","      <action dev=\"ggregory\" type=\"fix\" due-to=\"LF-Lin\">","64","        Fix minor typo #792.","65","      <\/action>"],"delete":[]}]}},"9197342a833ea5007c0f92f7d7b37948e5eb052f":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2058\" dev=\"rgoers\" type=\"fix\">","33","        Prevent recursive calls to java.util.LogManager.getLogger().","34","      <\/action>","35","      <action issue=\"LOG4J2-2725\" dev=\"ckozak\" type=\"fix\" due-to=\"Dzmitry Anikechanka\">","36","        LOG4J2-2725 - Added try\/finally around event.execute() for RingBufferLogEventHandler to clear memory","37","        correctly in case of exception\/error","38","      <\/action>"],"delete":[]}]}},"38ddc757b1d862fd78c8f8efb6756d708ed2c18e":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-1176\" dev=\"rpopma\" type=\"fix\">","51","        Fixed memory leak when log4j jars are in Tomcat's lib folder.","52","      <\/action>"],"delete":[]}]}},"ac578602d6454018407b726d12447f27fd3e317e":{"changes":{"core\/src\/test\/resources\/log4j-test2.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/BasicConfigurationFactory.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/FileConfigurationMonitor.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerTest.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfigurationFactory.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":"MODIFY","combined\/src\/test\/resources\/log4j-test2.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/ResolverUtil.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":"MODIFY","log4j12-api\/src\/test\/java\/org\/apache\/log4j\/BasicConfigurationFactory.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfigurationFactory.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServer.java":"MODIFY"},"diff":{"core\/src\/test\/resources\/log4j-test2.xml":[{"add":["18","<configuration status=\"debug\" name=\"XMLConfigTest\" monitorInterval=\"5\" packages=\"org.apache.logging.log4j.test\">"],"delete":["18","<configuration status=\"debug\" name=\"XMLConfigTest\" packages=\"org.apache.logging.log4j.test\">"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["172","    public abstract Configuration getConfiguration(ConfigurationSource source);","185","            ConfigurationSource source = getInputFromURI(configLocation);","196","     * @return The ConfigurationSource for the configuration.","198","    protected ConfigurationSource getInputFromURI(URI configLocation) {","199","        File configFile = FileUtils.fileFromURI(configLocation);","202","                return new ConfigurationSource(new FileInputStream(configFile), configFile);","210","            ConfigurationSource source = getInputFromResource(configLocation.getPath(), loader);","216","            return new ConfigurationSource(configLocation.toURL().openStream(), configLocation.getPath());","233","    protected ConfigurationSource getInputFromString(String config, ClassLoader loader) {","236","            return new ConfigurationSource(url.openStream(), FileUtils.fileFromURI(url.toURI()));","238","            ConfigurationSource source = getInputFromResource(config, loader);","242","                    return new ConfigurationSource(new FileInputStream(file), file);","247","            return source;","255","     * @return The ConfigurationSource for the configuration.","257","    protected ConfigurationSource getInputFromResource(String resource, ClassLoader loader) {","271","","274","                return new ConfigurationSource(is, FileUtils.fileFromURI((url.toURI())));","279","        return new ConfigurationSource(is, resource);","329","                    ConfigurationSource source = getInputFromString(config, loader);","392","                    ConfigurationSource source = getInputFromResource(configName, loader);","407","        public Configuration getConfiguration(ConfigurationSource source) {","409","                String config = source.getLocation();","431","","432","    public static class ConfigurationSource {","433","","434","        private File file;","435","","436","        private String location;","437","","438","        private InputStream stream;","439","","440","        public ConfigurationSource() {","441","        }","442","","443","        public ConfigurationSource(InputStream stream) {","444","            this.stream = stream;","445","            this .file = null;","446","            this.location = null;","447","        }","448","","449","        public ConfigurationSource(InputStream stream, File file) {","450","            this.stream = stream;","451","            this.file = file;","452","            this.location = file.getAbsolutePath();","453","        }","454","","455","        public ConfigurationSource(InputStream stream, String location) {","456","            this.stream = stream;","457","            this.location = location;","458","            this.file = null;","459","        }","460","","461","        public File getFile() {","462","            return file;","463","        }","464","","465","        public void setFile(File file) {","466","            this.file = file;","467","        }","468","","469","        public String getLocation() {","470","            return location;","471","        }","472","","473","        public void setLocation(String location) {","474","            this.location = location;","475","        }","476","","477","        public InputStream getInputStream() {","478","            return stream;","479","        }","480","","481","        public void setInputStream(InputStream stream) {","482","            this.stream = stream;","483","        }","484","    }"],"delete":["94","     * The configuration File.","95","     *\/","96","    protected File configFile = null;","97","","98","    \/**","177","    public abstract Configuration getConfiguration(InputSource source);","190","            InputSource source = getInputFromURI(configLocation);","201","     * @return The InputSource for the configuration.","203","    protected InputSource getInputFromURI(URI configLocation) {","204","        configFile = FileUtils.fileFromURI(configLocation);","207","                InputSource source = new InputSource(new FileInputStream(configFile));","208","                source.setSystemId(configFile.getAbsolutePath());","209","                return source;","217","            InputSource source = getInputFromResource(configLocation.getPath(), loader);","223","            InputSource source = new InputSource(configLocation.toURL().openStream());","224","            source.setSystemId(configLocation.getPath());","225","            return source;","242","    protected InputSource getInputFromString(String config, ClassLoader loader) {","243","        InputSource source;","246","            source = new InputSource(url.openStream());","247","            if (FileUtils.isFile(url)) {","248","                configFile = FileUtils.fileFromURI(url.toURI());","249","            }","250","            source.setSystemId(config);","251","            return source;","253","            source = getInputFromResource(config, loader);","257","                    FileInputStream is = new FileInputStream(file);","258","                    configFile = file;","259","                    source = new InputSource(is);","260","                    source.setSystemId(config);","266","        return source;","273","     * @return The InputSource for the configuration.","275","    protected InputSource getInputFromResource(String resource, ClassLoader loader) {","289","        InputSource source = new InputSource(is);","292","                configFile = FileUtils.fileFromURI(url.toURI());","297","        source.setSystemId(resource);","298","        return source;","348","                    InputSource source = getInputFromString(config, loader);","411","                    InputSource source = getInputFromResource(configName, loader);","426","        public Configuration getConfiguration(InputSource source) {","428","                String config = source.getSystemId() != null ? source.getSystemId() : source.getPublicId();"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/BasicConfigurationFactory.java":[{"add":["43","    public Configuration getConfiguration(ConfigurationSource source) {"],"delete":["43","    public Configuration getConfiguration(InputSource source) {"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/FileConfigurationMonitor.java":[{"add":["52","     * @param interval The monitor interval in seconds. The minimum interval is 5 seconds."],"delete":["52","     * @param interval The monitor interval in seconds. The minimum interval is 30 seconds."]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/LoggerTest.java":[{"add":["27","import org.junit.Before;","31","import java.io.File;","38","import static org.junit.Assert.assertNotNull;","63","    @Before","64","    public void before() {","65","        config = ctx.getConfiguration();","66","        for (Map.Entry<String, Appender> entry : config.getAppenders().entrySet()) {","67","            if (entry.getKey().equals(\"List\")) {","68","                app = (ListAppender) entry.getValue();","69","                break;","70","            }","71","        }","72","        assertNotNull(\"No Appender\", app);","73","        app.clear();","74","    }","75","","76","","168","","169","    @Test","170","    public void testReconfiguration() throws Exception {","171","        File file = new File(\"target\/test-classes\/\" + CONFIG);","172","        long orig = file.lastModified();","173","        long newTime = orig + 10000;","174","        file.setLastModified(newTime);","175","        Thread.sleep(6000);","176","        for (int i = 0; i < 17; ++i) {","177","            logger.debug(\"Reconfigure\");","178","        }","179","        Configuration cfg = ctx.getConfiguration();","180","        assertNotNull(\"No configuration\", cfg);","181","        assertTrue(\"Reconfiguration failed\", cfg != config);","182","    }"],"delete":["51","        config = ctx.getConfiguration();","52","        for (Map.Entry<String, Appender> entry : config.getAppenders().entrySet()) {","53","            if (entry.getKey().equals(\"List\")) {","54","                app = (ListAppender) entry.getValue();","55","                break;","56","            }","57","        }"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":[{"add":["77","    public static LoggerContext initialize(ClassLoader loader, ConfigurationFactory.ConfigurationSource source) {"],"delete":["77","    public static LoggerContext initialize(ClassLoader loader, InputSource source) {"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfigurationFactory.java":[{"add":["63","    public Configuration getConfiguration(ConfigurationSource source) {","67","        return new JSONConfiguration(source);"],"delete":["63","    public Configuration getConfiguration(InputSource source) {","67","        return new JSONConfiguration(source, configFile);"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":[{"add":["64","        ConfigurationFactory.ConfigurationSource source =","65","            new ConfigurationFactory.ConfigurationSource(is, \"target\/test-classes\/log4j2-config.xml\");","84","        ConfigurationFactory.ConfigurationSource source =","85","            new ConfigurationFactory.ConfigurationSource(is);"],"delete":["64","        InputSource source = new InputSource(is);","65","        source.setSystemId(\"target\/test-classes\/log4j2-config.xml\");","84","        InputSource source = new InputSource(is);"]}],"combined\/src\/test\/resources\/log4j-test2.xml":[{"add":["18","<configuration status=\"debug\" name=\"XMLConfigTest\" monitorInterval=\"5\" packages=\"org.apache.logging.log4j.test\">"],"delete":["18","<configuration status=\"debug\" name=\"XMLConfigTest\" packages=\"org.apache.logging.log4j.test\">"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":[{"add":["85","    public XMLConfiguration(ConfigurationFactory.ConfigurationSource configSource) {","86","        this.configFile = configSource.getFile();","90","            InputStream configStream = configSource.getInputStream();","93","            InputSource source = new InputSource(new ByteArrayInputStream(buffer));","167","            LOGGER.error(\"Error parsing \" + configSource.getLocation(), domEx);","169","            LOGGER.error(\"Error parsing \" + configSource.getLocation(), ioe);","171","            LOGGER.error(\"Error parsing \" + configSource.getLocation(), pex);","203","            setName(configSource.getLocation());","222","                ConfigurationFactory.ConfigurationSource source =","223","                    new ConfigurationFactory.ConfigurationSource(new FileInputStream(configFile), configFile);","224","                return new XMLConfiguration(source);"],"delete":["85","    public XMLConfiguration(InputSource source, File configFile) {","86","        this.configFile = configFile;","90","            InputStream configStream = source.getByteStream();","93","            source = new InputSource(new ByteArrayInputStream(buffer));","167","            LOGGER.error(\"Error parsing \" + source.getSystemId(), domEx);","169","            LOGGER.error(\"Error parsing \" + source.getSystemId(), ioe);","171","            LOGGER.error(\"Error parsing \" + source.getSystemId(), pex);","203","            setName(source.getSystemId());","222","                InputSource source = new InputSource(new FileInputStream(configFile));","223","                source.setSystemId(configFile.getAbsolutePath());","224","                return new XMLConfiguration(source, configFile);"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/ResolverUtil.java":[{"add":["278","        BundleWiring wiring = (BundleWiring)FrameworkUtil.getBundle(ResolverUtil.class).adapt(BundleWiring.class);","279","        Collection<String> list = wiring.listResources(packageName, \"*.class\", BundleWiring.LISTRESOURCES_RECURSE);"],"delete":["278","        Collection<String> list = FrameworkUtil.getBundle(ResolverUtil.class).adapt(BundleWiring.class)","279","            .listResources(packageName, \"*.class\", BundleWiring.LISTRESOURCES_RECURSE);"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":[{"add":["63","    public JSONConfiguration(ConfigurationFactory.ConfigurationSource configSource) {","64","        this.configFile = configSource.getFile();","68","            InputStream configStream = configSource.getInputStream();","143","                setName(configSource.getLocation());","146","            LOGGER.error(\"Error parsing \" + configSource.getLocation(), ex);","177","                ConfigurationFactory.ConfigurationSource source =","178","                    new ConfigurationFactory.ConfigurationSource(new FileInputStream(configFile), configFile);","179","                return new JSONConfiguration(source);"],"delete":["29","import org.xml.sax.InputSource;","64","    public JSONConfiguration(InputSource source, File configFile) {","65","        this.configFile = configFile;","69","            InputStream configStream = source.getByteStream();","73","            source = new InputSource(is);","145","                setName(source.getSystemId());","148","            LOGGER.error(\"Error parsing \" + source.getSystemId(), ex);","179","                InputSource source = new InputSource(new FileInputStream(configFile));","180","                source.setSystemId(configFile.getAbsolutePath());","181","                return new JSONConfiguration(source, configFile);"]}],"log4j12-api\/src\/test\/java\/org\/apache\/log4j\/BasicConfigurationFactory.java":[{"add":["38","    public Configuration getConfiguration(ConfigurationSource source) {"],"delete":["38","    public Configuration getConfiguration(InputSource source) {"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfigurationFactory.java":[{"add":["39","    public Configuration getConfiguration(ConfigurationSource source) {","40","        return new XMLConfiguration(source);"],"delete":["39","    public Configuration getConfiguration(InputSource source) {","40","        return new XMLConfiguration(source, configFile);"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SocketServer.java":[{"add":["219","                ConfigurationSource source = null;","223","                    source = new ConfigurationSource(is, file);","230","                        source = new ConfigurationSource(url.openStream(), path);","240","                        return new XMLConfiguration(source);"],"delete":["219","                InputSource source = null;","223","                    source = new InputSource(is);","224","                    source.setSystemId(path);","231","                        source = new InputSource(url.openStream());","232","                        source.setSystemId(path);","242","                        return new XMLConfiguration(source, file);"]}]}},"4e421edd84177cc82e0bc896fcd44080cbb66ba1":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingFileAppender.java":[{"add":["140","                LOGGER.error(\"RollingFileAppender '{}': When no file name is provided a DirectFilenameRolloverStrategy must be configured\", getName());"],"delete":["140","                LOGGER.error(\"RollingFileAppender '{}': When no file name is provided a DirectFilenameRolloverStrategy must be configured\");"]}]}},"eaa663e9f9765d1ce98f7ebb122dc195c28e4df9":{"changes":{"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4j2Logger.java":"ADD","\/dev\/null":"DELETE","log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticMDCBinder.java":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/EventDataConverter.java":"ADD","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":"ADD","log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticMarkerBinder.java":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMDCAdapter.java":"ADD","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMarkerFactory.java":"ADD","log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticLoggerBinder.java":"MODIFY","log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/LoggerTest.java":"MODIFY"},"diff":{"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4j2Logger.java":[{"add":[],"delete":[]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticMDCBinder.java":[{"add":["18","import org.apache.logging.slf4j.Log4jMDCAdapter;"],"delete":["18","import org.slf4j.helpers.Log4jMDCAdapter;"]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/EventDataConverter.java":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticMarkerBinder.java":[{"add":["19","import org.apache.logging.slf4j.Log4jMarkerFactory;","23"," * SLF4J MarkerFactoryBinder implementation using Log4j. This class is part of the required classes used to specify an","24"," * SLF4J logging provider implementation."],"delete":["19","import org.slf4j.helpers.Log4jMarkerFactory;","23"," *"]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMDCAdapter.java":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jMarkerFactory.java":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/slf4j\/impl\/StaticLoggerBinder.java":[{"add":["19","import org.apache.logging.slf4j.Log4jLoggerFactory;","23"," * SLF4J LoggerFactoryBinder implementation using Log4j. This class is part of the required classes used to specify an","24"," * SLF4J logger provider implementation."],"delete":["19","import org.slf4j.helpers.Log4jLoggerFactory;","23"," *"]}],"log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/slf4j\/LoggerTest.java":[{"add":["115","        ((LocationAwareLogger)logger).log(null, Log4j2Logger.class.getName(), LocationAwareLogger.DEBUG_INT,"],"delete":["44","import org.slf4j.impl.SLF4JLogger;","116","        ((LocationAwareLogger)logger).log(null, SLF4JLogger.class.getName(), LocationAwareLogger.DEBUG_INT,"]}]}},"10d960dcbd8a36edfbf3b07475b24bb7f74587f3":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/LogRolloverTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/SizeBasedTriggeringPolicy.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/resources\/rollover-test.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/LogRolloverTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["165","    public void updateTime() {","166","        prevFileTime = nextFileTime;","167","    }","168","","171","            LOGGER.trace(\"PatternProcessor.getNextTime returning {}, nextFileTime={}, prevFileTime={}, current={}, freq={}\", \/\/","172","                    format(nextTime), format(nextFileTime), format(prevFileTime), format(System.currentTimeMillis()), frequency);"],"delete":["167","            LOGGER.trace(\"PatternProcessor.getNextTime returning {}, nextFileTime={}, prevFileTime={}, freq={}\", \/\/","168","                    format(nextTime), format(nextFileTime), format(prevFileTime), frequency);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/SizeBasedTriggeringPolicy.java":[{"add":["94","        boolean triggered = manager.getFileSize() > maxFileSize;","95","        if (triggered) {","96","            manager.getPatternProcessor().updateTime();","97","        }","98","        return triggered;"],"delete":["94","        return manager.getFileSize() > maxFileSize;"]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-535\" dev=\"rgoers\" type=\"fix\">","25","        Reset rollover time when size rollover is triggered.","26","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/resources\/rollover-test.xml":[{"add":[],"delete":[]}]}},"b6d2e348d8c142754edb0ee13b42521d28fe3db9":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":[{"add":["26","import static java.util.Objects.requireNonNull;","27","","29"," * The default {@link ErrorHandler} implementation falling back to {@link StatusLogger}.","30"," * <p>","31"," * It avoids flooding the {@link StatusLogger} by allowing either the first 3 errors or errors once every 5 minutes.","32"," * <\/p>","38","    private static final int MAX_EXCEPTION_COUNT = 3;","40","    private static final long EXCEPTION_INTERVAL_NANOS = TimeUnit.MINUTES.toNanos(5);","44","    private long lastExceptionInstantNanos = System.nanoTime() - EXCEPTION_INTERVAL_NANOS - 1;","49","        this.appender = requireNonNull(appender, \"appender\");","54","     * @param msg a message","58","        final boolean allowed = acquirePermit();","59","        if (allowed) {","66","     *","67","     * @param msg a message","68","     * @param error a {@link Throwable}","71","    public void error(final String msg, final Throwable error) {","72","        final boolean allowed = acquirePermit();","73","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","74","            throw new AppenderLoggingException(msg, error);","79","     * Handle an error with a message, an exception, and a logging event.","80","     *","81","     * @param msg a message","82","     * @param event a {@link LogEvent}","83","     * @param error a {@link Throwable}","86","    public void error(final String msg, final LogEvent event, final Throwable error) {","87","        final boolean allowed = acquirePermit();","88","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","89","            throw new AppenderLoggingException(msg, error);","91","    }","92","","93","    private boolean acquirePermit() {","94","        final long currentInstantNanos = System.nanoTime();","95","        synchronized (this) {","96","            if (currentInstantNanos - lastExceptionInstantNanos > EXCEPTION_INTERVAL_NANOS) {","97","                lastExceptionInstantNanos = currentInstantNanos;","98","                return true;","99","            } else if (exceptionCount < MAX_EXCEPTION_COUNT) {","100","                exceptionCount++;","101","                lastExceptionInstantNanos = currentInstantNanos;","102","                return true;","103","            } else {","104","                return false;","105","            }","112",""],"delete":["27"," *","33","    private static final int MAX_EXCEPTIONS = 3;","35","    private static final long EXCEPTION_INTERVAL = TimeUnit.MINUTES.toNanos(5);","39","    private long lastException = System.nanoTime() - EXCEPTION_INTERVAL - 1;","44","        this.appender = appender;","47","","50","     * @param msg The message.","54","        final long current = System.nanoTime();","55","        if (current - lastException > EXCEPTION_INTERVAL || exceptionCount++ < MAX_EXCEPTIONS) {","58","        lastException = current;","63","     * @param msg The message.","64","     * @param t The Throwable.","67","    public void error(final String msg, final Throwable t) {","68","        final long current = System.nanoTime();","69","        if (current - lastException > EXCEPTION_INTERVAL || exceptionCount++ < MAX_EXCEPTIONS) {","70","            LOGGER.error(msg, t);","71","        }","72","        lastException = current;","73","        if (!appender.ignoreExceptions() && t != null && !(t instanceof AppenderLoggingException)) {","74","            throw new AppenderLoggingException(msg, t);","79","     * Handle an error with a message, and exception and a logging event.","80","     * @param msg The message.","81","     * @param event The LogEvent.","82","     * @param t The Throwable.","85","    public void error(final String msg, final LogEvent event, final Throwable t) {","86","        final long current = System.nanoTime();","87","        if (current - lastException > EXCEPTION_INTERVAL || exceptionCount++ < MAX_EXCEPTIONS) {","88","            LOGGER.error(msg, t);","90","        lastException = current;","91","        if (!appender.ignoreExceptions() && t != null && !(t instanceof AppenderLoggingException)) {","92","            throw new AppenderLoggingException(msg, t);"]}],"src\/changes\/changes.xml":[{"add":["103","      <action issue=\"LOG4J2-3060\" dev=\"vy\" type=\"fix\" due-to=\" Nikita Mikhailov\">","104","        Fix thread-safety issues in DefaultErrorHandler.","105","      <\/action>","106","      <action issue=\"LOG4J2-3185\" dev=\"vy\" type=\"fix\" due-to=\"mzbonnt\">","107","        Fix thread-safety issues in DefaultErrorHandler.","108","      <\/action>"],"delete":[]}]}},"7f840ca8feea0ba1cf00ed9a2ce11d05c52f94df":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileAppenderUpdateDataTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileAppenderUpdateDataTest.java":[{"add":["28","import org.junit.After;","30","import org.junit.BeforeClass;","67","    private LoggerContext loggerContext1 = null;","68","    private LoggerContext loggerContext2 = null;","69","","70","    @After","71","\tpublic void after() {","72","    \tif (loggerContext1 != null) {","73","    \t\tloggerContext1.close();","74","    \t\tloggerContext1 = null;","75","\t\t}","76","    \tif (loggerContext2 != null) {","77","    \t\tloggerContext2.close();","78","    \t\tloggerContext2 = null;","79","\t\t}","80","\t}","81","","98","        loggerContext1 = Configurator.initialize(buildConfigA().build());","102","        loggerContext2 = Configurator.initialize(buildConfigB().build());","108","\t@Test","109","\tpublic void testReconfigure() {","110","\t\t\/\/ initial config with indexed rollover","111","\t\tloggerContext1 = Configurator.initialize(buildConfigA().build());","112","\t\tvalidateAppender(loggerContext1, \"target\/rolling-update-date\/foo.log.%i\");","113","","114","\t\t\/\/ rebuild config with date based rollover","115","\t\tloggerContext1.setConfiguration(buildConfigB().build());","116","\t\tvalidateAppender(loggerContext1, \"target\/rolling-update-date\/foo.log.%d{yyyy-MM-dd-HH:mm:ss}.%i\");","117","\t}","118",""],"delete":["81","        final LoggerContext loggerContext1 = Configurator.initialize(buildConfigA().build());","85","        final LoggerContext loggerContext2 = Configurator.initialize(buildConfigB().build());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["527","    public Configuration setConfiguration(final Configuration config) {"],"delete":["527","    private Configuration setConfiguration(final Configuration config) {"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2009\" dev=\"rgoers\" type=\"fix\">","34","        Expose LoggerContext.setConfiguration as a public method.","35","      <\/action>"],"delete":[]}]}},"8004a16e796286a22574547c3a6b4358ef7e49bb":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-782\" dev=\"mattsicker\" type=\"fix\">","27","        Remove invalid Oracle Maven repository.","28","      <\/action>"],"delete":[]}],"pom.xml":[{"add":[],"delete":["975","  <repositories>","976","    <repository>","977","      <id>oracleReleases<\/id>","978","      <name>Oracle Released Java Packages<\/name>","979","      <url>http:\/\/download.oracle.com\/maven<\/url>","980","      <layout>default<\/layout>","981","    <\/repository>","982","  <\/repositories>"]}]}},"b2ec5106279486a72f1156e1907df7daee8ada2e":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessage.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessageTest.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessage.java":[{"add":["85","        return obj == null ? that.obj == null : equalObjectsOrStrings(obj, that.obj);","86","    }","87","    ","88","    private boolean equalObjectsOrStrings(Object left, Object right) {","89","        return left.equals(right) || String.valueOf(left).equals(String.valueOf(right));"],"delete":["85","        return obj == null ? that.obj == null : obj.equals(that.obj);"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessageTest.java":[{"add":["90","        assertEquals(other, msg);"],"delete":["22","import org.junit.Ignore;","79","    public void testDeserializeNonSerializableParamNotEqualIfToStringDiffers() {","80","        ObjectMessageTest nonSerializable = new ObjectMessageTest();","81","        assertFalse(nonSerializable instanceof Serializable);","82","        ObjectMessage msg = new ObjectMessage(nonSerializable);","83","        ObjectMessage other = SerialUtil.deserialize(SerialUtil.serialize(msg));","84","        assertNotEquals(\"Expected different: toString is different\", msg, other);","85","    }","86","    ","87","    @Ignore","88","    @Test","100","\/\/ TODO this fails: msg.obj.equals(other.obj) is false...","101","\/\/ TODO ObjectMessage.equals() implementation does not match the serialization mechanism"]}]}},"837dcd89d5f0ff02c240ec10704409ca133f5dbe":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessage.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessageTest.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessage.java":[{"add":["267","        out.writeObject(stringArgs);","276","        stringArgs = (String[]) in.readObject();"],"delete":["275","        stringArgs = new String[length];","276","        for (int i = 0; i < length; ++i) {","277","            stringArgs[i] = in.readUTF();","278","        }"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-523\" dev=\"ggregory\" type=\"fix\">","24","        LocalizedMessage serialization is broken.","25","      <\/action>"],"delete":[]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/LocalizedMessageTest.java":[{"add":[],"delete":["45","    @Ignore(\"org.apache.commons.lang3.SerializationException: java.io.EOFException\")","54","    @Ignore(\"org.apache.commons.lang3.SerializationException: java.io.EOFException\")"]}]}},"b2ace544c47fb8000ad38e566924c85bf845bad2":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-775\" dev=\"ggregory\" type=\"update\">","25","        Update Apache Flume to 1.5.0.1 from 1.5.0.","26","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["160","    <flumeVersion>1.5.0.1<\/flumeVersion>"],"delete":["160","    <flumeVersion>1.5.0<\/flumeVersion>"]}]}},"d517ea241fcdde0c0e6ec97230eb7564228a32c9":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/MutableLogEventTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/MutableLogEventTest.java":[{"add":["100","        assertSame(\"level\", Level.OFF, mutable.getLevel());","153","        assertSame(\"level\", Level.OFF, mutable.getLevel());"],"delete":["100","        assertNull(\"level\", mutable.getLevel());","153","        assertNull(\"level\", mutable.getLevel());"]}]}},"fc3e9d2dc79db9410e67f9e87d92cb5e30f69cdf":{"changes":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilterTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilter.java":"MODIFY","core\/src\/test\/resources\/log4j2-sdfilter.xml":"ADD"},"diff":{"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilterTest.java":[{"add":["19","import org.apache.logging.log4j.LogManager;","20","import org.apache.logging.log4j.Logger;","21","import org.apache.logging.log4j.core.Appender;","23","import org.apache.logging.log4j.core.LoggerContext;","24","import org.apache.logging.log4j.core.config.Configuration;","25","import org.apache.logging.log4j.core.config.Configurator;","27","import org.apache.logging.log4j.message.MapMessage;","29","import org.apache.logging.log4j.test.appender.ListAppender;","32","import java.util.HashMap;","33","import java.util.List;","34","import java.util.Map;","35","","36","import static org.junit.Assert.assertFalse;","37","import static org.junit.Assert.assertNotNull;","71","","72","    @Test","73","    public void testConfig() {","74","        LoggerContext ctx = Configurator.initialize(\"Test1\", null, \"target\/test-classes\/log4j2-sdfilter.xml\");","75","        Configuration config = ctx.getConfiguration();","76","        Filter filter = config.getFilter();","77","        assertNotNull(\"No StructuredDataFilter\", filter);","78","        assertTrue(\"Not a StructuredDataFilter\", filter instanceof  StructuredDataFilter);","79","        StructuredDataFilter sdFilter = (StructuredDataFilter) filter;","80","        assertFalse(\"Should not be And filter\", sdFilter.isAnd());","81","        Map<String, List<String>> map = sdFilter.getMap();","82","        assertNotNull(\"No Map\", map);","83","        assertTrue(\"No elements in Map\", map.size() != 0);","84","        assertTrue(\"Incorrect number of elements in Map\", map.size() == 1);","85","        assertTrue(\"Map does not contain key eventId\", map.containsKey(\"eventId\"));","86","        assertTrue(\"List does not contain 2 elements\", map.get(\"eventId\").size() == 2);","87","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-113\" dev=\"rgoers\" type=\"fix\">","26","        StructuredDataFilter createFilter was annotated with PluginAttr instead of PluginElement for the","27","        KeyValuePairs.","28","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/StructuredDataFilter.java":[{"add":["24","import org.apache.logging.log4j.core.config.plugins.PluginElement;","101","    public static StructuredDataFilter createFilter(@PluginElement(\"pairs\") KeyValuePair[] pairs,"],"delete":["100","    public static StructuredDataFilter createFilter(@PluginAttr(\"pairs\") KeyValuePair[] pairs,"]}],"core\/src\/test\/resources\/log4j2-sdfilter.xml":[{"add":[],"delete":[]}]}},"dbc245151834f6af6fa1d41afe1d486bbbd575f4":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424LayoutTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SyslogAppenderTestBase.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/RFC5424LayoutTest.java":[{"add":["298","        String[] fields = new String[] {","299","                \"[BAZ@32473 baz=\\\"org.apache.logging.log4j.core.layout.RFC5424LayoutTest.testLoggerFields\\\"]\",","300","                \"[RequestContext@3692 bar=\\\"org.apache.logging.log4j.core.layout.RFC5424LayoutTest.testLoggerFields\\\"]\",","302","        };","303","        List<String> expectedToContain = Arrays.asList(fields);","334","                Assert.assertTrue(\"Message expected to contain \" + value + \" but did not\", message.contains(value));"],"delete":["298","        List<String> expectedToContain = Arrays.asList(","299","                \"[BAZ@32473 baz=\\\"org.apache.logging.log4j.core.layout.RFC5424LayoutTest.testLoggerFields\\\"]\"  +","300","                \"[RequestContext@3692 bar=\\\"org.apache.logging.log4j.core.layout.RFC5424LayoutTest.testLoggerFields\\\"]\" +","302","        );","333","                Assert.assertTrue(\"Not expected message received\", message.contains(value));"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SyslogAppenderTestBase.java":[{"add":["99","        String str = msg.asString(null, null);","100","        sentMessages.add(str);","117","            assertTrue(\"Incorrect message received: \" + receivedMessage,","118","                    receivedMessage.endsWith(sentMessage + suffix) || receivedMessage.contains(sentMessage));"],"delete":["99","        sentMessages.add(line1);","116","            assertTrue(\"Incorrect message received: \" + receivedMessage, receivedMessage.endsWith(sentMessage + suffix));"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-560\" dev=\"rgoers\" type=\"fix\">","24","          SyslogAppenderTest and RFC5424LayoutTest were failing in Java 8.","25","      <\/action>"],"delete":[]}]}},"195aedd8979db85a1bee5b04cbaa2838827c7574":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","    <release version=\"2.?.?\" date=\"2014-??-??\" description=\"Bug fixes and enhancements\">","24","      <action issue=\"LOG4J2-793\" dev=\"mattsicker\" type=\"add\">","25","        Add support for custom SLF4J Markers in log4j-slf4j-impl module.","26","      <\/action>"],"delete":["23","    <release version=\"2.?.?\" date=\"2014-??-??\" description=\"Bug fixes and enhancements\">    "]}]}},"ae353a20a5d83a7df3f2d937a6adec4243226970":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MarkerSimpleNamePatternConverterTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/layouts.xml.vm":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MarkerSimpleNamePatternConverter.java":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MarkerSimpleNamePatternConverterTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-1144\" dev=\"ggregory\" type=\"fix\">","42","        Add %markerSimpleName in pattern layout should evaluate to marker name (not toString()).","43","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/layouts.xml.vm":[{"add":["961","              <td>The full name of the marker, including parents, if one is present.<\/td>","962","            <\/tr>","963","            <tr>","964","              <td align=\"center\">","965","                <b>markerSimpleName<\/b>","966","              <\/td>","967","              <td>The simple name of the marker (not including parents), if one is present.<\/td>"],"delete":["961","              <td>The name of the marker, if one is present.<\/td>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MarkerSimpleNamePatternConverter.java":[{"add":[],"delete":[]}]}},"1a63d3793ac446bb19a8f137967b927215351346":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContextKey.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/LoggerContextKey.java":[{"add":["21","\/**\r","22"," * Creates keys used in maps for use in LoggerContext implementations.\r","23"," * \r","24"," * @since 2.5\r","25"," *\/\r"],"delete":[]}]}},"500a5aea930b18eec3526982921a9ee3c305f956":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2028\" dev=\"rgoers\" type=\"fix\" due-to=\"Jason Tedor\">","34","        Java 9 StackLocator was not properly skipping the initial stack frames.","35","      <\/action>"],"delete":[]}]}},"4392e24370a4323600909034485267fe391e9ef0":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["171","        LOGGER.trace(\"AbstractConfiguration stopping...\");","172","        ","184","                \/\/LOGGER.trace(\"AbstractConfiguration stopped AsyncLogger disruptor.\");","188","        int asyncLoggerConfigCount = 0;","197","                asyncLoggerConfigCount++;","202","            asyncLoggerConfigCount++;","204","        LOGGER.trace(\"AbstractConfiguration stopped {} AsyncLoggerConfigs.\", asyncLoggerConfigCount);","210","        int asyncAppenderCount = 0;","214","                asyncAppenderCount++;","217","        LOGGER.trace(\"AbstractConfiguration stopped {} AsyncAppenders.\", asyncAppenderCount);","218","","219","        int appenderCount = 0;","223","                appenderCount++;","226","        LOGGER.trace(\"AbstractConfiguration stopped {} Appenders.\", appenderCount);","227","","228","        int loggerCount = 0;","233","            loggerCount++;","235","        LOGGER.trace(\"AbstractConfiguration stopped {} Loggers.\", loggerCount);","236",""],"delete":["171",""]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-520\" dev=\"rpopma\" type=\"fix\" due-to=\"JavaTech, Andre Bogus\">","25","        Resolved issue where AsyncAppender dropped events if queue still contained","26","        events when application is stopped.","27","      <\/action>","29","        Resolved a problem with the previous solution for LOG4J2-392 that resulted in dropped events"],"delete":["25","        Resolved a problem with the previous solution that resulted in dropped events"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["361","    public static boolean canDeserialize(final Serializable event) {","362","        return event instanceof LogEventProxy;","363","    }","364","    "],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":[{"add":["114","        LOGGER.trace(\"AsyncAppender stopping. Queue still has {} events.\", queue.size());","121","        LOGGER.trace(\"AsyncAppender stopped. Queue has {} events.\", queue.size());","250","            LOGGER.trace(\"AsyncAppender.AsyncThread shutting down. Processing remaining {} queue events.\",","251","                    queue.size());","252","            int count= 0;","253","            int ignored = 0;","257","                    if (Log4jLogEvent.canDeserialize(s)) {","261","                        count++;","262","                    } else {","263","                        ignored++;","264","                        LOGGER.trace(\"Ignoring event of class {}\", s.getClass().getName());","270","            LOGGER.trace(\"AsyncAppender.AsyncThread stopped. Queue has {} events remaining. \" +","271","            \t\t\"Processed {} and ignored {} events since shutdown started.\", ","272","            \t\tqueue.size(), count, ignored);"],"delete":["251","                    if (s instanceof Log4jLogEvent) {"]}]}},"a7e4f542386a6679357b5f38ecad8d68dd9e2c1e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["215","        } catch (Exception | LinkageError e) {"],"delete":["215","        } catch (Exception e) {"]}]}},"b3ec097011ab551fef6c74d623ed332a6abe8be8":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppender.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingRandomAccessFileAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileManager.java":[{"add":["106","    \/**","107","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","108","     * @return {@link Boolean#FALSE}.","109","     * @deprecated end-of-batch on the event is used instead.","110","     *\/","111","    @Deprecated","113","        return Boolean.FALSE;","116","    \/**","117","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","118","     * This method is a no-op.","119","     * @deprecated end-of-batch on the event is used instead.","120","     *\/","121","    @Deprecated","122","    public void setEndOfBatch(@SuppressWarnings(\"unused\") final boolean endOfBatch) {"],"delete":["72","    private final ThreadLocal<Boolean> isEndOfBatch = new ThreadLocal<>();","84","        this.isEndOfBatch.set(Boolean.FALSE);","109","        return isEndOfBatch.get();","112","    public void setEndOfBatch(final boolean endOfBatch) {","113","        this.isEndOfBatch.set(Boolean.valueOf(endOfBatch));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["111","    \/**","112","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","113","     * @return {@link Boolean#FALSE}.","114","     * @deprecated end-of-batch on the event is used instead.","115","     *\/","116","    @Deprecated","118","        return Boolean.FALSE;","121","    \/**","122","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","123","     * This method is a no-op.","124","     * @deprecated end-of-batch on the event is used instead.","125","     *\/","126","    @Deprecated","127","    public void setEndOfBatch(@SuppressWarnings(\"unused\") final boolean endOfBatch) {"],"delete":["48","    private final ThreadLocal<Boolean> isEndOfBatch = new ThreadLocal<>();","73","        isEndOfBatch.set(Boolean.FALSE);","114","        return isEndOfBatch.get();","117","    public void setEndOfBatch(final boolean endOfBatch) {","118","        this.isEndOfBatch.set(Boolean.valueOf(endOfBatch));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppender.java":[{"add":[],"delete":["144","     * Write the log entry rolling over the file when required.","145","     *","146","     * @param event The LogEvent.","147","     *\/","148","    @Override","149","    public void append(final LogEvent event) {","150","","151","        \/\/ Leverage the nice batching behaviour of async Loggers\/Appenders:","152","        \/\/ we can signal the file manager that it needs to flush the buffer","153","        \/\/ to disk at the end of a batch.","154","        \/\/ From a user's point of view, this means that all log events are","155","        \/\/ _always_ available in the log file, without incurring the overhead","156","        \/\/ of immediateFlush=true.","157","        getManager().setEndOfBatch(event.isEndOfBatch()); \/\/ FIXME manager's EndOfBatch threadlocal can be deleted","158","","159","        \/\/ LOG4J2-1292 utilize gc-free Layout.encode() method: taken care of in superclass","160","        super.append(event);","161","    }","162","","163","    \/**"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/MemoryMappedFileAppender.java":[{"add":[],"delete":["157","     * Write the log entry rolling over the file when required.","158","     *","159","     * @param event The LogEvent.","160","     *\/","161","    @Override","162","    public void append(final LogEvent event) {","163","","164","        \/\/ Leverage the nice batching behaviour of async Loggers\/Appenders:","165","        \/\/ we can signal the file manager that it needs to flush the buffer","166","        \/\/ to disk at the end of a batch.","167","        \/\/ From a user's point of view, this means that all log events are","168","        \/\/ _always_ available in the log file, without incurring the overhead","169","        \/\/ of immediateFlush=true.","170","        getManager().setEndOfBatch(event.isEndOfBatch()); \/\/ FIXME manager's EndOfBatch threadlocal can be deleted","171","        super.append(event); \/\/ TODO should only call force() if immediateFlush && endOfBatch?","172","    }","173","","174","    \/**"]}],"src\/changes\/changes.xml":[{"add":["87","      <action issue=\"LOG4J2-3141\" dev=\"ckozak\" type=\"add\">","88","        Avoid ThreadLocal overhead in RandomAccessFileAppender, RollingRandomAccessFileManager,","89","        and MemoryMappedFileManager due to the unused setEndOfBatch and isEndOfBatch methods.","90","        The methods on LogEvent are preferred.","91","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileManager.java":[{"add":["75","    \/**","76","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","77","     * @return {@link Boolean#FALSE}.","78","     * @deprecated end-of-batch on the event is used instead.","79","     *\/","80","\t@Deprecated","82","        return Boolean.FALSE;","85","    \/**","86","     * No longer used, the {@link org.apache.logging.log4j.core.LogEvent#isEndOfBatch()} attribute is used instead.","87","     * This method is a no-op.","88","     * @deprecated end-of-batch on the event is used instead.","89","     *\/","90","    @Deprecated","91","    public void setEndOfBatch(@SuppressWarnings(\"unused\") final boolean endOfBatch) {"],"delete":["45","    private final ThreadLocal<Boolean> isEndOfBatch = new ThreadLocal<>();","53","        this.isEndOfBatch.set(Boolean.FALSE);","78","        return isEndOfBatch.get();","81","    public void setEndOfBatch(final boolean endOfBatch) {","82","        this.isEndOfBatch.set(Boolean.valueOf(endOfBatch));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingRandomAccessFileAppender.java":[{"add":[],"delete":["241","        \/\/ Leverage the nice batching behaviour of async Loggers\/Appenders:","242","        \/\/ we can signal the file manager that it needs to flush the buffer","243","        \/\/ to disk at the end of a batch.","244","        \/\/ From a user's point of view, this means that all log events are","245","        \/\/ _always_ available in the log file, without incurring the overhead","246","        \/\/ of immediateFlush=true.","247","        manager.setEndOfBatch(event.isEndOfBatch()); \/\/ FIXME manager's EndOfBatch threadlocal can be deleted","248",""]}]}},"ed003f96573790138898dce7df10c961bd14739b":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-random-direct.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["89","            if (randomAccessFile != null && randomAccessFile.length() == 0) {"],"delete":["89","            if (randomAccessFile.length() == 0) {"]}],"log4j-core\/src\/test\/resources\/log4j-rolling-random-direct.xml":[{"add":["29","      <PatternLayout header=\"This is a test\">"],"delete":["29","      <PatternLayout>"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2247\" dev=\"rgoers\" type=\"fix\">","34","        NullPointerException would occur when header was provided to a Layout on RollingRandingAccessFileAppender","35","        with DirectWriteRolloverStrategy.","36","      <\/action>"],"delete":[]}]}},"8acedb4e7718ad6ac6ddb648143bfbb1aa10fa83":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationRootLoggerOnlyTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/resources\/log4j2-properties-root-only.properties":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationRootLoggerOnlyTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationFactory.java":[{"add":["153","        if (loggerProp != null) {"],"delete":["153","        if (appenderProp != null) {","402","    @SuppressWarnings({\"unchecked\", \"rawtypes\"})"]}],"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-1153\" dev=\"rpopma\" type=\"fix\">","42","        Fixed NullPointerException when only root logger is defined (and no named loggers) in configuration properties file.","43","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j2-properties-root-only.properties":[{"add":[],"delete":[]}]}},"59204c45d0b4c6542ad9ff887a5d67c75b9fdc8a":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":[{"add":["391","        if (mbs.isRegistered(objectName)) {","392","            try {","393","                mbs.unregisterMBean(objectName);","394","            } catch (MBeanRegistrationException | InstanceNotFoundException ex) {","395","                LOGGER.trace(\"Failed to unregister MBean {}\", objectName);","396","            }","397","        }","401",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["77","      <action issue=\"LOG4J2-3121\" dev=\"ggregory\" type=\"fix\" due-to=\"Markus Spann\">","78","          log4j2 config modified at run-time may trigger incomplete MBean re-initialization due to InstanceAlreadyExistsException."],"delete":[]}]}},"8e633b1013f8c21d5df3352ccb95696dd55a5339":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["21","import java.lang.ref.PhantomReference;","22","import java.lang.ref.Reference;","23","import java.lang.ref.ReferenceQueue;","32","import org.apache.logging.log4j.Marker;","33","import org.apache.logging.log4j.MarkerManager;","58","    private static final Marker SHUTDOWN_HOOK = MarkerManager.getMarker(\"SHUTDOWN HOOK\");","73","    \/**","74","     * Once a shutdown hook thread executes, we can't remove it from the runtime (throws an exception). Therefore,","75","     * it's really pointless to keep a strongly accessible reference to said thread. Thus, please use a","76","     * PhantomReference here to prevent possible cyclic memory references.","77","     *\/","78","    private Reference<Thread> shutdownThread;","160","                    registerShutdownHookIfEnabled();","176","                if (status == Status.INITIALIZED || status == Status.STOPPED) {","177","                    registerShutdownHookIfEnabled();","187","    private void registerShutdownHookIfEnabled() {","188","        if (config.isShutdownHookEnabled()) {","189","            LOGGER.debug(SHUTDOWN_HOOK, \"Shutdown hook enabled. Registering a new one.\");","190","            final Thread thread = new Thread(new ShutdownThread(this), \"log4j-shutdown\");","191","            shutdownThread = new PhantomReference<Thread>(thread, new ReferenceQueue<Thread>());","192","            try {","193","                Runtime.getRuntime().addShutdownHook(thread);","194","            } catch (final IllegalStateException ise) {","195","                LOGGER.warn(SHUTDOWN_HOOK, \"Unable to register shutdown hook due to JVM state\");","196","            } catch (final SecurityException se) {","197","                LOGGER.warn(SHUTDOWN_HOOK, \"Unable to register shutdown hook due to security restrictions\");","198","            }","199","        }","200","    }","201","","210","            unregisterShutdownHook();","220","","221","            \/\/ in finally: unregister MBeans even if an exception occurred while stopping","226","    private void unregisterShutdownHook() {","227","        if (shutdownThread != null) {","228","            LOGGER.debug(SHUTDOWN_HOOK, \"Enqueue shutdown hook for garbage collection.\");","229","            shutdownThread.enqueue();","230","        }","231","    }","232","","358","        firePropertyChangeEvent(new PropertyChangeEvent(this, PROPERTY_CONFIG, prev, config));","368","    private void firePropertyChangeEvent(final PropertyChangeEvent event) {","369","        for (final PropertyChangeListener listener : propertyChangeListeners) {","370","            listener.propertyChange(event);","371","        }","372","    }","373","","395","        LOGGER.debug(\"Reconfiguration started for context {}\", name);","431","        LOGGER.debug(\"Reconfiguration started for context {}\", name);","446","    private static class ShutdownThread implements Runnable {","456","            LOGGER.debug(\"Stopping LoggerContext [{}]\", context);","458","            LOGGER.debug(\"LoggerContext [{}] stopped.\", context);"],"delete":["67","    private ShutdownThread shutdownThread = null;","149","                    if (config.isShutdownHookEnabled()) {","150","                        shutdownThread = new ShutdownThread(this);","151","                        try {","152","                            Runtime.getRuntime().addShutdownHook(shutdownThread);","153","                        } catch (final IllegalStateException ise) {","154","                            LOGGER.warn(\"Unable to register shutdown hook due to JVM state\");","155","                            shutdownThread = null;","156","                        } catch (final SecurityException se) {","157","                            LOGGER.warn(\"Unable to register shutdown hook due to security restrictions\");","158","                            shutdownThread = null;","159","                        }","160","                    }","176","                if ((status == Status.INITIALIZED || status == Status.STOPPED) && config.isShutdownHookEnabled() ) {","177","                    shutdownThread = new ShutdownThread(this);","178","                    try {","179","                        Runtime.getRuntime().addShutdownHook(shutdownThread);","180","                    } catch (final IllegalStateException ise) {","181","                        LOGGER.warn(\"Unable to register shutdown hook due to JVM state\");","182","                        shutdownThread = null;","183","                    } catch (final SecurityException se) {","184","                        LOGGER.warn(\"Unable to register shutdown hook due to security restrictions\");","185","                        shutdownThread = null;","186","                    }","204","            if (shutdownThread != null) {","205","                Runtime.getRuntime().removeShutdownHook(shutdownThread);","206","                shutdownThread = null;","207","            }","217","            ","218","            \/\/ in finally: unregister MBeans even if an exception occurred while stopping ","348","        \/\/ notify listeners","349","        final PropertyChangeEvent evt = new PropertyChangeEvent(this, PROPERTY_CONFIG, prev, config);","350","        for (final PropertyChangeListener listener : propertyChangeListeners) {","351","            listener.propertyChange(evt);","352","        }","383","        LOGGER.debug(\"Reconfiguration started for context \" + name);","419","        LOGGER.debug(\"Reconfiguration started for context \" + name);","434","    private class ShutdownThread extends Thread {","444","            context.shutdownThread = null;"]}]}},"1e6f69b6096e6742bb0c7a83c3343fa4e94b142f":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReflectionComparison.java":"ADD","\/dev\/null":"DELETE","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReflectiveCallerClassUtility.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/ClassLoaderContextSelector.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReflectionComparison.java":[{"add":[],"delete":[]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["38","        Assert.assertNotNull(\"No package data returned\", callerPackageData);"],"delete":["38","        Assert.assertNotNull(\"No package data returned\", callerPackageData);;"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-322\" dev=\"nickwilliams\" type=\"fix\">","24","        Centralized reflective use of Reflection#getCallerClass and properly handled its instability in various versions","25","        of Java.","26","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReflectiveCallerClassUtility.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["39","    private static final PrivateSecurityManager SECURITY_MANAGER;","40","","41","    private static final Method GET_SUPPRESSED;","42","","43","    private static final Method ADD_SUPPRESSED;","53","    private int commonElementCount;","56","        if (ReflectiveCallerClassUtility.isSupported()) {","57","            SECURITY_MANAGER = null;","58","        } else {","59","            PrivateSecurityManager securityManager;","60","            try {","61","                securityManager = new PrivateSecurityManager();","62","                if (securityManager.getClasses() == null) {","63","                    \/\/ This shouldn't happen.","64","                    securityManager = null;","65","                    LOGGER.error(\"Unable to obtain call stack from security manager.\");","66","                }","67","            } catch (final Exception e) {","68","                securityManager = null;","69","                LOGGER.debug(\"Unable to install security manager.\", e);","70","            }","71","            SECURITY_MANAGER = securityManager;","72","        }","73","","74","        Method getSuppressed = null, addSuppressed = null;","75","        final Method[] methods = Throwable.class.getMethods();","76","        for (final Method method : methods) {","77","            if (method.getName().equals(\"getSuppressed\")) {","78","                getSuppressed = method;","79","            } else if (method.getName().equals(\"addSuppressed\")) {","80","                addSuppressed = method;","81","            }","82","        }","83","        GET_SUPPRESSED = getSuppressed;","84","        ADD_SUPPRESSED = addSuppressed;","199","    @SuppressWarnings(\"ThrowableResultOfMethodCallIgnored\")","254","    @SuppressWarnings(\"ThrowableResultOfMethodCallIgnored\")","326","        if (ReflectiveCallerClassUtility.isSupported()) {","328","            int index = 1;","329","            Class<?> clazz = ReflectiveCallerClassUtility.getCaller(index);","332","                clazz = ReflectiveCallerClassUtility.getCaller(++index);","335","        } else if (SECURITY_MANAGER != null) {","336","            final Class<?>[] array = SECURITY_MANAGER.getClasses();","483","        if (GET_SUPPRESSED != null) {","485","                return (ThrowableProxy[]) GET_SUPPRESSED.invoke(throwable);","494","        if (GET_SUPPRESSED != null && ADD_SUPPRESSED != null) {","496","                final Throwable[] array = (Throwable[]) GET_SUPPRESSED.invoke(throwable);","498","                    ADD_SUPPRESSED.invoke(this, new ThrowableProxy(t));"],"delete":["20","import java.lang.reflect.Modifier;","29","import org.apache.logging.log4j.core.helpers.Loader;","39","    private static Method getCallerClass;","40","","41","    private static PrivateSecurityManager securityManager;","42","","45","    private static Method getSuppressed;","46","    private static Method addSuppressed;","49","    private int commonElementCount;","59","        setupCallerCheck();","60","        versionCheck();","300","        if (getCallerClass != null) {","302","            int index = 2;","303","            Class<?> clazz = getCallerClass(index);","306","                clazz = getCallerClass(++index);","309","        } else if (securityManager != null) {","310","            final Class<?>[] array = securityManager.getClasses();","423","     * Invoke Reflection.getCallerClass via reflection. This is slightly slower than calling the method","424","     * directly but removes any dependency on Sun's JDK being present at compile time. The difference","425","     * can be measured by running the ReflectionComparison test.","426","     * @param index The index into the stack trace.","427","     * @return The Class at the specified stack entry.","428","     *\/","429","    private Class<?> getCallerClass(final int index) {","430","        if (getCallerClass != null) {","431","            try {","432","                final Object[] params = new Object[]{index};","433","                return (Class<?>) getCallerClass.invoke(null, params);","434","            } catch (final Exception ex) {","435","                \/\/ logger.debug(\"Unable to determine caller class via Sun Reflection\", ex);","436","            }","437","        }","438","        return null;","439","    }","440","","441","    \/**","475","    private static void versionCheck() {","476","        final Method[] methods = Throwable.class.getMethods();","477","        for (final Method method : methods) {","478","            if (method.getName().equals(\"getSuppressed\")) {","479","                getSuppressed = method;","480","            } else if (method.getName().equals(\"addSuppressed\")) {","481","                addSuppressed = method;","482","            }","483","        }","484","    }","485","","486","    \/**","487","     * Determine if Reflection.getCallerClass is available.","488","     *\/","489","    private static void setupCallerCheck() {","490","        try {","491","            final ClassLoader loader = Loader.getClassLoader();","492","            \/\/ Use wildcard to avoid compile-time reference.","493","            final Class<?> clazz = loader.loadClass(\"sun.reflect.Reflection\");","494","            final Method[] methods = clazz.getMethods();","495","            for (final Method method : methods) {","496","                final int modifier = method.getModifiers();","497","                if (method.getName().equals(\"getCallerClass\") && Modifier.isStatic(modifier) &&","498","                    method.getParameterTypes().length == 1) {","499","                    getCallerClass = method;","500","                    return;","501","                }","502","            }","503","        } catch (final ClassNotFoundException cnfe) {","504","            LOGGER.debug(\"sun.reflect.Reflection is not installed\");","505","        }","506","","507","        try {","508","            final PrivateSecurityManager mgr = new PrivateSecurityManager();","509","            if (mgr.getClasses() != null) {","510","                securityManager = mgr;","511","            } else {","512","                \/\/ This shouldn't happen.","513","                LOGGER.error(\"Unable to obtain call stack from security manager\");","514","            }","515","        } catch (final Exception ex) {","516","            LOGGER.debug(\"Unable to install security manager\", ex);","517","        }","518","    }","519","","521","        if (getSuppressed != null) {","523","                return (ThrowableProxy[]) getSuppressed.invoke(throwable);","532","        if (getSuppressed != null && addSuppressed != null) {","534","                final Throwable[] array = (Throwable[]) getSuppressed.invoke(throwable);","536","                    addSuppressed.invoke(this, new ThrowableProxy(t));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/ClassLoaderContextSelector.java":[{"add":["32","import org.apache.logging.log4j.core.impl.ReflectiveCallerClassUtility;","50","    private static final PrivateSecurityManager SECURITY_MANAGER;","58","        if (ReflectiveCallerClassUtility.isSupported()) {","59","            SECURITY_MANAGER = null;","60","        } else {","61","            PrivateSecurityManager securityManager;","62","            try {","63","                securityManager = new PrivateSecurityManager();","64","                if (securityManager.getCaller(ClassLoaderContextSelector.class.getName()) == null) {","65","                    \/\/ This shouldn't happen.","66","                    securityManager = null;","67","                    LOGGER.error(\"Unable to obtain call stack from security manager.\");","68","                }","69","            } catch (final Exception e) {","70","                securityManager = null;","71","                LOGGER.debug(\"Unable to install security manager\", e);","72","            }","73","            SECURITY_MANAGER = securityManager;","74","        }","94","            if (ReflectiveCallerClassUtility.isSupported()) {","99","                        clazz = ReflectiveCallerClassUtility.getCaller(index);","119","            if (SECURITY_MANAGER != null) {","120","                final Class<?> clazz = SECURITY_MANAGER.getCaller(fqcn);","144","                } catch (final ClassNotFoundException ignore) {","145","                    \/\/this is ok"],"delete":["19","import java.lang.reflect.Method;","20","import java.lang.reflect.Modifier;","51","    private static PrivateSecurityManager securityManager;","52","","53","    private static Method getCallerClass;","61","        setupCallerCheck();","81","            if (getCallerClass != null) {","86","                        final Object[] params = new Object[] {index};","87","                        clazz = (Class<?>) getCallerClass.invoke(null, params);","107","            if (securityManager != null) {","108","                final Class<?> clazz = securityManager.getCaller(fqcn);","132","                } catch (final ClassNotFoundException ex) {","133","                    \/\/System.out.println(\"Could not load class \" + name);","221","    private static void setupCallerCheck() {","222","        try {","223","            final ClassLoader loader = Loader.getClassLoader();","224","            final Class<?> clazz = loader.loadClass(\"sun.reflect.Reflection\");","225","            final Method[] methods = clazz.getMethods();","226","            for (final Method method : methods) {","227","                final int modifier = method.getModifiers();","228","                if (method.getName().equals(\"getCallerClass\") && Modifier.isStatic(modifier)) {","229","                    getCallerClass = method;","230","                    break;","231","                }","232","            }","233","        } catch (final ClassNotFoundException cnfe) {","234","            LOGGER.debug(\"sun.reflect.Reflection is not installed\");","235","        }","236","        try {","237","            securityManager = new PrivateSecurityManager();","238","        } catch (final Exception ex) {","239","            ex.printStackTrace();","240","            LOGGER.debug(\"Unable to install security manager\", ex);","241","        }","242","    }","243",""]}]}},"da6d0e2dcb882273f576459d6fc978c58c50e38a":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderCountTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderCountTest.java":[{"add":["32","import java.nio.file.StandardCopyOption;","42","    private static final String SOURCE = \"src\/test\/resources\/__files\";","45","    private static final String FILENAME = \"onStartup.log\";","46","    private static final String TARGET = \"rolling_test.log.\";","64","        if (Files.exists(Paths.get(DIR))) {","72","        File dir = new File(DIR);","73","        if (!dir.exists()) {","74","            Files.createDirectory(new File(DIR).toPath());","75","        }","76","        Path target = Paths.get(DIR, TARGET + System.currentTimeMillis());","77","        Files.copy(Paths.get(SOURCE, FILENAME), target, StandardCopyOption.COPY_ATTRIBUTES);","83","        assertEquals(\"Expected 17 files, got \" + count, 17, count);"],"delete":["43","    private static final String FILENAME = \"rolling_test.log\";","61","        if (Files.exists(Paths.get(\"target\/onStartup\"))) {","74","        assertEquals(\"Expected 16 files, got \" + count, 16, count);"]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2039\" dev=\"rgoers\" type=\"fix\">","33","        RolloverFails when file matches pattern but index is too large.","34","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":[{"add":["135","                    try {","136","                        final Integer index = Integer.parseInt(matcher.group(1));","137","                        eligibleFiles.put(index, entry);","138","                    } catch (NumberFormatException ex) {","139","                        LOGGER.debug(\"Ignoring file {} which matches pattern but the index is invalid.\",","140","                                entry.toFile().getName());","141","                    }"],"delete":["135","                    final Integer index = Integer.parseInt(matcher.group(1));","136","                    eligibleFiles.put(index, entry);"]}]}},"e5c8122bc3c98d374c453622cccae58227c625e3":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/markers.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["39","      <action issue=\"LOG4J2-2029\" dev=\"ggregory\" type=\"fix\" due-to=\"Fabrizio Cucci\">","40","        Marker examples should not use deprecate flow APIs.","41","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/markers.xml":[{"add":["52","        logger.traceEntry();","56","        String result = ... ","57","","58","        return logger.traceExit(result);","62","        logger.traceEntry();","65","            logger.debug(UPDATE_MARKER, \"UPDATE {} SET {}\", table, formatCols());","66","        }","67","\t","68","        String result = ... ","70","        return logger.traceExit(result);"],"delete":["52","        logger.entry(param);","56","        return logger.exit();","60","        logger.entry(param);","63","          logger.debug(UPDATE_MARKER, \"UPDATE {} SET {}\", table, formatCols());","65","        return logger.exit();"]}]}},"59a8efed01dbc94c335e24222cc28039070f72a0":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertyFilePropertySourceSecurityManagerIT.java":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertyFilePropertySourceSecurityManagerIT.java":[{"add":["27","import org.junit.BeforeClass;","46","\t@BeforeClass","47","\tpublic static void beforeClass() {","48","\t\tAssert.assertTrue(TEST_FIXTURE_PATH, Files.exists(Paths.get(TEST_FIXTURE_PATH)));","49","\t}","50","\t","63","\t\tpublic void checkPermission(final Permission permission) {","80","\t\tfinal PropertiesUtil propertiesUtil = new PropertiesUtil(TEST_FIXTURE_PATH);"],"delete":["57","\t\tpublic void checkPermission(Permission permission) {","74","\t\tAssert.assertTrue(TEST_FIXTURE_PATH, Files.exists(Paths.get(TEST_FIXTURE_PATH)));","75","\t\tPropertiesUtil propertiesUtil = new PropertiesUtil(TEST_FIXTURE_PATH);"]}]}},"c8a7e559fa3cfd16f0e8a7be945a7682bebd11ab":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Chars.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Chars.java":[{"add":["35","    \/** NUL. *\/","36","\tpublic static final char NUL = 0;","37","","38","\t\/** Single Quote [']. *\/"],"delete":["35","    \/** Single Quote [']. *\/"]}],"src\/changes\/changes.xml":[{"add":["169","      <action issue=\"LOG4J2-2243\" dev=\"ggregory\" type=\"update\" due-to=\"Gary Gregory\">","170","        Cannot see or copy all of certain JAnsi exception messages on Windows due to NUL characters.","171","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["41","import org.apache.logging.log4j.util.Chars;","276","            LOGGER.warn(\"Unable to instantiate {} due to {}\", JANSI_CLASS, clean(Throwables.getRootCause(ex).toString()).trim());","281","    private static String clean(String string) {","282","\t\treturn string.replace(Chars.NUL, Chars.SPACE);","283","\t}","284","","285","\t\/**"],"delete":["275","            LOGGER.warn(\"Unable to instantiate {} due to {}\", JANSI_CLASS, Throwables.getRootCause(ex).toString().trim());","280","    \/**"]}]}},"35f4ed5f7817305a12d3badc311cce810324ecf9":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/ResolverUtil.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/ResolverUtil.java":[{"add":["21","import java.io.InputStream;","201","                    final String containerPath = urlPath.substring(1, urlPath.length() - packageName.length() - 2);","203","                    if (containerFile.exists()) {","204","                        if (containerFile.isDirectory()) {","205","                            loadImplementationsInDirectory(test, packageName, new File(containerFile, packageName));","206","                        } else {","207","                            loadImplementationsInJar(test, packageName, containerFile);","208","                        }","210","                        \/\/ fallback code for Jboss\/Wildfly, if the file couldn't be found","211","                        \/\/ by loading the path as a file, try to read the jar as a stream","212","                        final String path = urlPath.substring(0, urlPath.length() - packageName.length() - 2);","213","                        final URL newURL = new URL(url.getProtocol(), url.getHost(), path);","214","","215","                        try (final InputStream is = newURL.openStream()) {","216","                            final JarInputStream jarStream;","217","                            if (is instanceof JarInputStream) {","218","                                jarStream = (JarInputStream) is;","219","                            } else {","220","                                jarStream = new JarInputStream(is);","221","                            }","222","                            loadImplementationsInJar(test, packageName, path, jarStream);","223","                        }"],"delete":["200","                    final String containerPath = urlPath.substring(1,","201","                                                  urlPath.length() - packageName.length() - 2);","203","                    if (containerFile.isDirectory()) {","204","                        loadImplementationsInDirectory(test, packageName, new File(containerFile, packageName));","206","                        loadImplementationsInJar(test, packageName, containerFile);"]}],"src\/changes\/changes.xml":[{"add":["54","      <action issue=\"LOG4J2-548\" dev=\"ggregory\" type=\"update\" due-to=\"Shehata, Paresh Varke, Eric Victorson, Martin Laforet\">","55","      \tLog4j 2.0 ERROR \"Could not search jar\" with JBoss EAP 6.2.","56","      <\/action>"],"delete":[]}]}},"8201adf9336e8b677356b27a9e748c74f4fcd8fd":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/StringsTest.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Strings.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/StringsTest.java":[{"add":["19","import java.util.Arrays;","20","import java.util.Iterator;","21","","37","    public void testJoin() {","38","        Assert.assertEquals(null, Strings.join((Iterable<?>) null, '.'));","39","        Assert.assertEquals(null, Strings.join((Iterator<?>) null, '.'));","40","        Assert.assertEquals(\"\", Strings.join((Arrays.asList()), '.'));","41","","42","        Assert.assertEquals(\"a\", Strings.join(Arrays.asList(\"a\"), '.'));","43","        Assert.assertEquals(\"a.b\", Strings.join(Arrays.asList(\"a\", \"b\"), '.'));","44","        Assert.assertEquals(\"a.b.c\", Strings.join(Arrays.asList(\"a\", \"b\", \"c\"), '.'));","45","","46","        Assert.assertEquals(\"\", Strings.join(Arrays.asList((String) null), ':'));","47","        Assert.assertEquals(\":\", Strings.join(Arrays.asList(null, null), ':'));","48","        Assert.assertEquals(\"a:\", Strings.join(Arrays.asList(\"a\", null), ':'));","49","        Assert.assertEquals(\":b\", Strings.join(Arrays.asList(null, \"b\"), ':'));","50","    }","51","","52","    @Test"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/Strings.java":[{"add":["218","            return Objects.toString(first, EMPTY);"],"delete":["218","            return Objects.toString(first);"]}],"src\/changes\/changes.xml":[{"add":["194","      <action issue=\"LOG4J2-2270\" dev=\"ggregory\" type=\"fix\" due-to=\"Cyril Martin\">","195","        Strings::join, when called with [null] returns \"null\" instead of EMPTY.","196","      <\/action>      "],"delete":[]}]}},"5a940e05b9cf48e1c3522be59fb876ddb38d261e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RandomAccessFileAppender.java":[{"add":["64","        public Builder() {","65","            this.withBufferSize(RandomAccessFileManager.DEFAULT_BUFFER_SIZE);","66","        }","67","","72","                LOGGER.error(\"No name provided for RandomAccessFileAppender\");","77","                LOGGER.error(\"No filename provided for RandomAccessFileAppender with name {}\", name);"],"delete":["68","                LOGGER.error(\"No name provided for FileAppender\");","73","                LOGGER.error(\"No filename provided for FileAppender with name \" + name);"]}],"src\/changes\/changes.xml":[{"add":["97","      <action issue=\"LOG4J2-3150\" dev=\"ckozak\" type=\"fix\">","98","        RandomAccessFile appender uses the correct default buffer size of 256 kB","99","        rather than the default appender buffer size of 8 kB.","100","      <\/action>"],"delete":[]}]}},"0fc41eb518d1e826ebc90ee7c9d1bacb3d1a3553":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/WatchHttpTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/WatchHttpTest.java":[{"add":["108","            watchManager.watch(new Source(url), new HttpWatcher(configuration, null,","144","            watchManager.watch(new Source(url), new HttpWatcher(configuration, null,"],"delete":["108","            watchManager.watch(new Source(url.toURI(), previous.getTimeInMillis()), new HttpWatcher(configuration, null,","144","            watchManager.watch(new Source(url.toURI(), previous.getTimeInMillis()), new HttpWatcher(configuration, null,"]}]}},"365e427f462e9a2789062d21cfbf34eed57cdb97":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["80","      <action issue=\"LOG4J2-1157\" dev=\"mattsicker\" type=\"fix\" due-to=\"Norbert Bartels\">","81","        Fix compilation error for classes annotated with @Plugin.","82","      <\/action>"],"delete":[]}]}},"300bc5750df5b6b6088984eb3d430de90dded566":{"changes":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStack.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStackTest.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextMap.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStackTest.java":"MODIFY","api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStack.java":"MODIFY","api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextMapTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStack.java":[{"add":["163","    ","164","    @Override","165","    public String toString() {","166","        return String.valueOf(list);","167","    }"],"delete":[]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStackTest.java":[{"add":["319","    @Test","320","    public void testToStringShowsListContents() {","321","        final DefaultThreadContextStack stack = new DefaultThreadContextStack(true);","322","        stack.clear();","323","        assertEquals(\"[]\", stack.toString());","324","        ","325","        stack.push(\"msg1\");","326","        stack.add(\"msg2\");","327","        stack.push(\"msg3\");","328","        assertEquals(\"[msg1, msg2, msg3]\", stack.toString());","329","        ","330","        stack.retainAll(Arrays.asList(\"msg1\", \"msg3\"));","331","        assertEquals(\"[msg1, msg3]\", stack.toString());","332","    }"],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextMap.java":[{"add":["141","","142","    @Override","143","    public String toString() {","144","        Map<String, String> map = localMap.get();","145","        return map == null ? \"{}\" : map.toString();","146","    }"],"delete":[]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/MutableThreadContextStackTest.java":[{"add":["322","","323","    @Test","324","    public void testToStringShowsListContents() {","325","        final MutableThreadContextStack stack = new MutableThreadContextStack(new ArrayList<String>());","326","        assertEquals(\"[]\", stack.toString());","327","        ","328","        stack.push(\"msg1\");","329","        stack.add(\"msg2\");","330","        stack.push(\"msg3\");","331","        assertEquals(\"[msg1, msg2, msg3]\", stack.toString());","332","        ","333","        stack.retainAll(Arrays.asList(\"msg1\", \"msg3\"));","334","        assertEquals(\"[msg1, msg3]\", stack.toString());","335","    }"],"delete":[]}],"api\/src\/main\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextStack.java":[{"add":["253","    ","254","    @Override","255","    public String toString() {","256","        final List<String> list = stack.get();","257","        return list == null ? \"[]\" : list.toString();","258","    }"],"delete":[]}],"api\/src\/test\/java\/org\/apache\/logging\/log4j\/spi\/DefaultThreadContextMapTest.java":[{"add":["157","    ","158","    @Test","159","    public void testToStringShowsMapContext() {","160","        final DefaultThreadContextMap map = new DefaultThreadContextMap(true);","161","        assertEquals(\"{}\", map.toString());","162","        ","163","        map.put(\"key1\", \"value1\");","164","        assertEquals(\"{key1=value1}\", map.toString());","165","        ","166","        map.remove(\"key1\");","167","        map.put(\"key2\", \"value2\");","168","        assertEquals(\"{key2=value2}\", map.toString());","169","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-302\" dev=\"rpopma\" type=\"fix\">","24","        Added toString methods to ThreadContextStack\/Map implementation classes.","25","      <\/action>"],"delete":[]}]}},"01c77f691cdebf4cffb54e5c35c954d51c864dbd":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["225","      <action issue=\"LOG4J2-1380\" dev=\"ggregory\" type=\"update\">","226","        Update Jackson from 2.7.3 to 2.7.4.","227","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["192","    <jackson2Version>2.7.4<\/jackson2Version>"],"delete":["192","    <jackson2Version>2.7.3<\/jackson2Version>"]}]}},"2989b2891e39afa2a746cf02b6463bb9722f177a":{"changes":{"src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["601","  <version>2.2.2<\/version>","607","  <version>2.2.2<\/version>"],"delete":["601","  <version>2.2.1<\/version>","607","  <version>2.2.1<\/version>"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-306\" dev=\"ggregory\" type=\"update\">","24","        Update JSON Jackson library to 2.2.2 from 2.2.1.","25","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["138","    <jackson.version>2.2.2<\/jackson.version>"],"delete":["138","    <jackson.version>2.2.1<\/jackson.version>"]}]}},"1899c1b0e01647a836dd799ddc80de8095d388b8":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-517\" dev=\"rpopma\" type=\"fix\">","24","        Switch in log4j-1.2-api Category.getEffectiveLevel has no cases for FATAL, OFF.","25","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["166","            case ERROR:","168","            case FATAL:","169","                return Level.FATAL;","170","            default:","171","                return Level.OFF;"],"delete":["166","            default:"]}]}},"23ab632a75a23d2ce662537c498f5ee7708fb128":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyTest.java":[{"add":["18","import java.io.ByteArrayInputStream;","19","import java.io.ByteArrayOutputStream;","21","import java.io.ObjectInputStream;","22","import java.io.ObjectOutputStream;","30","import sun.misc.BASE64Decoder;","31","","35","import static org.junit.Assert.*;","36","","53","        assertEquals(expected.proxy.getName(), actual.proxy.getName());","54","        assertEquals(expected.proxy.getMessage(), actual.proxy.getMessage());","55","        assertEquals(expected.proxy.getLocalizedMessage(), actual.proxy.getLocalizedMessage());","56","        assertEquals(expected.proxy.getCommonElementCount(), actual.proxy.getCommonElementCount());","57","        assertArrayEquals(expected.proxy.getExtendedStackTrace(), actual.proxy.getExtendedStackTrace());","58","        assertEquals(expected.proxy, actual.proxy);","69","        assertNotNull(\"No package data returned\", callerPackageData);","70","    }","71","","72","    @Test","73","    public void testSerialization() throws Exception {","74","        final Throwable throwable = new IllegalArgumentException(\"This is a test\");","75","        final ThrowableProxy proxy = new ThrowableProxy(throwable);","76","        final byte[] binary = serialize(proxy);","77","        final ThrowableProxy proxy2 = deserialize(binary);","78","","79","        assertEquals(proxy.getName(), proxy2.getName());","80","        assertEquals(proxy.getMessage(), proxy2.getMessage());","81","        assertEquals(proxy.getCauseProxy(), proxy2.getCauseProxy());","82","        assertArrayEquals(proxy.getExtendedStackTrace(), proxy2.getExtendedStackTrace());","83","    }","84","","85","    \/\/ DO NOT REMOVE THIS COMMENT:","86","    \/\/ UNCOMMENT WHEN GENERATING SERIALIZED THROWABLEPROXY FOR #testSerializationWithUnknownThrowable","87","    \/\/ public static class DeletedException extends Exception {","88","    \/\/ private static final long serialVersionUID = 1L;","89","    \/\/","90","    \/\/ public DeletedException(String msg) {","91","    \/\/ super(msg);","92","    \/\/ }","93","    \/\/ };","94","","95","    @Test","96","    public void testSerializationWithUnknownThrowable() throws Exception {","97","","98","        final String msg = \"OMG I've been deleted!\";","99","        ","100","        \/\/ DO NOT DELETE THIS COMMENT:","101","        \/\/ UNCOMMENT TO RE-GENERATE SERIALIZED EVENT WHEN UPDATING THIS TEST.","102","        \/\/ final Exception thrown = new DeletedException(msg);","103","        \/\/ final ThrowableProxy proxy = new ThrowableProxy(thrown);","104","        \/\/ final byte[] binary = serialize(proxy);","105","        \/\/ String base64 = new BASE64Encoder().encode(binary);","106","        \/\/ System.out.println(\"final String base64 = \\\"\" + base64.replaceAll(\"\\r\\n\", \"\\\\\\\\r\\\\\\\\n\\\" +\\r\\n\\\"\") + \"\\\";\");","107","","108","         final String base64 = \"rO0ABXNyADFvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJsZVByb3h5\\r\\n\" +","109","                 \"2cww1Zp7rPoCAAdJABJjb21tb25FbGVtZW50Q291bnRMAApjYXVzZVByb3h5dAAzTG9yZy9hcGFj\\r\\n\" +","110","                 \"aGUvbG9nZ2luZy9sb2c0ai9jb3JlL2ltcGwvVGhyb3dhYmxlUHJveHk7WwASZXh0ZW5kZWRTdGFj\\r\\n\" +","111","                 \"a1RyYWNldAA\/W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkU3Rh\\r\\n\" +","112","                 \"Y2tUcmFjZUVsZW1lbnQ7TAAQbG9jYWxpemVkTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO0wA\\r\\n\" +","113","                 \"B21lc3NhZ2VxAH4AA0wABG5hbWVxAH4AA1sAEXN1cHByZXNzZWRQcm94aWVzdAA0W0xvcmcvYXBh\\r\\n\" +","114","                 \"Y2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL1Rocm93YWJsZVByb3h5O3hwAAAAAHB1cgA\/W0xv\\r\\n\" +","115","                 \"cmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkU3RhY2tUcmFjZUVsZW1l\\r\\n\" +","116","                 \"bnQ7ys+II6XHz7wCAAB4cAAAABhzcgA8b3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1w\\r\\n\" +","117","                 \"bC5FeHRlbmRlZFN0YWNrVHJhY2VFbGVtZW504d7Pusa2kAcCAAJMAA5leHRyYUNsYXNzSW5mb3QA\\r\\n\" +","118","                 \"NkxvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBsL0V4dGVuZGVkQ2xhc3NJbmZvO0wA\\r\\n\" +","119","                 \"EXN0YWNrVHJhY2VFbGVtZW50dAAdTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDt4cHNyADRv\\r\\n\" +","120","                 \"cmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4dGVuZGVkQ2xhc3NJbmZvAAAAAAAA\\r\\n\" +","121","                 \"AAECAANaAAVleGFjdEwACGxvY2F0aW9ucQB+AANMAAd2ZXJzaW9ucQB+AAN4cAF0AA10ZXN0LWNs\\r\\n\" +","122","                 \"YXNzZXMvdAABP3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxp\\r\\n\" +","123","                 \"bmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgADTAAIZmlsZU5hbWVxAH4AA0wACm1ldGhvZE5h\\r\\n\" +","124","                 \"bWVxAH4AA3hwAAAAaHQANW9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuVGhyb3dh\\r\\n\" +","125","                 \"YmxlUHJveHlUZXN0dAAXVGhyb3dhYmxlUHJveHlUZXN0LmphdmF0ACV0ZXN0U2VyaWFsaXphdGlv\\r\\n\" +","126","                 \"bldpdGhVbmtub3duVGhyb3dhYmxlc3EAfgAIc3EAfgAMAHEAfgAPdAAIMS42LjBfNDVzcQB+ABD\/\\r\\n\" +","127","                 \"\/\/\/+dAAkc3VuLnJlZmxlY3QuTmF0aXZlTWV0aG9kQWNjZXNzb3JJbXBsdAAdTmF0aXZlTWV0aG9k\\r\\n\" +","128","                 \"QWNjZXNzb3JJbXBsLmphdmF0AAdpbnZva2Uwc3EAfgAIc3EAfgAMAHEAfgAPcQB+ABdzcQB+ABAA\\r\\n\" +","129","                 \"AAAncQB+ABlxAH4AGnQABmludm9rZXNxAH4ACHNxAH4ADABxAH4AD3EAfgAXc3EAfgAQAAAAGXQA\\r\\n\" +","130","                 \"KHN1bi5yZWZsZWN0LkRlbGVnYXRpbmdNZXRob2RBY2Nlc3NvckltcGx0ACFEZWxlZ2F0aW5nTWV0\\r\\n\" +","131","                 \"aG9kQWNjZXNzb3JJbXBsLmphdmFxAH4AH3NxAH4ACHNxAH4ADABxAH4AD3EAfgAXc3EAfgAQAAAC\\r\\n\" +","132","                 \"VXQAGGphdmEubGFuZy5yZWZsZWN0Lk1ldGhvZHQAC01ldGhvZC5qYXZhcQB+AB9zcQB+AAhzcQB+\\r\\n\" +","133","                 \"AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAC90AClvcmcuanVuaXQucnVubmVycy5t\\r\\n\" +","134","                 \"b2RlbC5GcmFtZXdvcmtNZXRob2QkMXQAFEZyYW1ld29ya01ldGhvZC5qYXZhdAARcnVuUmVmbGVj\\r\\n\" +","135","                 \"dGl2ZUNhbGxzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAAx0ADNv\\r\\n\" +","136","                 \"cmcuanVuaXQuaW50ZXJuYWwucnVubmVycy5tb2RlbC5SZWZsZWN0aXZlQ2FsbGFibGV0ABdSZWZs\\r\\n\" +","137","                 \"ZWN0aXZlQ2FsbGFibGUuamF2YXQAA3J1bnNxAH4ACHNxAH4ADAF0AA5qdW5pdC00LjExLmphcnEA\\r\\n\" +","138","                 \"fgAPc3EAfgAQAAAALHQAJ29yZy5qdW5pdC5ydW5uZXJzLm1vZGVsLkZyYW1ld29ya01ldGhvZHEA\\r\\n\" +","139","                 \"fgAvdAARaW52b2tlRXhwbG9zaXZlbHlzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4A\\r\\n\" +","140","                 \"D3NxAH4AEAAAABF0ADJvcmcuanVuaXQuaW50ZXJuYWwucnVubmVycy5zdGF0ZW1lbnRzLkludm9r\\r\\n\" +","141","                 \"ZU1ldGhvZHQAEUludm9rZU1ldGhvZC5qYXZhdAAIZXZhbHVhdGVzcQB+AAhzcQB+AAwBdAAOanVu\\r\\n\" +","142","                 \"aXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAQ90AB5vcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5u\\r\\n\" +","143","                 \"ZXJ0ABFQYXJlbnRSdW5uZXIuamF2YXQAB3J1bkxlYWZzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4x\\r\\n\" +","144","                 \"MS5qYXJxAH4AD3NxAH4AEAAAAEZ0AChvcmcuanVuaXQucnVubmVycy5CbG9ja0pVbml0NENsYXNz\\r\\n\" +","145","                 \"UnVubmVydAAbQmxvY2tKVW5pdDRDbGFzc1J1bm5lci5qYXZhdAAIcnVuQ2hpbGRzcQB+AAhzcQB+\\r\\n\" +","146","                 \"AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAADJxAH4AUHEAfgBRcQB+AFJzcQB+AAhz\\r\\n\" +","147","                 \"cQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAO50ACBvcmcuanVuaXQucnVubmVy\\r\\n\" +","148","                 \"cy5QYXJlbnRSdW5uZXIkM3EAfgBKcQB+ADdzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJx\\r\\n\" +","149","                 \"AH4AD3NxAH4AEAAAAD90ACBvcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5uZXIkMXEAfgBKdAAI\\r\\n\" +","150","                 \"c2NoZWR1bGVzcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3NxAH4AEAAAAOxxAH4A\\r\\n\" +","151","                 \"SXEAfgBKdAALcnVuQ2hpbGRyZW5zcQB+AAhzcQB+AAwBdAAOanVuaXQtNC4xMS5qYXJxAH4AD3Nx\\r\\n\" +","152","                 \"AH4AEAAAADVxAH4ASXEAfgBKdAAKYWNjZXNzJDAwMHNxAH4ACHNxAH4ADAF0AA5qdW5pdC00LjEx\\r\\n\" +","153","                 \"LmphcnEAfgAPc3EAfgAQAAAA5XQAIG9yZy5qdW5pdC5ydW5uZXJzLlBhcmVudFJ1bm5lciQycQB+\\r\\n\" +","154","                 \"AEpxAH4ARHNxAH4ACHNxAH4ADAF0AA5qdW5pdC00LjExLmphcnEAfgAPc3EAfgAQAAABNXEAfgBJ\\r\\n\" +","155","                 \"cQB+AEpxAH4AN3NxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAAAAAydAA6b3JnLmVjbGlw\\r\\n\" +","156","                 \"c2UuamR0LmludGVybmFsLmp1bml0NC5ydW5uZXIuSlVuaXQ0VGVzdFJlZmVyZW5jZXQAGEpVbml0\\r\\n\" +","157","                 \"NFRlc3RSZWZlcmVuY2UuamF2YXEAfgA3c3EAfgAIc3EAfgAMAXQABC5jcC9xAH4AD3NxAH4AEAAA\\r\\n\" +","158","                 \"ACZ0ADNvcmcuZWNsaXBzZS5qZHQuaW50ZXJuYWwuanVuaXQucnVubmVyLlRlc3RFeGVjdXRpb250\\r\\n\" +","159","                 \"ABJUZXN0RXhlY3V0aW9uLmphdmFxAH4AN3NxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9zcQB+ABAA\\r\\n\" +","160","                 \"AAHTdAA2b3JnLmVjbGlwc2UuamR0LmludGVybmFsLmp1bml0LnJ1bm5lci5SZW1vdGVUZXN0UnVu\\r\\n\" +","161","                 \"bmVydAAVUmVtb3RlVGVzdFJ1bm5lci5qYXZhdAAIcnVuVGVzdHNzcQB+AAhzcQB+AAwBdAAELmNw\\r\\n\" +","162","                 \"L3EAfgAPc3EAfgAQAAACq3EAfgCFcQB+AIZxAH4Ah3NxAH4ACHNxAH4ADAF0AAQuY3AvcQB+AA9z\\r\\n\" +","163","                 \"cQB+ABAAAAGGcQB+AIVxAH4AhnEAfgA3c3EAfgAIc3EAfgAMAXQABC5jcC9xAH4AD3NxAH4AEAAA\\r\\n\" +","164","                 \"AMVxAH4AhXEAfgCGdAAEbWFpbnQAFk9NRyBJJ3ZlIGJlZW4gZGVsZXRlZCFxAH4AlXQARm9yZy5h\\r\\n\" +","165","                 \"cGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuVGhyb3dhYmxlUHJveHlUZXN0JERlbGV0ZWRF\\r\\n\" +","166","                 \"eGNlcHRpb251cgA0W0xvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLlRocm93YWJs\\r\\n\" +","167","                 \"ZVByb3h5O\/rtAeCFous5AgAAeHAAAAAA\";","168","","169","","170","        byte[] binaryDecoded = new BASE64Decoder().decodeBuffer(base64);","171","        final ThrowableProxy proxy2 = deserialize(binaryDecoded);","172","","173","        assertEquals(this.getClass().getName() + \"$DeletedException\", proxy2.getName());","174","        assertEquals(msg, proxy2.getMessage());","175","    }","176","","177","    private byte[] serialize(ThrowableProxy proxy) throws IOException {","178","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","179","        final ObjectOutputStream out = new ObjectOutputStream(arr);","180","        out.writeObject(proxy);","181","        return arr.toByteArray();","182","    }","183","","184","    private ThrowableProxy deserialize(byte[] binary) throws IOException, ClassNotFoundException {","185","        final ByteArrayInputStream inArr = new ByteArrayInputStream(binary);","186","        final ObjectInputStream in = new ObjectInputStream(inArr);","187","        return (ThrowableProxy) in.readObject();"],"delete":["24","import org.junit.Assert;","46","        Assert.assertEquals(expected.proxy.getName(), actual.proxy.getName());","47","        Assert.assertEquals(expected.proxy.getMessage(), actual.proxy.getMessage());","48","        Assert.assertEquals(expected.proxy.getLocalizedMessage(), actual.proxy.getLocalizedMessage());","49","        Assert.assertEquals(expected.proxy.getCommonElementCount(), actual.proxy.getCommonElementCount());","50","        Assert.assertArrayEquals(expected.proxy.getExtendedStackTrace(), actual.proxy.getExtendedStackTrace());        ","51","        Assert.assertEquals(expected.proxy, actual.proxy);","62","        Assert.assertNotNull(\"No package data returned\", callerPackageData);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEventTest.java":[{"add":["20","import java.io.IOException;","28","import org.apache.logging.log4j.message.Message;","35","import sun.misc.BASE64Decoder;","36","","40","","44","","45","        \/*","46","         * (non-Javadoc)","47","         * ","53","        }","55","","60","","65","","68","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", null, Strings.EMPTY, Level.INFO, new SimpleMessage(","69","                \"abc\"), null);","71","        byte[] binary = serialize(evt);","72","        final Log4jLogEvent evt2 = deserialize(binary);","88","","92","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", null, Strings.EMPTY, Level.INFO, new SimpleMessage(","93","                \"abc\"), thrown);","95","        byte[] binary = serialize(evt);","96","        final Log4jLogEvent evt2 = deserialize(binary);","108","        assertNull(evt2.getThrown());","109","        assertNotNull(evt2.getThrownProxy());","115","    private byte[] serialize(Log4jLogEvent event) throws IOException {","116","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","117","        final ObjectOutputStream out = new ObjectOutputStream(arr);","118","        out.writeObject(event);","119","        return arr.toByteArray();","120","    }","121","","122","    private Log4jLogEvent deserialize(byte[] binary) throws IOException, ClassNotFoundException {","123","        final ByteArrayInputStream inArr = new ByteArrayInputStream(binary);","124","        final ObjectInputStream in = new ObjectInputStream(inArr);","125","        final Log4jLogEvent result = (Log4jLogEvent) in.readObject();","126","        return result;","127","    }","128","","129","    \/\/ DO NOT REMOVE THIS COMMENT:","130","    \/\/ UNCOMMENT WHEN GENERATING SERIALIZED EVENT FOR #testJavaIoSerializableWithUnknownThrowable","131","    \/\/ public static class DeletedException extends Exception {","132","    \/\/ private static final long serialVersionUID = 1L;","133","    \/\/ public DeletedException(String msg) {","134","    \/\/ super(msg);","135","    \/\/ }","136","    \/\/ };","137","","138","    @Test","139","    public void testJavaIoSerializableWithUnknownThrowable() throws Exception {","140","        final String loggerName = \"some.test\";","141","        final Marker marker = null;","142","        final String loggerFQN = Strings.EMPTY;","143","        final Level level = Level.INFO;","144","        final Message msg = new SimpleMessage(\"abc\");","145","        final String threadName = Thread.currentThread().getName();","146","        final String errorMessage = \"OMG I've been deleted!\";","147","        ","148","        \/\/ DO NOT DELETE THIS COMMENT:","149","        \/\/ UNCOMMENT TO RE-GENERATE SERIALIZED EVENT WHEN UPDATING THIS TEST.","150","        \/\/ final Exception thrown = new DeletedException(errorMessage);","151","        \/\/ final Log4jLogEvent evt = new Log4jLogEvent(loggerName, marker, loggerFQN, level, msg, thrown);","152","        \/\/ final byte[] binary = serialize(evt);","153","        \/\/","154","        \/\/ String base64 = new BASE64Encoder().encode(binary);","155","        \/\/ System.out.println(\"final String base64 = \\\"\" + base64.replaceAll(\"\\r\\n\", \"\\\\\\\\r\\\\\\\\n\\\" +\\r\\n\\\"\") + \"\\\";\");","156","","157","        final String base64 = \"rO0ABXNyAD5vcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkxvZzRqTG9nRXZlbnQk\\r\\n\"","158","                + \"TG9nRXZlbnRQcm94eZztD11w2ioWAgAOWgAMaXNFbmRPZkJhdGNoWgASaXNMb2NhdGlvblJlcXVp\\r\\n\"","159","                + \"cmVkSgAKdGltZU1pbGxpc0wACmNvbnRleHRNYXB0AA9MamF2YS91dGlsL01hcDtMAAxjb250ZXh0\\r\\n\"","160","                + \"U3RhY2t0ADVMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL1RocmVhZENvbnRleHQkQ29udGV4dFN0\\r\\n\"","161","                + \"YWNrO0wABWxldmVsdAAgTG9yZy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9MZXZlbDtMAApsb2dnZXJG\\r\\n\"","162","                + \"UUNOdAASTGphdmEvbGFuZy9TdHJpbmc7TAAKbG9nZ2VyTmFtZXEAfgAETAAGbWFya2VydAAhTG9y\\r\\n\"","163","                + \"Zy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9NYXJrZXI7TAAHbWVzc2FnZXQAKkxvcmcvYXBhY2hlL2xv\\r\\n\"","164","                + \"Z2dpbmcvbG9nNGovbWVzc2FnZS9NZXNzYWdlO0wABnNvdXJjZXQAHUxqYXZhL2xhbmcvU3RhY2tU\\r\\n\"","165","                + \"cmFjZUVsZW1lbnQ7TAAKdGhyZWFkTmFtZXEAfgAETAAGdGhyb3dudAAVTGphdmEvbGFuZy9UaHJv\\r\\n\"","166","                + \"d2FibGU7TAALdGhyb3duUHJveHl0ADNMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL2NvcmUvaW1w\\r\\n\"","167","                + \"bC9UaHJvd2FibGVQcm94eTt4cAAAAAAAAEmWAtJzcgAeamF2YS51dGlsLkNvbGxlY3Rpb25zJEVt\\r\\n\"","168","                + \"cHR5TWFwWTYUhVrc59ACAAB4cHNyAD5vcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouVGhyZWFkQ29u\\r\\n\"","169","                + \"dGV4dCRFbXB0eVRocmVhZENvbnRleHRTdGFjawAAAAAAAAABAgAAeHBzcgAeb3JnLmFwYWNoZS5s\\r\\n\"","170","                + \"b2dnaW5nLmxvZzRqLkxldmVsAAAAAAAYIBoCAANJAAhpbnRMZXZlbEwABG5hbWVxAH4ABEwADXN0\\r\\n\"","171","                + \"YW5kYXJkTGV2ZWx0ACxMb3JnL2FwYWNoZS9sb2dnaW5nL2xvZzRqL3NwaS9TdGFuZGFyZExldmVs\\r\\n\"","172","                + \"O3hwAAABkHQABElORk9+cgAqb3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLnNwaS5TdGFuZGFyZExl\\r\\n\"","173","                + \"dmVsAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAESU5GT3QAAHQA\\r\\n\"","174","                + \"CXNvbWUudGVzdHBzcgAub3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLm1lc3NhZ2UuU2ltcGxlTWVz\\r\\n\"","175","                + \"c2FnZYt0TTBgt6KoAgABTAAHbWVzc2FnZXEAfgAEeHB0AANhYmNwdAAEbWFpbnNyAEVvcmcuYXBh\\r\\n\"","176","                + \"Y2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkxvZzRqTG9nRXZlbnRUZXN0JERlbGV0ZWRFeGNl\\r\\n\"","177","                + \"cHRpb24AAAAAAAAAAQIAAHhyABNqYXZhLmxhbmcuRXhjZXB0aW9u0P0fPho7HMQCAAB4cgATamF2\\r\\n\"","178","                + \"YS5sYW5nLlRocm93YWJsZdXGNSc5d7jLAwADTAAFY2F1c2VxAH4ACEwADWRldGFpbE1lc3NhZ2Vx\\r\\n\"","179","                + \"AH4ABFsACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDt4cHEAfgAh\\r\\n\"","180","                + \"dAAWT01HIEkndmUgYmVlbiBkZWxldGVkIXVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVu\\r\\n\"","181","                + \"dDsCRio8PP0iOQIAAHhwAAAAGnNyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbd\\r\\n\"","182","                + \"hQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAETAAIZmlsZU5hbWVxAH4ABEwA\\r\\n\"","183","                + \"Cm1ldGhvZE5hbWVxAH4ABHhwAAAAl3QANG9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmlt\\r\\n\"","184","                + \"cGwuTG9nNGpMb2dFdmVudFRlc3R0ABZMb2c0akxvZ0V2ZW50VGVzdC5qYXZhdAAqdGVzdEphdmFJ\\r\\n\"","185","                + \"b1NlcmlhbGl6YWJsZVdpdGhVbmtub3duVGhyb3dhYmxlc3EAfgAl\/\/\/\/\/nQAJHN1bi5yZWZsZWN0\\r\\n\"","186","                + \"Lk5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbHQAHU5hdGl2ZU1ldGhvZEFjY2Vzc29ySW1wbC5qYXZh\\r\\n\"","187","                + \"dAAHaW52b2tlMHNxAH4AJQAAACdxAH4AK3EAfgAsdAAGaW52b2tlc3EAfgAlAAAAGXQAKHN1bi5y\\r\\n\"","188","                + \"ZWZsZWN0LkRlbGVnYXRpbmdNZXRob2RBY2Nlc3NvckltcGx0ACFEZWxlZ2F0aW5nTWV0aG9kQWNj\\r\\n\"","189","                + \"ZXNzb3JJbXBsLmphdmFxAH4AL3NxAH4AJQAAAlV0ABhqYXZhLmxhbmcucmVmbGVjdC5NZXRob2R0\\r\\n\"","190","                + \"AAtNZXRob2QuamF2YXEAfgAvc3EAfgAlAAAAL3QAKW9yZy5qdW5pdC5ydW5uZXJzLm1vZGVsLkZy\\r\\n\"","191","                + \"YW1ld29ya01ldGhvZCQxdAAURnJhbWV3b3JrTWV0aG9kLmphdmF0ABFydW5SZWZsZWN0aXZlQ2Fs\\r\\n\"","192","                + \"bHNxAH4AJQAAAAx0ADNvcmcuanVuaXQuaW50ZXJuYWwucnVubmVycy5tb2RlbC5SZWZsZWN0aXZl\\r\\n\"","193","                + \"Q2FsbGFibGV0ABdSZWZsZWN0aXZlQ2FsbGFibGUuamF2YXQAA3J1bnNxAH4AJQAAACx0ACdvcmcu\\r\\n\"","194","                + \"anVuaXQucnVubmVycy5tb2RlbC5GcmFtZXdvcmtNZXRob2RxAH4AOHQAEWludm9rZUV4cGxvc2l2\\r\\n\"","195","                + \"ZWx5c3EAfgAlAAAAEXQAMm9yZy5qdW5pdC5pbnRlcm5hbC5ydW5uZXJzLnN0YXRlbWVudHMuSW52\\r\\n\"","196","                + \"b2tlTWV0aG9kdAARSW52b2tlTWV0aG9kLmphdmF0AAhldmFsdWF0ZXNxAH4AJQAAAQ90AB5vcmcu\\r\\n\"","197","                + \"anVuaXQucnVubmVycy5QYXJlbnRSdW5uZXJ0ABFQYXJlbnRSdW5uZXIuamF2YXQAB3J1bkxlYWZz\\r\\n\"","198","                + \"cQB+ACUAAABGdAAob3JnLmp1bml0LnJ1bm5lcnMuQmxvY2tKVW5pdDRDbGFzc1J1bm5lcnQAG0Js\\r\\n\"","199","                + \"b2NrSlVuaXQ0Q2xhc3NSdW5uZXIuamF2YXQACHJ1bkNoaWxkc3EAfgAlAAAAMnEAfgBKcQB+AEtx\\r\\n\"","200","                + \"AH4ATHNxAH4AJQAAAO50ACBvcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5uZXIkM3EAfgBHcQB+\\r\\n\"","201","                + \"AD1zcQB+ACUAAAA\/dAAgb3JnLmp1bml0LnJ1bm5lcnMuUGFyZW50UnVubmVyJDFxAH4AR3QACHNj\\r\\n\"","202","                + \"aGVkdWxlc3EAfgAlAAAA7HEAfgBGcQB+AEd0AAtydW5DaGlsZHJlbnNxAH4AJQAAADVxAH4ARnEA\\r\\n\"","203","                + \"fgBHdAAKYWNjZXNzJDAwMHNxAH4AJQAAAOV0ACBvcmcuanVuaXQucnVubmVycy5QYXJlbnRSdW5u\\r\\n\"","204","                + \"ZXIkMnEAfgBHcQB+AERzcQB+ACUAAAAadAAwb3JnLmp1bml0LmludGVybmFsLnJ1bm5lcnMuc3Rh\\r\\n\"","205","                + \"dGVtZW50cy5SdW5CZWZvcmVzdAAPUnVuQmVmb3Jlcy5qYXZhcQB+AERzcQB+ACUAAAAbdAAvb3Jn\\r\\n\"","206","                + \"Lmp1bml0LmludGVybmFsLnJ1bm5lcnMuc3RhdGVtZW50cy5SdW5BZnRlcnN0AA5SdW5BZnRlcnMu\\r\\n\"","207","                + \"amF2YXEAfgBEc3EAfgAlAAABNXEAfgBGcQB+AEdxAH4APXNxAH4AJQAAADJ0ADpvcmcuZWNsaXBz\\r\\n\"","208","                + \"ZS5qZHQuaW50ZXJuYWwuanVuaXQ0LnJ1bm5lci5KVW5pdDRUZXN0UmVmZXJlbmNldAAYSlVuaXQ0\\r\\n\"","209","                + \"VGVzdFJlZmVyZW5jZS5qYXZhcQB+AD1zcQB+ACUAAAAmdAAzb3JnLmVjbGlwc2UuamR0LmludGVy\\r\\n\"","210","                + \"bmFsLmp1bml0LnJ1bm5lci5UZXN0RXhlY3V0aW9udAASVGVzdEV4ZWN1dGlvbi5qYXZhcQB+AD1z\\r\\n\"","211","                + \"cQB+ACUAAAHTdAA2b3JnLmVjbGlwc2UuamR0LmludGVybmFsLmp1bml0LnJ1bm5lci5SZW1vdGVU\\r\\n\"","212","                + \"ZXN0UnVubmVydAAVUmVtb3RlVGVzdFJ1bm5lci5qYXZhdAAIcnVuVGVzdHNzcQB+ACUAAAKrcQB+\\r\\n\"","213","                + \"AGdxAH4AaHEAfgBpc3EAfgAlAAABhnEAfgBncQB+AGhxAH4APXNxAH4AJQAAAMVxAH4AZ3EAfgBo\\r\\n\"","214","                + \"dAAEbWFpbnhzcgAxb3JnLmFwYWNoZS5sb2dnaW5nLmxvZzRqLmNvcmUuaW1wbC5UaHJvd2FibGVQ\\r\\n\"","215","                + \"cm94ednMMNWae6z6AgAHSQASY29tbW9uRWxlbWVudENvdW50TAAKY2F1c2VQcm94eXEAfgAJWwAS\\r\\n\"","216","                + \"ZXh0ZW5kZWRTdGFja1RyYWNldAA\/W0xvcmcvYXBhY2hlL2xvZ2dpbmcvbG9nNGovY29yZS9pbXBs\\r\\n\"","217","                + \"L0V4dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnQ7TAAQbG9jYWxpemVkTWVzc2FnZXEAfgAETAAHbWVz\\r\\n\"","218","                + \"c2FnZXEAfgAETAAEbmFtZXEAfgAEWwARc3VwcHJlc3NlZFByb3hpZXN0ADRbTG9yZy9hcGFjaGUv\\r\\n\"","219","                + \"bG9nZ2luZy9sb2c0ai9jb3JlL2ltcGwvVGhyb3dhYmxlUHJveHk7eHAAAAAAcHVyAD9bTG9yZy5h\\r\\n\"","220","                + \"cGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuRXh0ZW5kZWRTdGFja1RyYWNlRWxlbWVudDvK\\r\\n\"","221","                + \"z4gjpcfPvAIAAHhwAAAAGnNyADxvcmcuYXBhY2hlLmxvZ2dpbmcubG9nNGouY29yZS5pbXBsLkV4\\r\\n\"","222","                + \"dGVuZGVkU3RhY2tUcmFjZUVsZW1lbnTh3s+6xraQBwIAAkwADmV4dHJhQ2xhc3NJbmZvdAA2TG9y\\r\\n\"","223","                + \"Zy9hcGFjaGUvbG9nZ2luZy9sb2c0ai9jb3JlL2ltcGwvRXh0ZW5kZWRDbGFzc0luZm87TAARc3Rh\\r\\n\"","224","                + \"Y2tUcmFjZUVsZW1lbnRxAH4AB3hwc3IANG9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmlt\\r\\n\"","225","                + \"cGwuRXh0ZW5kZWRDbGFzc0luZm8AAAAAAAAAAQIAA1oABWV4YWN0TAAIbG9jYXRpb25xAH4ABEwA\\r\\n\"","226","                + \"B3ZlcnNpb25xAH4ABHhwAXQADXRlc3QtY2xhc3Nlcy90AAE\/cQB+ACZzcQB+AHRzcQB+AHcAcQB+\\r\\n\"","227","                + \"AHp0AAgxLjYuMF80NXEAfgAqc3EAfgB0c3EAfgB3AHEAfgB6cQB+AH1xAH4ALnNxAH4AdHNxAH4A\\r\\n\"","228","                + \"dwBxAH4AenEAfgB9cQB+ADBzcQB+AHRzcQB+AHcAcQB+AHpxAH4AfXEAfgAzc3EAfgB0c3EAfgB3\\r\\n\"","229","                + \"AXQADmp1bml0LTQuMTEuamFycQB+AHpxAH4ANnNxAH4AdHNxAH4AdwF0AA5qdW5pdC00LjExLmph\\r\\n\"","230","                + \"cnEAfgB6cQB+ADpzcQB+AHRzcQB+AHcBdAAOanVuaXQtNC4xMS5qYXJxAH4AenEAfgA+c3EAfgB0\\r\\n\"","231","                + \"c3EAfgB3AXQADmp1bml0LTQuMTEuamFycQB+AHpxAH4AQXNxAH4AdHNxAH4AdwF0AA5qdW5pdC00\\r\\n\"","232","                + \"LjExLmphcnEAfgB6cQB+AEVzcQB+AHRzcQB+AHcBdAAOanVuaXQtNC4xMS5qYXJxAH4AenEAfgBJ\\r\\n\"","233","                + \"c3EAfgB0c3EAfgB3AXQADmp1bml0LTQuMTEuamFycQB+AHpxAH4ATXNxAH4AdHNxAH4AdwF0AA5q\\r\\n\"","234","                + \"dW5pdC00LjExLmphcnEAfgB6cQB+AE5zcQB+AHRzcQB+AHcBdAAOanVuaXQtNC4xMS5qYXJxAH4A\\r\\n\"","235","                + \"enEAfgBQc3EAfgB0c3EAfgB3AXQADmp1bml0LTQuMTEuamFycQB+AHpxAH4AU3NxAH4AdHNxAH4A\\r\\n\"","236","                + \"dwF0AA5qdW5pdC00LjExLmphcnEAfgB6cQB+AFVzcQB+AHRzcQB+AHcBdAAOanVuaXQtNC4xMS5q\\r\\n\"","237","                + \"YXJxAH4AenEAfgBXc3EAfgB0c3EAfgB3AXQADmp1bml0LTQuMTEuamFycQB+AHpxAH4AWXNxAH4A\\r\\n\"","238","                + \"dHNxAH4AdwF0AA5qdW5pdC00LjExLmphcnEAfgB6cQB+AFxzcQB+AHRzcQB+AHcBdAAOanVuaXQt\\r\\n\"","239","                + \"NC4xMS5qYXJxAH4AenEAfgBfc3EAfgB0c3EAfgB3AXQABC5jcC9xAH4AenEAfgBgc3EAfgB0c3EA\\r\\n\"","240","                + \"fgB3AXQABC5jcC9xAH4AenEAfgBjc3EAfgB0c3EAfgB3AXQABC5jcC9xAH4AenEAfgBmc3EAfgB0\\r\\n\"","241","                + \"c3EAfgB3AXQABC5jcC9xAH4AenEAfgBqc3EAfgB0c3EAfgB3AXQABC5jcC9xAH4AenEAfgBrc3EA\\r\\n\"","242","                + \"fgB0c3EAfgB3AXQABC5jcC9xAH4AenEAfgBscQB+ACJxAH4AInQARW9yZy5hcGFjaGUubG9nZ2lu\\r\\n\"","243","                + \"Zy5sb2c0ai5jb3JlLmltcGwuTG9nNGpMb2dFdmVudFRlc3QkRGVsZXRlZEV4Y2VwdGlvbnVyADRb\\r\\n\"","244","                + \"TG9yZy5hcGFjaGUubG9nZ2luZy5sb2c0ai5jb3JlLmltcGwuVGhyb3dhYmxlUHJveHk7+u0B4IWi\\r\\n\"","245","                + \"6zkCAAB4cAAAAAA=\";","246","","247","        byte[] binaryDecoded = new BASE64Decoder().decodeBuffer(base64);","248","        final Log4jLogEvent evt2 = deserialize(binaryDecoded);","249","","250","        assertEquals(loggerFQN, evt2.getLoggerFqcn());","251","        assertEquals(level, evt2.getLevel());","252","        assertEquals(loggerName, evt2.getLoggerName());","253","        assertEquals(marker, evt2.getMarker());","254","        assertEquals(msg, evt2.getMessage());","255","        assertEquals(threadName, evt2.getThreadName());","256","        assertEquals(null, evt2.getThrown());","257","        assertEquals(this.getClass().getName() + \"$DeletedException\", evt2.getThrownProxy().getName());","258","        assertEquals(errorMessage, evt2.getThrownProxy().getMessage());","259","    }","260","","266","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", marker, Strings.EMPTY, NULL_LEVEL, new SimpleMessage(","267","                \"abc\"), t);","276","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", marker, Strings.EMPTY, NULL_LEVEL, new SimpleMessage(","277","                \"abc\"), t);","279",""],"delete":["36","    ","40","        \/* (non-Javadoc)","46","        }        ","52","    ","57","    ","60","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", null, Strings.EMPTY,","61","                Level.INFO, new SimpleMessage(\"abc\"), null);","63","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","64","        final ObjectOutputStream out = new ObjectOutputStream(arr);","65","        out.writeObject(evt);","66","","67","        final ByteArrayInputStream inArr = new ByteArrayInputStream(arr.toByteArray());","68","        final ObjectInputStream in = new ObjectInputStream(inArr);","69","        final Log4jLogEvent evt2 = (Log4jLogEvent) in.readObject();","85","    ","89","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", null, Strings.EMPTY,","90","                Level.INFO, new SimpleMessage(\"abc\"), thrown);","92","        final ByteArrayOutputStream arr = new ByteArrayOutputStream();","93","        final ObjectOutputStream out = new ObjectOutputStream(arr);","94","        out.writeObject(evt);","95","","96","        final ByteArrayInputStream inArr = new ByteArrayInputStream(arr.toByteArray());","97","        final ObjectInputStream in = new ObjectInputStream(inArr);","98","        final Log4jLogEvent evt2 = (Log4jLogEvent) in.readObject();","110","        assertEquals(evt.getThrown().getClass(), evt2.getThrown().getClass());","111","        assertEquals(evt.getThrown().getMessage(), evt2.getThrown().getMessage());","122","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", marker, Strings.EMPTY,","123","                NULL_LEVEL, new SimpleMessage(\"abc\"), t);","132","        final Log4jLogEvent evt = new Log4jLogEvent(\"some.test\", marker, Strings.EMPTY,","133","                NULL_LEVEL, new SimpleMessage(\"abc\"), t);","135","        "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jLogEvent.java":[{"add":["502","        private final transient Throwable thrown;"],"delete":["502","        private final Throwable thrown;"]}]}},"02944252c5d2833f44bc03197743853eb56d35f3":{"changes":{"log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SetUtils.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-web\/src\/test\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImplTest.java":"MODIFY","src\/site\/xdoc\/manual\/webapp.xml":"MODIFY"},"diff":{"log4j-web\/src\/main\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImpl.java":[{"add":["18","import java.net.MalformedURLException;","20","import java.net.URL;","22","import java.util.Set;","40","import org.apache.logging.log4j.core.util.SetUtils;","98","        URI configLocation = getConfigURI(location);;","140","        URI uri = getConfigURI(location);","141","        this.loggerContext = Configurator.initialize(this.name, this.getClassLoader(), uri, this.servletContext);","142","    }","143","","144","    private URI getConfigURI(final String location) {","145","        try {","146","            String configLocation = location;","147","            if (configLocation == null) {","148","                String[] paths = SetUtils.prefixSet(servletContext.getResourcePaths(\"\/WEB-INF\/\"), \"\/WEB-INF\/log4j2\");","149","                if (paths.length == 1) {","150","                    configLocation = paths[0];","151","                } else if (paths.length > 1) {","152","                    final String prefix = \"\/WEB-INF\/log4j2-\" + this.name + \".\";","153","                    boolean found = false;","154","                    for (String str : paths) {","155","                        if (str.startsWith(prefix)) {","156","                            configLocation = str;","157","                            break;","158","                        }","159","                    }","160","                    if (!found) {","161","                        configLocation = paths[0];","162","                    }","163","                }","164","            }","165","            if (configLocation != null) {","166","                URL url = servletContext.getResource(configLocation);","167","                if (url != null) {","168","                    return url.toURI();","169","                }","170","            }","171","        } catch (Exception ex) {","172","            \/\/ Just try passing the location.","173","        }","174","        if (location != null) {","175","            try {","176","                return FileUtils.getCorrectedFilePathUri(location);","177","            } catch (final Exception e) {","178","                this.servletContext.log(\"Unable to convert configuration location [\" + location + \"] to a URI!\", e);","179","            }","180","        }","181","        return null;"],"delete":["94","        URI configLocation = null;","95","        if (location != null) {","96","            try {","97","                configLocation = FileUtils.getCorrectedFilePathUri(location);","98","            } catch (final Exception e) {","99","                this.servletContext.log(\"Unable to convert configuration location [\" + location + \"] to a URI!\", e);","100","            }","101","        }","143","        this.loggerContext = Configurator.initialize(this.name, this.getClassLoader(), location, this.servletContext);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SetUtils.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-554\" dev=\"rgoers\" type=\"update\">","25","        Allow configuration files to be located as Servlet Context resources.","26","      <\/action>"],"delete":[]}],"log4j-web\/src\/test\/java\/org\/apache\/logging\/log4j\/web\/Log4jWebInitializerImplTest.java":[{"add":["107","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","171","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","236","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","281","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","325","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","361","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","382","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);","436","        expect(this.servletContext.getResourcePaths(\"\/WEB-INF\/\")).andReturn(null);"],"delete":["356",""]}],"src\/site\/xdoc\/manual\/webapp.xml":[{"add":["42","        To avoid problems the Log4j shutdown hook will automatically be disabled when the log4j-web jar is included.","43","      <a name=\"Configuration\"\/>","44","      <subsection name=\"Configuration\">","45","        <p>Log4j allows the configuration file to be specified in web.xml using the log4jConfiguration context parameter.","46","          Log4j will search for configuration files by:","47","            <ol>","48","                <li>If a location is provided it will be searched for as a servlet context resource. For example,","49","                    if log4jConfiguration contains \"logging.xml\" then Log4j will look for a file with that name in the","50","                    root directory of the web application.","51","                <\/li>","52","                <li>If no location is defined Log4j will search for a file that starts with \"log4j2\" in the WEB-INF directory.","53","                    If more than one file is found then if a file that starts with \"log4j2-<i>name<\/i>\", where <i>name<\/i> is the","54","                    name of the web application, is present it will be used. Otherwise the first file will be used.","55","                <\/li>","56","                <li>The \"normal\" search sequence using the classpath and file URLs will be used to locate the configuration","57","                    file.","58","                <\/li>","59","            <\/ol>","60","        <\/p>","61","      <\/subsection>"],"delete":["42","        It is important to note that you should add <code>shutdownHook=&quot;disable&quot;<\/code> to your root","43","        configuration element to avoid memory leaks. For example:","44","      <\/p>","45","      <pre class=\"prettyprint\"><![CDATA[","46","<Configuration shutdownHook=\"disable\">","47","    <!-- ... -->","48","<\/Configuration>","49","      ]]><\/pre>"]}]}},"1f69d773ad8d0fb005355c1d0c6a4b34bec2fbaf":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FastFileManager.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/FastRollingFileManager.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/OutputStreamManager.java":[{"add":["131","    protected synchronized void close() {","146","    public synchronized void flush() {"],"delete":["131","    protected void close() {","146","    public void flush() {"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-311\" dev=\"rpopma\" type=\"fix\">","24","        Synchronized flush() and close() methods in the XxxFileManager and OutputStreamManager classes.","25","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/FastFileManager.java":[{"add":["106","    public synchronized void flush() {","118","    public synchronized void close() {"],"delete":["106","    public void flush() {","118","    public void close() {"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/FastRollingFileManager.java":[{"add":["101","    public synchronized void flush() {","113","    public synchronized void close() {"],"delete":["101","    public void flush() {","113","    public void close() {"]}]}},"73db0bb1a99caa6d0b5872ad909b38d6ee40fcb4":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":[{"add":["48"," * &nbsp;&lt;Filters&gt;<br>","49"," * &nbsp;&nbsp;&lt;BurstFilter level=\"INFO\" rate=\"16\" maxBurst=\"100\"\/&gt;<br>","50"," * &nbsp;&lt;\/Filters&gt;<br>"],"delete":["48"," * &nbsp;&lt;filters&gt;<br>","49"," * &nbsp;&nbsp;&lt;Burst level=\"INFO\" rate=\"16\" maxBurst=\"100\"\/&gt;<br>","50"," * &nbsp;&lt;\/filters&gt;<br>"]}]}},"a4aab92d9fc64eccfbcff8c69e4759976d57078d":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["226","                this.formatEntry(extStackTrace[i], sb);","240","                    this.formatEntry(extStackTrace[i], sb);","258","    private void formatEntry(final ExtendedStackTraceElement extStackTraceElement, final StringBuilder sb) {"],"delete":["226","                this.formatEntry(causedTrace[i], extStackTrace[i], sb);","240","                    this.formatEntry(causedTrace[i], extStackTrace[i], sb);","258","    private void formatEntry(final StackTraceElement element, final ExtendedStackTraceElement extStackTraceElement,","259","            final StringBuilder sb) {"]}]}},"9156dd4fb3a428f2f0f31ffd663fa51f97c49063":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/AbstractSocketServer.java":"MODIFY","log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/BasicConfigurationFactory.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/DefaultConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/json\/JsonConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/NullConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdmin.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/Log4jInitPerformance.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfigurationFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfigurationFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/json\/JsonConfiguration.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/BasicConfigurationFactory.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/server\/AbstractSocketServer.java":[{"add":["31","import org.apache.logging.log4j.core.config.ConfigurationSource;","71","                        source = new ConfigurationSource(url.openStream(), url);"],"delete":["70","                        source = new ConfigurationSource(url.openStream(), path);"]}],"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/BasicConfigurationFactory.java":[{"add":["24","import org.apache.logging.log4j.core.config.ConfigurationSource;","34","        return new String[] { \"*\" };","52","            super(ConfigurationSource.NULL_SOURCE);","53","","57","            final Level level = (levelName != null && Level.getLevel(levelName) != null) ? Level.getLevel(levelName)","58","                    : Level.DEBUG;"],"delete":["33","        return new String[] {\"*\"};","54","            final Level level = (levelName != null && Level.getLevel(levelName) != null) ? Level.getLevel(levelName) : Level.DEBUG;"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/TestConfigurator.java":[{"add":["97","        final File file = new File(\"target\/test-classes\/log4j2-config.xml\");","98","        final InputStream is = new FileInputStream(file);","99","        final ConfigurationSource source = new ConfigurationSource(is, file);","117","        final ConfigurationSource source =","118","            new ConfigurationSource(is);"],"delete":["97","        final InputStream is = new FileInputStream(\"target\/test-classes\/log4j2-config.xml\");","98","        final ConfigurationFactory.ConfigurationSource source =","99","            new ConfigurationFactory.ConfigurationSource(is, \"target\/test-classes\/log4j2-config.xml\");","117","        final ConfigurationFactory.ConfigurationSource source =","118","            new ConfigurationFactory.ConfigurationSource(is);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["37","import org.apache.logging.log4j.core.config.ConfigurationSource;","389","    \/**","390","     * Returns the initial configuration location or {@code null}. The returned value may not be the location of the","391","     * current configuration. Use ","392","     * {@link #getConfiguration()}.{@link Configuration#getConfigurationSource() getConfigurationSource()}.{@link ","393","     * ConfigurationSource#getLocation() getLocation()} to get the actual source of the current configuration.","394","     * @return the initial configuration location or {@code null}","395","     *\/","400","    \/**","401","     * Sets the configLocation to the specified value and reconfigures this context.","402","     * @param configLocation the location of the new configuration","403","     *\/"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/DefaultConfiguration.java":[{"add":["52","        super(ConfigurationSource.NULL_SOURCE);","53","        "],"delete":["52",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["38","import org.apache.logging.log4j.core.config.ConfigurationSource;","64","    private static final String[] VERBOSE_CLASSES = new String[] { ResolverUtil.class.getName() };","120","    public XmlConfiguration(final ConfigurationSource configSource) {","121","        super(configSource);","122","        final File configFile = configSource.getFile();","136","            final StatusConfiguration statusConfig = new StatusConfiguration().withVerboseClasses(VERBOSE_CLASSES)","229","        try {","230","            final ConfigurationSource source = getConfigurationSource().resetInputStream();","231","            if (source == null) {","232","                return null;","234","            final XmlConfiguration config = new XmlConfiguration(source);","235","            return (config.rootElement == null) ? null : config;","236","        } catch (final IOException ex) {","237","            LOGGER.error(\"Cannot locate file \" + getConfigurationSource(), ex);","314","        return getClass().getSimpleName() + \"[location=\" + getConfigurationSource() + \"]\";"],"delete":["20","import java.io.FileInputStream;","21","import java.io.FileNotFoundException;","40","import org.apache.logging.log4j.core.config.ConfigurationFactory;","65","","67","","68","    private static final String[] VERBOSE_CLASSES = new String[] {ResolverUtil.class.getName()};","69","","73","","75","","77","","80","    private final File configFile;","81","","130","    public XmlConfiguration(final ConfigurationFactory.ConfigurationSource configSource) {","131","        this.configFile = configSource.getFile();","145","            final StatusConfiguration statusConfig = new StatusConfiguration()","146","                    .withVerboseClasses(VERBOSE_CLASSES)","239","        if (configFile != null) {","240","            try {","241","                final ConfigurationFactory.ConfigurationSource source =","242","                    new ConfigurationFactory.ConfigurationSource(new FileInputStream(configFile), configFile);","243","                final XmlConfiguration config = new XmlConfiguration(source);","244","                return (config.rootElement == null) ? null : config;","245","            } catch (final FileNotFoundException ex) {","246","                LOGGER.error(\"Cannot locate file \" + configFile, ex);","324","        final String path = configFile != null ? configFile.getAbsolutePath() : \"unknown\";","325","        return getClass().getSimpleName() + \"[location=\" + path + \"]\";"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/json\/JsonConfigurationFactory.java":[{"add":["20","import org.apache.logging.log4j.core.config.ConfigurationSource;"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/NullConfiguration.java":[{"add":["28","        super(ConfigurationSource.NULL_SOURCE);"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfiguration.java":[{"add":["18","import org.apache.logging.log4j.core.config.ConfigurationSource;","27","    public YamlConfiguration(ConfigurationSource configSource) {"],"delete":["18","import org.apache.logging.log4j.core.config.ConfigurationFactory;","27","    public YamlConfiguration(ConfigurationFactory.ConfigurationSource configSource) {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["264","            return new ConfigurationSource(configLocation.toURL().openStream(), configLocation.toURL());","328","        return new ConfigurationSource(is, url);"],"delete":["264","            return new ConfigurationSource(configLocation.toURL().openStream(), configLocation.getPath());","328","        return new ConfigurationSource(is, resource);","491","","492","    \/**","493","     * Represents the source for the logging configuration.","494","     *\/","495","    public static class ConfigurationSource {","496","","497","        private File file;","498","","499","        private String location;","500","","501","        private InputStream stream;","502","","503","        public ConfigurationSource() {","504","        }","505","","506","        public ConfigurationSource(final InputStream stream) {","507","            this.stream = stream;","508","            this.file = null;","509","            this.location = null;","510","        }","511","","512","        public ConfigurationSource(final InputStream stream, final File file) {","513","            this.stream = stream;","514","            this.file = file;","515","            this.location = file.getAbsolutePath();","516","        }","517","","518","        public ConfigurationSource(final InputStream stream, final String location) {","519","            this.stream = stream;","520","            this.location = location;","521","            this.file = null;","522","        }","523","","524","        public File getFile() {","525","            return file;","526","        }","527","","528","        public void setFile(final File file) {","529","            this.file = file;","530","        }","531","","532","        public String getLocation() {","533","            return location;","534","        }","535","","536","        public void setLocation(final String location) {","537","            this.location = location;","538","        }","539","","540","        public InputStream getInputStream() {","541","            return stream;","542","        }","543","","544","        public void setInputStream(final InputStream stream) {","545","            this.stream = stream;","546","        }","547","        ","548","        @Override","549","        public String toString() {","550","            if (file != null) {","551","                return file.getAbsolutePath();","552","            }","553","            if (location != null) {","554","                return location;","555","            }","556","            return \"stream (unknown location)\";","557","        }","558","    }"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configurator.java":[{"add":["125","                                           final ConfigurationSource source) {","138","                                           final ConfigurationSource source,"],"delete":["125","                                           final ConfigurationFactory.ConfigurationSource source) {","138","                                           final ConfigurationFactory.ConfigurationSource source,"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/Log4jContextFactory.java":[{"add":["24","import org.apache.logging.log4j.core.config.ConfigurationSource;","90","                                    final boolean currentContext, final ConfigurationSource source) {"],"delete":["89","                                    final boolean currentContext, final ConfigurationFactory.ConfigurationSource source) {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdmin.java":[{"add":["22","import java.io.FileInputStream;","30","import java.net.URL;","44","import org.apache.logging.log4j.core.config.ConfigurationSource;","54","public class LoggerContextAdmin extends NotificationBroadcasterSupport implements LoggerContextAdminMBean,","55","        PropertyChangeListener {","66","     * Constructs a new {@code LoggerContextAdmin} with the {@code Executor} to be used for sending {@code Notification}","67","     * s asynchronously to listeners.","86","        final String[] notifTypes = new String[] { NOTIF_TYPE_RECONFIGURED };","118","    public void setConfigLocationUri(final String configLocation) throws URISyntaxException, IOException {","119","        if (configLocation == null || configLocation.isEmpty()) {","120","            throw new IllegalArgumentException(\"Missing configuration location\");","121","        }","123","        LOGGER.debug(\"Remote request to reconfigure using location \" + configLocation);","124","        final File configFile = new File(configLocation);","125","        ConfigurationSource configSource = null;","126","        if (configFile.exists()) {","127","            LOGGER.debug(\"Opening config file {}\", configFile.getAbsolutePath());","128","            configSource = new ConfigurationSource(new FileInputStream(configFile), configFile);","129","        } else {","130","            final URL configURL = new URL(configLocation);","131","            LOGGER.debug(\"Opening config URL {}\", configURL);","132","            configSource = new ConfigurationSource(configURL.openStream(), configURL);","133","        }","134","        final Configuration config = ConfigurationFactory.getInstance().getConfiguration(configSource);","135","        loggerContext.start(config);","144","        final Notification notif = new Notification(NOTIF_TYPE_RECONFIGURED, getObjectName(), nextSeqNo(), now(), null);","156","            final ConfigurationSource source = loggerContext.getConfiguration().getConfigurationSource();","157","            final ConfigurationSource copy = source.resetInputStream();","159","            return readContents(copy.getInputStream(), charset);","168","     * Returns the contents of the specified input stream as a String.","169","     * @param in stream to read from","171","     * @return stream contents","172","     * @throws IOException if a problem occurred reading from the stream.","174","    private String readContents(final InputStream in, final Charset charset) throws IOException {","192","    public void setConfigText(final String configText, final String charsetName) {","193","        LOGGER.debug(\"---------\");","194","        LOGGER.debug(\"Remote request to reconfigure from config text.\");","195","","196","        try {","197","            final InputStream in = new ByteArrayInputStream(configText.getBytes(charsetName));","198","            final ConfigurationSource source = new ConfigurationSource(in);","199","            final Configuration updated = ConfigurationFactory.getInstance().getConfiguration(source);","200","            loggerContext.start(updated);","201","            LOGGER.debug(\"Completed remote request to reconfigure from config text.\");","202","        } catch (final Exception ex) {","203","            final String msg = \"Could not reconfigure from config text\";","204","            LOGGER.error(msg, ex);","205","            throw new IllegalArgumentException(msg, ex);","206","        }","207","    }","208","","209","    @Override"],"delete":["28","import java.net.URI;","43","import org.apache.logging.log4j.core.config.ConfigurationFactory.ConfigurationSource;","47","import org.apache.logging.log4j.core.util.FileUtils;","54","public class LoggerContextAdmin extends NotificationBroadcasterSupport","55","        implements LoggerContextAdminMBean, PropertyChangeListener {","64","    private String customConfigText;","67","     * Constructs a new {@code LoggerContextAdmin} with the {@code Executor} to","68","     * be used for sending {@code Notification}s asynchronously to listeners.","87","        final String[] notifTypes = new String[] {\/\/","88","                NOTIF_TYPE_RECONFIGURED };","120","    public void setConfigLocationUri(final String configLocation)","121","            throws URISyntaxException, IOException {","123","        LOGGER.debug(\"Remote request to reconfigure using location \"","124","                + configLocation);","125","        final URI uri = FileUtils.getCorrectedFilePathUri(configLocation);","126","","127","        \/\/ validate the location first: invalid location will result in","128","        \/\/ default configuration being configured, try to avoid that...","129","        uri.toURL().openStream().close();","130","","131","        loggerContext.setConfigLocation(uri);","140","        \/\/ erase custom text if new configuration was read from a location","141","        if (loggerContext.getConfiguration().getName() != null) {","142","            customConfigText = null;","143","        }","144","        final Notification notif = new Notification(NOTIF_TYPE_RECONFIGURED,","145","                getObjectName(), nextSeqNo(), now(), null);","156","        if (customConfigText != null) {","157","            return customConfigText;","158","        }","161","            return readContents(FileUtils.getCorrectedFilePathUri(getConfigLocationUri()), charset);","169","    @Override","170","    public void setConfigText(final String configText, final String charsetName) {","171","        final String old = customConfigText;","172","        customConfigText = Assert.requireNonNull(configText, \"configText\");","173","        LOGGER.debug(\"---------\");","174","        LOGGER.debug(\"Remote request to reconfigure from config text.\");","175","","176","        try {","177","            final InputStream in = new ByteArrayInputStream(","178","                    configText.getBytes(charsetName));","179","            final ConfigurationSource source = new ConfigurationSource(in);","180","            final Configuration updated = ConfigurationFactory.getInstance()","181","                    .getConfiguration(source);","182","            loggerContext.start(updated);","183","            LOGGER.debug(\"Completed remote request to reconfigure from config text.\");","184","        } catch (final Exception ex) {","185","            customConfigText = old;","186","            final String msg = \"Could not reconfigure from config text\";","187","            LOGGER.error(msg, ex);","188","            throw new IllegalArgumentException(msg, ex);","189","        }","190","    }","191","","193","     * ","194","     * @param uri","196","     * @return","197","     * @throws IOException","199","    private String readContents(final URI uri, final Charset charset) throws IOException {","200","        InputStream in = null;","203","            in = uri.toURL().openStream();"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/Log4jInitPerformance.java":[{"add":["22","import org.apache.logging.log4j.core.config.ConfigurationSource;","48","        final ConfigurationSource source =","49","            new ConfigurationSource(is);"],"delete":["22","import org.apache.logging.log4j.core.config.ConfigurationFactory;","48","        final ConfigurationFactory.ConfigurationSource source =","49","            new ConfigurationFactory.ConfigurationSource(is);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["54","import org.apache.logging.log4j.core.util.Assert;","103","    private final ConfigurationSource configurationSource;","108","    protected AbstractConfiguration(final ConfigurationSource configurationSource) {","109","        this.configurationSource = Assert.requireNonNull(configurationSource, \"configurationSource is null\");","114","    ","115","    @Override","116","    public ConfigurationSource getConfigurationSource() {","117","        return configurationSource;","118","    }","278","    protected void createAdvertiser(String advertiserString, ConfigurationSource configSource,"],"delete":["86","","88","","95","","97","","99","","101","","103","","105","","107","","109","","111","","117","    protected AbstractConfiguration() {","281","    protected void createAdvertiser(String advertiserString, ConfigurationFactory.ConfigurationSource configSource,"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfigurationFactory.java":[{"add":["20","import org.apache.logging.log4j.core.config.ConfigurationSource;"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-539\" dev=\"rpopma\" type=\"fix\" due-to=\"Colin Froggatt\">","25","        Fixed issue with \"Reconfigure using XML below\" function in JMX Client GUI.","26","        ConfigurationSource is now a top-level class and can be obtained with Configuration.getConfigurationSource().","27","        LoggerContext.getConfiguration().getConfigurationSource() ","28","        provides a reliable public method for obtaining a logger context's configuration location and content.","29","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfigurationFactory.java":[{"add":["20","import org.apache.logging.log4j.core.config.ConfigurationSource;"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationSource.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":[{"add":["100","    ","101","    \/**","102","     * Returns the source of this configuration.","103","     * @return the source of this configuration","104","     *\/","105","    ConfigurationSource getConfigurationSource();"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/json\/JsonConfiguration.java":[{"add":["20","import java.io.IOException;","29","import org.apache.logging.log4j.core.config.ConfigurationSource;","48","    private static final String[] VERBOSE_CLASSES = new String[] { ResolverUtil.class.getName() };","52","    public JsonConfiguration(final ConfigurationSource configSource) {","53","        super(configSource);","54","        final File configFile = configSource.getFile();","71","            final StatusConfiguration statusConfig = new StatusConfiguration().withVerboseClasses(VERBOSE_CLASSES)","137","        try {","138","            final ConfigurationSource source = getConfigurationSource().resetInputStream();","139","            if (source == null) {","140","                return null;","142","            return new JsonConfiguration(source);","143","        } catch (final IOException ex) {","144","            LOGGER.error(\"Cannot locate file {}\", getConfigurationSource(), ex);","209","        final String p = node.getParent() == null ? \"null\" : node.getParent().getName() == null ? \"root\" : node","210","                .getParent().getName();","242","","245","        return getClass().getSimpleName() + \"[location=\" + getConfigurationSource() + \"]\";"],"delete":["20","import java.io.FileInputStream;","21","import java.io.FileNotFoundException;","30","import org.apache.logging.log4j.core.config.ConfigurationFactory;","49","    private static final String[] VERBOSE_CLASSES = new String[]{ResolverUtil.class.getName()};","50","","52","","55","    private final File configFile;","56","","57","    public JsonConfiguration(final ConfigurationFactory.ConfigurationSource configSource) {","58","        this.configFile = configSource.getFile();","75","            final StatusConfiguration statusConfig = new StatusConfiguration()","76","                    .withVerboseClasses(VERBOSE_CLASSES)","142","        if (configFile != null) {","143","            try {","144","                final ConfigurationFactory.ConfigurationSource source =","145","                    new ConfigurationFactory.ConfigurationSource(new FileInputStream(configFile), configFile);","146","                return new JsonConfiguration(source);","147","            } catch (final FileNotFoundException ex) {","148","                LOGGER.error(\"Cannot locate file {}\", configFile, ex);","214","        final String p = node.getParent() == null ? \"null\" : node.getParent().getName() == null ?","215","                \"root\" : node.getParent().getName();","247","    ","250","        final String path = configFile != null ? configFile.getAbsolutePath() : \"unknown\";","251","        return getClass().getSimpleName() + \"[location=\" + path + \"]\";"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/BasicConfigurationFactory.java":[{"add":["24","import org.apache.logging.log4j.core.config.ConfigurationSource;","52","            super(ConfigurationSource.NULL_SOURCE);"],"delete":[]}]}},"8c355e0d39c47e2fbd747dcd0eab622f165a21fc":{"changes":{"core\/src\/test\/resources\/META-INF\/LICENSE":"ADD","core\/src\/test\/resources\/META-INF\/NOTICE":"ADD","osgi\/core-osgi-async\/pom.xml":"MODIFY","osgi\/core-osgi-net\/pom.xml":"MODIFY","osgi\/core-osgi-jpa\/pom.xml":"MODIFY","pom.xml":"MODIFY","api\/pom.xml":"MODIFY","jmx-gui\/pom.xml":"MODIFY","taglib\/pom.xml":"MODIFY","core\/src\/main\/resources\/META-INF\/LICENSE":"ADD","flume-ng\/pom.xml":"MODIFY","jcl-bridge\/pom.xml":"MODIFY","osgi\/core-osgi-nosql-mongo\/pom.xml":"MODIFY","samples\/pom.xml":"MODIFY","log4j12-api\/pom.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","osgi\/core-osgi-reduced\/pom.xml":"MODIFY","osgi\/core-osgi-nosql-couch\/pom.xml":"MODIFY","slf4j-impl\/pom.xml":"MODIFY","log4j-to-slf4j\/pom.xml":"MODIFY","dist\/src\/assembly\/src.xml":"MODIFY"},"diff":{"core\/src\/test\/resources\/META-INF\/LICENSE":[{"add":[],"delete":[]}],"core\/src\/test\/resources\/META-INF\/NOTICE":[{"add":[],"delete":[]}],"osgi\/core-osgi-async\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"osgi\/core-osgi-net\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"osgi\/core-osgi-jpa\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"pom.xml":[{"add":["639","      <!-- We need to disable the standard ASF configuration to be able to publish our own notice and license files -->","640","      <plugin>","641","        <groupId>org.apache.maven.plugins<\/groupId>","642","        <artifactId>maven-remote-resources-plugin<\/artifactId>","643","        <executions>","644","          <execution>","645","            <goals>","646","              <goal>process<\/goal>","647","            <\/goals>","648","            <configuration>","649","              <skip>true<\/skip>","650","            <\/configuration>","651","          <\/execution>","652","        <\/executions>","653","      <\/plugin>"],"delete":[]}],"api\/pom.xml":[{"add":["47","  <build>","48","    <plugins>","49","      <!-- Include the standard NOTICE and LICENSE -->","50","      <plugin>","51","        <groupId>org.apache.maven.plugins<\/groupId>","52","        <artifactId>maven-remote-resources-plugin<\/artifactId>","53","        <executions>","54","          <execution>","55","            <goals>","56","              <goal>process<\/goal>","57","            <\/goals>","58","            <configuration>","59","              <skip>false<\/skip>","60","            <\/configuration>","61","          <\/execution>","62","        <\/executions>","63","      <\/plugin>","64","    <\/plugins>","65","  <\/build>"],"delete":[]}],"jmx-gui\/pom.xml":[{"add":["58","  <build>","59","    <plugins>","60","      <!-- Include the standard NOTICE and LICENSE -->","61","      <plugin>","62","        <groupId>org.apache.maven.plugins<\/groupId>","63","        <artifactId>maven-remote-resources-plugin<\/artifactId>","64","        <executions>","65","          <execution>","66","            <goals>","67","              <goal>process<\/goal>","68","            <\/goals>","69","            <configuration>","70","              <skip>false<\/skip>","71","            <\/configuration>","72","          <\/execution>","73","        <\/executions>","74","      <\/plugin>","75","    <\/plugins>","76","  <\/build>"],"delete":[]}],"taglib\/pom.xml":[{"add":["81","  <build>","82","    <plugins>","83","      <!-- Include the standard NOTICE and LICENSE -->","84","      <plugin>","85","        <groupId>org.apache.maven.plugins<\/groupId>","86","        <artifactId>maven-remote-resources-plugin<\/artifactId>","87","        <executions>","88","          <execution>","89","            <goals>","90","              <goal>process<\/goal>","91","            <\/goals>","92","            <configuration>","93","              <skip>false<\/skip>","94","            <\/configuration>","95","          <\/execution>","96","        <\/executions>","97","      <\/plugin>","98","    <\/plugins>","99","  <\/build>"],"delete":[]}],"core\/src\/main\/resources\/META-INF\/LICENSE":[{"add":[],"delete":[]}],"flume-ng\/pom.xml":[{"add":["135","      <!-- Include the standard NOTICE and LICENSE -->","136","      <plugin>","137","        <groupId>org.apache.maven.plugins<\/groupId>","138","        <artifactId>maven-remote-resources-plugin<\/artifactId>","139","        <executions>","140","          <execution>","141","            <goals>","142","              <goal>process<\/goal>","143","            <\/goals>","144","            <configuration>","145","              <skip>false<\/skip>","146","            <\/configuration>","147","          <\/execution>","148","        <\/executions>","149","      <\/plugin>"],"delete":[]}],"jcl-bridge\/pom.xml":[{"add":["61","  <build>","62","    <plugins>","63","      <!-- Include the standard NOTICE and LICENSE -->","64","      <plugin>","65","        <groupId>org.apache.maven.plugins<\/groupId>","66","        <artifactId>maven-remote-resources-plugin<\/artifactId>","67","        <executions>","68","          <execution>","69","            <goals>","70","              <goal>process<\/goal>","71","            <\/goals>","72","            <configuration>","73","              <skip>false<\/skip>","74","            <\/configuration>","75","          <\/execution>","76","        <\/executions>","77","      <\/plugin>","78","    <\/plugins>","79","  <\/build>"],"delete":[]}],"osgi\/core-osgi-nosql-mongo\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"samples\/pom.xml":[{"add":["96","      <!-- Include the standard NOTICE and LICENSE -->","97","      <plugin>","98","        <groupId>org.apache.maven.plugins<\/groupId>","99","        <artifactId>maven-remote-resources-plugin<\/artifactId>","100","        <executions>","101","          <execution>","102","            <goals>","103","              <goal>process<\/goal>","104","            <\/goals>","105","            <configuration>","106","              <skip>false<\/skip>","107","            <\/configuration>","108","          <\/execution>","109","        <\/executions>","110","      <\/plugin>"],"delete":[]}],"log4j12-api\/pom.xml":[{"add":["55","  <build>","56","    <plugins>","57","      <!-- Include the standard NOTICE and LICENSE -->","58","      <plugin>","59","        <groupId>org.apache.maven.plugins<\/groupId>","60","        <artifactId>maven-remote-resources-plugin<\/artifactId>","61","        <executions>","62","          <execution>","63","            <goals>","64","              <goal>process<\/goal>","65","            <\/goals>","66","            <configuration>","67","              <skip>false<\/skip>","68","            <\/configuration>","69","          <\/execution>","70","        <\/executions>","71","      <\/plugin>","72","    <\/plugins>","73","  <\/build>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-309\" dev=\"rgoers\" type=\"fix\">","24","        Insure jars and distributions only have a single License and Notice file.","25","      <\/action>"],"delete":[]}],"osgi\/core-osgi-reduced\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"osgi\/core-osgi-nosql-couch\/pom.xml":[{"add":["44","        <artifactId>maven-antrun-plugin<\/artifactId>","45","        <executions>","46","          <execution>","47","            <id>generate-sources<\/id>","48","            <phase>generate-sources<\/phase>","49","            <configuration>","50","              <tasks>","51","                <mkdir dir=\"target\/classes\"\/>","52","              <\/tasks>","53","            <\/configuration>","54","            <goals>","55","              <goal>run<\/goal>","56","            <\/goals>","57","          <\/execution>","58","        <\/executions>","59","      <\/plugin>","60","      <plugin>"],"delete":[]}],"slf4j-impl\/pom.xml":[{"add":["112","      <!-- Include the standard NOTICE and LICENSE -->","113","      <plugin>","114","        <groupId>org.apache.maven.plugins<\/groupId>","115","        <artifactId>maven-remote-resources-plugin<\/artifactId>","116","        <executions>","117","          <execution>","118","            <goals>","119","              <goal>process<\/goal>","120","            <\/goals>","121","            <configuration>","122","              <skip>false<\/skip>","123","            <\/configuration>","124","          <\/execution>","125","        <\/executions>","126","      <\/plugin>"],"delete":[]}],"log4j-to-slf4j\/pom.xml":[{"add":["65","  <build>","66","    <plugins>","67","      <!-- Include the standard NOTICE and LICENSE -->","68","      <plugin>","69","        <groupId>org.apache.maven.plugins<\/groupId>","70","        <artifactId>maven-remote-resources-plugin<\/artifactId>","71","        <executions>","72","          <execution>","73","            <goals>","74","              <goal>process<\/goal>","75","            <\/goals>","76","            <configuration>","77","              <skip>false<\/skip>","78","            <\/configuration>","79","          <\/execution>","80","        <\/executions>","81","      <\/plugin>","82","    <\/plugins>","83","  <\/build>"],"delete":[]}],"dist\/src\/assembly\/src.xml":[{"add":["72","    <!-- license, readme, etc. calculated at build time","76","    <\/fileSet>  -->"],"delete":["72","    <!-- license, readme, etc. calculated at build time -->","76","    <\/fileSet>"]}]}},"e8ccf2b12732fff9c1dabd5b6ecc66ae8d7b6506":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-1140\" dev=\"rpopma\" type=\"fix\">","42","        Fixed bug where headers were not being written to first file with RollingFileAppender.","43","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["305","            \/\/ LOG4J2-1140: check writeHeader before creating the file","306","            final boolean writeHeader = !data.append || !file.exists();"],"delete":["313","            final boolean writeHeader = !data.append || !file.exists();"]}]}},"3f5d58cd32ad96ccb4a644fc32be11ffca0e5922":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncAppenderTest2.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerLoggingFromToStringTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncAppenderTest.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigTest2.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigLoggingFromToStringTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerLoggingFromToStringTest2.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerTest2.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigLoggingFromToStringTest2.java":"ADD","log4j-core\/src\/test\/resources\/log4j2-queueFullAsyncAppender.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncAppenderTest2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerLoggingFromToStringTest.java":[{"add":["77","        asyncLoggerRecursiveTest(logger, unlocker, blockingAppender, this);","78","    }","79","","80","    static void asyncLoggerRecursiveTest(final Logger logger,","81","                                         final Unlocker unlocker,","82","                                         final BlockingAppender blockingAppender,","83","                                         final QueueFullAbstractTest factory) {","88","            final DomainObject obj = factory.new DomainObject(129);"],"delete":["51","\/\/        System.setProperty(\"Log4jContextSelector\", AsyncLoggerContextSelector.class.getName());","82","            final DomainObject obj = new DomainObject(129);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigTest.java":[{"add":["69","        asyncLoggerConfigTest(logger, unlocker, blockingAppender);","70","    }","71","","72","    static void asyncLoggerConfigTest(final Logger logger,","73","                                      final Unlocker unlocker,","74","                                      final BlockingAppender blockingAppender) {"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncAppenderTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigTest2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigLoggingFromToStringTest.java":[{"add":["70","        asyncLoggerConfigRecursiveTest(logger, unlocker, blockingAppender, this);","71","    }","72","","73","    static void asyncLoggerConfigRecursiveTest(final Logger logger,","74","                                               final Unlocker unlocker,","75","                                               final BlockingAppender blockingAppender,","76","                                               final QueueFullAbstractTest factory) {","81","            final DomainObject obj = factory.new DomainObject(129);"],"delete":["47","\/\/        System.setProperty(\"AsyncLogger.RingBufferSize\", \"128\"); \/\/ minimum ringbuffer size","75","            final DomainObject obj = new DomainObject(129);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerLoggingFromToStringTest2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerTest2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerTest.java":[{"add":["77","        asyncLoggerTest(logger, unlocker, blockingAppender);","78","    }","79","","80","    static void asyncLoggerTest(final Logger logger,","81","                                final Unlocker unlocker,","82","                                final BlockingAppender blockingAppender) {"],"delete":["50","\/\/        System.setProperty(\"Log4jContextSelector\", AsyncLoggerContextSelector.class.getName());"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/QueueFullAsyncLoggerConfigLoggingFromToStringTest2.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/log4j2-queueFullAsyncAppender.xml":[{"add":[],"delete":[]}]}},"7868911351273509b7188efa19b408e3695a6448":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FixedDateFormat.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["97","      <action issue=\"LOG4J2-3153\" dev=\"ckozak\" type=\"fix\">","98","        DatePatternConverter performance is not impacted by microsecond-precision clocks when such precision isn't","99","        required.","100","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FixedDateFormat.java":[{"add":["711","","712","    \/**","713","     * Returns {@code true} if the old and new date values will result in the same formatted output, {@code false}","714","     * if results <i>may<\/i> differ.","715","     *\/","716","    public final boolean isEquivalent(long oldEpochSecond, int oldNanoOfSecond, long epochSecond, int nanoOfSecond) {","717","        if (oldEpochSecond == epochSecond) {","718","            if (secondFractionDigits <= 3) {","719","                \/\/ Convert nanos to milliseconds for comparison if the format only requires milliseconds.","720","                return (oldNanoOfSecond \/ 1000_000L) == (nanoOfSecond \/ 1000_000L);","721","            }","722","            return oldNanoOfSecond == nanoOfSecond;","723","        }","724","        return false;","725","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":[{"add":["106","            if (!fixedDateFormat.isEquivalent(previousTime, nanos, epochSecond, nanoOfSecond)) {"],"delete":["106","            if (previousTime != epochSecond || nanos != nanoOfSecond) {"]}]}},"2ea183ee7ab530005e5e395deeac003a432b5cc7":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SmtpAppenderAsyncTest.java":"ADD","log4j-core\/src\/test\/resources\/SmtpAppenderAsyncTest.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SmtpAppenderAsyncTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/SmtpAppenderAsyncTest.xml":[{"add":[],"delete":[]}]}},"1a127dd530846ac8367308d791bd8fe2d512b67f":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":"MODIFY","core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/ShutdownDisabledTest.java":"ADD","src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","core\/src\/test\/resources\/log4j-test3.xml":"ADD"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["88","    \/**","89","     *","90","     *\/","91","    protected boolean isShutdownHookEnabled = true;","92","","157","    public boolean isShutdownHookEnabled() {","158","        return isShutdownHookEnabled;","159","    }","160",""],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/Configuration.java":[{"add":["83","","85","","87","","89","","90","    boolean isShutdownHookEnabled();"],"delete":["83","    ","85","    ","87","    "]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/XMLConfiguration.java":[{"add":["118","                    final String dest = getSubst().replace(entry.getValue());","132","                } else if (\"shutdownHook\".equalsIgnoreCase(entry.getKey())) {","133","                    String hook = getSubst().replace(entry.getValue());","134","                    isShutdownHookEnabled = !hook.equalsIgnoreCase(\"disable\");"],"delete":["118","                    final String dest = entry.getValue();"]}],"core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/ShutdownDisabledTest.java":[{"add":[],"delete":[]}],"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["328","","350","                 <td>shutdownHook<\/td>","351","                 <td>Specifies whether or not Log4j should automatically shutdown when the JVM shuts down. The","352","                 shutdown hook is enabled by default but may be disabled by setting this attribute to \"disable\"<\/td>","353","              <\/tr>","354","              <tr>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-318\" dev=\"rgoers\" type=\"update\">","24","        Allow shutdown hook to be disabled in the configuration.","25","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/JSONConfiguration.java":[{"add":["112","                } else if (\"shutdownHook\".equalsIgnoreCase(entry.getKey())) {","113","                    String hook = getSubst().replace(entry.getValue());","114","                    isShutdownHookEnabled = !hook.equalsIgnoreCase(\"disable\");"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["146","                if ((status == Status.INITIALIZED || status == Status.STOPPED)) {","149","                    if (config.isShutdownHookEnabled()) {","150","                        shutdownThread = new ShutdownThread(this);","151","                        try {","152","                            Runtime.getRuntime().addShutdownHook(shutdownThread);","153","                        } catch (final IllegalStateException ise) {","154","                            LOGGER.warn(\"Unable to register shutdown hook due to JVM state\");","155","                            shutdownThread = null;","156","                        } catch (final SecurityException se) {","157","                            LOGGER.warn(\"Unable to register shutdown hook due to security restrictions\");","158","                            shutdownThread = null;","159","                        }","176","                if ((status == Status.INITIALIZED || status == Status.STOPPED) && config.isShutdownHookEnabled() ) {","180","                    } catch (final IllegalStateException ise) {","181","                        LOGGER.warn(\"Unable to register shutdown hook due to JVM state\");","182","                        shutdownThread = null;"],"delete":["146","                if (status == Status.INITIALIZED || status == Status.STOPPED) {","149","                    shutdownThread = new ShutdownThread(this);","150","                    try {","151","                        Runtime.getRuntime().addShutdownHook(shutdownThread);","152","                    } catch (final SecurityException se) {","153","                        LOGGER.warn(\"Unable to register shutdown hook due to security restrictions\");","154","                        shutdownThread = null;","171","                if (status == Status.INITIALIZED || status == Status.STOPPED) {"]}],"core\/src\/test\/resources\/log4j-test3.xml":[{"add":[],"delete":[]}]}},"74384c21c688fff51b29facbc427840a2e4700b7":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-2055\" dev=\"rgoers\" type=\"fix\">","34","        If Log4j is used as the Tomcat logging implementation startup might fail if an application also uses Log4j.","35","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":[{"add":["66","            try {","67","                loadProviders(classLoader);","68","            } catch (Throwable ex) {","69","                LOGGER.debug(\"Unable to retrieve provider from ClassLoader {}\", classLoader, ex);","70","            }"],"delete":["66","            loadProviders(classLoader);"]}]}},"b9d4578de9272df95b7b60be5e372b7e33efa544":{"changes":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/SimpleLayout.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/ConsoleAppender.java":"ADD"},"diff":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/SimpleLayout.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["102","      <action issue=\"LOG4J2-2476\" dev=\"ggregory\" type=\"fix\" due-to=\"Al Bundy\">","103","        org.apache.log4j.SimpleLayout and ConsoleAppender missing in log4j-1.2-api.","104","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/ConsoleAppender.java":[{"add":[],"delete":[]}]}},"9496c0c2d7c25257933d523664896920789d6610":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactoryTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactory.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/EventParameterMemoryLeakTest.java":"ADD","log4j-core\/src\/test\/resources\/EventParameterMemoryLeakTest.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactoryTest.java":[{"add":["124","        try {","125","            assertNotNull(event.getContextMap());","126","            assertNotNull(event.getContextData());","127","            assertNotNull(event.getContextStack());","128","        } finally {","129","            ReusableLogEventFactory.release(event);","130","        }"],"delete":["124","        ReusableLogEventFactory.release(event);","125","        assertNotNull(event.getContextMap());","126","        assertNotNull(event.getContextData());","127","        assertNotNull(event.getContextStack());"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactory.java":[{"add":["100","            MutableLogEvent mutableLogEvent = (MutableLogEvent) logEvent;","101","            mutableLogEvent.clear();","102","            mutableLogEvent.reserved = false;"],"delete":["100","            ((MutableLogEvent) logEvent).reserved = false;"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/EventParameterMemoryLeakTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/EventParameterMemoryLeakTest.xml":[{"add":[],"delete":[]}]}},"80a496327fc0ae7b33308b114d034ff91699f595":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/StyleConverterTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/StyleConverter.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["42","      <action issue=\"LOG4J2-2001\" dev=\"ggregory\" type=\"fix\" due-to=\"Paul Burrowes\">","43","        StyleConverter.newInstance argument validation is incorrect.","44","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/StyleConverterTest.java":[{"add":["24","import org.junit.Assert;","61","","62","    @Test","63","    public void testNull() {","64","        Assert.assertNull(StyleConverter.newInstance(null, null));","65","    }"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/StyleConverter.java":[{"add":["78","        if (options == null) {","79","            return null;","80","        }","81","        if (options.length < 2) {","86","            LOGGER.error(\"No pattern supplied for style converter\");","90","            LOGGER.error(\"No style attributes supplied for style converter\");"],"delete":["78","        if (options.length < 1) {","83","            LOGGER.error(\"No pattern supplied on style\");","87","            LOGGER.error(\"No style attributes provided\");"]}]}},"8b569ca42da7a39187bc3a7c070408f8b26a36f3":{"changes":{"log4j-1.2-api\/pom.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/pom.xml":"MODIFY","log4j-jmx-gui\/pom.xml":"MODIFY","log4j-web\/pom.xml":"MODIFY","log4j-jul\/pom.xml":"MODIFY","log4j-nosql\/pom.xml":"MODIFY"},"diff":{"log4j-1.2-api\/pom.xml":[{"add":["110","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1467\" dev=\"rpopma, ggregory\" type=\"fix\" due-to=\"Ralf, Gary Gregory\">","27","        [OSGi] Missing import package.","28","      <\/action>","29","      <action issue=\"LOG4J2-351\" dev=\"rpopma, ggregory\" type=\"fix\" due-to=\"Roland Weiglhofer\">","30","        [OSGi] wrong Fragment-Host in manifest files.","31","      <\/action>"],"delete":[]}],"log4j-flume-ng\/pom.xml":[{"add":["150","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}],"log4j-jmx-gui\/pom.xml":[{"add":["80","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}],"log4j-web\/pom.xml":[{"add":["85","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}],"log4j-jul\/pom.xml":[{"add":["85","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}],"log4j-nosql\/pom.xml":[{"add":["73","            <Fragment-Host>org.apache.logging.log4j.core<\/Fragment-Host>"],"delete":[]}]}},"2321796a79494c25d90cd78b46e0e366703a1778":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/BaseConfiguration.java":[{"add":["25","import java.util.HashSet;","28","import java.util.Set;","34","import org.apache.logging.log4j.LogManager;","40","import org.apache.logging.log4j.core.appender.AsyncAppender;","42","import org.apache.logging.log4j.core.async.AsyncLoggerConfig;","43","import org.apache.logging.log4j.core.async.AsyncLoggerContextSelector;","56","import org.apache.logging.log4j.core.impl.Log4jContextFactory;","63","import org.apache.logging.log4j.core.selector.ContextSelector;","64","import org.apache.logging.log4j.spi.LoggerContextFactory;","181","        ","182","        \/\/ LOG4J2-392 first stop AsyncLogger Disruptor thread","183","        final LoggerContextFactory factory = LogManager.getFactory();","184","        if (factory instanceof Log4jContextFactory) {","185","            ContextSelector selector = ((Log4jContextFactory) factory).getSelector();","186","            if (selector instanceof AsyncLoggerContextSelector) { \/\/ all loggers are async","187","                \/\/ TODO until LOG4J2-493 is fixed we can only stop AsyncLogger once!","188","                \/\/ but LoggerContext.setConfiguration will call config.stop()","189","                \/\/ every time the configuration changes...","190","                \/\/","191","                \/\/ Uncomment the line below after LOG4J2-493 is fixed","192","                \/\/AsyncLogger.stop();","193","            }","194","        }","195","        \/\/ similarly, first stop AsyncLoggerConfig Disruptor thread(s)","196","        Set<LoggerConfig> alreadyStopped = new HashSet<LoggerConfig>();","197","        for (final LoggerConfig logger : loggers.values()) {","198","            if (logger instanceof AsyncLoggerConfig) {","199","                logger.clearAppenders();","200","                logger.stopFilter();","201","                alreadyStopped.add(logger);","202","            }","203","        }","204","        if (root instanceof AsyncLoggerConfig) {","205","            root.stopFilter();","206","            alreadyStopped.add(root);","207","        }","208","        ","211","        ","212","        \/\/ LOG4J2-511, LOG4J2-392 stop AsyncAppenders first","214","            if (array[i] instanceof AsyncAppender) {","215","                array[i].stop();","216","            }","217","        }","218","        for (int i = array.length - 1; i >= 0; --i) {","219","            if (array[i].isStarted()) { \/\/ then stop remaining Appenders","220","                array[i].stop();","221","            }","224","            if (alreadyStopped.contains(logger)) {","225","                continue;","226","            }","230","        if (!alreadyStopped.contains(root)) {","231","            root.stopFilter();","232","        }","234","        if (advertiser != null && advertisement != null) {"],"delete":["175","            array[i].stop();","181","        root.stopFilter();","183","        if (advertiser != null && advertisement != null)","184","        {"]}],"src\/changes\/changes.xml":[{"add":["23","      <action issue=\"LOG4J2-511\" dev=\"rpopma\" type=\"fix\" due-to=\"James Pretorius\">","24","        Stop AsyncLoggerConfig Disruptor thread(s), then AsyncAppender thread(s) first","25","        before stopping other appenders.","26","      <\/action>","27","      <action issue=\"LOG4J2-392\" dev=\"rpopma\" type=\"fix\" due-to=\"ilynaf, Andre Bogus\">","28","        Stop AsyncLoggerConfig Disruptor thread(s), then AsyncAppender thread(s) first","29","        before stopping other appenders.","30","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["297","        if (temp == null) {","298","            return; \/\/ stop() has already been called","299","        }"],"delete":[]}]}},"23ec2ac7a480854591c794c966edd046b5bba952":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":[],"delete":["1","<!-- vi: set sw=2: -->\r"]}]}},"ed9c83ed0c071e57b826fcf0ca3564434c10618e":{"changes":{"\/dev\/null":"DELETE","log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/PreciseClock.java":"ADD","log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/Instant.java":"ADD","log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemClock.java":"MODIFY","log4j-api-java9\/src\/assembly\/java9.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstant.java":"ADD","log4j-core-java9\/src\/assembly\/java9.xml":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/PreciseClock.java":[{"add":[],"delete":[]}],"log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/Instant.java":[{"add":[],"delete":[]}],"log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/SystemClock.java":[{"add":["20","import org.apache.logging.log4j.core.time.MutableInstant;","21","import org.apache.logging.log4j.core.time.PreciseClock;","22",""],"delete":[]}],"log4j-api-java9\/src\/assembly\/java9.xml":[{"add":[],"delete":["34","        <exclude>module-info.class<\/exclude>","42","    <fileSet>","43","      <directory>${project.build.outputDirectory}<\/directory>","44","      <outputDirectory>\/classes<\/outputDirectory>","45","      <includes>","46","        <include>module-info.class<\/include>","47","      <\/includes>","48","    <\/fileSet>"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J@-2271\" dev=\"rgoers\" type=\"fix\">","34","        Move module-info.class to META-INF\/versions\/9 directory.","35","      <\/action>"],"delete":[]}],"log4j-core-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/time\/MutableInstant.java":[{"add":[],"delete":[]}],"log4j-core-java9\/src\/assembly\/java9.xml":[{"add":["37","        <exclude>**\/time\/Instant.class<\/exclude>","38","        <exclude>**\/time\/MutableInstant.class<\/exclude>","39","        <exclude>**\/time\/PreciseClock.class<\/exclude>"],"delete":["37","        <exclude>**\/util\/Instant.class<\/exclude>","38","        <exclude>**\/util\/MutableInstant.class<\/exclude>","39","        <exclude>**\/util\/PreciseClock.class<\/exclude>"]}]}},"44deb6f7587615db91b7310b2dcb5caddeb7129b":{"changes":{"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":"MODIFY"},"diff":{"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":[{"add":["317","            this.buffer = new char[formatter.getFormat().length()];","335","            return formatter.isEquivalent(","336","                    instant1.getEpochSecond(),","337","                    instant1.getNanoOfSecond(),","338","                    instant2.getEpochSecond(),","339","                    instant2.getNanoOfSecond());"],"delete":["311","        @SuppressWarnings(\"OptionalGetWithoutIsPresent\")","312","        private static final int MAX_FORMATTED_INSTANT_LENGTH = Arrays","313","                .stream(FixedDateFormat.FixedFormat.values())","314","                .mapToInt(format -> format.getPattern().length())","315","                .max()","316","                .getAsInt();","317","","324","            this.buffer = new char[MAX_FORMATTED_INSTANT_LENGTH];","342","            return instant1.getEpochMillisecond() == instant2.getEpochMillisecond();"]}]}},"220d6b850cff04b0cd835667a342082326f0b6b9":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1173\" dev=\"rpopma\" type=\"fix\">","27","        Fixed rollover error when copying to a directory mapped to a remote Linux host.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":[{"add":["19","import java.io.FileInputStream;","20","import java.io.FileOutputStream;","22","import java.nio.channels.FileChannel;","47","     * @param src current file name.","48","     * @param dst new file name.","69","     * ","78","     * ","87","     * ","97","     * @param source current file name.","98","     * @param destination new file name.","122","                                destination.getAbsolutePath(), iex.getMessage());","132","                            destination.getAbsolutePath(), iex.getMessage());","150","","151","        \/\/ LOG4J2-1173: Files.copy(source.toPath(), destination.toPath()) throws IOException","152","        \/\/ when copying to a directory mapped to a remote Linux host","153","","154","        try (FileInputStream srcStream = new FileInputStream(source);","155","                FileOutputStream destStream = new FileOutputStream(destination);","156","                FileChannel srcChannel = srcStream.getChannel();","157","                FileChannel destChannel = destStream.getChannel();) {","158","","159","            destChannel.transferFrom(srcChannel, 0, srcChannel.size());","160","        }"],"delete":["20","import java.nio.file.Files;","45","     * @param src              current file name.","46","     * @param dst              new file name.","92","     * @param source           current file name.","93","     * @param destination      new file name.","117","                            destination.getAbsolutePath(), iex.getMessage());","127","                        destination.getAbsolutePath(), iex.getMessage());","145","        Files.copy(source.toPath(), destination.toPath());"]}]}},"5edb9781f93579bbbfaa61fe994d44f9e65037a1":{"changes":{"log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/ClientGUI.java":"MODIFY"},"diff":{"log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/ClientGUI.java":[{"add":["179","        SwingUtilities.invokeLater(new Runnable() {","180","            public void run() { \/\/ LOG4J2-538","181","                handleNotificationInAWTEventThread(notif, paramObject);","182","            }","183","        });","184","    }","185","","186","    private void handleNotificationInAWTEventThread(final Notification notif, final Object paramObject) {"],"delete":[]}]}},"0edfc3d5fbdb7aefc46858db88ed6a38b949c703":{"changes":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventHandler.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":"MODIFY"},"diff":{"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":[{"add":["87","        public void translateTo(final Log4jEventWrapper event,","88","                final long sequence) {","123","        final String strategy = System","124","                .getProperty(\"AsyncLoggerConfig.WaitStrategy\");","162","        final String cls = System","163","                .getProperty(\"AsyncLoggerConfig.ExceptionHandler\");","170","            final Class<? extends ExceptionHandler> klass = (Class<? extends ExceptionHandler>) Class","190","","191","        \/**","192","         * Release references held by ring buffer to allow objects to be","193","         * garbage-collected.","194","         *\/","195","        public void clear() {","196","            loggerConfig = null;","197","            event = null;","198","        }","220","            event.clear();"],"delete":["87","        public void translateTo(final Log4jEventWrapper event, final long sequence) {","122","        final String strategy = System.getProperty(\"AsyncLoggerConfig.WaitStrategy\");","160","        final String cls = System.getProperty(\"AsyncLoggerConfig.ExceptionHandler\");","167","            final","168","            Class<? extends ExceptionHandler> klass = (Class<? extends ExceptionHandler>) Class"]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventHandler.java":[{"add":["43","        event.clear();"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["22","    <release version=\"2.0-beta9\" date=\"soon, very soon\" description=\"Bug fixes and enhancements\">","23","      <action issue=\"LOG4J2-304\" dev=\"rpopma\" type=\"fix\">","24","        Fixed Async Loggers memory leak.","25","      <\/action>","26","    <\/release>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":[{"add":["68","    public void setValues(final AsyncLogger asyncLogger,","69","            final String loggerName, final Marker marker, final String fqcn,","70","            final Level level, final Message data, final Throwable t,","194","            final Map<Property, Boolean> properties,","195","            final StrSubstitutor strSubstitutor) {","214","","215","    \/**","216","     * Release references held by ring buffer to allow objects to be","217","     * garbage-collected.","218","     *\/","219","    public void clear() {","220","        setValues(null, \/\/ asyncLogger","221","                null, \/\/ loggerName","222","                null, \/\/ marker","223","                null, \/\/ fqcn","224","                null, \/\/ level","225","                null, \/\/ data","226","                null, \/\/ t","227","                null, \/\/ map","228","                null, \/\/ contextStack","229","                null, \/\/ threadName","230","                null, \/\/ location","231","                0 \/\/ currentTimeMillis","232","        );","233","    }"],"delete":["68","    public void setValues(final AsyncLogger asyncLogger, final String loggerName,","69","            final Marker marker, final String fqcn, final Level level, final Message data, final Throwable t,","126","    \/\/ @Override","132","    \/\/ @Override","138","    \/\/ @Override","144","    \/\/ @Override","150","    \/\/ @Override","159","    \/\/ @Override","165","    \/\/ @Override","171","    \/\/ @Override","177","    \/\/ @Override","183","    \/\/ @Override","189","    \/\/ @Override","204","            final Map<Property, Boolean> properties, final StrSubstitutor strSubstitutor) {"]}]}},"8b6df4436376aa66e26570ae41dcbf01965e1448":{"changes":{"log4j-layout-template-json\/pom.xml":"MODIFY"},"diff":{"log4j-layout-template-json\/pom.xml":[{"add":["128","            <Export-Package>org.apache.logging.log4j.layout.template.json.*<\/Export-Package>"],"delete":["128","            <Export-Package>org.apache.logging.log4j.layout.template.json<\/Export-Package>"]}]}},"74db83bb90d7a0264449a6759ddcc9908469c295":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["103","      <action issue=\"LOG4J2-798\" dev=\"mattsicker\" type=\"fix\" due-to=\"Scott Harrington\">","104","        Fixed plugin scanning redundancy causing massive slowdowns in certain environments.","105","      <\/action>"],"delete":[]}]}},"18cc154ca80b648f639c43ba1dbf2e21f08fccfc":{"changes":{"log4j-core\/src\/site\/xdoc\/index.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/faq.xml":"MODIFY"},"diff":{"log4j-core\/src\/site\/xdoc\/index.xml":[{"add":["38","            <p>","39","              Below is a list of Log4j features that require external dependencies.","40","              See the <a href=\"dependencies.html#Dependency_Tree\">Dependency Tree<\/a>","41","              for the exact list of JAR files needed for these features.","42","            <\/p>"],"delete":["26","","31",""]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-760\" dev=\"rpopma\" type=\"fix\">","25","        Documentation improvement: link to dependency tree from log4j-core component page,","26","        link to log4j-component page from FAQ page.","27","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/faq.xml":[{"add":["47","        <p>Some of the Log4j components have features with optional dependencies.","48","          The component page will have more detail.","49","          For example, the <a href=\"log4j-core\/index.html\">log4j-core component page<\/a>","50","          has an outline of which log4j-core features have external dependencies.<\/p>","51","        "],"delete":["47",""]}]}},"4320ef3ae7e77fab85e9db3509075a7362a544dc":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["277","        root.getReliabilityStrategy().beforeStopConfiguration(this);","279","        final String cls = getClass().getSimpleName();","280","        LOGGER.trace(\"{} notified {} ReliabilityStrategies that config will be stopped.\", cls, loggerConfigs.size()","281","                + 1);","282","        ","283","        if (!loggerConfigs.isEmpty()) {","284","            LOGGER.trace(\"{} stopping {} LoggerConfigs.\", cls, loggerConfigs.size());","285","            for (final LoggerConfig logger : loggerConfigs.values()) {","286","                logger.stop();","287","            }","289","        LOGGER.trace(\"{} stopping root LoggerConfig.\", cls);","298","                ","301","        final List<Appender> async = getAsyncAppenders(array);","302","        if (!async.isEmpty()) {","303","            \/\/ LOG4J2-511, LOG4J2-392 stop AsyncAppenders first","304","            LOGGER.trace(\"{} stopping {} AsyncAppenders.\", cls, async.size());","305","            for (Appender appender : async) {","306","                appender.stop();","314","        root.getReliabilityStrategy().beforeStopAppenders();","315","        ","326","        LOGGER.trace(\"{} cleaning Appenders from {} LoggerConfigs.\", cls, loggerConfigs.size() + 1);","336","        root.clearAppenders();","349","    ","350","    private List<Appender> getAsyncAppenders(final Appender[] all) {","351","        final List<Appender> result = new ArrayList<Appender>();","352","        for (int i = all.length - 1; i >= 0; --i) {","353","            if (all[i] instanceof AsyncAppender) {","354","                result.add(all[i]);","355","            }","356","        }","357","        return result;","358","    }"],"delete":["277","        final String cls = getClass().getSimpleName();","278","        LOGGER.trace(\"{} notified {} ReliabilityStrategies that config will be stopped.\", cls, loggerConfigs.size());","280","        LOGGER.trace(\"{} stopping {} LoggerConfigs.\", cls, loggerConfigs.size());","281","        for (final LoggerConfig logger : loggerConfigs.values()) {","282","            logger.stop();","292","        ","293","        LOGGER.trace(\"{} stopping AsyncAppenders.\", cls);","294","","297","","298","        \/\/ LOG4J2-511, LOG4J2-392 stop AsyncAppenders first","299","        int asyncAppenderCount = 0;","300","        for (int i = array.length - 1; i >= 0; --i) {","301","            if (array[i] instanceof AsyncAppender) {","302","                array[i].stop();","303","                asyncAppenderCount++;","306","        LOGGER.trace(\"{} stopped {} AsyncAppenders.\", cls, asyncAppenderCount);","312","","323","        LOGGER.trace(\"{} cleaning Appenders from {} LoggerConfigs.\", cls, loggerConfigs.size());"]}]}},"a696b8d3cfc87e37dd460057149e9b50b78440ce":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["102","        Double stack trace logging when using %throwable in %style and %highlight."],"delete":["102","        Double stack trace logging when using %throwable in a %style."]}]}},"fa4a8be9719c5d08a6b026b3f0f68b8502853810":{"changes":{"src\/changes\/changes.xml":"MODIFY","core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/ClassLoaderContextSelector.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","      <action issue=\"LOG4J2-108\" dev=\"rgoers\" type=\"fix\">","26","        Fix NullPointerException in ClassLoaderContextSelector when no class is returned from","27","        the SecurityManager.","28","      <\/action>"],"delete":[]}],"core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/ClassLoaderContextSelector.java":[{"add":["101","                if (clazz != null) {","102","                    return locateContext(clazz.getClassLoader(), null);","103","                }"],"delete":["101","                return locateContext(clazz.getClassLoader(), null);"]}]}}}