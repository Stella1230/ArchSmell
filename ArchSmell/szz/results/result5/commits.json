{"9f55c387b951016e8011f042ecd817b31668f2c8":{"changes":{"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.22.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.23.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.15.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.13.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.14.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.16.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.21.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.24.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.25.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.20.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.18.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.17.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.19.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.10.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.11.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.12.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.30.log":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.5.log.gz":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/EligibleFilesTest.java":"MODIFY","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.7.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.4.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.6.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.8.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.1.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.2.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.3.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.9.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.29.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.28.log.gz":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":"MODIFY","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.26.log.gz":"ADD","log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.27.log.gz":"ADD"},"diff":{"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.22.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.23.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.15.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.13.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.14.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.16.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.21.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.24.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.25.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.20.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.18.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.17.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.19.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.10.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.11.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.12.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.30.log":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.5.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/EligibleFilesTest.java":[{"add":["40","    @Test","41","    public void runTestWithPlusCharacter() throws Exception {","42","        final String path = \"target\/test-classes\/rolloverPath\/log4j.20211028T194500+0200.\" + NotANumber.VALUE + \".log.gz\";","43","        final TestRolloverStrategy strategy = new TestRolloverStrategy();","44","        final Map<Integer, Path> files = strategy.findFilesWithPlusInPath(path);","45","        assertTrue(files.size() > 0, \"No files found\");","46","        assertEquals(30, files.size(), \"Incorrect number of files found. Should be 30, was \" + files.size());","47","    }","48","","63","","64","        public Map<Integer, Path> findFilesWithPlusInPath(final String path) {","65","            \/\/ timezone might expand to \"+0200\", because of '+' we have to be careful when working with regex","66","            return getEligibleFiles(path, \"log4j.txt.%d{yyyyMMdd'T'HHmmssZ}.%i.log.gz\");","67","        }"],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.7.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.4.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.6.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.8.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.1.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.2.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.3.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.9.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.29.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.28.log.gz":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["109","      <action issue=\"LOG4J2-3168\" dev=\"rgoers\" type=\"fix\" due-to=\"Benjamin W?ster\">","110","       Fix bug when file names contain regex characters.","111","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/AbstractRolloverStrategy.java":[{"add":["123","        \/\/ use Pattern.quote to treat all initial parts of the fileName as literal","124","        \/\/ this fixes issues with filenames containing 'magic' regex characters","126","            fileName = Pattern.quote(fileName.substring(0, fileName.length() - suffixLength)) + \".*\";","127","        } else {","128","            fileName = Pattern.quote(fileName);","130","        \/\/ since we insert a pattern inside a regex escaped string,","131","        \/\/ surround it with quote characters so that (\\d) is treated as a pattern and not a literal","132","        final String filePattern = fileName.replaceFirst(\"0?\\\\u0000\", \"\\\\\\\\E(0?\\\\\\\\d+)\\\\\\\\Q\");"],"delete":["124","            fileName = fileName.substring(0, fileName.length() - suffixLength) + \".*\";","126","        final String filePattern = fileName.replaceFirst(\"0?\\\\u0000\", \"(0?\\\\\\\\d+)\");"]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.26.log.gz":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/rolloverPath\/log4j.20211028T194500+0200.27.log.gz":[{"add":[],"delete":[]}]}},"b8498895698857a227e34c23c0b3a50cadb4c1f7":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-988\" dev=\"ggregory\" type=\"update\" due-to=\"Gary Gregory\">","72","        Update tests to use ActiveMQ from 5.10 to 5.11.1.","73","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["193","    <activemq.version>5.11.1<\/activemq.version>"],"delete":["193","    <activemq.version>5.10.0<\/activemq.version>"]}]}},"0438bce46ba8b77b638cf969265eb6d4c9bdea34":{"changes":{"log4j-jcl\/src\/site\/xdoc\/index.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-jcl\/src\/site\/xdoc\/index.xml":[{"add":["36","             The Commons Logging Bridge requires at least Java 6 and is dependent on the Log4j 2 API","37","             and the Commons Logging API.","44","          the other Log4j 2 jars and the Commons Logging API jar, and all logging done using the","45","          Commons Logging API will be routed to Log4j."],"delete":["36","             The Commons Logging Bridge requires at least Java 6 and is dependent on the Log4j 2 API.","43","          the other Log4j 2 jars and all logging done using the Commons Logging API will be routed to Log4j."]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-722\" dev=\"rpopma\" type=\"fix\">","25","        Clarified in documentation that Commons Logging API jar is required when using log4j-jcl.","26","      <\/action>      ","27","      <action issue=\"LOG4J2-723\" dev=\"rpopma\" type=\"fix\">"],"delete":["24","      <action issue=\"LOG4J2-723\" dev=\"rpopma\" type=\"update\">"]}]}},"c18acf17119a0849b104d33beca19c0ed66832d7":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverterTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverterTest.java":[{"add":["23","import org.apache.logging.log4j.core.util.datetime.FixedDateFormat;","30","    \/**","31","     * SimpleTimePattern for DEFAULT.","32","     *\/","33","    private static final String DEFAULT_PATTERN = FixedDateFormat.FixedFormat.DEFAULT.getPattern();","34","","35","    \/**","36","     * ISO8601 string literal.","37","     *\/","38","    private static final String ISO8601_FORMAT = FixedDateFormat.FixedFormat.ISO8601.name();","39","","40","    private static final String[] ISO8601_FORMAT_OPTIONS = { ISO8601_FORMAT };","61","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT_OPTIONS);","103","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT_OPTIONS);","112","    public void testFormatDateStringBuilderOriginalPattern() {","113","        final String[] pattern = { \"yyyy\/MM\/dd HH-mm-ss.SSS\" };","114","        final DatePatternConverter converter = DatePatternConverter.newInstance(pattern);","115","        final StringBuilder sb = new StringBuilder();","116","        converter.format(date(2001, 1, 1), sb);","117","","118","        final String expected = \"2001\/02\/01 14-15-16.123\";","119","        assertEquals(expected, sb.toString());","120","    }","121","","122","    @Test","134","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT_OPTIONS);","150","    public void testGetPatternReturnsDefaultForNullOptions() {","151","        assertEquals(DEFAULT_PATTERN, DatePatternConverter.newInstance(null).getPattern());","152","    }","153","","154","    @Test","155","    public void testGetPatternReturnsDefaultForEmptyOptionsArray() {","156","        assertEquals(DEFAULT_PATTERN, DatePatternConverter.newInstance(new String[0]).getPattern());","157","    }","158","","159","    @Test","160","    public void testGetPatternReturnsDefaultForSingleNullElementOptionsArray() {","161","        assertEquals(DEFAULT_PATTERN, DatePatternConverter.newInstance(new String[1]).getPattern());","162","    }","163","","164","    @Test","165","    public void testGetPatternReturnsDefaultForTwoNullElementsOptionsArray() {","166","        assertEquals(DEFAULT_PATTERN, DatePatternConverter.newInstance(new String[2]).getPattern());","167","    }","168","","169","    @Test","170","    public void testGetPatternReturnsDefaultForInvalidPattern() {","171","        final String[] invalid = { \"ABC I am not a valid date pattern\" };","172","        assertEquals(DEFAULT_PATTERN, DatePatternConverter.newInstance(invalid).getPattern());","173","    }","174","","175","    @Test","176","    public void testGetPatternReturnsNullForUnix() {","177","        final String[] options = { \"UNIX\" };","178","        assertNull(DatePatternConverter.newInstance(options).getPattern());","179","    }","180","","181","    @Test","182","    public void testGetPatternReturnsNullForUnixMillis() {","183","        final String[] options = { \"UNIX_MILLIS\" };","184","        assertNull(DatePatternConverter.newInstance(options).getPattern());"],"delete":["29","    private static final String[] ISO8601_FORMAT = { DatePatternConverter.ISO8601_FORMAT };","50","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT);","92","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT);","112","        final DatePatternConverter converter = DatePatternConverter.newInstance(ISO8601_FORMAT);","128","    public void testGetPatternReturnsCorrectDefault() {","129","        assertEquals(DatePatternConverter.DEFAULT_PATTERN, DatePatternConverter.newInstance(null).getPattern());"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-812\" dev=\"rgoers\" type=\"update\">","34","        PatternLayout timestamp formatting performance improvement: replaced synchronized SimpleDateFormat with","35","        Apache Commons FastDateFormat. This and better caching resulted in a ~3-30X faster timestamp formatting.","36","      <\/action>","37","      <action issue=\"LOG4J2-1097\" dev=\"rpopma\" type=\"update\">","38","        PatternLayout timestamp formatting performance improvement: predefined date formats (and variants using","39","        a period '.' millisecond separator instead of ',') are now formatted ~2-10X faster than other date formats.","40","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":[{"add":["19","import java.util.Objects;","26","import org.apache.logging.log4j.core.util.datetime.FixedDateFormat;","27","import org.apache.logging.log4j.core.util.datetime.FixedDateFormat.FixedFormat;","36","    private final class CachedTime {","40","        public CachedTime(final long timestampMillis) {","46","    private final AtomicReference<CachedTime> cachedTime;","74","    private static final class FixedFormatter extends Formatter {","75","        private final FixedDateFormat fixedDateFormat;","76","","77","        FixedFormatter(final FixedDateFormat fixedDateFormat) {","78","            this.fixedDateFormat = fixedDateFormat;","79","        }","80","","81","        @Override","82","        String format(final long timeMillis) {","83","            return fixedDateFormat.format(timeMillis);","84","        }","85","","86","        @Override","87","        public String toPattern() {","88","            return fixedDateFormat.getFormat();","89","        }","90","    }","91","","140","        final FixedDateFormat fixedDateFormat = FixedDateFormat.createIfSupported(options);","141","        if (fixedDateFormat != null) {","142","            formatter = createFormatter(fixedDateFormat);","144","            formatter = createFormatter(options);","145","        }","146","        cachedTime = new AtomicReference<>(new CachedTime(System.currentTimeMillis()));","147","    }","148","","149","    private static Formatter createFormatter(final FixedDateFormat fixedDateFormat) {","150","        return new FixedFormatter(fixedDateFormat);","151","    }","152","","153","    private static Formatter createFormatter(final String[] options) {","154","        \/\/ if we get here, options is a non-null array with at least one element (first of which non-null)","155","        Objects.requireNonNull(options);","156","        if (options.length == 0) {","157","            throw new IllegalArgumentException(\"options array must have at least one element\");","158","        }","159","        Objects.requireNonNull(options[0]);","160","        final String patternOption = options[0];","161","        if (UNIX_FORMAT.equals(patternOption)) {","162","            return new UnixFormatter();","163","        }","164","        if (UNIX_MILLIS_FORMAT.equals(patternOption)) {","165","            return new UnixMillisFormatter();","168","        \/\/ if the option list contains a TZ option, then set it.","169","        TimeZone tz = null;","170","        if (options != null && options.length > 1) {","171","            tz = TimeZone.getTimeZone(options[1]);","173","","174","        try {","175","            final FastDateFormat tempFormat = FastDateFormat.getInstance(patternOption, tz);","176","            return new PatternFormatter(tempFormat);","177","        } catch (final IllegalArgumentException e) {","178","            LOGGER.warn(\"Could not instantiate FastDateFormat with pattern \" + patternOption, e);","179","","180","            \/\/ default to the DEFAULT format","181","            return createFormatter(FixedDateFormat.create(FixedFormat.DEFAULT));","182","        }","194","        format(date.getTime(), toAppendTo);","202","        format(event.getTimeMillis(), output);","203","    }","204","    ","205","    public void format(final long timestampMillis, final StringBuilder output) {","206","        CachedTime cached = cachedTime.get();","207","        if (timestampMillis != cached.timestampMillis) {","208","            final CachedTime newTime = new CachedTime(timestampMillis);","209","            if (cachedTime.compareAndSet(cached, newTime)) {","210","                cached = newTime;","212","                cached = cachedTime.get();","215","        output.append(cached.formatted);"],"delete":["33","    private final class CurrentTime {","37","        public CurrentTime(final long timestampMillis) {","43","    private final AtomicReference<CurrentTime> currentTime;","77","","86","","90","     * ABSOLUTE string literal.","91","     *\/","92","    private static final String ABSOLUTE_FORMAT = \"ABSOLUTE\";","93","","94","    \/**","95","     * SimpleTimePattern for ABSOLUTE.","96","     *\/","97","    private static final String ABSOLUTE_TIME_PATTERN = \"HH:mm:ss,SSS\";","98","","99","    \/**","100","     * COMPACT string literal.","101","     *\/","102","    private static final String COMPACT_FORMAT = \"COMPACT\";","103","","104","    \/**","105","     * SimpleTimePattern for COMPACT.","106","     *\/","107","    private static final String COMPACT_PATTERN = \"yyyyMMddHHmmssSSS\";","108","","109","    \/**","110","     * DATE string literal.","111","     *\/","112","    private static final String DATE_AND_TIME_FORMAT = \"DATE\";","113","","114","    \/**","115","     * SimpleTimePattern for DATE.","116","     *\/","117","    private static final String DATE_AND_TIME_PATTERN = \"dd MMM yyyy HH:mm:ss,SSS\";","118","","119","    \/**","120","     * DEFAULT string literal.","121","     *\/","122","    private static final String DEFAULT_FORMAT = \"DEFAULT\";","123","","124","    \/**","125","     * SimpleTimePattern for DEFAULT.","126","     *\/","127","    \/\/ package private for unit tests","128","    static final String DEFAULT_PATTERN = \"yyyy-MM-dd HH:mm:ss,SSS\";","129","","130","    \/**","131","     * ISO8601_BASIC string literal.","132","     *\/","133","    private static final String ISO8601_BASIC_FORMAT = \"ISO8601_BASIC\";","134","","135","    \/**","136","     * SimpleTimePattern for ISO8601_BASIC.","137","     *\/","138","    private static final String ISO8601_BASIC_PATTERN = \"yyyyMMdd'T'HHmmss,SSS\";","139","","140","    \/**","141","     * ISO8601 string literal.","142","     *\/","143","    \/\/ package private for unit tests","144","    static final String ISO8601_FORMAT = \"ISO8601\";","145","","146","    \/**","147","     * SimpleTimePattern for ISO8601.","148","     *\/","149","    \/\/ package private for unit tests","150","    static final String ISO8601_PATTERN = \"yyyy-MM-dd'T'HH:mm:ss,SSS\";","151","","152","    \/**","184","        \/\/ null patternOption is OK.","185","        final String patternOption = options != null && options.length > 0 ? options[0] : null;","186","","187","        String pattern = null;","188","        Formatter tempFormatter = null;","189","","190","        if (patternOption == null || patternOption.equalsIgnoreCase(DEFAULT_FORMAT)) {","191","            pattern = DEFAULT_PATTERN;","192","        } else if (patternOption.equalsIgnoreCase(ISO8601_FORMAT)) {","193","            pattern = ISO8601_PATTERN;","194","        } else if (patternOption.equalsIgnoreCase(ISO8601_BASIC_FORMAT)) {","195","            pattern = ISO8601_BASIC_PATTERN;","196","        } else if (patternOption.equalsIgnoreCase(ABSOLUTE_FORMAT)) {","197","            pattern = ABSOLUTE_TIME_PATTERN;","198","        } else if (patternOption.equalsIgnoreCase(DATE_AND_TIME_FORMAT)) {","199","            pattern = DATE_AND_TIME_PATTERN;","200","        } else if (patternOption.equalsIgnoreCase(COMPACT_FORMAT)) {","201","            pattern = COMPACT_PATTERN;","202","        } else if (patternOption.equalsIgnoreCase(UNIX_FORMAT)) {","203","            tempFormatter = new UnixFormatter();","204","        } else if (patternOption.equalsIgnoreCase(UNIX_MILLIS_FORMAT)) {","205","            tempFormatter = new UnixMillisFormatter();","207","            pattern = patternOption;","210","        if (pattern != null) {","211","            FastDateFormat tempFormat;","212","","213","            TimeZone tz = null;","214","","215","            \/\/ if the option list contains a TZ option, then set it.","216","            if (options != null && options.length > 1) {","217","                tz = TimeZone.getTimeZone(options[1]);","218","            }","219","","220","            try {","221","                tempFormat = FastDateFormat.getInstance(pattern, tz);","222","            } catch (final IllegalArgumentException e) {","223","                LOGGER.warn(\"Could not instantiate FastDateFormat with pattern \" + patternOption, e);","224","","225","                \/\/ default to the DEFAULT format","226","                tempFormat = FastDateFormat.getInstance(DEFAULT_PATTERN);","227","            }","228","","229","","230","            tempFormatter = new PatternFormatter(tempFormat);","232","        formatter = tempFormatter;","233","        currentTime = new AtomicReference<>(new CurrentTime(System.currentTimeMillis()));","245","            toAppendTo.append(formatter.format(date.getTime()));","253","        final long timestampMillis = event.getTimeMillis();","254","        CurrentTime current = currentTime.get();","255","        if (timestampMillis != current.timestampMillis) {","256","            final CurrentTime newTime = new CurrentTime(timestampMillis);","257","            if (currentTime.compareAndSet(current, newTime)) {","258","                current = newTime;","260","                current = currentTime.get();","263","","264","        output.append(current.formatted);"]}]}},"0b37ee7466284d6a012a092f7284d15c53b75803":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-random-direct.xml":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAppenderDirectWriteTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingRandomAccessFileAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAccessFileManager.java":[{"add":["107","        final String name = fileName == null ? filePattern : fileName;","108","        return narrow(RollingRandomAccessFileManager.class, getManager(name, new FactoryData(fileName, filePattern, isAppend,","131","            if (randomAccessFile == null) {","132","                String fileName = getFileName();","133","                File file = new File(fileName);","134","                FileUtils.makeParentDirs(file);","135","                createFileAfterRollover(fileName);","136","            }","147","        createFileAfterRollover(getFileName());","148","    }","149","","150","    private void createFileAfterRollover(String fileName) throws IOException {","151","        this.randomAccessFile = new RandomAccessFile(fileName, \"rw\");","200","            File file = null;","201","            long size = 0;","202","            long time = System.currentTimeMillis();","204","            if (data.fileName != null) {","205","                file = new File(name);","206","","207","                if (!data.append) {","208","                    file.delete();","210","                size = data.append ? file.length() : 0;","211","                if (file.exists()) {","212","                    time = file.lastModified();","214","                try {","215","                    FileUtils.makeParentDirs(file);","216","                    raf = new RandomAccessFile(name, \"rw\");","217","                    if (data.append) {","218","                        final long length = raf.length();","219","                        LOGGER.trace(\"RandomAccessFile {} seek to {}\", name, length);","220","                        raf.seek(length);","221","                    } else {","222","                        LOGGER.trace(\"RandomAccessFile {} set length to 0\", name);","223","                        raf.setLength(0);","225","                } catch (final IOException ex) {","226","                    LOGGER.error(\"Cannot access RandomAccessFile \" + ex, ex);","227","                    if (raf != null) {","228","                        try {","229","                            raf.close();","230","                        } catch (final IOException e) {","231","                            LOGGER.error(\"Cannot close RandomAccessFile {}\", name, e);","232","                        }","233","                    }","234","                    return null;","237","            final boolean writeHeader = !data.append || file == null || !file.exists();","238","","239","            final RollingRandomAccessFileManager rrm = new RollingRandomAccessFileManager(data.getLoggerContext(), raf, name, data.pattern,","240","                    NullOutputStream.getInstance(), data.append, data.immediateFlush, data.bufferSize, size, time, data.policy,","241","                    data.strategy, data.advertiseURI, data.layout, data.filePermissions, data.fileOwner, data.fileGroup, writeHeader);","242","            if (rrm.isAttributeViewEnabled()) {","243","                rrm.defineAttributeView(file.toPath());","244","            }","245","            return rrm;","253","        private final String fileName;","269","         * @param fileName The file name.","283","        public FactoryData(final String fileName, final String pattern, final boolean append, final boolean immediateFlush,","289","            this.fileName = fileName;"],"delete":["107","        return narrow(RollingRandomAccessFileManager.class, getManager(fileName, new FactoryData(filePattern, isAppend,","140","        this.randomAccessFile = new RandomAccessFile(getFileName(), \"rw\");","189","            final File file = new File(name);","190","","191","            if (!data.append) {","192","                file.delete();","193","            }","194","            final long size = data.append ? file.length() : 0;","195","            final long time = file.exists() ? file.lastModified() : System.currentTimeMillis();","196","","197","            final boolean writeHeader = !data.append || !file.exists();","199","            try {","200","                FileUtils.makeParentDirs(file);","201","                raf = new RandomAccessFile(name, \"rw\");","202","                if (data.append) {","203","                    final long length = raf.length();","204","                    LOGGER.trace(\"RandomAccessFile {} seek to {}\", name, length);","205","                    raf.seek(length);","206","                } else {","207","                    LOGGER.trace(\"RandomAccessFile {} set length to 0\", name);","208","                    raf.setLength(0);","210","                final RollingRandomAccessFileManager rrm = new RollingRandomAccessFileManager(data.getLoggerContext(), raf, name, data.pattern,","211","                        NullOutputStream.getInstance(), data.append, data.immediateFlush, data.bufferSize, size, time, data.policy,","212","                        data.strategy, data.advertiseURI, data.layout, data.filePermissions, data.fileOwner, data.fileGroup, writeHeader);","213","                if (rrm.isAttributeViewEnabled()) {","214","                    rrm.defineAttributeView(file.toPath());","216","                return rrm;","217","            } catch (final IOException ex) {","218","                LOGGER.error(\"Cannot access RandomAccessFile \" + ex, ex);","219","                if (raf != null) {","220","                    try {","221","                        raf.close();","222","                    } catch (final IOException e) {","223","                        LOGGER.error(\"Cannot close RandomAccessFile {}\", name, e);","227","            return null;","263","        public FactoryData(final String pattern, final boolean append, final boolean immediateFlush,"]}],"log4j-core\/src\/test\/resources\/log4j-rolling-random-direct.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1928\" dev=\"rgoers\" type=\"update\">","34","        Add support for DirectWriteRolloverStrategy to RollingRandomAcessFileAppender.","35","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingRandomAppenderDirectWriteTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/RollingRandomAccessFileAppender.java":[{"add":["30","import org.apache.logging.log4j.core.appender.rolling.DirectFileRolloverStrategy;","31","import org.apache.logging.log4j.core.appender.rolling.DirectWriteRolloverStrategy;","99","            if (strategy == null) {","100","                if (fileName != null) {","101","                    strategy = DefaultRolloverStrategy.newBuilder()","102","                            .withCompressionLevelStr(String.valueOf(Deflater.DEFAULT_COMPRESSION))","103","                            .withConfig(getConfiguration())","104","                            .build();","105","                } else {","106","                    strategy = DirectWriteRolloverStrategy.newBuilder()","107","                            .withCompressionLevelStr(String.valueOf(Deflater.DEFAULT_COMPRESSION))","108","                            .withConfig(getConfiguration())","109","                            .build();","110","                }","111","            } else if (fileName == null && !(strategy instanceof DirectFileRolloverStrategy)) {","112","                LOGGER.error(\"RollingFileAppender '{}': When no file name is provided a DirectFilenameRolloverStrategy must be configured\");"],"delete":["97","            if (fileName == null) {","98","                LOGGER.error(\"No filename was provided for FileAppender with name \" + name);","112","            if (strategy == null) {","113","                strategy = DefaultRolloverStrategy.newBuilder()","114","                                .withCompressionLevelStr(String.valueOf(Deflater.DEFAULT_COMPRESSION))","115","                                .withConfig(getConfiguration())","116","                                .build();","117","            }","118",""]}]}},"be4165ecf99bd30518ed847b18c2b70d4b3f3b7f":{"changes":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY"},"diff":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":[{"add":["167","    \/**","168","     * Tests setPriority(Priority).","169","     *","170","     * @deprecated","171","     *\/","172","    @Deprecated","173","    @Test","174","    public void testSetPriorityNull() {","175","        Logger.getLogger(\"org.example.foo\").setPriority(null);","176","    }","177",""],"delete":[]}],"src\/changes\/changes.xml":[{"add":["95","      <action issue=\"LOG4J2-3095\" dev=\"ggregory\" type=\"fix\" due-to=\"Kenny MacLeod, Gary Gregory\">","96","        Category.setLevel should accept null value.","97","      <\/action>"],"delete":[]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["226","    private String getLevelStr(final Priority priority) {","227","        return priority == null ? null : priority.levelStr;","228","    }","229","","231","        setLevel(getLevelStr(level));","239","        setLevel(getLevelStr(priority));"],"delete":["227","        setLevel(level.levelStr);","235","        setLevel(priority.levelStr);"]}]}},"dff84c2868dfc7f4bf573962689c535565d89804":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SmtpAppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SmtpAppenderTest.java":[{"add":["122","                .setSubject(\"Subject Pattern %X{\" + subjectKey + \"} %maxLen{%m}{10}\")","155","        assertEquals(\"Subject Pattern \" + subjectValue +\" Error with\", email.getHeaderValue(\"Subject\"));","168","","169","        assertEquals(\"Subject Pattern \" + subjectValue +\" Error mess\", email2.getHeaderValue(\"Subject\"));","170",""],"delete":["122","                .setSubject(\"Subject Pattern %X{\" + subjectKey + \"}\")","155","        final String headerValue = email.getHeaderValue(\"Subject\");","156","        assertEquals(headerValue, \"Subject Pattern \" + subjectValue);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SmtpManager.java":[{"add":["186","            final String subject = data.subject.toSerializable(appendEvent);","187","","188","            sendMultipartMessage(message, mp, subject);","273","    \/**","274","     * @deprecated Please use the {@link #sendMultipartMessage(MimeMessage, MimeMultipart, String)} method instead.","275","     *\/","276","    @Deprecated","285","    protected void sendMultipartMessage(final MimeMessage msg, final MimeMultipart mp, final String subject) throws MessagingException {","286","        synchronized (msg) {","287","            msg.setContent(mp);","288","            msg.setSentDate(new Date());","289","            msg.setSubject(subject);","290","            Transport.send(msg);","291","        }","292","    }","293",""],"delete":["186","            sendMultipartMessage(message, mp);"]}],"src\/changes\/changes.xml":[{"add":["180","      <action issue=\"LOG4J2-3174\" dev=\"vy\" type=\"fix\" due-to=\"romainmoreau\">","181","        Wrong subject on mail when it depends on the LogEvent","182","      <\/action>"],"delete":[]}]}},"843ca800ba60464059a22e9e12edcaf5ecd92d95":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/DefaultErrorHandler.java":[{"add":["73","        if (allowed) {","74","            LOGGER.error(msg, error);","75","        }","76","        if (!appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","91","        if (allowed) {","92","            LOGGER.error(msg, error);","93","        }","94","        if (!appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {"],"delete":["73","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {","88","        if (allowed && !appender.ignoreExceptions() && error != null && !(error instanceof AppenderLoggingException)) {"]}]}},"e0d9aa76b8b960f97577e6dffb923cf1376e95ff":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["140","      <action issue=\"LOG4J2-1723\" dev=\"ggregory\" type=\"fix\" due-to=\"Ludovic HOCHET\">","141","        Unwanted transitive dependency on geronimo-jms_1.1_spec causes OSGi tests to fail.","142","      <\/action>"],"delete":[]}],"log4j-core\/pom.xml":[{"add":["236","      <exclusions>","237","        <exclusion>","238","          <groupId>org.apache.geronimo.specs<\/groupId>","239","          <artifactId>geronimo-jms_1.1_spec<\/artifactId>","240","        <\/exclusion>","241","      <\/exclusions>    "],"delete":[]}]}},"177a85708535cad6a3e0af9468f323135cc91fbd":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["618","                \/\/ LOG4J2-2808 don't block unless necessary","619","                map.computeIfAbsent(\"hostName\", s -> NetUtils.getLocalHostname());"],"delete":["618","                map.putIfAbsent(\"hostName\", NetUtils.getLocalHostname());"]}],"src\/changes\/changes.xml":[{"add":["97","      <action issue=\"LOG4J2-2808\" dev=\"ckozak\" type=\"fix\" due-to=\"Asapha Halifa\">","98","        LoggerContext skips resolving localhost when hostName is configured.","99","      <\/action>"],"delete":[]}]}},"00323c993db37f1b2ff2b6c90f43f8f58da80c40":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["275","            LOGGER.warn(\"Unable to instantiate {} due to {}\", JANSI_CLASS, Throwables.getRootCause(ex).toString().trim());"],"delete":["275","            LOGGER.warn(\"Unable to instantiate {} due to {}\", JANSI_CLASS, Throwables.getRootCause(ex));"]}]}},"5b4f3db4f5e7b24862c147b790806bca0b2d1892":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/CompositeConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/composite\/CompositeConfiguration.java":[{"add":["153","            if (sourceURI == null) {"],"delete":["153","            if (sourceURI != null) {"]}],"src\/changes\/changes.xml":[{"add":["87","      <action issue=\"LOG4J2-1912\" dev=\"ggregory\" type=\"fix\" due-to=\"R Ri\">","88","        CompositeConfiguration logs warning \"Unable to determine URI for configuration.\" However, the reconfiguration is completed.","89","      <\/action>"],"delete":[]}]}},"551ae399a1cb468cc662d64bf38434a4fe781f08":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessorTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest2.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessorTest.java":[{"add":["200","        final PatternProcessor pp = new PatternProcessor(\"c:\\\\test\\\\new\/app-%d{HH-mm-ss}.log\");","201","        final Calendar cal = Calendar.getInstance();","202","        cal.set(Calendar.HOUR_OF_DAY, 16);","203","        cal.set(Calendar.MINUTE, 02);","204","        cal.set(Calendar.SECOND, 15);","205","","207","        pp.formatFileName(buf, cal.getTime(), 23);"],"delete":["200","        final PatternProcessor pp = new PatternProcessor(\"c:\\\\test\\\\new\/app-%d{HH-mm-ss}{GMT+0}.log\");","202","        final Date date = new Date(1411142535260L); \/\/ Sat Sep 20 01:02:15 JST 2014","203","        pp.formatFileName(buf, date, 23);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest2.java":[{"add":["19","import java.util.Calendar;","36","        final String pattern = \"%d{HH-mm-ss} \\\\t ...\";","38","        final Calendar cal = Calendar.getInstance();","39","        cal.set(Calendar.HOUR_OF_DAY, 23);","40","        cal.set(Calendar.MINUTE, 53);","41","        cal.set(Calendar.SECOND, 01);","42","        parse(pattern, convert, buf, cal.getTime(), 123);","44","        assertEquals(\"23-53-01 \\t ...\", buf.toString());","51","        final String pattern = \"%d{HH-mm-ss} \\\\t---\";","53","        final Calendar cal = Calendar.getInstance();","54","        cal.set(Calendar.HOUR_OF_DAY, 13);","55","        cal.set(Calendar.MINUTE, 24);","56","        cal.set(Calendar.SECOND, 59);","57","        parse(pattern, convert, buf, cal.getTime(), new Integer(3));","59","        assertEquals(\"13-24-59 \\\\t---\", buf.toString());"],"delete":["35","        final String pattern = \"%d{HHmmss}{GMT+0} \\\\t ...\";","37","        final Date date = new Date(1411142535260L); \/\/ Sat Sep 20 01:02:15 JST 2014","38","        parse(pattern, convert, buf, date, 123);","40","        assertEquals(\"160215 \\t ...\", buf.toString());","47","        final String pattern = \"%d{HHmmss}{GMT+0} \\\\t---\";","49","        final Date date = new Date(1411142535260L); \/\/ Sat Sep 20 01:02:15 JST 2014","50","        parse(pattern, convert, buf, date, new Integer(3));","52","        assertEquals(\"160215 \\\\t---\", buf.toString());"]}]}},"f05b1aa192336236189d03fa7abc6b9335f53054":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/CsvParameterLayout.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["94","      <action issue=\"LOG4J2-2085\" dev=\"ggregory\" type=\"fix\" due-to=\"Istv¨¢n Neuwirth\">","95","        Wrong Apache Commons CSV version referenced in the Javadoc of CsvParameterLayout.","96","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/CsvParameterLayout.java":[{"add":["45"," * Depends on Apache Commons CSV 1.4."],"delete":["45"," * Depends on Apache Commons CSV 1.2."]}]}},"6cd8112119090b175a96a13a50372d527c944e00":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["2039","        <KeyValuePair key=\"INFO\" value=\"DEBUG\"\/>","2040","        <KeyValuePair key=\"WARN\" value=\"INFO\"\/>"],"delete":["2039","        <LevelPair key=\"INFO\" value=\"DEBUG\"\/>","2040","        <LevelPair key=\"WARN\" value=\"INFO\"\/>"]}],"src\/changes\/changes.xml":[{"add":["107","      <action issue=\"LOG4J2-1194\" dev=\"ggregory\" type=\"fix\" due-to=\"Adam Brin\">","108","        Documentation does not match parameters for LoggerNameLevelRewritePolicy.","109","      <\/action>"],"delete":[]}]}},"f408220999e079f8f3994684e84953987be68d6c":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationFactory.java":[{"add":["392","                    \"Using default configuration (logging only errors to the console), \" +","393","                    \"or user programmatically provided configurations. \" +"],"delete":["392","                    \"Using default configuration: logging only errors to the console. \" +"]}]}},"41d1261071a6694dc337b76c73aed5119213f16b":{"changes":{"src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["1858","    <td>true<\/td>"],"delete":["1858","    <td>false<\/td>"]}]}},"687bd523e3efe0c1b7d65a65a9abd995f9083ad4":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/FormattedMessage.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/FormattedMessageTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/FormattedMessage.java":[{"add":["258","            final String string = String.valueOf(obj);","259","            stringArgs[i] = string;","260","            out.writeUTF(string);"],"delete":["258","            stringArgs[i] = obj.toString();"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/FormattedMessageTest.java":[{"add":["18","import java.io.ByteArrayInputStream;","19","import java.io.ByteArrayOutputStream;","20","import java.io.IOException;","21","import java.io.ObjectInputStream;","22","import java.io.ObjectOutputStream;","23","import java.util.Locale;","24","","27","import org.junit.Assert;","30","import static org.junit.Assert.assertEquals;","158","","159","    @Test","160","    public void testSerialization() throws IOException, ClassNotFoundException {","161","        final FormattedMessage expected = new FormattedMessage(\"Msg\", \"a\", \"b\", \"c\");","162","        final ByteArrayOutputStream baos = new ByteArrayOutputStream();","163","        try (final ObjectOutputStream out = new ObjectOutputStream(baos)) {","164","            out.writeObject(expected);","165","        }","166","        final ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());","167","        final ObjectInputStream in = new ObjectInputStream(bais);","168","        final FormattedMessage actual = (FormattedMessage) in.readObject();","169","        Assert.assertEquals(expected, actual);","170","        Assert.assertEquals(expected.getFormat(), actual.getFormat());","171","        Assert.assertEquals(expected.getFormattedMessage(), actual.getFormattedMessage());","172","        Assert.assertArrayEquals(expected.getParameters(), actual.getParameters());","173","    }"],"delete":["22","import static org.junit.Assert.*;","23","","24","import java.util.Locale;"]}],"src\/changes\/changes.xml":[{"add":["36","      <action issue=\"LOG4J2-1929\" dev=\"ggregory\" type=\"fix\" due-to=\"Borys Sokolov\">","37","        EOFException with FormattedMessage.","38","      <\/action>"],"delete":[]}]}},"8998d6f715425bbdbc2c10d776f7a221de66e936":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["103","      <action issue=\"LOG4J2-3172\" dev=\"vy\" type=\"fix\" due-to=\"Barry Fleming\">","104","        Buffer immutable log events in the SmtpManager.","105","      <\/action>"],"delete":[]}]}},"717da184deee3c97051e14e53d138b918fe07d7b":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["171","        Update Jackson from 2.8.3 to 2.8.4.","172","      <\/action>","173","      <action issue=\"LOG4J2-1735\" dev=\"ggregory\" type=\"update\">","174","        Update Jackson from 2.8.4 to 2.8.5."],"delete":["171","        Updated Jackson from 2.8.3 to 2.8.4."]}],"pom.xml":[{"add":["192","    <jackson2Version>2.8.5<\/jackson2Version>"],"delete":["192","    <jackson2Version>2.8.4<\/jackson2Version>"]}]}},"0e74e32675b49b4dbb88440685809d0f03d91c87":{"changes":{"log4j-core\/src\/test\/resources\/gcFreeLogging.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/TimeFilterTest.java":"MODIFY","log4j-core\/src\/test\/resources\/gcFreeMixedSyncAsyncLogging.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/garbagefree.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/TimeFilter.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/resources\/gcFreeLogging.xml":[{"add":["20","    <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","27","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","34","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","43","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->"],"delete":["20","    <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","27","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","34","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","43","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/TimeFilterTest.java":[{"add":["18","import java.time.LocalDate;","19","import java.time.LocalTime;","20","import java.time.ZoneId;","21","import java.time.ZonedDateTime;","28","","63","    public void springForward() {","64","        final TimeFilter filter = new TimeFilter(LocalTime.of(2,0), LocalTime.of(3,0),","65","                ZoneId.of(\"America\/Los_Angeles\"), null, null, LocalDate.of(2020, 3, 8));","68","        ZonedDateTime date = ZonedDateTime.of(2020, 3, 8, 2, 6, 30, 0, ZoneId.of(\"America\/Los_Angeles\"));","69","        CLOCKTIME = date.toInstant().toEpochMilli();","70","        LogEvent event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","71","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","72","        date = date.plusDays(1).withHour(2);","73","        CLOCKTIME = date.toInstant().toEpochMilli();","74","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","75","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","76","        date = date.withHour(4);","77","        CLOCKTIME = date.toInstant().toEpochMilli();","78","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","79","        assertSame(Filter.Result.DENY, filter.filter(event));","80","    }","81","","82","","83","    @Test","84","    public void fallBack() {","85","        final TimeFilter filter = new TimeFilter(LocalTime.of(1,0), LocalTime.of(2,0),","86","                ZoneId.of(\"America\/Los_Angeles\"), null, null, LocalDate.of(2020, 11, 1));","87","        filter.start();","88","        assertTrue(filter.isStarted());","89","        ZonedDateTime date = ZonedDateTime.of(2020, 11, 1, 1, 6, 30, 0, ZoneId.of(\"America\/Los_Angeles\")).withEarlierOffsetAtOverlap();","90","        CLOCKTIME = date.toInstant().toEpochMilli();","91","        LogEvent event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","92","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","93","        date = ZonedDateTime.of(2020, 11, 1, 1, 6, 30, 0, ZoneId.of(\"America\/Los_Angeles\")).withLaterOffsetAtOverlap();","94","        CLOCKTIME = date.toInstant().toEpochMilli();","95","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","96","        assertSame(Filter.Result.DENY, filter.filter(event));","97","        date = date.plusDays(1).withHour(1).withMinute(30);","98","        CLOCKTIME = date.toInstant().toEpochMilli();","99","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","100","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","101","        date = date.withHour(4);","102","        CLOCKTIME = date.toInstant().toEpochMilli();","103","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","104","        assertSame(Filter.Result.DENY, filter.filter(event));","105","    }","106","","107","","108","    @Test","109","    public void overnight() {","110","        final TimeFilter filter = new TimeFilter(LocalTime.of(23,0), LocalTime.of(1,0),","111","                ZoneId.of(\"America\/Los_Angeles\"), null, null, LocalDate.of(2020, 3, 10));","112","        filter.start();","113","        assertTrue(filter.isStarted());","114","        ZonedDateTime date = ZonedDateTime.of(2020, 3, 10, 23, 30, 30, 0, ZoneId.of(\"America\/Los_Angeles\")).withEarlierOffsetAtOverlap();","115","        CLOCKTIME = date.toInstant().toEpochMilli();","116","        LogEvent event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","117","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","118","        date = date.plusHours(1);","119","        CLOCKTIME = date.toInstant().toEpochMilli();","120","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","121","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","122","        date = date.plusHours(1);","123","        CLOCKTIME = date.toInstant().toEpochMilli();","124","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","125","        assertSame(Filter.Result.DENY, filter.filter(event));","126","        date = date.plusDays(1).withHour(0);","127","        CLOCKTIME = date.toInstant().toEpochMilli();","128","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","129","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","130","    }","131","","132","    @Test","133","    public void overnightForward() {","134","        final TimeFilter filter = new TimeFilter(LocalTime.of(23,0), LocalTime.of(2,0),","135","                ZoneId.of(\"America\/Los_Angeles\"), null, null, LocalDate.of(2020, 3, 7));","136","        filter.start();","137","        assertTrue(filter.isStarted());","138","        ZonedDateTime date = ZonedDateTime.of(2020, 3, 7, 23, 30, 30, 0, ZoneId.of(\"America\/Los_Angeles\")).withEarlierOffsetAtOverlap();","139","        CLOCKTIME = date.toInstant().toEpochMilli();","140","        LogEvent event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","141","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","142","        date = date.plusHours(1);","143","        CLOCKTIME = date.toInstant().toEpochMilli();","144","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","145","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","146","        date = date.plusHours(2);","147","        CLOCKTIME = date.toInstant().toEpochMilli();","148","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","149","        assertSame(Filter.Result.DENY, filter.filter(event));","150","        date = date.plusDays(1).withHour(0);","151","        CLOCKTIME = date.toInstant().toEpochMilli();","152","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","153","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","154","    }","155","","156","","157","    @Test","158","    public void overnightFallback() {","159","        final TimeFilter filter = new TimeFilter(LocalTime.of(23,0), LocalTime.of(2,0),","160","                ZoneId.of(\"America\/Los_Angeles\"), null, null, LocalDate.of(2020, 10, 31));","161","        filter.start();","162","        assertTrue(filter.isStarted());","163","        ZonedDateTime date = ZonedDateTime.of(2020, 10, 31, 23, 30, 30, 0, ZoneId.of(\"America\/Los_Angeles\")).withEarlierOffsetAtOverlap();","164","        CLOCKTIME = date.toInstant().toEpochMilli();","165","        LogEvent event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","166","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","167","        date = date.plusHours(1);","168","        CLOCKTIME = date.toInstant().toEpochMilli();","169","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","170","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","171","        date = date.plusHours(2);","172","        CLOCKTIME = date.toInstant().toEpochMilli();","173","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","174","        assertSame(Filter.Result.DENY, filter.filter(event));","175","        date = date.plusDays(1).withHour(0);","176","        CLOCKTIME = date.toInstant().toEpochMilli();","177","        event = Log4jLogEvent.newBuilder().setTimeMillis(CLOCKTIME).build();","178","        assertSame(Filter.Result.NEUTRAL, filter.filter(event));","179","    }","180","","181","    @Test","182","    public void testTime() {","183","        \/\/ https:\/\/garygregory.wordpress.com\/2013\/06\/18\/what-are-the-java-timezone-ids\/","184","        final TimeFilter filter = TimeFilter.createFilter(\"02:00:00\", \"03:00:00\", \"America\/Los_Angeles\", null, null);","185","        filter.start();","186","        assertTrue(filter.isStarted());","187","        final Calendar cal = Calendar.getInstance(TimeZone.getTimeZone(\"America\/Los_Angeles\"));","191","        \/\/assertSame(Filter.Result.NEUTRAL, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));","195","        cal.set(Calendar.HOUR_OF_DAY, 2);","199","        \/\/assertSame(Filter.Result.NEUTRAL, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));","204","        \/\/assertSame(Filter.Result.DENY, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));"],"delete":["21","import org.apache.logging.log4j.Level;","59","    public void testTime() {","60","        final TimeFilter filter = TimeFilter.createFilter(\"02:00:00\", \"03:00:00\", \"America\/LosAngeles\", null, null);","63","        final Calendar cal = Calendar.getInstance(TimeZone.getTimeZone(\"America\/LosAngeles\"));","67","        assertSame(Filter.Result.NEUTRAL, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));","74","        assertSame(Filter.Result.NEUTRAL, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));","79","        assertSame(Filter.Result.DENY, filter.filter(null, Level.ERROR, null, (Object) null, (Throwable) null));"]}],"log4j-core\/src\/test\/resources\/gcFreeMixedSyncAsyncLogging.xml":[{"add":["20","    <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","27","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","34","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->","43","      <!--<TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>-->"],"delete":["20","    <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","27","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","34","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>","43","      <TimeFilter start=\"05:00:00\" end=\"05:30:00\" onMatch=\"ACCEPT\" onMismatch=\"NEUTRAL\"\/>"]}],"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2805\" dev=\"rgoers\" type=\"fix\">","33","        TimeFilter did not handle daylight saving time transitions and did not support a range over 2 days.","34","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/garbagefree.xml":[{"add":["176","          <li>TimeFilter (garbage free since 2.8 except when range must be recalculated once per day)<\/li>"],"delete":["176","          <li>TimeFilter (garbage free since 2.8)<\/li>"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/TimeFilter.java":[{"add":["18","import java.time.Duration;","19","import java.time.Instant;","20","import java.time.LocalDate;","21","import java.time.LocalTime;","22","import java.time.ZoneId;","23","import java.time.ZonedDateTime;","24","import java.time.format.DateTimeFormatter;","47","    private static final DateTimeFormatter FORMATTER = DateTimeFormatter.ofPattern(\"HH:mm:ss\");","54","    private static final long DAY_MS = HOUR_MS * 24;","59","    private volatile long start;","60","    private final LocalTime startTime;","61","","65","    private volatile long end;","66","    private final LocalTime endTime;","67","","68","    private final long duration;","73","    private final ZoneId timeZone;","75","    \/*","76","     * Expose for unit testing.","77","     *\/","78","    TimeFilter(final LocalTime start, final LocalTime end, final ZoneId timeZone, final Result onMatch,","79","            final Result onMismatch, LocalDate now) {","81","        this.startTime = start;","82","        this.endTime = end;","84","        this.start = ZonedDateTime.of(now, startTime, timeZone).withEarlierOffsetAtOverlap().toInstant().toEpochMilli();","85","        long endMillis = ZonedDateTime.of(now, endTime, timeZone).withEarlierOffsetAtOverlap().toInstant().toEpochMilli();","86","        if (end.isBefore(start)) {","87","            \/\/ End time must be tomorrow.","88","            endMillis += DAY_MS;","89","        }","90","        duration = startTime.isBefore(endTime) ? Duration.between(startTime, endTime).toMillis() :","91","            Duration.between(startTime, endTime).plusHours(24).toMillis();","92","        long difference = (endMillis - this.start) - duration;","93","        if (difference != 0) {","94","            \/\/ Handle switch from standard time to daylight time and daylight time to standard time.","95","            endMillis -= difference;","96","        }","97","        this.end = endMillis;","100","    private TimeFilter(final LocalTime start, final LocalTime end, final ZoneId timeZone, final Result onMatch,","101","                       final Result onMismatch) {","102","        this(start, end, timeZone, onMatch, onMismatch, LocalDate.now());","103","    }","105","    private synchronized void adjustTimes(long currentTimeMillis) {","106","        if (currentTimeMillis <= end) {","107","            return;","108","        }","109","        LocalDate date = Instant.ofEpochMilli(currentTimeMillis).atZone(timeZone).toLocalDate();","110","        this.start = ZonedDateTime.of(date, startTime, timeZone).withEarlierOffsetAtOverlap().toInstant().toEpochMilli();","111","        long endMillis = ZonedDateTime.of(date, endTime, timeZone).withEarlierOffsetAtOverlap().toInstant().toEpochMilli();","112","        if (endTime.isBefore(startTime)) {","113","            \/\/ End time must be tomorrow.","114","            endMillis += DAY_MS;","115","        }","116","        long difference = (endMillis - this.start) - duration;","117","        if (difference != 0) {","118","            \/\/ Handle switch from standard time to daylight time and daylight time to standard time.","119","            endMillis -= difference;","120","        }","121","        this.end = endMillis;","132","        if (currentTimeMillis > end) {","133","            adjustTimes(currentTimeMillis);","135","        return currentTimeMillis >= start && currentTimeMillis <= end ? onMatch : onMismatch;","255","        final LocalTime startTime = parseTimestamp(start, LocalTime.MIN);","256","        final LocalTime endTime = parseTimestamp(end, LocalTime.MAX);","257","        final ZoneId timeZone = tz == null ? ZoneId.systemDefault() : ZoneId.of(tz);","260","        return new TimeFilter(startTime, endTime, timeZone, onMatch, onMismatch);","263","    private static LocalTime parseTimestamp(final String timestamp, final LocalTime defaultValue) {","267","","269","            return LocalTime.parse(timestamp, FORMATTER);","270","        } catch (final Exception e) {"],"delete":["18","import java.text.ParseException;","19","import java.text.SimpleDateFormat;","20","import java.util.Calendar;","21","import java.util.TimeZone;","50","    \/**","51","     * Length of minute in milliseconds.","52","     *\/","53","    private static final long MINUTE_MS = 60000;","54","","55","    \/**","56","     * Length of second in milliseconds.","57","     *\/","58","    private static final long SECOND_MS = 1000;","63","    private final long start;","64","    ","68","    private final long end;","73","    private final TimeZone timeZone;","75","    private long midnightToday;","76","    private long midnightTomorrow;","77","","78","","79","    private TimeFilter(final long start, final long end, final TimeZone timeZone, final Result onMatch,","80","                       final Result onMismatch) {","82","        this.start = start;","83","        this.end = end;","85","        initMidnight(start);","88","    \/**","89","     * Initializes the midnight boundaries to midnight in the specified time zone.","90","     * @param now a time in milliseconds since the epoch, used to pinpoint the current date","91","     *\/","92","    void initMidnight(final long now) {","93","        final Calendar calendar = Calendar.getInstance(timeZone);","94","        calendar.setTimeInMillis(now);","95","        calendar.set(Calendar.HOUR_OF_DAY, 0);","96","        calendar.set(Calendar.MINUTE, 0);","97","        calendar.set(Calendar.SECOND, 0);","98","        calendar.set(Calendar.MILLISECOND, 0);","99","        midnightToday = calendar.getTimeInMillis();","101","        calendar.add(Calendar.DATE, 1);","102","        midnightTomorrow = calendar.getTimeInMillis();","113","        if (currentTimeMillis >= midnightTomorrow || currentTimeMillis < midnightToday) {","114","            initMidnight(currentTimeMillis);","116","        return currentTimeMillis >= midnightToday + start && currentTimeMillis <= midnightToday + end \/\/","117","                ? onMatch \/\/ within window","118","                : onMismatch;","238","        final long s = parseTimestamp(start, 0);","239","        final long e = parseTimestamp(end, Long.MAX_VALUE);","240","        final TimeZone timeZone = tz == null ? TimeZone.getDefault() : TimeZone.getTimeZone(tz);","243","        return new TimeFilter(s, e, timeZone, onMatch, onMismatch);","246","    private static long parseTimestamp(final String timestamp, final long defaultValue) {","250","        final SimpleDateFormat stf = new SimpleDateFormat(\"HH:mm:ss\");","251","        stf.setTimeZone(TimeZone.getTimeZone(\"UTC\"));","253","            return stf.parse(timestamp).getTime();","254","        } catch (final ParseException e) {"]}]}},"4bc365db247618da5f911b2a4e725623923953d3":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["103","      <action issue=\"LOG4J2-3175\" dev=\"vy\" type=\"fix\" due-to=\"wuqian0808\">","104","        Avoid KafkaManager override when topics differ.","105","      <\/action>"],"delete":["5455","      <action issue=\"LOG4J2-2978\" dev=\"vy\" type=\"fix\" due-to=\"wuqian0808\">","5456","        Avoid KafkaManager override when topics differ.","5457","      <\/action>"]}]}},"3f45368597b8d47c4997963a4ecc5ae66f486a95":{"changes":{"Dockerfile":"MODIFY","src\/changes\/changes.xml":"MODIFY","toolchains-docker.xml":"ADD"},"diff":{"Dockerfile":[{"add":["15","# FROM openjdk:7-alpine","16","# Reverted to debian yet alpine does not include jdk9","17","FROM openjdk:7-jdk","18","","19","# Require while jdk9 is unstable on debian","20","RUN echo 'deb http:\/\/deb.debian.org\/debian unstable main' >> \/etc\/apt\/sources.list","24","    && apt-get update \\","25","    && apt-get install -y \\","26","       curl \\","27","       openjdk-9-jdk-headless \\","28","    && ln -svT \"\/usr\/lib\/jvm\/java-9-openjdk-$(dpkg --print-architecture)\" \/docker-java-9-home \\","30","    && curl -fsSL http:\/\/www-us.apache.org\/dist\/maven\/maven-3\/3.5.0\/binaries\/apache-maven-3.5.0-bin.tar.gz -o maven.tar.gz \\","33","","35","","38","    && \/opt\/apache-maven-3.5.0\/bin\/mvn verify --global-toolchains toolchains-docker.xml"],"delete":["15","FROM openjdk:7-alpine","19","    && apk update \\","20","    && apk add curl \\","21","    && mkdir \/opt \\","23","    && curl -fsSL http:\/\/www-us.apache.org\/dist\/maven\/maven-3\/3.3.9\/binaries\/apache-maven-3.3.9-bin.tar.gz -o maven.tar.gz \\","29","    && \/opt\/apache-maven-3.3.9\/bin\/mvn verify"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1950\" dev=\"ggregory\" type=\"update\" due-to=\"Pierrick HYMBERT\">","34","        Fix docker build with jdk9 requirements (#84).","35","      <\/action>"],"delete":[]}],"toolchains-docker.xml":[{"add":[],"delete":[]}]}},"5513abe87aee184acd147a7fcb4c586361d4a730":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["161","      <action issue=\"LOG4J2-1736\" dev=\"ggregory\" type=\"fix\">","162","        TcpSocketManagerFactory might leak Sockets when certain startup errors occur.","163","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/TcpSocketManager.java":[{"add":["36","import org.apache.logging.log4j.core.util.Closer;","388","        ","389","        @SuppressWarnings(\"resource\")","401","            Socket socket = null;","404","                socket = createSocket(data);","414","                Closer.closeSilently(socket);"],"delete":["400","                final Socket socket = createSocket(data);"]}]}},"9a08eb08f389ad9c432cbdfd4ab41246227d01db":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1971\" dev=\"rgoers\" type=\"fix\">","34","        Register log4j-core as an OSGi service. Skip tests for LOG4J2-1766 on MacOS. Use group \"staff\" for LOG4J2-1699 test on MacOS.","35","      <\/action>"],"delete":[]}]}},"22775f6a9edd7eb08f3a7eb9fb5c8bd532ac1524":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["66","      <action issue=\"LOG4J2-2049\" dev=\"ggregory\" type=\"update\">","67","        Update Apache Kafka Client from 0.11.0.0 to 0.11.0.1.","68","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["588","        <version>0.11.0.1<\/version>"],"delete":["588","        <version>0.11.0.0<\/version>"]}]}},"6b4a4dbf6b558bda00a0eed865e6bd550ac35166":{"changes":{"src\/site\/xdoc\/manual\/configuration.xml.vm":"MODIFY","src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/logsep.xml":"MODIFY","src\/site\/xdoc\/manual\/webapp.xml":"MODIFY","src\/site\/xdoc\/manual\/extending.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/configuration.xml.vm":[{"add":["1173","      <tt>org.apache.logging.log4j.core.selector.JndiContextSelector<\/tt> - use JNDI to locate each web application's LoggerContext."],"delete":["1173","      <tt>org.apache.logging.log4j.core.selector.JNDIContextSelector<\/tt> - use JNDI to locate each web application's LoggerContext."]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-750\" dev=\"ggregory\" type=\"fix\" due-to=\"Mike Calmus \">","25","        Webapp configuration page has incorrect class name.","26","      <\/action>      "],"delete":[]}],"src\/site\/xdoc\/manual\/logsep.xml":[{"add":["98","                  <kbd>org.apache.logging.log4j.core.selector.JndiContextSelector<\/kbd>. This will cause the container"],"delete":["98","                  <kbd>org.apache.logging.log4j.core.selector.JNDIContextSelector<\/kbd>. This will cause the container"]}],"src\/site\/xdoc\/manual\/webapp.xml":[{"add":["174","          <a href=\"..\/log4j-core\/apidocs\/org\/apache\/logging\/log4j\/core\/selector\/JndiContextSelector.html\"","175","            >JndiContextSelector<\/a>. If <code>isLog4jContextSelectorNamed<\/code> is not specified or is anything other","206","        <h4>Use the <code>JndiContextSelector<\/code><\/h4>","221","          \"org.apache.logging.log4j.core.selector.JndiContextSelector.\""],"delete":["174","          <a href=\"..\/log4j-core\/apidocs\/org\/apache\/logging\/log4j\/core\/selector\/JNDIContextSelector.html\"","175","            >JNDIContextSelector<\/a>. If <code>isLog4jContextSelectorNamed<\/code> is not specified or is anything other","206","        <h4>Use the <code>JNDIContextSelector<\/code><\/h4>","221","          \"org.apache.logging.log4j.core.selector.JNDIContextSelector.\""]}],"src\/site\/xdoc\/manual\/extending.xml":[{"add":["80","              <dt>JndiContextSelector<\/dt>"],"delete":["80","              <dt>JNDIContextSelector<\/dt>"]}]}},"4b77622ba9cc113ec71514bd8658abaad0963995":{"changes":{"log4j-core\/src\/test\/resources\/log4j-xinclude.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/XIncludeTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/resources\/log4j-xinclude.xml":[{"add":["21","    <Property name=\"filename\">target\/test-xinclude.log<\/Property>","24","  <xi:include href=\"log4j-xinclude-appenders.xml\" \/>","25","  <xi:include href=\"log4j-xinclude-loggers.xml\" \/>","26","<\/Configuration>"],"delete":["21","    <Property name=\"filename\">target\/test.log<\/Property>","24","  <xi:include href=\"target\/test-classes\/log4j-xinclude-appenders.xml\" \/>","25","  <xi:include href=\"target\/test-classes\/log4j-xinclude-loggers.xml\" \/>","26","<\/Configuration>"]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-742\" dev=\"ggreory\" type=\"fix\" due-to=\"Pascal Chollet\">","25","        XInclude not working with relative path.","26","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/XIncludeTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["133","            source.setSystemId(configSource.getLocation());"],"delete":[]}]}},"81b5806eb486e1e2bedc839565e05bb3f22b71be":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FormatCache.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/DatePrinter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDateParser.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDatePrinter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDateFormat.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/DateParser.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FormatCache.java":[{"add":["28"," * <p>FormatCache is a cache and factory for {@link Format}s.<\/p>","29"," * ","31"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","33"," * ","34"," * @since Apache Commons Lang 3.0","38","    ","40","     * No date or no time.  Used in same parameters as DateFormat.SHORT or DateFormat.LONG","42","    static final int NONE= -1;","43","    ","44","    private final ConcurrentMap<MultipartKey, F> cInstanceCache ","45","        = new ConcurrentHashMap<>(7);","46","    ","47","    private static final ConcurrentMap<MultipartKey, String> cDateTimeInstanceCache ","48","        = new ConcurrentHashMap<>(7);","51","     * <p>Gets a formatter instance using the default pattern in the","52","     * default timezone and locale.<\/p>","53","     * ","61","     * <p>Gets a formatter instance using the specified pattern, time zone","62","     * and locale.<\/p>","63","     * ","64","     * @param pattern  {@link java.text.SimpleDateFormat} compatible","65","     *  pattern, non-null","66","     * @param timeZone  the time zone, null means use the default TimeZone","67","     * @param locale  the locale, null means use the default Locale","69","     * @throws IllegalArgumentException if pattern is invalid","70","     *  or <code>null<\/code>","84","        if (format == null) {           ","86","            final F previousValue= cInstanceCache.putIfAbsent(key, format);","90","                format= previousValue;              ","95","    ","97","     * <p>Create a format instance using the specified pattern, time zone","98","     * and locale.<\/p>","99","     * ","100","     * @param pattern  {@link java.text.SimpleDateFormat} compatible pattern, this will not be null.","101","     * @param timeZone  time zone, this will not be null.","102","     * @param locale  locale, this will not be null.","104","     * @throws IllegalArgumentException if pattern is invalid","105","     *  or <code>null<\/code>","108","        ","110","     * <p>Gets a date\/time formatter instance using the specified style,","111","     * time zone and locale.<\/p>","112","     * ","113","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT, null indicates no date in format","114","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT, null indicates no time in format","115","     * @param timeZone  optional time zone, overrides time zone of","116","     *  formatted date, null means use default Locale","117","     * @param locale  optional locale, overrides system locale","119","     * @throws IllegalArgumentException if the Locale has no date\/time","120","     *  pattern defined","122","    \/\/ This must remain private, see LANG-884 ","123","    private F getDateTimeInstance(final Integer dateStyle, final Integer timeStyle, final TimeZone timeZone, Locale locale) {","132","     * <p>Gets a date\/time formatter instance using the specified style,","133","     * time zone and locale.<\/p>","134","     * ","135","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","136","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","137","     * @param timeZone  optional time zone, overrides time zone of","138","     *  formatted date, null means use default Locale","139","     * @param locale  optional locale, overrides system locale","141","     * @throws IllegalArgumentException if the Locale has no date\/time","142","     *  pattern defined","150","     * <p>Gets a date formatter instance using the specified style,","151","     * time zone and locale.<\/p>","152","     * ","153","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","154","     * @param timeZone  optional time zone, overrides time zone of","155","     *  formatted date, null means use default Locale","156","     * @param locale  optional locale, overrides system locale","158","     * @throws IllegalArgumentException if the Locale has no date\/time","159","     *  pattern defined","167","     * <p>Gets a time formatter instance using the specified style,","168","     * time zone and locale.<\/p>","169","     * ","170","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","171","     * @param timeZone  optional time zone, overrides time zone of","172","     *  formatted date, null means use default Locale","173","     * @param locale  optional locale, overrides system locale","175","     * @throws IllegalArgumentException if the Locale has no date\/time","176","     *  pattern defined","184","     * <p>Gets a date\/time format for the specified styles and locale.<\/p>","185","     * ","186","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT, null indicates no date in format","187","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT, null indicates no time in format","188","     * @param locale  The non-null locale of the desired format","196","        String pattern = cDateTimeInstanceCache.get(key);","201","                    formatter = DateFormat.getTimeInstance(timeStyle.intValue(), locale);                    ","202","                }","203","                else if (timeStyle == null) {","204","                    formatter = DateFormat.getDateInstance(dateStyle.intValue(), locale);                    ","205","                }","206","                else {","209","                pattern = ((SimpleDateFormat)formatter).toPattern();","210","                final String previous = cDateTimeInstanceCache.putIfAbsent(key, pattern);","215","                    pattern= previous;","226","     * <p>Helper class to hold multi-part Map keys<\/p>","234","         * @param keys the set of objects that make up the key.  Each key may be null.","248","            return Arrays.equals(keys, ((MultipartKey)obj).keys);","256","            if(hashCode==0) {","257","                int rc= 0;","258","                for(final Object key : keys) {","259","                    if(key!=null) {","260","                        rc= rc*7 + key.hashCode();","263","                hashCode= rc;"],"delete":["29"," * FormatCache is a cache and factory for {@link Format}s.","31"," *","32"," * @since 3.0","37","     * No date or no time. Used in same parameters as DateFormat.SHORT or DateFormat.LONG","39","    static final int NONE = -1;","40","","41","    private static final ConcurrentMap<MultipartKey, String> DATETIME_INSTANCE_CACHE =","42","            new ConcurrentHashMap<>(7);","43","","44","    private final ConcurrentMap<MultipartKey, F> cInstanceCache = new ConcurrentHashMap<>(7);","47","     * <p>","48","     * Gets a formatter instance using the default pattern in the default timezone and locale.","49","     * <\/p>","50","     *","58","     * <p>","59","     * Gets a formatter instance using the specified pattern, time zone and locale.","60","     * <\/p>","61","     *","62","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern, non-null","63","     * @param timeZone the time zone, null means use the default TimeZone","64","     * @param locale the locale, null means use the default Locale","66","     * @throws IllegalArgumentException if pattern is invalid or <code>null<\/code>","80","        if (format == null) {","82","            final F previousValue = cInstanceCache.putIfAbsent(key, format);","86","                format = previousValue;","91","","93","     * <p>","94","     * Create a format instance using the specified pattern, time zone and locale.","95","     * <\/p>","96","     *","97","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern, this will not be null.","98","     * @param timeZone time zone, this will not be null.","99","     * @param locale locale, this will not be null.","101","     * @throws IllegalArgumentException if pattern is invalid or <code>null<\/code>","104","","106","     * <p>","107","     * Gets a date\/time formatter instance using the specified style, time zone and locale.","108","     * <\/p>","109","     *","110","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT, null indicates no date in format","111","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT, null indicates no time in format","112","     * @param timeZone optional time zone, overrides time zone of formatted date, null means use default Locale","113","     * @param locale optional locale, overrides system locale","115","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","117","    \/\/ This must remain private, see LANG-884","118","    private F getDateTimeInstance(final Integer dateStyle, final Integer timeStyle, final TimeZone timeZone,","119","            Locale locale) {","128","     * <p>","129","     * Gets a date\/time formatter instance using the specified style, time zone and locale.","130","     * <\/p>","131","     *","132","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","133","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","134","     * @param timeZone optional time zone, overrides time zone of formatted date, null means use default Locale","135","     * @param locale optional locale, overrides system locale","137","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","145","     * <p>","146","     * Gets a date formatter instance using the specified style, time zone and locale.","147","     * <\/p>","148","     *","149","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","150","     * @param timeZone optional time zone, overrides time zone of formatted date, null means use default Locale","151","     * @param locale optional locale, overrides system locale","153","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","161","     * <p>","162","     * Gets a time formatter instance using the specified style, time zone and locale.","163","     * <\/p>","164","     *","165","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","166","     * @param timeZone optional time zone, overrides time zone of formatted date, null means use default Locale","167","     * @param locale optional locale, overrides system locale","169","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","177","     * <p>","178","     * Gets a date\/time format for the specified styles and locale.","179","     * <\/p>","180","     *","181","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT, null indicates no date in format","182","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT, null indicates no time in format","183","     * @param locale The non-null locale of the desired format","191","        String pattern = DATETIME_INSTANCE_CACHE.get(key);","196","                    formatter = DateFormat.getTimeInstance(timeStyle.intValue(), locale);","197","                } else if (timeStyle == null) {","198","                    formatter = DateFormat.getDateInstance(dateStyle.intValue(), locale);","199","                } else {","202","                pattern = ((SimpleDateFormat) formatter).toPattern();","203","                final String previous = DATETIME_INSTANCE_CACHE.putIfAbsent(key, pattern);","208","                    pattern = previous;","219","     * <p>","220","     * Helper class to hold multi-part Map keys","221","     * <\/p>","229","         * ","230","         * @param keys the set of objects that make up the key. Each key may be null.","244","            return obj != null && Arrays.equals(keys, ((MultipartKey) obj).keys);","252","            if (hashCode == 0) {","253","                int rc = 0;","254","                for (final Object key : keys) {","255","                    if (key != null) {","256","                        rc = rc * 7 + key.hashCode();","259","                hashCode = rc;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/DatePrinter.java":[{"add":["25"," * DatePrinter is the \"missing\" interface for the format methods of ","26"," * {@link java.text.DateFormat}. You can obtain an object implementing this","27"," * interface by using one of the FastDateFormat factory methods.","28"," * <p>","29"," * Warning: Since binary compatible methods may be added to this interface in any","30"," * release, developers are not expected to implement this interface.","31"," * <\/p>","32"," * ","33"," * <p>","34"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","35"," * <\/p>","36"," * ","37"," * @since Apache Commons Lang 3.2","70","     * <p>Formats a millisecond {@code long} value into the","71","     * supplied {@code Appendable}.<\/p>","75","     * @param <B> the Appendable class type, usually StringBuilder or StringBuffer.","77","     * @since 3.5","79","    <B extends Appendable> B format(long millis, B buf);","83","     * supplied {@code Appendable} using a {@code GregorianCalendar}.<\/p>","87","     * @param <B> the Appendable class type, usually StringBuilder or StringBuffer.","89","     * @since 3.5","91","    <B extends Appendable> B format(Date date, B buf);","94","     * <p>Formats a {@code Calendar} object into the supplied {@code Appendable}.<\/p>","101","     * @param <B> the Appendable class type, usually StringBuilder or StringBuffer.","103","     * @since 3.5","105","    <B extends Appendable> B format(Calendar calendar, B buf);","106","","136","     *","141","     * @see java.text.DateFormat#format(Object, StringBuffer, FieldPosition)"],"delete":["25"," * Copied from Commons Lang 3.","58","     * <p>Formats a milliseond {@code long} value into the","59","     * supplied {@code StringBuilder}.<\/p>","65","    StringBuilder format(long millis, StringBuilder buf);","69","     * supplied {@code StringBuilder} using a {@code GregorianCalendar}.<\/p>","75","    StringBuilder format(Date date, StringBuilder buf);","78","     * <p>Formats a {@code Calendar} object into the supplied {@code StringBuilder}.<\/p>","87","    StringBuilder format(Calendar calendar, StringBuilder buf);","117","     * ","118","     * See {@link java.text.DateFormat#format(Object, StringBuffer, FieldPosition)}","119","     * "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDateParser.java":[{"add":["68"," * ","69"," * <p>","70"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","71"," * <\/p>","72"," * ","73"," * @since Apache Commons Lang 3.2"],"delete":["68"," *","69"," * @since 3.2"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDatePrinter.java":[{"add":["33","import org.apache.logging.log4j.core.util.Throwables;","34","","36"," * <p>FastDatePrinter is a fast and thread-safe version of","37"," * {@link java.text.SimpleDateFormat}.<\/p>","38"," *","39"," * <p>To obtain a FastDatePrinter, use {@link FastDateFormat#getInstance(String, TimeZone, Locale)} ","40"," * or another variation of the factory methods of {@link FastDateFormat}.<\/p>","41"," * ","42"," * <p>Since FastDatePrinter is thread safe, you can use a static member instance:<\/p>","43"," * <code>","44"," *     private static final DatePrinter DATE_PRINTER = FastDateFormat.getInstance(\"yyyy-MM-dd\");","45"," * <\/code>","46"," * ","47"," * <p>This class can be used as a direct replacement to","48"," * {@code SimpleDateFormat} in most formatting situations.","49"," * This class is especially useful in multi-threaded server environments.","50"," * {@code SimpleDateFormat} is not thread-safe in any JDK version,","51"," * nor will it be as Sun have closed the bug\/RFE.","52"," * <\/p>","53"," *","54"," * <p>Only formatting is supported by this class, but all patterns are compatible with","55"," * SimpleDateFormat (except time zones and some year patterns - see below).<\/p>","56"," *","57"," * <p>Java 1.4 introduced a new pattern letter, {@code 'Z'}, to represent","58"," * time zones in RFC822 format (eg. {@code +0800} or {@code -1100}).","59"," * This pattern letter can be used here (on all JDK versions).<\/p>","60"," *","61"," * <p>In addition, the pattern {@code 'ZZ'} has been made to represent","62"," * ISO 8601 extended format time zones (eg. {@code +08:00} or {@code -11:00}).","63"," * This introduces a minor incompatibility with Java 1.4, but at a gain of","64"," * useful functionality.<\/p>","65"," * ","66"," * <p>Starting with JDK7, ISO 8601 support was added using the pattern {@code 'X'}.","67"," * To maintain compatibility, {@code 'ZZ'} will continue to be supported, but using","68"," * one of the {@code 'X'} formats is recommended.","69"," *","70"," * <p>Javadoc cites for the year pattern: <i>For formatting, if the number of","71"," * pattern letters is 2, the year is truncated to 2 digits; otherwise it is","72"," * interpreted as a number.<\/i> Starting with Java 1.7 a pattern of 'Y' or","73"," * 'YYY' will be formatted as '2003', while it was '03' in former Java","74"," * versions. FastDatePrinter implements the behavior of Java 7.<\/p>","75"," * ","76"," * <p>","77"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","78"," * <\/p>","79"," * ","80"," * @since Apache Commons Lang 3.2","81"," * @see FastDateParser","85","    \/\/ from the special int to StringBuffer conversion.","88","    \/\/   buffer.append((char)(value \/ 10 + '0'));","89","    \/\/   buffer.append((char)(value % 10 + '0'));","91","    \/\/ Note that the fastest append to StringBuffer is a single char (used here).","97","     * Required for serialization support.","98","     *","99","     * @see java.io.Serializable","100","     *\/","101","    private static final long serialVersionUID = 1L;","102","","103","    \/**","142","    \/\/-----------------------------------------------------------------------","144","     * <p>Constructs a new FastDatePrinter.<\/p>","145","     * Use {@link FastDateFormat#getInstance(String, TimeZone, Locale)}  or another variation of the ","146","     * factory methods of {@link FastDateFormat} to get a cached FastDatePrinter instance.","148","     * @param pattern  {@link java.text.SimpleDateFormat} compatible pattern","149","     * @param timeZone  non-null time zone to use","150","     * @param locale  non-null locale to use","162","     * <p>Initializes the instance for first use.<\/p>","169","        for (int i=mRules.length; --i >= 0; ) {","177","    \/\/-----------------------------------------------------------------------","179","     * <p>Returns a list of Rules given a pattern.<\/p>","216","            case 'Y': \/\/ week year","222","                if (c == 'Y') {","223","                    rule = new WeekYear((NumberRule) rule);","224","                }","258","            case 'u': \/\/ day in week (number)","259","                rule = new DayInWeekField(selectNumberRule(Calendar.DAY_OF_WEEK, tokenLen));","260","                break;","282","            case 'X': \/\/ ISO 8601 ","284","                break;    ","320","     * <p>Performs the parsing of tokens.<\/p>","322","     * @param pattern  the pattern","323","     * @param indexRef  index references","364","                } else if (!inLiteral &&","365","                         (c >= 'A' && c <= 'Z' || c >= 'a' && c <= 'z')) {","379","     * <p>Gets an appropriate rule for the padding required.<\/p>","381","     * @param field  the field to get a rule for","382","     * @param padding  the padding required","397","    \/\/-----------------------------------------------------------------------","399","     * <p>Formats a {@code Date}, {@code Calendar} or","400","     * {@code Long} (milliseconds) object.<\/p>","401","     * @deprecated Use {{@link #format(Date)}, {{@link #format(Calendar)}, {{@link #format(long)}, or {{@link #format(Object)}","402","     * @param obj  the object to format","403","     * @param toAppendTo  the buffer to append to","404","     * @param pos  the position - ignored","407","    @Deprecated","417","            throw new IllegalArgumentException(\"Unknown class: \" +","418","                (obj == null ? \"<null>\" : obj.getClass().getName()));","422","    \/**","423","     * <p>Formats a {@code Date}, {@code Calendar} or","424","     * {@code Long} (milliseconds) object.<\/p>","425","     * @since 3.5","426","     * @param obj  the object to format","427","     * @return The formatted value.","428","     *\/","429","    String format(final Object obj) {","430","        if (obj instanceof Date) {","431","            return format((Date) obj);","432","        } else if (obj instanceof Calendar) {","433","            return format((Calendar) obj);","434","        } else if (obj instanceof Long) {","435","            return format(((Long) obj).longValue());","436","        } else {","437","            throw new IllegalArgumentException(\"Unknown class: \" +","438","                (obj == null ? \"<null>\" : obj.getClass().getName()));","439","        }","440","    }","441","","442","    \/* (non-Javadoc)","447","        final Calendar c = newCalendar();","462","     * Creation method for new calender instances.","465","    private Calendar newCalendar() {","466","        return Calendar.getInstance(mTimeZone, mLocale);","469","    \/* (non-Javadoc)","474","        final Calendar c = newCalendar();","479","    \/* (non-Javadoc)","487","    \/* (non-Javadoc)","488","     * @see org.apache.commons.lang3.time.DatePrinter#format(long, java.lang.Appendable)","491","    public <B extends Appendable> B format(final long millis, final B buf) {","492","        final Calendar c = newCalendar();","493","        c.setTimeInMillis(millis);","494","        return applyRules(c, buf);","497","    \/* (non-Javadoc)","498","     * @see org.apache.commons.lang3.time.DatePrinter#format(java.util.Date, java.lang.Appendable)","501","    public <B extends Appendable> B format(final Date date, final B buf) {","502","        final Calendar c = newCalendar();","507","    \/* (non-Javadoc)","508","     * @see org.apache.commons.lang3.time.DatePrinter#format(java.util.Calendar, java.lang.Appendable)","511","    public <B extends Appendable> B format(Calendar calendar, final B buf) {","513","        if(!calendar.getTimeZone().equals(mTimeZone)) {","514","            calendar = (Calendar)calendar.clone();","515","            calendar.setTimeZone(mTimeZone);","516","        }","517","        return applyRules(calendar, buf);","521","     * Performs the formatting by applying the rules to the","522","     * specified calendar.","527","     *","528","     * @deprecated use {@link #format(Calendar)} or {@link #format(Calendar, Appendable)}","530","    @Deprecated","531","    protected StringBuffer applyRules(final Calendar calendar, final StringBuffer buf) {","532","        return (StringBuffer) applyRules(calendar, (Appendable)buf);","533","    }","534","","535","    \/**","536","     * <p>Performs the formatting by applying the rules to the","537","     * specified calendar.<\/p>","538","     *","539","     * @param calendar  the calendar to format","540","     * @param buf  the buffer to format into","541","     * @param <B> the Appendable class type, usually StringBuilder or StringBuffer.","542","     * @return the specified string buffer","543","     *\/","544","    private <B extends Appendable> B applyRules(final Calendar calendar, final B buf) {","545","        try {","546","            for (final Rule rule : mRules) {","547","                rule.appendTo(buf, calendar);","548","            }","549","        } catch (final IOException ioe) {","550","            Throwables.rethrow(ioe);","556","    \/\/-----------------------------------------------------------------------","557","    \/* (non-Javadoc)","565","    \/* (non-Javadoc)","573","    \/* (non-Javadoc)","582","     * <p>Gets an estimate for the maximum string length that the","583","     * formatter will produce.<\/p>","585","     * <p>The actual formatted length will almost always be less than or","586","     * equal to this amount.<\/p>","595","    \/\/-----------------------------------------------------------------------","597","     * <p>Compares two objects for equality.<\/p>","599","     * @param obj  the object to compare to","608","        return mPattern.equals(other.mPattern)","609","            && mTimeZone.equals(other.mTimeZone) ","610","            && mLocale.equals(other.mLocale);","614","     * <p>Returns a hash code compatible with equals.<\/p>","624","     * <p>Gets a debugging string version of this formatter.<\/p>","634","    \/\/-----------------------------------------------------------------------","636","     * Create the object after serialization. This implementation reinitializes the","637","     * transient properties.","649","     * Appends two digits to the given buffer.","650","     *","654","    private static void appendDigits(final Appendable buffer, final int value) throws IOException {","655","        buffer.append((char)(value \/ 10 + '0'));","656","        buffer.append((char)(value % 10 + '0'));","657","    }","658","","659","    private static final int MAX_DIGITS = 10; \/\/ log10(Integer.MAX_VALUE) ~= 9.3","660","","661","    \/**","662","     * Appends all digits to the given buffer.","663","     *","664","     * @param buffer the buffer to append to.","665","     * @param value the value to append digits from.","666","     *\/","667","    private static void appendFullDigits(final Appendable buffer, int value, int minFieldWidth) throws IOException {","668","        \/\/ specialized paths for 1 to 4 digits -> avoid the memory allocation from the temporary work array","669","        \/\/ see LANG-1248","670","        if (value < 10000) {","671","            \/\/ less memory allocation path works for four digits or less","672","","673","            int nDigits = 4;","674","            if (value < 1000) {","675","                --nDigits;","676","                if (value < 100) {","677","                    --nDigits;","678","                    if (value < 10) {","679","                        --nDigits;","680","                    }","681","                }","682","            }","683","            \/\/ left zero pad","684","            for (int i = minFieldWidth - nDigits; i > 0; --i) {","685","                buffer.append('0');","686","            }","687","","688","            switch (nDigits) {","689","            case 4:","690","                buffer.append((char) (value \/ 1000 + '0'));","691","                value %= 1000;","692","            case 3:","693","                if (value >= 100) {","694","                    buffer.append((char) (value \/ 100 + '0'));","695","                    value %= 100;","696","                } else {","697","                    buffer.append('0');","698","                }","699","            case 2:","700","                if (value >= 10) {","701","                    buffer.append((char) (value \/ 10 + '0'));","702","                    value %= 10;","703","                } else {","704","                    buffer.append('0');","705","                }","706","            case 1:","707","                buffer.append((char) (value + '0'));","708","            }","709","        } else {","710","            \/\/ more memory allocation path works for any digits","711","","712","            \/\/ build up decimal representation in reverse","713","            final char[] work = new char[MAX_DIGITS];","714","            int digit = 0;","715","            while (value != 0) {","716","                work[digit++] = (char) (value % 10 + '0');","717","                value = value \/ 10;","718","            }","719","","720","            \/\/ pad with zeros","721","            while (digit < minFieldWidth) {","722","                buffer.append('0');","723","                --minFieldWidth;","724","            }","725","","726","            \/\/ reverse","727","            while (--digit >= 0) {","728","                buffer.append(work[digit]);","729","            }","730","        }","734","    \/\/-----------------------------------------------------------------------","736","     * <p>Inner class defining a rule.<\/p>","749","         * @param buf the output buffer","751","         * @throws IOException if an I\/O error occurs","753","        void appendTo(Appendable buf, Calendar calendar) throws IOException;","757","     * <p>Inner class defining a numeric rule.<\/p>","765","         * @throws IOException if an I\/O error occurs","767","        void appendTo(Appendable buffer, int value) throws IOException;","771","     * <p>Inner class to output a constant single character.<\/p>","777","         * Constructs a new instance of {@code CharacterLiteral}","778","         * to hold the specified value.","798","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","804","     * <p>Inner class to output a constant string.<\/p>","810","         * Constructs a new instance of {@code StringLiteral}","811","         * to hold the specified value.","831","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","837","     * <p>Inner class to output one of a set of values.<\/p>","844","         * Constructs an instance of {@code TextField}","845","         * with the specified field and values.","861","            for (int i=mValues.length; --i >= 0; ) {","874","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","880","     * <p>Inner class to output an unpadded number.<\/p>","906","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","914","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","916","                buffer.append((char)(value + '0'));","920","               appendFullDigits(buffer, value, 1);","926","     * <p>Inner class to output an unpadded month.<\/p>","951","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","959","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","961","                buffer.append((char)(value + '0'));","969","     * <p>Inner class to output a padded number.<\/p>","1002","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1010","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","1011","            appendFullDigits(buffer, value, mSize);","1016","     * <p>Inner class to output a two digit number.<\/p>","1042","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1050","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","1054","                appendFullDigits(buffer, value, 2);","1060","     * <p>Inner class to output a two digit year.<\/p>","1084","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1092","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","1098","     * <p>Inner class to output a two digit month.<\/p>","1122","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1130","        public final void appendTo(final Appendable buffer, final int value) throws IOException {","1136","     * <p>Inner class to output the twelve hour field.<\/p>","1142","         * Constructs an instance of {@code TwelveHourField} with the specified","1143","         * {@code NumberRule}.","1163","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1175","        public void appendTo(final Appendable buffer, final int value) throws IOException {","1181","     * <p>Inner class to output the twenty four hour field.<\/p>","1187","         * Constructs an instance of {@code TwentyFourHourField} with the specified","1188","         * {@code NumberRule}.","1208","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1220","        public void appendTo(final Appendable buffer, final int value) throws IOException {","1225","    \/**","1226","     * <p>Inner class to output the numeric day in week.<\/p>","1227","     *\/","1228","    private static class DayInWeekField implements NumberRule {","1229","        private final NumberRule mRule;","1231","        DayInWeekField(final NumberRule rule) {","1232","            mRule = rule;","1233","        }","1234","","1235","        @Override","1236","        public int estimateLength() {","1237","            return mRule.estimateLength();","1238","        }","1239","","1240","        @Override","1241","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1242","            final int value = calendar.get(Calendar.DAY_OF_WEEK);","1243","            mRule.appendTo(buffer, value != Calendar.SUNDAY ? value - 1 : 7);","1244","        }","1245","","1246","        @Override","1247","        public void appendTo(final Appendable buffer, final int value) throws IOException {","1248","            mRule.appendTo(buffer, value);","1249","        }","1250","    }","1253","     * <p>Inner class to output the numeric day in week.<\/p>","1254","     *\/","1255","    private static class WeekYear implements NumberRule {","1256","        private final NumberRule mRule;","1257","","1258","        WeekYear(final NumberRule rule) {","1259","            mRule = rule;","1260","        }","1261","","1262","        @Override","1263","        public int estimateLength() {","1264","            return mRule.estimateLength();","1265","        }","1266","","1267","        @Override","1268","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1269","            mRule.appendTo(buffer, calendar.getWeekYear());","1270","        }","1271","","1272","        @Override","1273","        public void appendTo(final Appendable buffer, final int value) throws IOException {","1274","            mRule.appendTo(buffer, value);","1275","        }","1276","    }","1277","","1278","    \/\/-----------------------------------------------------------------------","1279","","1280","    private static final ConcurrentMap<TimeZoneDisplayKey, String> cTimeZoneDisplayCache =","1281","        new ConcurrentHashMap<>(7);","1282","    \/**","1283","     * <p>Gets the time zone display name, using a cache for performance.<\/p>","1285","     * @param tz  the zone to query","1286","     * @param daylight  true if daylight savings","1287","     * @param style  the style to use {@code TimeZone.LONG} or {@code TimeZone.SHORT}","1288","     * @param locale  the locale to use","1299","                value= prior;","1306","     * <p>Inner class to output a time zone name.<\/p>","1324","            ","1344","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1355","     * <p>Inner class to output a time zone as a number {@code +\/-HHMM}","1356","     * or {@code +\/-HH:MM}.<\/p>","1361","        ","1385","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1386","            ","1409","     * <p>Inner class to output a time zone as a number {@code +\/-HHMM}","1410","     * or {@code +\/-HH:MM}.<\/p>","1413","        ","1415","        static final Iso8601_Rule ISO8601_HOURS = new Iso8601_Rule(3);       ","1425","         * @return a Iso8601_Rule that can format TimeZone String of length {@code tokenLen}. If no such","1426","         *          rule exists, an IllegalArgumentException will be thrown.","1429","            switch(tokenLen) {","1437","                throw new IllegalArgumentException(\"invalid number of X\");                    ","1439","        }        ","1440","        ","1464","        public void appendTo(final Appendable buffer, final Calendar calendar) throws IOException {","1470","            ","1481","            if (length<5) {","1484","            ","1485","            if (length==6) {","1496","     * <p>Inner class that acts as a compound key for time zone names.<\/p>","1511","        TimeZoneDisplayKey(final TimeZone timeZone,","1512","                           final boolean daylight, final int style, final Locale locale) {","1527","            return (mStyle * 31 + mLocale.hashCode() ) * 31 + mTimeZone.hashCode();","1539","                final TimeZoneDisplayKey other = (TimeZoneDisplayKey)obj;","1540","                return","1541","                    mTimeZone.equals(other.mTimeZone) &&","1542","                    mStyle == other.mStyle &&","1543","                    mLocale.equals(other.mLocale);"],"delete":["27","import java.util.GregorianCalendar;","35"," * Copied from Commons Lang 3.","39","    \/\/ from the special int to StringBuilder conversion.","42","    \/\/ buffer.append((char)(value \/ 10 + '0'));","43","    \/\/ buffer.append((char)(value % 10 + '0'));","45","    \/\/ Note that the fastest append to StringBuilder is a single char (used here).","68","     * Required for serialization support.","69","     *","70","     * @see java.io.Serializable","71","     *\/","72","    private static final long serialVersionUID = 1L;","73","","74","    \/**","96","    \/\/ -----------------------------------------------------------------------","98","     * <p>","99","     * Constructs a new FastDatePrinter.","100","     * <\/p>","101","     * Use {@link FastDateFormat#getInstance(String, TimeZone, Locale)} or another variation of the factory methods of","102","     * {@link FastDateFormat} to get a cached FastDatePrinter instance.","104","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","105","     * @param timeZone non-null time zone to use","106","     * @param locale non-null locale to use","118","     * <p>","119","     * Initializes the instance for first use.","120","     * <\/p>","127","        for (int i = mRules.length; --i >= 0;) {","135","    \/\/ -----------------------------------------------------------------------","137","     * <p>","138","     * Returns a list of Rules given a pattern.","139","     * <\/p>","235","            case 'u': \/\/ day of week (1..7)","236","                rule = selectNumberRule(Calendar.DAY_OF_WEEK, tokenLen);","237","                break;","238","            case 'X': \/\/ ISO 8601","240","                break;","276","     * <p>","277","     * Performs the parsing of tokens.","278","     * <\/p>","280","     * @param pattern the pattern","281","     * @param indexRef index references","322","                } else if (!inLiteral && (c >= 'A' && c <= 'Z' || c >= 'a' && c <= 'z')) {","336","     * <p>","337","     * Gets an appropriate rule for the padding required.","338","     * <\/p>","340","     * @param field the field to get a rule for","341","     * @param padding the padding required","356","    \/\/ -----------------------------------------------------------------------","358","     * <p>","359","     * Formats a {@code Date}, {@code Calendar} or {@code Long} (milliseconds) object.","360","     * <\/p>","361","     *","362","     * @param obj the object to format","363","     * @param toAppendTo the buffer to append to","364","     * @param pos the position - ignored","376","            throw new IllegalArgumentException(\"Unknown class: \" + (obj == null ? \"<null>\" : obj.getClass().getName()));","380","    \/*","381","     * (non-Javadoc)","382","     * ","387","        final Calendar c = newCalendar(); \/\/ hard code GregorianCalendar","394","     * ","403","     * Creation method for ne calender instances.","404","     * ","407","    private GregorianCalendar newCalendar() {","408","        \/\/ hard code GregorianCalendar","409","        return new GregorianCalendar(mTimeZone, mLocale);","412","    \/*","413","     * (non-Javadoc)","414","     * ","419","        final Calendar c = newCalendar(); \/\/ hard code GregorianCalendar","424","    \/*","425","     * (non-Javadoc)","426","     * ","434","    \/*","435","     * (non-Javadoc)","436","     * ","437","     * @see org.apache.commons.lang3.time.DatePrinter#format(long, java.lang.StringBuilder)","440","    public StringBuilder format(final long millis, final StringBuilder buf) {","441","        return format(new Date(millis), buf);","444","    \/*","445","     * (non-Javadoc)","446","     * ","447","     * @see org.apache.commons.lang3.time.DatePrinter#format(java.util.Date, java.lang.StringBuilder)","450","    public StringBuilder format(final Date date, final StringBuilder buf) {","451","        final Calendar c = newCalendar(); \/\/ hard code GregorianCalendar","456","    \/*","457","     * (non-Javadoc)","458","     * ","459","     * @see org.apache.commons.lang3.time.DatePrinter#format(java.util.Calendar, java.lang.StringBuilder)","462","    public StringBuilder format(final Calendar calendar, final StringBuilder buf) {","464","        return format(calendar.getTime(), buf);","468","     * <p>","469","     * Performs the formatting by applying the rules to the specified calendar.","470","     * <\/p>","476","    protected StringBuilder applyRules(final Calendar calendar, final StringBuilder buf) {","477","        for (final Rule rule : mRules) {","478","            rule.appendTo(buf, calendar);","484","    \/\/ -----------------------------------------------------------------------","485","    \/*","486","     * (non-Javadoc)","487","     * ","495","    \/*","496","     * (non-Javadoc)","497","     * ","505","    \/*","506","     * (non-Javadoc)","507","     * ","516","     * <p>","517","     * Gets an estimate for the maximum string length that the formatter will produce.","518","     * <\/p>","520","     * <p>","521","     * The actual formatted length will almost always be less than or equal to this amount.","522","     * <\/p>","531","    \/\/ -----------------------------------------------------------------------","533","     * <p>","534","     * Compares two objects for equality.","535","     * <\/p>","537","     * @param obj the object to compare to","546","        return mPattern.equals(other.mPattern) && mTimeZone.equals(other.mTimeZone) && mLocale.equals(other.mLocale);","550","     * <p>","551","     * Returns a hash code compatible with equals.","552","     * <\/p>","562","     * <p>","563","     * Gets a debugging string version of this formatter.","564","     * <\/p>","574","    \/\/ -----------------------------------------------------------------------","576","     * Create the object after serialization. This implementation reinitializes the transient properties.","588","     * Appends digits to the given buffer.","589","     * ","593","    private static void appendDigits(final StringBuilder buffer, final int value) {","594","        buffer.append((char) (value \/ 10 + '0'));","595","        buffer.append((char) (value % 10 + '0'));","599","    \/\/ -----------------------------------------------------------------------","601","     * <p>","602","     * Inner class defining a rule.","603","     * <\/p>","616","         * @param buffer the output buffer","619","        void appendTo(StringBuilder buffer, Calendar calendar);","623","     * <p>","624","     * Inner class defining a numeric rule.","625","     * <\/p>","634","        void appendTo(StringBuilder buffer, int value);","638","     * <p>","639","     * Inner class to output a constant single character.","640","     * <\/p>","646","         * Constructs a new instance of {@code CharacterLiteral} to hold the specified value.","666","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","672","     * <p>","673","     * Inner class to output a constant string.","674","     * <\/p>","680","         * Constructs a new instance of {@code StringLiteral} to hold the specified value.","700","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","706","     * <p>","707","     * Inner class to output one of a set of values.","708","     * <\/p>","715","         * Constructs an instance of {@code TextField} with the specified field and values.","731","            for (int i = mValues.length; --i >= 0;) {","744","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","750","     * <p>","751","     * Inner class to output an unpadded number.","752","     * <\/p>","778","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","786","        public final void appendTo(final StringBuilder buffer, final int value) {","788","                buffer.append((char) (value + '0'));","792","                buffer.append(value);","798","     * <p>","799","     * Inner class to output an unpadded month.","800","     * <\/p>","825","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","833","        public final void appendTo(final StringBuilder buffer, final int value) {","835","                buffer.append((char) (value + '0'));","843","     * <p>","844","     * Inner class to output a padded number.","845","     * <\/p>","878","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","886","        public final void appendTo(final StringBuilder buffer, int value) {","887","            \/\/ pad the buffer with adequate zeros","888","            for (int digit = 0; digit < mSize; ++digit) {","889","                buffer.append('0');","890","            }","891","            \/\/ backfill the buffer with non-zero digits","892","            int index = buffer.length();","893","            for (; value > 0; value \/= 10) {","894","                buffer.setCharAt(--index, (char) ('0' + value % 10));","895","            }","900","     * <p>","901","     * Inner class to output a two digit number.","902","     * <\/p>","928","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","936","        public final void appendTo(final StringBuilder buffer, final int value) {","940","                buffer.append(value);","946","     * <p>","947","     * Inner class to output a two digit year.","948","     * <\/p>","972","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","980","        public final void appendTo(final StringBuilder buffer, final int value) {","986","     * <p>","987","     * Inner class to output a two digit month.","988","     * <\/p>","1012","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1020","        public final void appendTo(final StringBuilder buffer, final int value) {","1026","     * <p>","1027","     * Inner class to output the twelve hour field.","1028","     * <\/p>","1034","         * Constructs an instance of {@code TwelveHourField} with the specified {@code NumberRule}.","1054","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1066","        public void appendTo(final StringBuilder buffer, final int value) {","1072","     * <p>","1073","     * Inner class to output the twenty four hour field.","1074","     * <\/p>","1080","         * Constructs an instance of {@code TwentyFourHourField} with the specified {@code NumberRule}.","1100","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1112","        public void appendTo(final StringBuilder buffer, final int value) {","1117","    \/\/ -----------------------------------------------------------------------","1119","    private static final ConcurrentMap<TimeZoneDisplayKey, String> cTimeZoneDisplayCache = new ConcurrentHashMap<>(","1120","            7);","1123","     * <p>","1124","     * Gets the time zone display name, using a cache for performance.","1125","     * <\/p>","1127","     * @param tz the zone to query","1128","     * @param daylight true if daylight savings","1129","     * @param style the style to use {@code TimeZone.LONG} or {@code TimeZone.SHORT}","1130","     * @param locale the locale to use","1141","                value = prior;","1148","     * <p>","1149","     * Inner class to output a time zone name.","1150","     * <\/p>","1168","","1188","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1199","     * <p>","1200","     * Inner class to output a time zone as a number {@code +\/-HHMM} or {@code +\/-HH:MM}.","1201","     * <\/p>","1206","","1230","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1231","","1254","     * <p>","1255","     * Inner class to output a time zone as a number {@code +\/-HHMM} or {@code +\/-HH:MM}.","1256","     * <\/p>","1259","","1261","        static final Iso8601_Rule ISO8601_HOURS = new Iso8601_Rule(3);","1271","         * @return a Iso8601_Rule that can format TimeZone String of length {@code tokenLen}. If no such rule exists, an","1272","         *         IllegalArgumentException will be thrown.","1275","            switch (tokenLen) {","1283","                throw new IllegalArgumentException(\"invalid number of X\");","1285","        }","1286","","1310","        public void appendTo(final StringBuilder buffer, final Calendar calendar) {","1316","","1327","            if (length < 5) {","1330","","1331","            if (length == 6) {","1342","     * <p>","1343","     * Inner class that acts as a compound key for time zone names.","1344","     * <\/p>","1359","        TimeZoneDisplayKey(final TimeZone timeZone, final boolean daylight, final int style, final Locale locale) {","1374","            return (mStyle * 31 + mLocale.hashCode()) * 31 + mTimeZone.hashCode();","1386","                final TimeZoneDisplayKey other = (TimeZoneDisplayKey) obj;","1387","                return mTimeZone.equals(other.mTimeZone) && mStyle == other.mStyle && mLocale.equals(other.mLocale);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/DatePatternConverter.java":[{"add":["78","            return fastDateFormat.getPattern();"],"delete":["78","            return fastDateFormat.toPattern();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/FastDateFormat.java":[{"add":["28"," * <p>FastDateFormat is a fast and thread-safe version of","29"," * {@link java.text.SimpleDateFormat}.<\/p>","30"," *","31"," * <p>To obtain an instance of FastDateFormat, use one of the static factory methods: ","32"," * {@link #getInstance(String, TimeZone, Locale)}, {@link #getDateInstance(int, TimeZone, Locale)}, ","33"," * {@link #getTimeInstance(int, TimeZone, Locale)}, or {@link #getDateTimeInstance(int, int, TimeZone, Locale)} ","34"," * <\/p>","35"," * ","36"," * <p>Since FastDateFormat is thread safe, you can use a static member instance:<\/p>","37"," * <code>","38"," *   private static final FastDateFormat DATE_FORMATTER = FastDateFormat.getDateTimeInstance(FastDateFormat.LONG, FastDateFormat.SHORT);","39"," * <\/code>","40"," * ","41"," * <p>This class can be used as a direct replacement to","42"," * {@code SimpleDateFormat} in most formatting and parsing situations.","43"," * This class is especially useful in multi-threaded server environments.","44"," * {@code SimpleDateFormat} is not thread-safe in any JDK version,","45"," * nor will it be as Sun have closed the bug\/RFE.","46"," * <\/p>","47"," *","48"," * <p>All patterns are compatible with","49"," * SimpleDateFormat (except time zones and some year patterns - see below).<\/p>","50"," *","51"," * <p>Since 3.2, FastDateFormat supports parsing as well as printing.<\/p>","52"," *","53"," * <p>Java 1.4 introduced a new pattern letter, {@code 'Z'}, to represent","54"," * time zones in RFC822 format (eg. {@code +0800} or {@code -1100}).","55"," * This pattern letter can be used here (on all JDK versions).<\/p>","56"," *","57"," * <p>In addition, the pattern {@code 'ZZ'} has been made to represent","58"," * ISO 8601 extended format time zones (eg. {@code +08:00} or {@code -11:00}).","59"," * This introduces a minor incompatibility with Java 1.4, but at a gain of","60"," * useful functionality.<\/p>","61"," *","62"," * <p>Javadoc cites for the year pattern: <i>For formatting, if the number of","63"," * pattern letters is 2, the year is truncated to 2 digits; otherwise it is","64"," * interpreted as a number.<\/i> Starting with Java 1.7 a pattern of 'Y' or","65"," * 'YYY' will be formatted as '2003', while it was '03' in former Java","66"," * versions. FastDateFormat implements the behavior of Java 7.<\/p>","67"," * ","68"," * <p>","69"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","70"," * <\/p>","71"," * ","72"," * @since Apache Commons Lang 2.0","74","public class FastDateFormat extends Format implements DateParser, DatePrinter {","75","    ","76","    \/**","77","     * Required for serialization support.","78","     *","79","     * @see java.io.Serializable","80","     *\/","81","    @SuppressWarnings(\"unused\")","82","    private static final long serialVersionUID = 2L;","101","    private static final FormatCache<FastDateFormat> cache= new FormatCache<FastDateFormat>() {","111","    \/\/-----------------------------------------------------------------------","113","     * <p>Gets a formatter instance using the default pattern in the","114","     * default locale.<\/p>","116","     * @return a date\/time formatter","117","     *\/","118","    public static FastDateFormat getInstance() {","119","        return cache.getInstance();","120","    }","121","","122","    \/**","123","     * <p>Gets a formatter instance using the specified pattern in the","124","     * default locale.<\/p>","125","     *","126","     * @param pattern  {@link java.text.SimpleDateFormat} compatible","127","     *  pattern","128","     * @return a pattern based date\/time formatter","129","     * @throws IllegalArgumentException if pattern is invalid","130","     *\/","131","    public static FastDateFormat getInstance(final String pattern) {","132","        return cache.getInstance(pattern, null, null);","133","    }","134","","135","    \/**","136","     * <p>Gets a formatter instance using the specified pattern and","137","     * time zone.<\/p>","138","     *","139","     * @param pattern  {@link java.text.SimpleDateFormat} compatible","140","     *  pattern","141","     * @param timeZone  optional time zone, overrides time zone of","142","     *  formatted date","143","     * @return a pattern based date\/time formatter","144","     * @throws IllegalArgumentException if pattern is invalid","145","     *\/","146","    public static FastDateFormat getInstance(final String pattern, final TimeZone timeZone) {","147","        return cache.getInstance(pattern, timeZone, null);","148","    }","149","","150","    \/**","151","     * <p>Gets a formatter instance using the specified pattern and","152","     * locale.<\/p>","153","     *","154","     * @param pattern  {@link java.text.SimpleDateFormat} compatible","155","     *  pattern","156","     * @param locale  optional locale, overrides system locale","157","     * @return a pattern based date\/time formatter","158","     * @throws IllegalArgumentException if pattern is invalid","159","     *\/","160","    public static FastDateFormat getInstance(final String pattern, final Locale locale) {","161","        return cache.getInstance(pattern, null, locale);","162","    }","163","","164","    \/**","165","     * <p>Gets a formatter instance using the specified pattern, time zone","166","     * and locale.<\/p>","167","     *","168","     * @param pattern  {@link java.text.SimpleDateFormat} compatible","169","     *  pattern","170","     * @param timeZone  optional time zone, overrides time zone of","171","     *  formatted date","172","     * @param locale  optional locale, overrides system locale","173","     * @return a pattern based date\/time formatter","174","     * @throws IllegalArgumentException if pattern is invalid","175","     *  or {@code null}","176","     *\/","177","    public static FastDateFormat getInstance(final String pattern, final TimeZone timeZone, final Locale locale) {","178","        return cache.getInstance(pattern, timeZone, locale);","179","    }","180","","181","    \/\/-----------------------------------------------------------------------","182","    \/**","183","     * <p>Gets a date formatter instance using the specified style in the","184","     * default time zone and locale.<\/p>","185","     *","186","     * @param style  date style: FULL, LONG, MEDIUM, or SHORT","187","     * @return a localized standard date formatter","188","     * @throws IllegalArgumentException if the Locale has no date","189","     *  pattern defined","190","     * @since 2.1","191","     *\/","192","    public static FastDateFormat getDateInstance(final int style) {","193","        return cache.getDateInstance(style, null, null);","194","    }","195","","196","    \/**","197","     * <p>Gets a date formatter instance using the specified style and","198","     * locale in the default time zone.<\/p>","199","     *","200","     * @param style  date style: FULL, LONG, MEDIUM, or SHORT","201","     * @param locale  optional locale, overrides system locale","202","     * @return a localized standard date formatter","203","     * @throws IllegalArgumentException if the Locale has no date","204","     *  pattern defined","205","     * @since 2.1","206","     *\/","207","    public static FastDateFormat getDateInstance(final int style, final Locale locale) {","208","        return cache.getDateInstance(style, null, locale);","209","    }","210","","211","    \/**","212","     * <p>Gets a date formatter instance using the specified style and","213","     * time zone in the default locale.<\/p>","214","     *","215","     * @param style  date style: FULL, LONG, MEDIUM, or SHORT","216","     * @param timeZone  optional time zone, overrides time zone of","217","     *  formatted date","218","     * @return a localized standard date formatter","219","     * @throws IllegalArgumentException if the Locale has no date","220","     *  pattern defined","221","     * @since 2.1","222","     *\/","223","    public static FastDateFormat getDateInstance(final int style, final TimeZone timeZone) {","224","        return cache.getDateInstance(style, timeZone, null);","225","    }","226","","227","    \/**","228","     * <p>Gets a date formatter instance using the specified style, time","229","     * zone and locale.<\/p>","230","     *","231","     * @param style  date style: FULL, LONG, MEDIUM, or SHORT","232","     * @param timeZone  optional time zone, overrides time zone of","233","     *  formatted date","234","     * @param locale  optional locale, overrides system locale","235","     * @return a localized standard date formatter","236","     * @throws IllegalArgumentException if the Locale has no date","237","     *  pattern defined","238","     *\/","239","    public static FastDateFormat getDateInstance(final int style, final TimeZone timeZone, final Locale locale) {","240","        return cache.getDateInstance(style, timeZone, locale);","241","    }","242","","243","    \/\/-----------------------------------------------------------------------","244","    \/**","245","     * <p>Gets a time formatter instance using the specified style in the","246","     * default time zone and locale.<\/p>","247","     *","248","     * @param style  time style: FULL, LONG, MEDIUM, or SHORT","249","     * @return a localized standard time formatter","250","     * @throws IllegalArgumentException if the Locale has no time","251","     *  pattern defined","252","     * @since 2.1","253","     *\/","254","    public static FastDateFormat getTimeInstance(final int style) {","255","        return cache.getTimeInstance(style, null, null);","256","    }","257","","258","    \/**","259","     * <p>Gets a time formatter instance using the specified style and","260","     * locale in the default time zone.<\/p>","261","     *","262","     * @param style  time style: FULL, LONG, MEDIUM, or SHORT","263","     * @param locale  optional locale, overrides system locale","264","     * @return a localized standard time formatter","265","     * @throws IllegalArgumentException if the Locale has no time","266","     *  pattern defined","267","     * @since 2.1","268","     *\/","269","    public static FastDateFormat getTimeInstance(final int style, final Locale locale) {","270","        return cache.getTimeInstance(style, null, locale);","271","    }","272","","273","    \/**","274","     * <p>Gets a time formatter instance using the specified style and","275","     * time zone in the default locale.<\/p>","276","     *","277","     * @param style  time style: FULL, LONG, MEDIUM, or SHORT","278","     * @param timeZone  optional time zone, overrides time zone of","279","     *  formatted time","280","     * @return a localized standard time formatter","281","     * @throws IllegalArgumentException if the Locale has no time","282","     *  pattern defined","283","     * @since 2.1","284","     *\/","285","    public static FastDateFormat getTimeInstance(final int style, final TimeZone timeZone) {","286","        return cache.getTimeInstance(style, timeZone, null);","287","    }","288","","289","    \/**","290","     * <p>Gets a time formatter instance using the specified style, time","291","     * zone and locale.<\/p>","292","     *","293","     * @param style  time style: FULL, LONG, MEDIUM, or SHORT","294","     * @param timeZone  optional time zone, overrides time zone of","295","     *  formatted time","296","     * @param locale  optional locale, overrides system locale","297","     * @return a localized standard time formatter","298","     * @throws IllegalArgumentException if the Locale has no time","299","     *  pattern defined","300","     *\/","301","    public static FastDateFormat getTimeInstance(final int style, final TimeZone timeZone, final Locale locale) {","302","        return cache.getTimeInstance(style, timeZone, locale);","303","    }","304","","305","    \/\/-----------------------------------------------------------------------","306","    \/**","307","     * <p>Gets a date\/time formatter instance using the specified style","308","     * in the default time zone and locale.<\/p>","309","     *","310","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","311","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","312","     * @return a localized standard date\/time formatter","313","     * @throws IllegalArgumentException if the Locale has no date\/time","314","     *  pattern defined","315","     * @since 2.1","316","     *\/","317","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle) {","318","        return cache.getDateTimeInstance(dateStyle, timeStyle, null, null);","319","    }","320","","321","    \/**","322","     * <p>Gets a date\/time formatter instance using the specified style and","323","     * locale in the default time zone.<\/p>","324","     *","325","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","326","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","327","     * @param locale  optional locale, overrides system locale","328","     * @return a localized standard date\/time formatter","329","     * @throws IllegalArgumentException if the Locale has no date\/time","330","     *  pattern defined","331","     * @since 2.1","332","     *\/","333","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle, final Locale locale) {","334","        return cache.getDateTimeInstance(dateStyle, timeStyle, null, locale);","335","    }","336","","337","    \/**","338","     * <p>Gets a date\/time formatter instance using the specified style and","339","     * time zone in the default locale.<\/p>","340","     *","341","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","342","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","343","     * @param timeZone  optional time zone, overrides time zone of","344","     *  formatted date","345","     * @return a localized standard date\/time formatter","346","     * @throws IllegalArgumentException if the Locale has no date\/time","347","     *  pattern defined","348","     * @since 2.1","349","     *\/","350","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle, final TimeZone timeZone) {","351","        return getDateTimeInstance(dateStyle, timeStyle, timeZone, null);","352","    }","353","    \/**","354","     * <p>Gets a date\/time formatter instance using the specified style,","355","     * time zone and locale.<\/p>","356","     *","357","     * @param dateStyle  date style: FULL, LONG, MEDIUM, or SHORT","358","     * @param timeStyle  time style: FULL, LONG, MEDIUM, or SHORT","359","     * @param timeZone  optional time zone, overrides time zone of","360","     *  formatted date","361","     * @param locale  optional locale, overrides system locale","362","     * @return a localized standard date\/time formatter","363","     * @throws IllegalArgumentException if the Locale has no date\/time","364","     *  pattern defined","365","     *\/","366","    public static FastDateFormat getDateTimeInstance(","367","            final int dateStyle, final int timeStyle, final TimeZone timeZone, final Locale locale) {","368","        return cache.getDateTimeInstance(dateStyle, timeStyle, timeZone, locale);","369","    }","370","","371","    \/\/ Constructor","372","    \/\/-----------------------------------------------------------------------","373","    \/**","374","     * <p>Constructs a new FastDateFormat.<\/p>","375","     *","376","     * @param pattern  {@link java.text.SimpleDateFormat} compatible pattern","377","     * @param timeZone  non-null time zone to use","378","     * @param locale  non-null locale to use","386","    \/\/-----------------------------------------------------------------------","388","     * <p>Constructs a new FastDateFormat.<\/p>","390","     * @param pattern  {@link java.text.SimpleDateFormat} compatible pattern","391","     * @param timeZone  non-null time zone to use","392","     * @param locale  non-null locale to use","393","     * @param centuryStart The start of the 100 year period to use as the \"default century\" for 2 digit year parsing.  If centuryStart is null, defaults to now - 80 years","396","    protected FastDateFormat(final String pattern, final TimeZone timeZone, final Locale locale, final Date centuryStart) {","397","        printer= new FastDatePrinter(pattern, timeZone, locale);","398","        parser= new FastDateParser(pattern, timeZone, locale, centuryStart);","402","    \/\/-----------------------------------------------------------------------","404","     * <p>Formats a {@code Date}, {@code Calendar} or","405","     * {@code Long} (milliseconds) object.<\/p>","406","     * This method is an implementation of {@link Format#format(Object, StringBuilder, FieldPosition)}","408","     * @param obj  the object to format","409","     * @param toAppendTo  the buffer to append to","410","     * @param pos  the position - ignored","415","        return toAppendTo.append(printer.format(obj));","419","     * <p>Formats a millisecond {@code long} value.<\/p>","421","     * @param millis  the millisecond value to format","431","     * <p>Formats a {@code Date} object using a {@code GregorianCalendar}.<\/p>","433","     * @param date  the date to format","442","     * <p>Formats a {@code Calendar} object.<\/p>","444","     * @param calendar  the calendar to format","453","     * <p>Formats a millisecond {@code long} value into the","454","     * supplied {@code StringBuffer}.<\/p>","456","     * @param millis  the millisecond value to format","457","     * @param buf  the buffer to format into","459","     * @since 3.5","462","    public <B extends Appendable> B format(final long millis, final B buf) {","467","     * <p>Formats a {@code Date} object into the","468","     * supplied {@code StringBuffer} using a {@code GregorianCalendar}.<\/p>","470","     * @param date  the date to format","471","     * @param buf  the buffer to format into","473","     * @since 3.5","476","    public <B extends Appendable> B format(final Date date, final B buf) {","481","     * <p>Formats a {@code Calendar} object into the","482","     * supplied {@code StringBuffer}.<\/p>","484","     * @param calendar  the calendar to format","485","     * @param buf  the buffer to format into","487","     * @since 3.5","488","    *\/","490","    public <B extends Appendable> B format(final Calendar calendar, final B buf) {","495","    \/\/-----------------------------------------------------------------------","497","","498","    \/* (non-Javadoc)","506","    \/* (non-Javadoc)","516","     * @see org.apache.commons.lang3.time.DateParser#parse(java.lang.String, java.text.ParsePosition, java.util.Calendar)","517","     *\/","518","    @Override","519","    public boolean parse(final String source, final ParsePosition pos, final Calendar calendar) {","520","        return parser.parse(source, pos, calendar);","521","    }","522","","523","    \/* (non-Javadoc)","532","    \/\/-----------------------------------------------------------------------","534","     * <p>Gets the pattern used by this formatter.<\/p>","544","     * <p>Gets the time zone used by this formatter.<\/p>","546","     * <p>This zone is always used for {@code Date} formatting. <\/p>","556","     * <p>Gets the locale used by this formatter.<\/p>","566","     * <p>Gets an estimate for the maximum string length that the","567","     * formatter will produce.<\/p>","569","     * <p>The actual formatted length will almost always be less than or","570","     * equal to this amount.<\/p>","579","    \/\/-----------------------------------------------------------------------","581","     * <p>Compares two objects for equality.<\/p>","583","     * @param obj  the object to compare to","588","        if (obj instanceof FastDateFormat == false) {","597","     * <p>Returns a hash code compatible with equals.<\/p>","607","     * <p>Gets a debugging string version of this formatter.<\/p>","613","        return \"FastDateFormat[\" + printer.getPattern() + \",\" + printer.getLocale() + \",\" + printer.getTimeZone().getID() + \"]\";"],"delete":["18","import java.io.Serializable;","29"," * This is a copy of Commons Lang's Fast Date Formatter.","31","public class FastDateFormat extends Format implements DatePrinter, DateParser, Serializable {","50","    \/**","51","     * Required for serialization support.","52","     *","53","     * @see java.io.Serializable","54","     *\/","55","    private static final long serialVersionUID = 2L;","56","","57","    private static final FormatCache<FastDateFormat> CACHE = new FormatCache<FastDateFormat>() {","67","    \/\/ Constructor","68","    \/\/ -----------------------------------------------------------------------","70","     * <p>","71","     * Constructs a new FastDateFormat.","72","     * <\/p>","74","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","75","     * @param timeZone non-null time zone to use","76","     * @param locale non-null locale to use","84","    \/\/ -----------------------------------------------------------------------","86","     * <p>","87","     * Constructs a new FastDateFormat.","88","     * <\/p>","90","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","91","     * @param timeZone non-null time zone to use","92","     * @param locale non-null locale to use","93","     * @param centuryStart The start of the 100 year period to use as the \"default century\" for 2 digit year parsing.","94","     *            If centuryStart is null, defaults to now - 80 years","97","    protected FastDateFormat(final String pattern, final TimeZone timeZone, final Locale locale,","98","            final Date centuryStart) {","99","        printer = new FastDatePrinter(pattern, timeZone, locale);","100","        parser = new FastDateParser(pattern, timeZone, locale, centuryStart);","101","    }","102","","103","    \/\/ -----------------------------------------------------------------------","104","    \/**","105","     * <p>","106","     * Gets a formatter instance using the default pattern in the default locale.","107","     * <\/p>","108","     *","109","     * @return a date\/time formatter","110","     *\/","111","    public static FastDateFormat getInstance() {","112","        return CACHE.getInstance();","113","    }","114","","115","    \/**","116","     * <p>","117","     * Gets a formatter instance using the specified pattern in the default locale.","118","     * <\/p>","119","     *","120","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","121","     * @return a pattern based date\/time formatter","122","     * @throws IllegalArgumentException if pattern is invalid","123","     *\/","124","    public static FastDateFormat getInstance(final String pattern) {","125","        return CACHE.getInstance(pattern, null, null);","126","    }","127","","128","    \/**","129","     * <p>","130","     * Gets a formatter instance using the specified pattern and time zone.","131","     * <\/p>","132","     *","133","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","134","     * @param timeZone optional time zone, overrides time zone of formatted date","135","     * @return a pattern based date\/time formatter","136","     * @throws IllegalArgumentException if pattern is invalid","137","     *\/","138","    public static FastDateFormat getInstance(final String pattern, final TimeZone timeZone) {","139","        return CACHE.getInstance(pattern, timeZone, null);","140","    }","141","","142","    \/**","143","     * <p>","144","     * Gets a formatter instance using the specified pattern and locale.","145","     * <\/p>","146","     *","147","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","148","     * @param locale optional locale, overrides system locale","149","     * @return a pattern based date\/time formatter","150","     * @throws IllegalArgumentException if pattern is invalid","151","     *\/","152","    public static FastDateFormat getInstance(final String pattern, final Locale locale) {","153","        return CACHE.getInstance(pattern, null, locale);","154","    }","155","","156","    \/**","157","     * <p>","158","     * Gets a formatter instance using the specified pattern, time zone and locale.","159","     * <\/p>","160","     *","161","     * @param pattern {@link java.text.SimpleDateFormat} compatible pattern","162","     * @param timeZone optional time zone, overrides time zone of formatted date","163","     * @param locale optional locale, overrides system locale","164","     * @return a pattern based date\/time formatter","165","     * @throws IllegalArgumentException if pattern is invalid or {@code null}","166","     *\/","167","    public static FastDateFormat getInstance(final String pattern, final TimeZone timeZone, final Locale locale) {","168","        return CACHE.getInstance(pattern, timeZone, locale);","169","    }","170","","171","    \/\/ -----------------------------------------------------------------------","172","    \/**","173","     * <p>","174","     * Gets a date formatter instance using the specified style in the default time zone and locale.","175","     * <\/p>","176","     *","177","     * @param style date style: FULL, LONG, MEDIUM, or SHORT","178","     * @return a localized standard date formatter","179","     * @throws IllegalArgumentException if the Locale has no date pattern defined","180","     * @since 2.1","181","     *\/","182","    public static FastDateFormat getDateInstance(final int style) {","183","        return CACHE.getDateInstance(style, null, null);","184","    }","185","","186","    \/**","187","     * <p>","188","     * Gets a date formatter instance using the specified style and locale in the default time zone.","189","     * <\/p>","190","     *","191","     * @param style date style: FULL, LONG, MEDIUM, or SHORT","192","     * @param locale optional locale, overrides system locale","193","     * @return a localized standard date formatter","194","     * @throws IllegalArgumentException if the Locale has no date pattern defined","195","     * @since 2.1","196","     *\/","197","    public static FastDateFormat getDateInstance(final int style, final Locale locale) {","198","        return CACHE.getDateInstance(style, null, locale);","199","    }","200","","201","    \/**","202","     * <p>","203","     * Gets a date formatter instance using the specified style and time zone in the default locale.","204","     * <\/p>","205","     *","206","     * @param style date style: FULL, LONG, MEDIUM, or SHORT","207","     * @param timeZone optional time zone, overrides time zone of formatted date","208","     * @return a localized standard date formatter","209","     * @throws IllegalArgumentException if the Locale has no date pattern defined","210","     * @since 2.1","211","     *\/","212","    public static FastDateFormat getDateInstance(final int style, final TimeZone timeZone) {","213","        return CACHE.getDateInstance(style, timeZone, null);","214","    }","215","","216","    \/**","217","     * <p>","218","     * Gets a date formatter instance using the specified style, time zone and locale.","219","     * <\/p>","220","     *","221","     * @param style date style: FULL, LONG, MEDIUM, or SHORT","222","     * @param timeZone optional time zone, overrides time zone of formatted date","223","     * @param locale optional locale, overrides system locale","224","     * @return a localized standard date formatter","225","     * @throws IllegalArgumentException if the Locale has no date pattern defined","226","     *\/","227","    public static FastDateFormat getDateInstance(final int style, final TimeZone timeZone, final Locale locale) {","228","        return CACHE.getDateInstance(style, timeZone, locale);","229","    }","230","","231","    \/\/ -----------------------------------------------------------------------","232","    \/**","233","     * <p>","234","     * Gets a time formatter instance using the specified style in the default time zone and locale.","235","     * <\/p>","236","     *","237","     * @param style time style: FULL, LONG, MEDIUM, or SHORT","238","     * @return a localized standard time formatter","239","     * @throws IllegalArgumentException if the Locale has no time pattern defined","240","     * @since 2.1","241","     *\/","242","    public static FastDateFormat getTimeInstance(final int style) {","243","        return CACHE.getTimeInstance(style, null, null);","244","    }","245","","246","    \/**","247","     * <p>","248","     * Gets a time formatter instance using the specified style and locale in the default time zone.","249","     * <\/p>","250","     *","251","     * @param style time style: FULL, LONG, MEDIUM, or SHORT","252","     * @param locale optional locale, overrides system locale","253","     * @return a localized standard time formatter","254","     * @throws IllegalArgumentException if the Locale has no time pattern defined","255","     * @since 2.1","256","     *\/","257","    public static FastDateFormat getTimeInstance(final int style, final Locale locale) {","258","        return CACHE.getTimeInstance(style, null, locale);","259","    }","260","","261","    \/**","262","     * <p>","263","     * Gets a time formatter instance using the specified style and time zone in the default locale.","264","     * <\/p>","265","     *","266","     * @param style time style: FULL, LONG, MEDIUM, or SHORT","267","     * @param timeZone optional time zone, overrides time zone of formatted time","268","     * @return a localized standard time formatter","269","     * @throws IllegalArgumentException if the Locale has no time pattern defined","270","     * @since 2.1","271","     *\/","272","    public static FastDateFormat getTimeInstance(final int style, final TimeZone timeZone) {","273","        return CACHE.getTimeInstance(style, timeZone, null);","274","    }","275","","276","    \/**","277","     * <p>","278","     * Gets a time formatter instance using the specified style, time zone and locale.","279","     * <\/p>","280","     *","281","     * @param style time style: FULL, LONG, MEDIUM, or SHORT","282","     * @param timeZone optional time zone, overrides time zone of formatted time","283","     * @param locale optional locale, overrides system locale","284","     * @return a localized standard time formatter","285","     * @throws IllegalArgumentException if the Locale has no time pattern defined","286","     *\/","287","    public static FastDateFormat getTimeInstance(final int style, final TimeZone timeZone, final Locale locale) {","288","        return CACHE.getTimeInstance(style, timeZone, locale);","289","    }","290","","291","    \/\/ -----------------------------------------------------------------------","292","    \/**","293","     * <p>","294","     * Gets a date\/time formatter instance using the specified style in the default time zone and locale.","295","     * <\/p>","296","     *","297","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","298","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","299","     * @return a localized standard date\/time formatter","300","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","301","     * @since 2.1","302","     *\/","303","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle) {","304","        return CACHE.getDateTimeInstance(dateStyle, timeStyle, null, null);","305","    }","306","","307","    \/**","308","     * <p>","309","     * Gets a date\/time formatter instance using the specified style and locale in the default time zone.","310","     * <\/p>","311","     *","312","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","313","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","314","     * @param locale optional locale, overrides system locale","315","     * @return a localized standard date\/time formatter","316","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","317","     * @since 2.1","318","     *\/","319","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle, final Locale locale) {","320","        return CACHE.getDateTimeInstance(dateStyle, timeStyle, null, locale);","321","    }","322","","323","    \/**","324","     * <p>","325","     * Gets a date\/time formatter instance using the specified style and time zone in the default locale.","326","     * <\/p>","327","     *","328","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","329","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","330","     * @param timeZone optional time zone, overrides time zone of formatted date","331","     * @return a localized standard date\/time formatter","332","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","333","     * @since 2.1","334","     *\/","335","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle,","336","            final TimeZone timeZone) {","337","        return getDateTimeInstance(dateStyle, timeStyle, timeZone, null);","338","    }","339","","340","    \/**","341","     * <p>","342","     * Gets a date\/time formatter instance using the specified style, time zone and locale.","343","     * <\/p>","344","     *","345","     * @param dateStyle date style: FULL, LONG, MEDIUM, or SHORT","346","     * @param timeStyle time style: FULL, LONG, MEDIUM, or SHORT","347","     * @param timeZone optional time zone, overrides time zone of formatted date","348","     * @param locale optional locale, overrides system locale","349","     * @return a localized standard date\/time formatter","350","     * @throws IllegalArgumentException if the Locale has no date\/time pattern defined","351","     *\/","352","    public static FastDateFormat getDateTimeInstance(final int dateStyle, final int timeStyle,","353","            final TimeZone timeZone, final Locale locale) {","354","        return CACHE.getDateTimeInstance(dateStyle, timeStyle, timeZone, locale);","358","    \/\/ -----------------------------------------------------------------------","360","     * <p>","361","     * Formats a {@code Date}, {@code Calendar} or {@code Long} (milliseconds) object.","362","     * <\/p>","364","     * @param obj the object to format","365","     * @param toAppendTo the buffer to append to","366","     * @param pos the position - ignored","371","        return printer.format(obj, toAppendTo, pos);","375","     * <p>","376","     * Formats a millisecond {@code long} value.","377","     * <\/p>","379","     * @param millis the millisecond value to format","389","     * <p>","390","     * Formats a {@code Date} object using a {@code GregorianCalendar}.","391","     * <\/p>","393","     * @param date the date to format","402","     * <p>","403","     * Formats a {@code Calendar} object.","404","     * <\/p>","406","     * @param calendar the calendar to format","415","     * <p>","416","     * Formats a millisecond {@code long} value into the supplied {@code StringBuilder}.","417","     * <\/p>","419","     * @param millis the millisecond value to format","420","     * @param buf the buffer to format into","422","     * @since 2.1","425","    public StringBuilder format(final long millis, final StringBuilder buf) {","430","     * <p>","431","     * Formats a {@code Date} object into the supplied {@code StringBuilder} using a {@code GregorianCalendar}.","432","     * <\/p>","434","     * @param date the date to format","435","     * @param buf the buffer to format into","439","    public StringBuilder format(final Date date, final StringBuilder buf) {","444","     * <p>","445","     * Formats a {@code Calendar} object into the supplied {@code StringBuilder}.","446","     * <\/p>","448","     * @param calendar the calendar to format","449","     * @param buf the buffer to format into","451","     *\/","453","    public StringBuilder format(final Calendar calendar, final StringBuilder buf) {","458","    \/\/ -----------------------------------------------------------------------","460","    \/*","461","     * (non-Javadoc)","462","     * ","470","    \/*","471","     * (non-Javadoc)","472","     * ","482","     * ","491","    \/\/ -----------------------------------------------------------------------","493","     * <p>","494","     * Gets the pattern used by this formatter.","495","     * <\/p>","505","     * <p>","506","     * Gets the time zone used by this formatter.","507","     * <\/p>","509","     * <p>","510","     * This zone is always used for {@code Date} formatting.","511","     * <\/p>","521","     * <p>","522","     * Gets the locale used by this formatter.","523","     * <\/p>","533","     * <p>","534","     * Gets an estimate for the maximum string length that the formatter will produce.","535","     * <\/p>","537","     * <p>","538","     * The actual formatted length will almost always be less than or equal to this amount.","539","     * <\/p>","547","    public String toPattern() {","548","        return printer.getPattern();","549","    }","550","","552","    \/\/ -----------------------------------------------------------------------","554","     * <p>","555","     * Compares two objects for equality.","556","     * <\/p>","558","     * @param obj the object to compare to","563","        if (!(obj instanceof FastDateFormat)) {","572","     * <p>","573","     * Returns a hash code compatible with equals.","574","     * <\/p>","584","     * <p>","585","     * Gets a debugging string version of this formatter.","586","     * <\/p>","592","        return \"FastDateFormat[\" + printer.getPattern() + \",\" + printer.getLocale() + \",\"","593","                + printer.getTimeZone().getID() + \"]\";","595","","596","    \/**","597","     * <p>","598","     * Performs the formatting by applying the rules to the specified calendar.","599","     * <\/p>","600","     *","601","     * @param calendar the calendar to format","602","     * @param buf the buffer to format into","603","     * @return the specified string buffer","604","     *\/","605","    protected StringBuilder applyRules(final Calendar calendar, final StringBuilder buf) {","606","        return printer.applyRules(calendar, buf);","607","    }","608","","609","    @Override","610","    public boolean parse(String source, ParsePosition pos, Calendar calendar) {","611","        return parser.parse(source, pos, calendar);","612","    }","613",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/datetime\/DateParser.java":[{"add":["26"," * DateParser is the \"missing\" interface for the parsing methods of","27"," * {@link java.text.DateFormat}. You can obtain an object implementing this","28"," * interface by using one of the FastDateFormat factory methods.","29"," * <p>","30"," * Warning: Since binary compatible methods may be added to this interface in any","31"," * release, developers are not expected to implement this interface.","32"," * ","33"," * <p>","34"," * Copied and modified from <a href=\"https:\/\/commons.apache.org\/proper\/commons-lang\/\">Apache Commons Lang<\/a>.","35"," * <\/p>","36"," * ","37"," * @since Apache Commons Lang 3.2","42","     * Equivalent to DateFormat.parse(String). ","44","     * See {@link java.text.DateFormat#parse(String)} for more information. ","45","     * @param source A <code>String<\/code> whose beginning should be parsed. ","52","     * Equivalent to DateFormat.parse(String, ParsePosition). ","54","     * See {@link java.text.DateFormat#parse(String, ParsePosition)} for more information. ","57","     * @param pos A <code>ParsePosition<\/code> object with index and error index information ","58","     * as described above. ","59","     * @return A <code>Date<\/code> parsed from the string. In case of error, returns null. ","76","     * ","77","     * @since 3.5","82","    \/\/-----------------------------------------------------------------------","84","     * <p>Gets the pattern used by this parser.<\/p>","91","     * <p>","93","     * <\/p>","96","     * The default {@link TimeZone} used to create a {@link Date} when the {@link TimeZone} is not specified by","97","     * the format pattern.","105","     * <p>Gets the locale used by this parser.<\/p>","117","     * @see java.text.DateFormat#parseObject(String) ","127","     * @see java.text.DateFormat#parseObject(String, ParsePosition) "],"delete":["26"," * Copied from Commons Lang 3.","31","     * Equivalent to DateFormat.parse(String).","33","     * See {@link java.text.DateFormat#parse(String)} for more information.","34","     * ","35","     * @param source A <code>String<\/code> whose beginning should be parsed.","42","     * Equivalent to DateFormat.parse(String, ParsePosition).","44","     * See {@link java.text.DateFormat#parse(String, ParsePosition)} for more information.","47","     * @param pos A <code>ParsePosition<\/code> object with index and error index information as described above.","48","     * @return A <code>Date<\/code> parsed from the string. In case of error, returns null.","69","    \/\/ -----------------------------------------------------------------------","71","     * Gets the pattern used by this parser.","81","     * The default {@link TimeZone} used to create a {@link Date} when the {@link TimeZone} is not specified by the","82","     * format pattern.","90","     * Gets the locale used by this parser.","102","     * @see java.text.DateFormat#parseObject(String)","112","     * @see java.text.DateFormat#parseObject(String, ParsePosition)","115",""]}]}},"a6c42300973a1770698d280970e5b334cde323e7":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/Jira739Test.java":"ADD","log4j-core\/src\/test\/resources\/LOG4J2-739.xml":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/Jira739Test.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/resources\/LOG4J2-739.xml":[{"add":[],"delete":[]}]}},"97ebed83bfc3ebf313e8979525a15e86b9911a3f":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-981\" dev=\"ggregory\" type=\"fix\" due-to=\"Mikhail Mazurskiy\">","33","        Incorrect unlock in ProviderUtil.","34","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/ProviderUtil.java":[{"add":["119","                try {","120","                    if (INSTANCE == null) {","121","                        INSTANCE = new ProviderUtil();","122","                    }","123","                } finally {","124","                    STARTUP_LOCK.unlock();"],"delete":["119","                if (INSTANCE == null) {","120","                    INSTANCE = new ProviderUtil();","125","            } finally {","126","                STARTUP_LOCK.unlock();"]}]}},"9c230639dffc3c13b91a7194644e219825e6a84c":{"changes":{"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolverTest.java":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":"MODIFY"},"diff":{"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolverTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["68","      <action issue=\"LOG4J2-3087\" dev=\"vy\" type=\"fix\" due-to=\"Anton Klar¨¦n\">","69","        Fix race in JsonTemplateLayout where a timestamp could end up unquoted.","70","      <\/action>"],"delete":[]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":[{"add":["312","            if (formatResolverContext.formattedTimestampBuilder.length() == 0 || formatResolverContext.calendar.getTimeInMillis() != timestampMillis) {","506","    \/**","507","     * Visible for tests","508","     *\/","509","    Calendar getCalendar() {","510","        return ((FormatResolver) internalResolver).formatResolverContext.calendar;","511","    }","512",""],"delete":["232","            timestampFormat.format(calendar, formattedTimestampBuilder);","313","            if (formatResolverContext.calendar.getTimeInMillis() != timestampMillis) {"]}]}},"01cf5b000fe83b5b29217589aa648b7d5ef00427":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsAppender.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/JmsAppender.java":[{"add":["219","            JndiManager jndiManager = null;","221","                jndiManager = JndiManager.getJndiManager(factoryName, providerUrl, urlPkgPrefixes,","222","                        securityPrincipalName, securityCredentials, null);","223","                actualJmsManager = JmsManager.getJmsManager(name, jndiManager, factoryBindingName,","224","                        destinationBindingName, userName, password);","230","                if (jndiManager != null) {","231","                    jndiManager.stop(500, TimeUnit.MILLISECONDS);","232","                }"],"delete":["220","            final JndiManager jndiManager = JndiManager.getJndiManager(factoryName, providerUrl, urlPkgPrefixes,","221","                securityPrincipalName, securityCredentials, null);","222","            actualJmsManager = JmsManager.getJmsManager(name, jndiManager, factoryBindingName,","223","                destinationBindingName, userName, password);"]}],"src\/changes\/changes.xml":[{"add":["45","      <action issue=\"LOG4J2-1953\" dev=\"ggregory\" type=\"fix\">","46","        JndiManager is not released when the JmsAppender builder catches an exception trying to build itself.","47","      <\/action>"],"delete":[]}]}},"c67cab7b8c43dac7ac0eaa997cc6785b62d5738d":{"changes":{"log4j-core\/src\/test\/resources\/log4j2-962.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayoutMainMapLookupTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/resources\/log4j2-962.xml":[{"add":["24","    <File name=\"File\" fileName=\"target\/${main:0}.log\" bufferedIO=\"false\">","25","      <PatternLayout>","26","        <Pattern>%d %m%n<\/Pattern>","27","      <\/PatternLayout>","28","    <\/File>    "],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayoutMainMapLookupTest.java":[{"add":["22","import org.apache.logging.log4j.core.appender.FileAppender;\r","44","    public void testFileName() {\r","45","        FileAppender fileApp = (FileAppender) context.getRequiredAppender(\"File\");\r","46","        final String name = fileApp.getFileName();\r","47","        Assert.assertEquals(\"target\/value0.log\", name);\r","48","    }\r","49","\r","50","    @Test\r","52","        ListAppender listApp = context.getListAppender(\"List\");\r","61","\r"],"delete":["38","    \r","39","    private ListAppender listApp;\r","46","        listApp = context.getListAppender(\"List\");\r"]}]}},"224a9ec0a1e4976f52e74c3618a82d72a55981f0":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["119","      <action issue=\"LOG4J2-1196\" dev=\"mattsicker\" type=\"fix\" due-to=\"Ren¨¦ Zanner\">","120","        MongoDbConnection does not close MongoClient.","121","      <\/action>"],"delete":[]}]}},"97624123cf8bc152cfc0acc67c2b432947044732":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-801\" dev=\"mattsicker\" type=\"fix\">","42","        org.apache.logging.log4j.core.Logger should be serializable.","43","      <\/action>"],"delete":[]}]}},"e5394028c000008505991c45b8ce593422f7ac55":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThreadContextDataInjector.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThreadContextDataInjector.java":[{"add":["210","            int count = props == null ? 0 : props.size();"],"delete":["210","            int count = props.size();"]}],"src\/changes\/changes.xml":[{"add":["31","    <release version=\"2.13.3\" date=\"2020-05-10\" description=\"GA Release 2.13.3\">","32","      <action issue=\"LOG4J2-2838\" dev=\"rgoers\" type=\"fix\">","33","        Fix NullPointerException in ThreadContextDataInjector.","34","      <\/action>","35","    <\/release>"],"delete":[]}]}},"da2b9188e1871e02bd93558646568d2e0c08559d":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/ZipCompressAction.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/Action.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/helper\/FileRenameActionTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RolloverDescriptionImpl.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/package-info.java":"ADD","\/dev\/null":"DELETE","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/GZCompressAction.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RolloverDescription.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/AbstractAction.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/CompositeAction.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/ZipCompressAction.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/Action.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/helper\/FileRenameActionTest.java":[{"add":["18","import org.apache.logging.log4j.core.appender.rolling.action.FileRenameAction;"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RolloverDescriptionImpl.java":[{"add":["18","import org.apache.logging.log4j.core.appender.rolling.action.Action;"],"delete":["18","import org.apache.logging.log4j.core.appender.rolling.helper.Action;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/package-info.java":[{"add":[],"delete":[]}],"\/dev\/null":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/GZCompressAction.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["24","import org.apache.logging.log4j.core.appender.rolling.action.Action;","25","import org.apache.logging.log4j.core.appender.rolling.action.FileRenameAction;","26","import org.apache.logging.log4j.core.appender.rolling.action.GZCompressAction;","27","import org.apache.logging.log4j.core.appender.rolling.action.ZipCompressAction;"],"delete":["24","import org.apache.logging.log4j.core.appender.rolling.helper.Action;","25","import org.apache.logging.log4j.core.appender.rolling.helper.FileRenameAction;","26","import org.apache.logging.log4j.core.appender.rolling.helper.GZCompressAction;","27","import org.apache.logging.log4j.core.appender.rolling.helper.ZipCompressAction;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RolloverDescription.java":[{"add":["18","import org.apache.logging.log4j.core.appender.rolling.action.Action;"],"delete":["18","import org.apache.logging.log4j.core.appender.rolling.helper.Action;"]}],"src\/changes\/changes.xml":[{"add":["190","      <action issue=\"LOG4J2-528\" dev=\"ggregory\" type=\"update\">","191","        Rename package org.apache.logging.log4j.core.appender.rolling.helper to org.apache.logging.log4j.core.appender.rolling.action.","192","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/FileRenameAction.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["31","import org.apache.logging.log4j.core.appender.rolling.action.AbstractAction;","32","import org.apache.logging.log4j.core.appender.rolling.action.Action;"],"delete":["31","import org.apache.logging.log4j.core.appender.rolling.helper.AbstractAction;","32","import org.apache.logging.log4j.core.appender.rolling.helper.Action;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/AbstractAction.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/action\/CompositeAction.java":[{"add":[],"delete":[]}]}},"3cee912e394f6b6eca7d9913b60884027c92fd1b":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfig.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest.java":[{"add":["26","import org.apache.logging.log4j.core.config.AppenderRef;","28","import org.apache.logging.log4j.core.config.LoggerConfig;","64","    ","65","    @Test","66","    public void testIncludeLocationDefaultsToFalse() {","67","    \tLoggerConfig rootLoggerConfig = ","68","    \t\t\tAsyncLoggerConfig.RootLogger.createLogger(","69","    \t\t\t\t\tnull, \"INFO\", null, new AppenderRef[0], null, null, null);","70","    \tassertFalse(\"Include location should default to false for async logggers\",","71","    \t\t\t    rootLoggerConfig.isIncludeLocation());","72","    \t","73","    \tLoggerConfig loggerConfig =","74","    \t        AsyncLoggerConfig.createLogger(","75","    \t        \t\tnull, \"INFO\", \"com.foo.Bar\", null, new AppenderRef[0], null, null, null);","76","    \tassertFalse(\"Include location should default to false for async logggers\",","77","    \t\t\t    loggerConfig.isIncludeLocation());","78","    }"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-991\" dev=\"rpopma\" type=\"fix\" due-to=\"Ryan Rupp\">","27","        Async root logger config should default includeLocation to false.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfig.java":[{"add":["238","                    AsyncLoggerConfig.includeLocation(includeLocation));"],"delete":["238","                    includeLocation(includeLocation));"]}]}},"82fddc287c1fee698cbcad67778823d3123c4011":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1943\" dev=\"rgoers\" type=\"fix\">","34","        The eventPrefix attribute was being ignored in the RFC5424Layout.","35","      <\/action>"],"delete":[]}]}},"72629641696d4db7bde9f5afb046b0e4264fae4f":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-layout-template-json\/src\/test\/resources\/nullEventDelimitedJsonTemplateLayoutLogging.xml":"MODIFY","log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/JsonTemplateLayoutNullEventDelimiterTest.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3089\" dev=\"vy\" type=\"fix\" due-to=\"Tim Perry\">","72","        Fix sporadic JsonTemplateLayoutNullEventDelimiterTest failures on Windows.","73","      <\/action>"],"delete":[]}],"log4j-layout-template-json\/src\/test\/resources\/nullEventDelimitedJsonTemplateLayoutLogging.xml":[{"add":["21","            port=\"${sys:serverPort}\""],"delete":["21","            port=\"50514\""]}],"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/JsonTemplateLayoutNullEventDelimiterTest.java":[{"add":["33","class JsonTemplateLayoutNullEventDelimiterTest {","36","    void test() throws Exception {","39","        try (final TcpServer server = new TcpServer(0)) {","40","","41","            \/\/ Set the configuration.","42","            System.setProperty(","43","                    \"serverPort\",","44","                    String.valueOf(server.getPort()));","45","            System.setProperty(","46","                    \"log4j.configurationFile\",","47","                    \"nullEventDelimitedJsonTemplateLayoutLogging.xml\");","54","            \/\/ Set the expected bytes.","55","            final byte[] expectedBytes = {","56","                    '\"', 'f', 'o', 'o', '\"', '\\0',","57","                    '\"', 'b', 'a', 'r', '\"', '\\0'","58","            };","59","","120","        public int getPort() {","121","            return serverSocket.getLocalPort();","122","        }","123",""],"delete":["33","public class JsonTemplateLayoutNullEventDelimiterTest {","34","","35","    \/\/ Set the configuration.","36","    static {","37","        System.setProperty(","38","                \"log4j.configurationFile\",","39","                \"nullEventDelimitedJsonTemplateLayoutLogging.xml\");","40","    }","41","","42","    \/\/ Note that this port is hardcoded in the configuration file too!","43","    private static final int PORT = 50514;","46","    public void test() throws Exception {","47","","48","        \/\/ Set the expected bytes.","49","        final byte[] expectedBytes = {","50","                '\"', 'f', 'o', 'o', '\"', '\\0',","51","                '\"', 'b', 'a', 'r', '\"', '\\0'","52","        };","55","        try (final TcpServer server = new TcpServer(PORT)) {"]}]}},"62863cbd0e57bacde86fca68e91853927cdeff5f":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-2817\" dev=\"rgoers\" type=\"fix\" due-to=\"Trejkaz\">","33","        Allow the file size action to parse the value without being sensitive to the current locale.","34","      <\/action>"],"delete":[]}]}},"32cd96a25484b37b43b523bfd18186aa6c04cc72":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["242","      <action issue=\"LOG4J2-532\" dev=\"ggregory\" type=\"update\">","243","        Resource leak in Flume appender when it cannot create a BerkeleyDB db.","244","      <\/action>"],"delete":[]}],"log4j-flume-ng\/src\/main\/java\/org\/apache\/logging\/log4j\/flume\/appender\/FlumePersistentManager.java":[{"add":["392","            Database database = null;","393","            Environment environment = null;","416","                \/\/ For consistency, close database as well as environment even though it should never happen since the","417","                \/\/ database is that last thing in the block above, but this does guard against a future line being","418","                \/\/ inserted at the end that would bomb (like some debug logging).","419","                if (database != null) {","420","                    database.close();","421","                    database = null;","422","                }","423","                if (environment != null) {","424","                    environment.close();","425","                    environment = null;","426","                }"],"delete":["392","","393","            Database database;","394","            Environment environment;","404",""]}]}},"1883517b7e55623d8052403b6687c36120d3cb91":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/KeyStoreConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/KeyStoreConfiguration.java":[{"add":["53","     *         The standard name of the requested algorithm. See the Java Secure Socket Extension Reference Guide for information about these names.","65","        return new KeyStoreConfiguration(location, password, keyStoreType, keyManagerFactoryAlgorithm);"],"delete":["53","     *        TODO","65","        return new KeyStoreConfiguration(location, password, keyStoreType, null);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-966\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">","27","        KeyStoreConfiguration.createKeyStoreConfiguration() ignores keyManagerFactoryAlgorithm.","28","      <\/action>","30","        "],"delete":["27","        StringFormattedMessage serialization is incorrect."]}]}},"55f80f35060d60788393714514b1c27aa5773095":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["1268","              <th>Default<\/th>","1274","              <td><em>Required<\/em><\/td>","1277","                This can be any subinterface of <code>ConnectionFactory<\/code> as well.","1283","              <td><em>Required<\/em><\/td>","1285","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/javax\/naming\/Context.html#INITIAL_CONTEXT_FACTORY\">INITIAL_CONTEXT_FACTORY<\/a>.","1286","                If a factoryName is specified without a providerURL a warning message will be logged as this is ","1287","                likely to cause problems.","1288","              <\/td>","1293","              <td>null<\/td>","1300","              <td><em>Required<\/em><\/td>","1302","                The Layout to use to format the LogEvent.","1309","              <td><em>Required<\/em><\/td>","1310","              <td>The name of the Appender. <\/td>","1315","              <td>null<\/td>","1321","              <td><em>Required<\/em><\/td>","1323","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/javax\/naming\/Context.html#PROVIDER_URL\">PROVIDER_URL<\/a>.","1324","              <\/td>","1329","              <td><em>Required<\/em><\/td>","1341","              <td>null<\/td>","1343","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/javax\/naming\/Context.html#SECURITY_PRINCIPAL\">SECURITY_PRINCIPAL<\/a>.","1350","              <td>null<\/td>","1352","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/javax\/naming\/Context.html#SECURITY_CREDENTIALS\">SECURITY_CREDENTIALS<\/a>.","1358","              <td>true<\/td>","1359","              <td>When <code>true<\/code>, exceptions caught while appending events are","1360","                internally logged and then ignored. When <code>false<\/code> exceptions are propagated to the","1361","                caller. You must set this to <code>false<\/code> when wrapping this Appender in a","1367","              <td>false<\/td>","1374","              <td>5000<\/td>","1383","              <td>null<\/td>","1386","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/javax\/naming\/Context.html#URL_PKG_PREFIXES\">URL_PKG_PREFIXES<\/a>.","1392","              <td>null<\/td>","2625","                <a href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/java\/text\/SimpleDateFormat.html\">SimpleDateFormat<\/a>","3731","\t\t\t\t\t\t\t\thref=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/java\/text\/SimpleDateFormat.html\">","4507","                a valid <a href=\"http:\/\/download.oracle.com\/javase\/7\/docs\/api\/java\/nio\/charset\/Charset.html\">Charset<\/a>."],"delete":["1275","                This can be any subinterface of <code>ConnectionFactory<\/code> as well. This attribute is required.","1282","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/javax\/naming\/Context.html#INITIAL_CONTEXT_FACTORY\">INITIAL_CONTEXT_FACTORY<\/a>.","1283","                If no value is provided the","1284","                default InitialContextFactory will be used. If a factoryName is specified without a providerURL","1285","                a warning message will be logged as this is likely to cause problems.<\/td>","1297","                The Layout to use to format the LogEvent. Required, there is no default.","1304","              <td>The name of the Appender. Required.<\/td>","1315","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/javax\/naming\/Context.html#PROVIDER_URL\">PROVIDER_URL<\/a>.","1316","                If this value is null the default system provider will be used.<\/td>","1333","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/javax\/naming\/Context.html#SECURITY_PRINCIPAL\">SECURITY_PRINCIPAL<\/a>.","1341","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/javax\/naming\/Context.html#SECURITY_CREDENTIALS\">SECURITY_CREDENTIALS<\/a>.","1347","              <td>The default is <code>true<\/code>, causing exceptions encountered while appending events to be","1348","                internally logged and then ignored. When set to <code>false<\/code> exceptions will be propagated to the","1349","                caller, instead. You must set this to <code>false<\/code> when wrapping this Appender in a","1371","                <a class=\"javadoc\" href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/javax\/naming\/Context.html#URL_PKG_PREFIXES\">URL_PKG_PREFIXES<\/a>.","2609","                <a href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/java\/text\/SimpleDateFormat.html\">SimpleDateFormat<\/a>","3715","\t\t\t\t\t\t\t\thref=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/java\/text\/SimpleDateFormat.html\">","4491","                a valid <a href=\"http:\/\/download.oracle.com\/javase\/6\/docs\/api\/java\/nio\/charset\/Charset.html\">Charset<\/a>."]}]}},"34a1b610222ce691301d3ceb7c0bc589ceecb893":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["243","      <action issue=\"LOG4J2-2289\" dev=\"ggregory\" type=\"fix\" due-to=\"Hari Menon\">","244","        XML Schema for DynamicFilterThreshold does not accept multiple KeyValuePairs.","245","      <\/action>"],"delete":[]}]}},"c350c93cf95fd73ce3f49be0de7fc212802e0599":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfiguration.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["29","      <action issue=\"LOG4J2-976\" dev=\"ggregory\" type=\"fix\" due-to=\"Matt Quinn\">","32","      <action issue=\"LOG4J2-966\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">","33","        Using monitorInterval with YAML config file format causes JSONParseException.","34","      <\/action>"],"delete":["29","      <action issue=\"LOG4J2-966\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/yaml\/YamlConfiguration.java":[{"add":["18","import java.io.IOException;","19","","20","import org.apache.logging.log4j.core.config.Configuration;","41","    @Override","42","    public Configuration reconfigure() {","43","        try {","44","            final ConfigurationSource source = getConfigurationSource().resetInputStream();","45","            if (source == null) {","46","                return null;","47","            }","48","            return new YamlConfiguration(source);","49","        } catch (final IOException ex) {","50","            LOGGER.error(\"Cannot locate file {}\", getConfigurationSource(), ex);","51","        }","52","        return null;","53","    }"],"delete":[]}]}},"eff4780cac9f945ab58c08754df61a3232f18e55":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/TlsSyslogInputStreamReader.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["44","      <action issue=\"LOG4J2-972\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">","45","        org.apache.logging.log4j.core.net.ssl.TlsSyslogInputStreamReader does not need to create temp Integer objects.","46","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/TlsSyslogInputStreamReader.java":[{"add":["88","        nextMessageLength = Integer.parseInt(new String(length));"],"delete":["88","        nextMessageLength = new Integer(new String(length));"]}]}},"ea4101a9975d654c6729eb50724ae9908467b888":{"changes":{"log4j-core\/revapi.json":"MODIFY"},"diff":{"log4j-core\/revapi.json":[{"add":["381","]"],"delete":["381","]"]}]}},"df0b5a1d503aa297605ebc746693b39f4812dfc2":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["4465","        java.lang.System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"ServiceWindows\" : \"ServiceOther\";]]]]><![CDATA[>","4781","        java.lang.System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"MyCustomWindowsAppender\" : \"MySyslogAppender\";]]]]><![CDATA[>"],"delete":["4465","        importPackage(java.lang);","4466","        System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"ServiceWindows\" : \"ServiceOther\";]]]]><![CDATA[>","4782","        importPackage(java.lang);","4783","        System.getProperty(\"os.name\").search(\"Windows\") > -1 ? \"MyCustomWindowsAppender\" : \"MySyslogAppender\";]]]]><![CDATA[>"]}]}},"7ca3c4f5f206ca81dfdda2699703c9abc4d22624":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/Interpolator.java":[{"add":["18","import java.util.Collections;","89","     * Create the default Interpolator.","96","     * Creates the default Interpolator with the provided properties.","99","        this(new PropertiesLookup(properties), Collections.emptyList());"],"delete":["29","import org.apache.logging.log4j.core.util.Loader;","32","import org.apache.logging.log4j.util.Constants;","90","     * Create the default Interpolator using only Lookups that work without an event.","97","     * Creates the Interpolator using only Lookups that work without an event and initial properties.","100","        this.defaultLookup = new PropertiesLookup(properties);","101","        \/\/ TODO: this ought to use the PluginManager","102","        strLookupMap.put(\"log4j\", new Log4jLookup());","103","        strLookupMap.put(\"sys\", new SystemPropertiesLookup());","104","        strLookupMap.put(\"env\", new EnvironmentLookup());","105","        strLookupMap.put(\"main\", MainMapLookup.MAIN_SINGLETON);","106","        strLookupMap.put(\"map\", new MapLookup(properties));","107","        strLookupMap.put(\"marker\", new MarkerLookup());","108","        strLookupMap.put(\"java\", new JavaLookup());","109","        strLookupMap.put(\"lower\", new LowerLookup());","110","        strLookupMap.put(\"upper\", new UpperLookup());","111","        \/\/ JNDI","112","        if (JndiManager.isJndiLookupEnabled()) {","113","            try {","114","                \/\/ [LOG4J2-703] We might be on Android","115","                strLookupMap.put(LOOKUP_KEY_JNDI,","116","                        Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.core.lookup.JndiLookup\", StrLookup.class));","117","            } catch (final LinkageError | Exception e) {","118","                handleError(LOOKUP_KEY_JNDI, e);","119","            }","120","        }","121","        \/\/ JMX input args","122","        try {","123","            \/\/ We might be on Android","124","            strLookupMap.put(LOOKUP_KEY_JVMRUNARGS,","125","                Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.core.lookup.JmxRuntimeInputArgumentsLookup\",","126","                        StrLookup.class));","127","        } catch (final LinkageError | Exception e) {","128","            handleError(LOOKUP_KEY_JVMRUNARGS, e);","129","        }","130","        strLookupMap.put(\"date\", new DateLookup());","131","        if (Constants.IS_WEB_APP) {","132","            try {","133","                strLookupMap.put(LOOKUP_KEY_WEB,","134","                    Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.web.WebLookup\", StrLookup.class));","135","            } catch (final Exception ignored) {","136","                handleError(LOOKUP_KEY_WEB, ignored);","137","            }","138","        } else {","139","            LOGGER.debug(\"Not in a ServletContext environment, thus not loading WebLookup plugin.\");","140","        }","141","        try {","142","            strLookupMap.put(LOOKUP_KEY_DOCKER,","143","                Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.docker.DockerLookup\", StrLookup.class));","144","        } catch (final Exception ignored) {","145","            handleError(LOOKUP_KEY_DOCKER, ignored);","146","        }","147","        try {","148","            strLookupMap.put(LOOKUP_KEY_SPRING,","149","                    Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.spring.boot.SpringLookup\", StrLookup.class));","150","        } catch (final Exception ignored) {","151","            handleError(LOOKUP_KEY_SPRING, ignored);","152","        }","153","        try {","154","            strLookupMap.put(LOOKUP_KEY_KUBERNETES,","155","                    Loader.newCheckedInstanceOf(\"org.apache.logging.log4j.kubernetes.KubernetesLookup\", StrLookup.class));","156","        } catch (final Exception | NoClassDefFoundError error) {","157","            handleError(LOOKUP_KEY_KUBERNETES, error);","158","        }"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/JsonLayoutTest.java":[{"add":["35","import org.apache.logging.log4j.core.LogEvent;","41","import org.apache.logging.log4j.core.config.DefaultConfiguration;","42","import org.apache.logging.log4j.core.impl.ContextDataFactory;","57","import org.apache.logging.log4j.util.StringMap;","597","    \/**","598","     * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-2749\">LOG4J2-2749<\/a>","599","     *\/","600","    @Test","613","    \/**","614","     * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-3358\">LOG4J2-3358<\/a>","615","     *\/","616","    @Test","617","    public void jsonLayout_should_substitute_lookups() {","618","","619","        \/\/ Create the layout.","620","        KeyValuePair[] additionalFields = {","621","                KeyValuePair","622","                        .newBuilder()","623","                        .setKey(\"who\")","624","                        .setValue(\"${ctx:WHO}\")","625","                        .build()","626","        };","627","        JsonLayout layout = JsonLayout","628","                .newBuilder()","629","                .setConfiguration(new DefaultConfiguration())","630","                .setAdditionalFields(additionalFields)","631","                .build();","632","","633","        \/\/ Create a log event containing `WHO` key in MDC.","634","        StringMap contextData = ContextDataFactory.createContextData();","635","        contextData.putValue(\"WHO\", \"mduft\");","636","        LogEvent logEvent = Log4jLogEvent","637","                .newBuilder()","638","                .setContextData(contextData)","639","                .build();","640","","641","        \/\/ Verify the `WHO` key.","642","        String serializedLogEvent = layout.toSerializable(logEvent);","643","        assertThat(serializedLogEvent, containsString(\"\\\"who\\\" : \\\"mduft\\\"\"));","644","","645","    }","646",""],"delete":["593","    @Test  \/\/ LOG4J2-2749"]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3358\" dev=\"ckozak\" type=\"fix\">","34","        log4j-jpl formats message parameters correctly using MessageFormat.","35","      <\/action>"],"delete":[]}]}},"f65f0b916ddb1f6c336283a684286d27582d1e21":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-813\" dev=\"ggregory\" type=\"fix\" due-to=\"David Erichsen, Brandon Barry\">"],"delete":["26","      <action issue=\"LOG4J2-813\" dev=\"ggregory\" type=\"fix\" due-to=\"Brandon Barry\">"]}]}},"d6a512bd367459be40f5d8897f36a5d4587c1370":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTranslator.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventHandler.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerEventTranslationExceptionTest.java":"ADD","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTranslator.java":[{"add":["58","        try {","59","            event.setValues(asyncLogger, loggerName, marker, fqcn, level, message, thrown,","60","                    \/\/ config properties are taken care of in the EventHandler thread","61","                    \/\/ in the AsyncLogger#actualAsyncLog method","62","                    INJECTOR.injectContextData(null, (StringMap) event.getContextData()), contextStack,","63","                    threadId, threadName, threadPriority, location, clock, nanoClock);","64","        } finally {","65","            clear(); \/\/ clear the translator","66","        }"],"delete":["58","","59","        event.setValues(asyncLogger, loggerName, marker, fqcn, level, message, thrown,","60","                \/\/ config properties are taken care of in the EventHandler thread","61","                \/\/ in the AsyncLogger#actualAsyncLog method","62","                INJECTOR.injectContextData(null, (StringMap) event.getContextData()), contextStack,","63","                threadId, threadName, threadPriority, location, clock, nanoClock);","64","","65","        clear(); \/\/ clear the translator"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventTest.java":[{"add":["60","    \/**","61","     * @see <a href=\"https:\/\/issues.apache.org\/jira\/browse\/LOG4J2-2816\">LOG4J2-2816<\/a>","62","     *\/","63","    @Test","64","    public void testIsPopulated() {","65","        final RingBufferLogEvent evt = new RingBufferLogEvent();","66","","67","        assertFalse(evt.isPopulated());","68","","69","        final String loggerName = null;","70","        final Marker marker = null;","71","        final String fqcn = null;","72","        final Level level = null;","73","        final Message data = null;","74","        final Throwable t = null;","75","        final ContextStack contextStack = null;","76","        final String threadName = null;","77","        final StackTraceElement location = null;","78","        evt.setValues(null, loggerName, marker, fqcn, level, data, t, (StringMap) evt.getContextData(),","79","                contextStack, -1, threadName, -1, location, new FixedPreciseClock(), new DummyNanoClock(1));","80","","81","        assertTrue(evt.isPopulated());","82","","83","        evt.clear();","84","","85","        assertFalse(evt.isPopulated());","86","    }","87",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":[{"add":["64","    private boolean populated;","110","        this.populated = true;","159","     * @return {@code true} if this event is populated with data, {@code false} otherwise","160","     *\/","161","    public boolean isPopulated() {","162","        return populated;","163","    }","164","","165","    \/**","400","        this.populated = false;","401",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEventHandler.java":[{"add":["45","            \/\/ RingBufferLogEvents are populated by an EventTranslator. If an exception is thrown during event","46","            \/\/ translation, the event may not be fully populated, but Disruptor requires that the associated sequence","47","            \/\/ still be published since a slot has already been claimed in the ring buffer. Ignore any such unpopulated","48","            \/\/ events. The exception that occurred during translation will have already been propagated.","49","            if (event.isPopulated()) {","50","                event.execute(endOfBatch);","51","            }"],"delete":["45","            event.execute(endOfBatch);"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerEventTranslationExceptionTest.java":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["80","      <action issue=\"LOG4J2-2816\" dev=\"vy\" type=\"fix\" due-to=\"Jacob Shields\">","81","        Handle Disruptor event translation exceptions.","82","      <\/action>","85","      <\/action>"],"delete":[]}]}},"044470e925d2e649fca396d7fdf829431f13ccce":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/test\/appender\/DeadlockAppender.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-deadlock.xml":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/DeadlockTest.java":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/test\/appender\/DeadlockAppender.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["72","    private volatile URI configLocation;","345","    private Configuration setConfiguration(final Configuration config) {","347","        configLock.lock();","349","            final Configuration prev = this.config;","350","            config.addListener(this);","351","            final ConcurrentMap<String, String> map = config.getComponent(Configuration.CONTEXT_PROPERTIES);","352","","353","            try { \/\/ LOG4J2-719 network access may throw android.os.NetworkOnMainThreadException","354","                map.putIfAbsent(\"hostName\", NetUtils.getLocalHostname());","355","            } catch (final Exception ex) {","356","                LOGGER.debug(\"Ignoring {}, setting hostName to 'unknown'\", ex.toString());","357","                map.putIfAbsent(\"hostName\", \"unknown\");","358","            }","359","            map.putIfAbsent(\"contextName\", name);","360","            config.start();","361","            this.config = config;","362","            updateLoggers();","363","            if (prev != null) {","364","                prev.removeListener(this);","365","                prev.stop();","366","            }","367","","368","            firePropertyChangeEvent(new PropertyChangeEvent(this, PROPERTY_CONFIG, prev, config));","369","","370","            try {","371","                Server.reregisterMBeansAfterReconfigure();","372","            } catch (final Throwable t) {","373","                \/\/ LOG4J2-716: Android has no java.lang.management","374","                LOGGER.error(\"Could not reconfigure JMX\", t);","375","            }","376","            return prev;","377","        } finally {","378","            configLock.unlock();","403","    public URI getConfigLocation() {","411","    public void setConfigLocation(final URI configLocation) {","413","","414","        reconfigure(configLocation);","420","    private void reconfigure(final URI configURI) {","423","                configURI, this, cl);","424","        final Configuration instance = ConfigurationFactory.getInstance().getConfiguration(name, configURI, cl);","432","                configURI, this, cl);","433","    }","434","","435","    \/**","436","     * Reconfigure the context.","437","     *\/","438","    public void reconfigure() {","439","        reconfigure(configLocation);"],"delete":["72","    private URI configLocation;","345","    private synchronized Configuration setConfiguration(final Configuration config) {","347","        final Configuration prev = this.config;","348","        config.addListener(this);","349","        final ConcurrentMap<String, String> map = config.getComponent(Configuration.CONTEXT_PROPERTIES);","350","","351","        try { \/\/ LOG4J2-719 network access may throw android.os.NetworkOnMainThreadException","352","            map.putIfAbsent(\"hostName\", NetUtils.getLocalHostname());","353","        } catch (final Exception ex) {","354","            LOGGER.debug(\"Ignoring {}, setting hostName to 'unknown'\", ex.toString());","355","            map.putIfAbsent(\"hostName\", \"unknown\");","356","        }","357","        map.putIfAbsent(\"contextName\", name);","358","        config.start();","359","        this.config = config;","360","        updateLoggers();","361","        if (prev != null) {","362","            prev.removeListener(this);","363","            prev.stop();","364","        }","365","","366","        firePropertyChangeEvent(new PropertyChangeEvent(this, PROPERTY_CONFIG, prev, config));","367","","369","            Server.reregisterMBeansAfterReconfigure();","370","        } catch (final Throwable t) {","371","            \/\/ LOG4J2-716: Android has no java.lang.management","372","            LOGGER.error(\"Could not reconfigure JMX\", t);","374","        return prev;","398","    public synchronized URI getConfigLocation() {","406","    public synchronized void setConfigLocation(final URI configLocation) {","408","        reconfigure();","414","    public synchronized void reconfigure() {","417","            configLocation, this, cl);","418","        final Configuration instance = ConfigurationFactory.getInstance().getConfiguration(name, configLocation, cl);","426","            configLocation, this, cl);"]}],"log4j-core\/src\/test\/resources\/log4j-deadlock.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-993\" dev=\"rgoers\" type=\"fix\">","27","        Deadlock would occur if appender thread creates a new Logger during reconfiguration.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/DeadlockTest.java":[{"add":[],"delete":[]}]}},"913ed21b4178cd59a61ce9bdfe56058cab26df6a":{"changes":{"src\/site\/xdoc\/manual\/appenders.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/appenders.xml":[{"add":["2634","              Each Route must reference an Appender. If the Route contains a ref attribute then the"],"delete":["2634","              Each Route must reference an Appender. If the Route contains an AppenderRef attribute then the"]}]}},"3e3edbb26f7cfc3fdbc7cf752a4eb4760bad408f":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/HTMLLayoutTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/layout\/HTMLLayoutTest.java":[{"add":["56","    private static final String body = \"<tr><td bgcolor=\\\"#993300\\\" style=\\\"color:White; font-size : small;\\\" colspan=\\\"6\\\">java.lang.NullPointerException: test\";","58","    private static final String multiLine = \"<td title=\\\"Message\\\">First line<br \/>Second line<\/td>\";","68","        final HTMLLayout layout = HTMLLayout.createLayout(\"true\", null, \"text\/html; charset=UTF-16\", null, \"small\",","69","                null);","83","    public void testLayoutIncludeLocationNo() {","84","        testLayout(false);","85","    }","86","","87","    @Test","88","    public void testLayoutIncludeLocationYes() {","89","        testLayout(true);","90","    }","91","","92","    private void testLayout(boolean includeLocation) {","95","        final HTMLLayout layout = HTMLLayout.createLayout(\"\" + includeLocation, null, null, null, \"small\", null);","128","        String html = list.toString();","129","        if (includeLocation) {","130","            assertTrue(\"Incorrect multiline\", list.get(50).equals(multiLine));","131","            assertTrue(\"Missing location\", html.contains(\"HTMLLayoutTest.java:\"));","132","            assertTrue(\"Incorrect body\", list.get(71).equals(body));","133","        } else {","134","            assertFalse(\"Location should not be in the output table\", html.contains(\"<td>HTMLLayoutTest.java:\"));","135","        }"],"delete":["56","    private static final String body =","57","        \"<tr><td bgcolor=\\\"#993300\\\" style=\\\"color:White; font-size : small;\\\" colspan=\\\"6\\\">java.lang.NullPointerException: test\";","59","    private static final String multiLine =","60","        \"<td title=\\\"Message\\\">First line<br \/>Second line<\/td>\";","61","","71","        final HTMLLayout layout = HTMLLayout.createLayout(\"true\", null, \"text\/html; charset=UTF-16\", null, \"small\", null);","85","    public void testLayout() {","88","        final HTMLLayout layout = HTMLLayout.createLayout(\"true\", null, null, null, \"small\", null);","121","        assertTrue(\"Incorrect multiline\", list.get(50).equals(multiLine));","122","        assertTrue(\"Incorrect body\", list.get(71).equals(body));"]}]}},"08838c864c2e46d9a25c48cf2c316b1b011c9f2b":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["29","      <action issue=\"LOG4J2-964\" dev=\"ggregory\" type=\"fix\" due-to=\"Jonne Jyryl?\">        ","30","        StringFormattedMessage serialization is incorrect."],"delete":["29","      <action issue=\"LOG4J2-964\" dev=\"ggregory\" type=\"fix\" due-to=\"Jonne Jyryl?\">","30","        "]}]}},"609ff5f284e5e916c01b24feeb383cfeebc7d0cb":{"changes":{"log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":"MODIFY","log4j-slf4j18-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocatorUtil.java":"MODIFY","log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":"MODIFY","log4j-slf4j18-impl\/src\/test\/java\/org\/apache\/logging\/other\/pkg\/LoggerContextAnchorTest.java":"ADD","log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/other\/pkg\/LoggerContextAnchorTest.java":"ADD"},"diff":{"log4j-api-java9\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":[{"add":["21","import java.util.function.Predicate;","43","    public Class<?> getCallerClass(final Class<?> sentinelClass, final Predicate<Class<?>> callerPredicate) {","44","        if (sentinelClass == null) {","45","            throw new IllegalArgumentException(\"sentinelClass cannot be null\");","46","        }","47","        if (callerPredicate == null) {","48","            throw new IllegalArgumentException(\"callerPredicate cannot be null\");","49","        }","50","        return walker.walk(s -> s","51","                        .map(StackWalker.StackFrame::getDeclaringClass)","52","                        \/\/ Skip until the sentinel class is found","53","                        .dropWhile(clazz -> !sentinelClass.equals(clazz))","54","                        \/\/ Skip until the predicate evaluates to true, also ignoring recurrences of the sentinel","55","                        .dropWhile(clazz -> sentinelClass.equals(clazz) || !callerPredicate.test(clazz))","56","                        .findFirst().orElse(null));","57","    }","58",""],"delete":[]}],"log4j-slf4j18-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":[{"add":["22","import org.apache.logging.log4j.status.StatusLogger;","27","import java.util.function.Predicate;","28","","34","    private static final StatusLogger LOGGER = StatusLogger.getLogger();","35","    private static final String SLF4J_PACKAGE = \"org.slf4j\";","36","    private static final Predicate<Class<?>> CALLER_PREDICATE = clazz ->","37","            !AbstractLoggerAdapter.class.equals(clazz) && !clazz.getName().startsWith(SLF4J_PACKAGE);","40","    private final Log4jMarkerFactory markerFactory;","41","","56","                ? StackLocatorUtil.getCallerClass(Log4jLoggerFactory.class, CALLER_PREDICATE)","58","        LOGGER.trace(\"Log4jLoggerFactory.getContext() found anchor {}\", anchor);"],"delete":["31","    private static final String FQCN = Log4jLoggerFactory.class.getName();","32","    private static final String PACKAGE = \"org.slf4j\";","33","    private final Log4jMarkerFactory markerFactory;","50","                ? StackLocatorUtil.getCallerClass(FQCN, PACKAGE, 1)"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocatorUtil.java":[{"add":["20","import java.util.function.Predicate;","81","    \/**","82","     * Search for a calling class.","83","     *","84","     * @param sentinelClass Sentinel class at which to begin searching","85","     * @param callerPredicate Predicate checked after the sentinelClass is found","86","     * @return the first matching class after <code>sentinelClass<\/code> is found.","87","     *\/","88","    @PerformanceSensitive","89","    public static Class<?> getCallerClass(final Class<?> sentinelClass, final Predicate<Class<?>> callerPredicate) {","90","        return stackLocator.getCallerClass(sentinelClass, callerPredicate);","91","    }","92",""],"delete":[]}],"log4j-slf4j-impl\/src\/main\/java\/org\/apache\/logging\/slf4j\/Log4jLoggerFactory.java":[{"add":["22","import org.apache.logging.log4j.status.StatusLogger;","27","import java.util.function.Predicate;","28","","34","    private static final StatusLogger LOGGER = StatusLogger.getLogger();","35","    private static final String SLF4J_PACKAGE = \"org.slf4j\";","37","    private static final Predicate<Class<?>> CALLER_PREDICATE = clazz ->","38","            !AbstractLoggerAdapter.class.equals(clazz) && !clazz.getName().startsWith(SLF4J_PACKAGE);","49","                ? StackLocatorUtil.getCallerClass(Log4jLoggerFactory.class, CALLER_PREDICATE)","51","        LOGGER.trace(\"Log4jLoggerFactory.getContext() found anchor {}\", anchor);","56",""],"delete":["31","    private static final String FQCN = Log4jLoggerFactory.class.getName();","32","    private static final String PACKAGE = \"org.slf4j\";","44","                ? StackLocatorUtil.getCallerClass(FQCN, PACKAGE, 1)"]}],"src\/changes\/changes.xml":[{"add":["83","      <action issue=\"LOG4J2-3083\" dev=\"ckozak\" type=\"fix\">","84","        log4j-slf4j-impl and log4j-slf4j18-impl correctly detect the calling class using both LoggerFactory.getLogger","85","        methods as well as LoggerFactory.getILoggerFactory().getLogger.","86","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/StackLocator.java":[{"add":["20","import java.util.function.Predicate;","99","    @PerformanceSensitive","100","    public Class<?> getCallerClass(final Class<?> sentinelClass, final Predicate<Class<?>> callerPredicate) {","101","        if (sentinelClass == null) {","102","            throw new IllegalArgumentException(\"sentinelClass cannot be null\");","103","        }","104","        if (callerPredicate == null) {","105","            throw new IllegalArgumentException(\"callerPredicate cannot be null\");","106","        }","107","        boolean foundSentinel = false;","108","        Class<?> clazz;","109","        for (int i = 2; null != (clazz = getCallerClass(i)); i++) {","110","            if (sentinelClass.equals(clazz)) {","111","                foundSentinel = true;","112","            } else if (foundSentinel && callerPredicate.test(clazz)) {","113","                return clazz;","114","            }","115","        }","116","        return null;","117","    }","118",""],"delete":[]}],"log4j-slf4j18-impl\/src\/test\/java\/org\/apache\/logging\/other\/pkg\/LoggerContextAnchorTest.java":[{"add":[],"delete":[]}],"log4j-slf4j-impl\/src\/test\/java\/org\/apache\/logging\/other\/pkg\/LoggerContextAnchorTest.java":[{"add":[],"delete":[]}]}},"a631f732fd8b4e9950a4f592315decbfed1632b4":{"changes":{"src\/changes\/changes.xml":"MODIFY","pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["65","      <action issue=\"LOG4J2-987\" dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory\">","66","        Migrate tests from Logback 1.1.2 to 1.1.3.","67","      <\/action>"],"delete":[]}],"pom.xml":[{"add":["164","    <logbackVersion>1.1.3<\/logbackVersion>"],"delete":["164","    <logbackVersion>1.1.2<\/logbackVersion>"]}]}},"61826ad2df7ced4fef8d99fa077fbee574f3c597":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["135","      <action dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory, Piotr P. Karwasz\">","147","      <action dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory, Piotr P. Karwasz\">","148","        Fix log4j-jakarta-web service file #723.","149","      <\/action>"],"delete":["135","      <action dev=\"ggregory\" type=\"fix\" due-to=\"Gary Gregory, ppkarwasz\">"]}]}},"8ec5e02c9eff93ecff3921b034532f60b705e439":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["25","        Fixed log4j-bom so that it won't specify a default scope on any third party dependencies."],"delete":["25","        Fixed log4j-bom so that it won't"]}]}},"2dd7063fb6c6fe73070aded6607a2e2d53613b46":{"changes":{"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolverTest.java":"ADD","log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/TestHelpers.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":"MODIFY","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":"MODIFY"},"diff":{"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolverTest.java":[{"add":[],"delete":[]}],"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/TestHelpers.java":[{"add":["18","import org.apache.logging.log4j.Level;","21","import org.apache.logging.log4j.core.LoggerContext;","23","import org.apache.logging.log4j.core.config.Configurator;","25","import org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilder;","26","import org.apache.logging.log4j.core.config.builder.api.ConfigurationBuilderFactory;","27","import org.apache.logging.log4j.core.config.builder.impl.BuiltConfiguration;","31","import org.apache.logging.log4j.test.appender.ListAppender;","35","import java.util.function.BiConsumer;","58","    public static String writeJson(final Object value) {","59","        synchronized (JSON_WRITER) {","60","            final StringBuilder stringBuilder = JSON_WRITER.getStringBuilder();","62","            try {","63","                JSON_WRITER.writeValue(value);","64","                return stringBuilder.toString();","65","            } finally {","66","                stringBuilder.setLength(0);","67","            }","100","    \/**","101","     * Provides a configuration using the given JSON event template to the given consumer.","102","     * <p>","103","     * A {@link ListAppender} (named {@code List}) wrapping the layout is used to store the log events.","104","     * The root logger level is set to {@link Level#ALL}.","105","     * <\/p>","106","     * @param configName a configuration name","107","     * @param eventTemplate a JSON template","108","     * @param consumer a consumer accepting the created logger context and the list appender","109","     *\/","110","    public static void withContextFromTemplate(","111","            final String configName,","112","            final Object eventTemplate,","113","            final BiConsumer<LoggerContext, ListAppender> consumer) {","114","","115","        \/\/ Create the configuration builder.","116","        final ConfigurationBuilder<BuiltConfiguration> configBuilder = ConfigurationBuilderFactory","117","                .newConfigurationBuilder()","118","                .setStatusLevel(Level.ERROR)","119","                .setConfigurationName(configName);","120","","121","        \/\/ Create the configuration.","122","        final String eventTemplateJson = writeJson(eventTemplate);","123","        final String appenderName = \"List\";","124","        Configuration config = configBuilder","125","                .add(configBuilder","126","                        .newAppender(appenderName, \"List\")","127","                        .addAttribute(\"raw\", true)","128","                        .add(configBuilder","129","                                .newLayout(\"JsonTemplateLayout\")","130","                                .addAttribute(","131","                                        \"eventTemplate\",","132","                                        eventTemplateJson)))","133","                .add(configBuilder","134","                        .newRootLogger(Level.ALL)","135","                        .add(configBuilder.newAppenderRef(appenderName)))","136","                .build(false);","137","","138","        \/\/ Initialize the configuration and pass it to the consumer.","139","        try (final LoggerContext loggerContext = Configurator.initialize(config)) {","140","            final ListAppender appender = loggerContext.getConfiguration().getAppender(\"List\");","141","            consumer.accept(loggerContext, appender);","142","        }","143","","144","    }","145","","146","    public static void uncheckedSleep(final long millis) {","147","        try {","148","            Thread.sleep(millis);","149","        } catch (InterruptedException ignored) {","150","            Thread.currentThread().interrupt();","151","            throw new RuntimeException(\"interrupted\");","152","        }","153","    }","154",""],"delete":["50","    public static synchronized String writeJson(final Object value) {","51","        final StringBuilder stringBuilder = JSON_WRITER.getStringBuilder();","52","        stringBuilder.setLength(0);","53","        try {","54","            JSON_WRITER.writeValue(value);","55","            return stringBuilder.toString();","56","        } finally {"]}],"src\/changes\/changes.xml":[{"add":["103","      <action issue=\"LOG4J2-3183\" dev=\"vy\" type=\"fix\">","104","        Avoid using MutableInstant of the event as a cache key in JsonTemplateLayout.","105","      <\/action>"],"delete":[]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/InstantFormatter.java":[{"add":["224","            mutableInstant.initFrom(instant);"],"delete":["224","            mutableInstant.initFromEpochSecond(","225","                    instant.getEpochSecond(),","226","                    instant.getNanoOfSecond());"]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/resolver\/TimestampResolver.java":[{"add":["20","import org.apache.logging.log4j.core.time.MutableInstant;","220","        private final MutableInstant lastFormattedInstant = new MutableInstant();","232","            lastFormattedInstant.initFromEpochSecond(-1, 0);","285","            final boolean instantMatching = patternResolverContext.formatter.isInstantMatching(","286","                    patternResolverContext.lastFormattedInstant,","287","                    logEvent.getInstant());","288","            if (!instantMatching) {","292","                patternResolverContext.lastFormattedInstant.initFrom(logEvent.getInstant());","356","        private final MutableInstant instant = new MutableInstant();","365","        private EpochResolutionRecord() {","366","            instant.initFromEpochSecond(-1, 0);","367","        }","387","                resolutionRecord.instant.initFrom(logEventInstant);","469","    private static long epochNanos(final Instant instant) {","470","        final long nanos = Math.multiplyExact(1_000_000_000L, instant.getEpochSecond());","471","        return Math.addExact(nanos, instant.getNanoOfSecond());"],"delete":["219","        private Instant lastFormattedInstant;","283","            if (patternResolverContext.lastFormattedInstant == null ||","284","                    !patternResolverContext.formatter.isInstantMatching(","285","                            patternResolverContext.lastFormattedInstant,","286","                            logEvent.getInstant())) {","290","                patternResolverContext.lastFormattedInstant = logEvent.getInstant();","354","        private Instant instant;","363","        private EpochResolutionRecord() {}","383","                resolutionRecord.instant = logEventInstant;","465","    private static long epochNanos(Instant instant) {","466","        return 1_000_000_000L * instant.getEpochSecond() + instant.getNanoOfSecond();"]}]}},"05ef4b32d154c8bb5dd75a94247948818bba743c":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderReconfigureTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","log4j-core\/src\/test\/resources\/log4j-rolling-reconfigure.xml":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderReconfigureTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["95","    \/**","96","     * Copy constructor with another pattern as source.","97","     *","98","     * @param pattern  The file pattern.","99","     * @param copy Source pattern processor","100","     *\/","101","    public PatternProcessor(final String pattern, final PatternProcessor copy) {","102","        this(pattern);","103","        this.prevFileTime = copy.prevFileTime;","104","        this.nextFileTime = copy.nextFileTime;","105","        this.currentFileTime = copy.currentFileTime;","106","    }","107","","112","    public void setCurrentFileTime(final long currentFileTime) {","346",""],"delete":["99","    public void setCurrentFileTime(long currentFileTime) {"]}],"log4j-core\/src\/test\/resources\/log4j-rolling-reconfigure.xml":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["87","      <action issue=\"LOG4J2-1964\" dev=\"ggregory\" type=\"fix\" due-to=\"Pierrick HYMBERT\">","88","        Dynamic reconfiguration does not work for filePattern of RollingFile.","89","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["58","    private volatile PatternProcessor patternProcessor;","79","    private static final AtomicReferenceFieldUpdater<RollingFileManager, PatternProcessor> patternProcessorUpdater =","80","            AtomicReferenceFieldUpdater.newUpdater(RollingFileManager.class, PatternProcessor.class, \"patternProcessor\");","81","","356","    public void setPatternProcessor(final PatternProcessor patternProcessor) {","357","        patternProcessorUpdater.compareAndSet(this, this.patternProcessor, patternProcessor);","358","    }","359","","550","        public TriggeringPolicy getTriggeringPolicy() {","554","        public RolloverStrategy getRolloverStrategy() {","558","        public String getPattern() {","559","            return pattern;","560","        }","561","","592","    public void updateData(final Object data) {","596","        setPatternProcessor(new PatternProcessor(factoryData.getPattern(), getPatternProcessor()));","639","                final RollingFileManager rm = new RollingFileManager(data.getLoggerContext(), data.fileName, data.pattern, os,"],"delete":["58","    private final PatternProcessor patternProcessor;","543","        public TriggeringPolicy getTriggeringPolicy()","544","        {","548","        public RolloverStrategy getRolloverStrategy()","549","        {","583","    public void updateData(final Object data)","584","    {","630","                RollingFileManager rm = new RollingFileManager(data.getLoggerContext(), data.fileName, data.pattern, os,"]}]}},"e3a87c906f4b5e8a638b27bc2cfef45376493ede":{"changes":{"\/dev\/null":"DELETE","src\/changes\/changes.xml":"MODIFY"},"diff":{"\/dev\/null":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-773\" dev=\"rpopma\" type=\"fix\">","25","        Site: log4j-core component pages were still using the old logo.","26","      <\/action>","29","        link to log4j-core component page from FAQ page."],"delete":["26","        link to log4j-component page from FAQ page."]}]}},"7bb1ad473178f571fc0b8ca05a45a52db4463a06":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLoggerTest.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/junit\/LogManagerLoggerContextFactoryRule.java":"ADD"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLoggerTest.java":[{"add":["20","import org.apache.logging.log4j.junit.LogManagerLoggerContextFactoryRule;","21","import org.junit.ClassRule;","26","    @ClassRule","27","    public static final LogManagerLoggerContextFactoryRule rule = new LogManagerLoggerContextFactoryRule(","28","            new SimpleLoggerContextFactory());","29","","30","    private Logger logger = LogManager.getLogger(\"TestError\");","34","        logger.error(\"Logging without args\");","39","        logger.error(\"Logging without args {}\");","44","        logger.error(new Object[0]);","52","        logger.error(\"Logging with an empty Object[] {} {}\", new Object[0]);","53","    }","54","","55","    \/**","56","     * Tests LOG4J2-811.","57","     *\/","58","    @Test","59","    public void testMessageWithShortArray() {","60","        logger.error(\"Logging with a size 1 Object[] {} {}\", new Object[] { \"only one param\" });"],"delete":["24","    Logger logger = LogManager.getLogger(\"TestError\");","28","        logger.info(\"Hello\");","33","        logger.info(\"Hello {}\");","38","        logger.info(new Object[0]);","46","        logger.info(\"Hello {} {}\", new Object[0]);"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":[{"add":["156","        if (throwable == null && params != null && params.length > 0 && params[params.length - 1] instanceof Throwable) {"],"delete":["156","        if (throwable == null && params != null && params[params.length - 1] instanceof Throwable) {"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/junit\/LogManagerLoggerContextFactoryRule.java":[{"add":[],"delete":[]}]}},"c6663ddaa35d74df5f34f0f7142ef6cb944adb10":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/SyslogLayout.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/SyslogLayout.java":[{"add":["115","     * <li>Key: \"dateFormat\" Value: \"MMM dd HH:mm:ss\"<\/li>"],"delete":["115","     * <li>Key: \"dateFormat\" Value: \"MMM dd HH:mm:ss \"<\/li>"]}]}},"b03d7608931aa4a2ad0a6c486079781b154e5c2c":{"changes":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":"MODIFY","log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":"MODIFY"},"diff":{"log4j-1.2-api\/src\/test\/java\/org\/apache\/log4j\/CategoryTest.java":[{"add":["88","        \/\/ Logging a String","90","        List<LogEvent> list = appender.getEvents();","96","        \/\/ LOG4J2-3080: use message type consistently","97","        assertTrue(\"Incorrect Message type\", msg instanceof SimpleMessage);","98","        assertEquals(\"Hello, World\", msg.getFormat());","100","        \/\/ Logging a String map","101","        category.info(Collections.singletonMap(\"hello\", \"world\"));","102","        list = appender.getEvents();","103","        events = list.size();","104","        assertTrue(\"Number of events should be 1, was \" + events, events == 1);","105","        event = list.get(0);","106","        msg = event.getMessage();","107","        assertNotNull(\"No message\", msg);","108","        assertTrue(\"Incorrect Message type\", msg instanceof MapMessage);","109","        Object[] objects = msg.getParameters();","110","        assertEquals(\"world\", objects[0]);","111","        appender.clear();","112","        \/\/ Logging a generic map","113","        category.info(Collections.singletonMap(1234L, \"world\"));","114","        list = appender.getEvents();","115","        events = list.size();","116","        assertTrue(\"Number of events should be 1, was \" + events, events == 1);","117","        event = list.get(0);","118","        msg = event.getMessage();","119","        assertNotNull(\"No message\", msg);","120","        assertTrue(\"Incorrect Message type\", msg instanceof MapMessage);","121","        objects = msg.getParameters();","122","        assertEquals(\"world\", objects[0]);","123","        appender.clear();","124","        \/\/ Logging an object","125","        final Object obj = new Object();","126","        category.info(obj);","127","        list = appender.getEvents();","135","        assertEquals(obj, objects[0]);","136","        appender.clear();","137","","138","        category.log(Priority.INFO, \"Hello, World\");","139","        list = appender.getEvents();","140","        events = list.size();","141","        assertTrue(\"Number of events should be 1, was \" + events, events == 1);","142","        event = list.get(0);","143","        msg = event.getMessage();","144","        assertNotNull(\"No message\", msg);","145","        assertTrue(\"Incorrect Message type\", msg instanceof SimpleMessage);","146","        assertEquals(\"Hello, World\", msg.getFormat());"],"delete":["89","        final List<LogEvent> list = appender.getEvents();","95","        assertTrue(\"Incorrect Message type\", msg instanceof ObjectMessage);","96","        Object[] objects = msg.getParameters();","97","        assertTrue(\"Incorrect Object type\", objects[0] instanceof String);","99","        category.log(Priority.INFO, \"Hello, World\");","107","        assertTrue(\"Incorrect Object type\", objects[0] instanceof String);"]}],"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/Category.java":[{"add":["309","    private static Message createMessage(Object message) {","310","        if (message instanceof String) {","311","            return new SimpleMessage((String) message);","312","        }","313","        if (message instanceof CharSequence) {","314","            return new SimpleMessage((CharSequence) message);","315","        }","316","        if (message instanceof Map) {","317","            return new MapMessage<>((Map<String, ?>) message);","318","        }","319","        if (message instanceof Message) {","320","            return (Message) message;","321","        }","322","        return new ObjectMessage(message);","323","    }","324","","327","        final Message msg = createMessage(message);","550","            forcedLog(FQCN, priority, message, null);","556","            forcedLog(FQCN, priority, message, t);","562","            forcedLog(fqcn, priority, message, t);","568","            final Message msg = createMessage(message);"],"delete":["312","            @SuppressWarnings(\"unchecked\")","313","            final Message msg = message instanceof Message ? (Message) message","314","                : message instanceof Map ? new MapMessage((Map) message) : new ObjectMessage(message);","317","            final ObjectRenderer renderer = get(message.getClass());","318","            final Message msg = message instanceof Message ? (Message) message","319","                : renderer != null ? new RenderedMessage(renderer, message) : new ObjectMessage(message);","539","            @SuppressWarnings(\"unchecked\")","540","            final Message msg = message instanceof Map ? new MapMessage((Map) message) : new ObjectMessage(message);","541","            forcedLog(FQCN, priority, msg, null);","547","            @SuppressWarnings(\"unchecked\")","548","            final Message msg = message instanceof Map ? new MapMessage((Map) message) : new ObjectMessage(message);","549","            forcedLog(FQCN, priority, msg, t);","555","            final Message msg = new ObjectMessage(message);","556","            forcedLog(fqcn, priority, msg, t);","562","            final Message msg;","563","            if (message instanceof String) {","564","                msg = new SimpleMessage((String) message);","565","            }","566","            \/\/ SimpleMessage treats String and CharSequence differently, hence this else-if block.","567","            else if (message instanceof CharSequence) {","568","                msg = new SimpleMessage((CharSequence) message);","569","            } else if (message instanceof Map) {","570","                @SuppressWarnings(\"unchecked\")","571","                final Map<String, ?> map = (Map<String, ?>) message;","572","                msg = new MapMessage<>(map);","573","            } else {","574","                msg = new ObjectMessage(message);","575","            }"]}]}},"d17553b3011ed2f6d2ec7f8f71eb4e9be9737834":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":[{"add":["173","        @SuppressWarnings(\"resource\")"],"delete":[]}]}},"3d87ed70a04568426d06b4f10f005e0222c1995b":{"changes":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessage.java":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessage.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessageTest.java":"ADD","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessageTest.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ThreadDumpMessageTest.java":"MODIFY"},"diff":{"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessage.java":[{"add":["71","        if (message != null) {","72","            buffer.append(message);","73","        } else {","74","            buffer.append(charSequence);","75","        }"],"delete":["71","        buffer.append(charSequence);"]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessage.java":[{"add":["61","        if (objectString != null) { \/\/","62","            buffer.append(objectString);","63","        } else {","64","            StringBuilders.appendValue(buffer, obj);","65","        }"],"delete":["61","        StringBuilders.appendValue(buffer, obj);"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1719\" dev=\"rpopma\" type=\"fix\">","27","        Fixed race condition in ObjectMessage and SimpleMessage, ensuring that the log message contains the value the object has during the logging call.","28","      <\/action>"],"delete":[]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/SimpleMessageTest.java":[{"add":[],"delete":[]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ObjectMessageTest.java":[{"add":["69","","77","","94","","95","    @Test","96","    public void formatTo_usesCachedMessageString() throws Exception {","97","        final StringBuilder charSequence = new StringBuilder(\"initial value\");","98","        final ObjectMessage message = new ObjectMessage(charSequence);","99","        assertEquals(\"initial value\", message.getFormattedMessage());","100","","101","        charSequence.setLength(0);","102","        charSequence.append(\"different value\");","103","","104","        final StringBuilder result = new StringBuilder();","105","        message.formatTo(result);","106","        assertEquals(\"initial value\", result.toString());","107","    }"],"delete":["69","    ","77","    "]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/message\/ThreadDumpMessageTest.java":[{"add":["18","import java.util.concurrent.CountDownLatch;","91","","95","    @Test","96","    public void formatTo_usesCachedMessageString() throws Exception {","97","","98","        final ThreadDumpMessage message = new ThreadDumpMessage(\"\");","99","        final String initial = message.getFormattedMessage();","100","        assertFalse(\"no ThreadWithCountDownLatch thread yet\", initial.contains(\"ThreadWithCountDownLatch\"));","101","","102","        final CountDownLatch started = new CountDownLatch(1);","103","        final CountDownLatch keepAlive = new CountDownLatch(1);","104","        final ThreadWithCountDownLatch thread = new ThreadWithCountDownLatch(started, keepAlive);","105","        thread.start();","106","        started.await(); \/\/ ensure thread is running","107","","108","        final StringBuilder result = new StringBuilder();","109","        message.formatTo(result);","110","        assertFalse(\"no ThreadWithCountDownLatch captured\",","111","                result.toString().contains(\"ThreadWithCountDownLatch\"));","112","        assertEquals(initial, result.toString());","113","        keepAlive.countDown(); \/\/ allow thread to die","114","    }","115","","143","","144","    private class ThreadWithCountDownLatch extends Thread {","145","        private final CountDownLatch started;","146","        private CountDownLatch keepAlive;","147","        volatile boolean finished;","148","","149","        public ThreadWithCountDownLatch(final CountDownLatch started, final CountDownLatch keepAlive) {","150","            super(\"ThreadWithCountDownLatch\");","151","            this.started = started;","152","            this.keepAlive = keepAlive;","153","            setDaemon(true);","154","        }","155","","156","        @Override","157","        public void run() {","158","            started.countDown();","159","            try {","160","                keepAlive.await();","161","            } catch (InterruptedException e) {","162","                \/\/ ignored","163","            }","164","            finished = true;","165","        }","166","    }"],"delete":["90","        ","118",""]}]}},"3e7fd88c1755bcabcc888040817fc81b43a276cf":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-3170\" dev=\"vy\" type=\"add\" due-to=\"Gareth Smith\">","34","        Make CRLF\/HTML encoding run in O(n) worst-case time, rather than O(n^2).","35","      <\/action>"],"delete":[]}]}},"8548d7d1a7d3de8ad49954dc426abebaf3b52333":{"changes":{"src\/site\/xdoc\/manual\/customloglevels.xml.vm":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/customloglevels.xml.vm":[{"add":["319","            <\/p><p>","320","              NOTE: Under the bash shell on Unix\/Mac\/Linux the ${dollar} character needs to be escaped, so the class name should","321","               be between single quotes 'org.apache.logging.log4j.core.tools.Generate${dollar}ExtendedLogger\u2019.","336","            <\/p><p>","337","              NOTE: Under the bash shell on Unix\/Mac\/Linux the ${dollar} character needs to be escaped, so the class name should","338","               be between single quotes 'org.apache.logging.log4j.core.tools.Generate${dollar}CustomLogger\u2019."],"delete":[]}]}},"d2ff38172c5dfc16f19e29e122bc68fc8be5e292":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/PluginManager.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/plugins\/util\/PluginManager.java":[{"add":["41","import org.apache.logging.log4j.util.Strings;","90","        if (Strings.isBlank(p)) {","102","     * @param packages collection of package names to add. Empty and null package names are ignored.","105","        for (String pkg : packages) {","106","            if (Strings.isNotBlank(pkg)) {","107","                PACKAGES.addIfAbsent(pkg);","108","            }"],"delete":["89","        if (p == null || p.isEmpty()) {","101","     * @param packages collection of package names to add. Ignored if {@code null} or empty.","104","        if (packages == null || packages.isEmpty()) {","105","            return;","107","        PACKAGES.addAllAbsent(packages);"]}]}},"7c53af7ced826c71b31e3698f2cb846ac7ddd4f7":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":"MODIFY","log4j-core\/.gitignore":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":[{"add":["480","                    .equals(PropertiesUtil.getProperties().getStringProperty(Constants.LOG4J_CONTEXT_SELECTOR));"],"delete":["480","                    .equals(System.getProperty(Constants.LOG4J_CONTEXT_SELECTOR));"]}],"log4j-core\/.gitignore":[{"add":["4","\/bin\/"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["38","      <action issue=\"LOG4J2-967\" dev=\"ggregory\" type=\"fix\" due-to=\"Stefan Wehner\">","39","        log4j2.component.properties not read for all properties.","40","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["38","import org.apache.logging.log4j.util.PropertiesUtil;","103","            final String name = PropertiesUtil.getProperties().getStringProperty(\"AsyncLogger.ThreadNameStrategy\", CACHED.name());","136","        final String userPreferredRBSize = PropertiesUtil.getProperties().getStringProperty(\"AsyncLogger.RingBufferSize\",","172","        final String strategy = PropertiesUtil.getProperties().getStringProperty(\"AsyncLogger.WaitStrategy\");","186","        final String cls = PropertiesUtil.getProperties().getStringProperty(\"AsyncLogger.ExceptionHandler\");"],"delete":["102","            final String name = System.getProperty(\"AsyncLogger.ThreadNameStrategy\", CACHED.name());","135","        final String userPreferredRBSize = System.getProperty(\"AsyncLogger.RingBufferSize\",","171","        final String strategy = System.getProperty(\"AsyncLogger.WaitStrategy\");","185","        final String cls = System.getProperty(\"AsyncLogger.ExceptionHandler\");"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigHelper.java":[{"add":["27","import org.apache.logging.log4j.util.PropertiesUtil;","147","        final String userPreferredRBSize = PropertiesUtil.getProperties().getStringProperty("],"delete":["146","        final String userPreferredRBSize = System.getProperty("]}]}},"d9cadbe9b4c381544f526494ed4ae64d593a8342":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["45","      <action issue=\"LOG4J2-1936\" dev=\"ggregory\" type=\"fix\" due-to=\"Helber Belmiro\">","46","        ClassNotFoundException when making all loggers asynchronous under OSGi environment.","47","      <\/action>"],"delete":[]}],"log4j-api\/pom.xml":[{"add":["211","              org.apache.logging.log4j.core.async;resolution:=optional,"],"delete":[]}]}},"b89b8983f6df451c4708362684ae046371340d7e":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationPropertyTest.java":"ADD"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/ConfigurationPropertyTest.java":[{"add":[],"delete":[]}]}},"3dac6e00861a16c625f9e3af404fee4a7c559744":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-736\" dev=\"mattsicker\" type=\"fix\">","25","        Fixed log4j-bom so that it won't","26","      <\/action>","27","      <action issue=\"LOG4J2-735\" dev=\"mattsicker\" type=\"fix\">","28","        Fixed log4j-bom so that it won't interfere with spring-bom and others.","29","      <\/action>"],"delete":[]}]}},"64170ccc1059377f039441808d2b54e71ea423a8":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderSocketOptionsTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SecureSocketAppenderSocketOptionsTest.java":"MODIFY",".travis.yml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderSocketOptionsTest.java":[{"add":["102","        Assume.assumeFalse(\"Do not run on Travis CI\", \"true\".equals(System.getenv(\"TRAVIS\")));"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SecureSocketAppenderSocketOptionsTest.java":[{"add":["122","        Assume.assumeFalse(\"Do not run on Travis CI\", \"true\".equals(System.getenv(\"TRAVIS\")));"],"delete":[]}],".travis.yml":[{"add":["15","# trusty required for oraclejdk9","16","dist: trusty"],"delete":["23","addons:","24","  apt:","25","    packages:","26","      - oracle-java9-installer","27",""]}]}},"43425c5235b12b1514d391099ef0d09ebb29e0f0":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/pom.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-663\" dev=\"mattsicker\" type=\"fix\" due-to=\"Florian Brunner\">","25","        Fix OSGi Import-Package problem with the JMS API.","26","      <\/action>"],"delete":[]}],"log4j-core\/pom.xml":[{"add":["93","      <optional>true<\/optional>"],"delete":[]}]}},"78c68473e2c81432c5bc3e5ba8d93b463ecfa2d9":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtilTest.java":"MODIFY","log4j-api\/src\/test\/resources\/PropertiesUtilTest.properties":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtilTest.java":[{"add":["47","        \/\/ One invalid entry remains","48","        assertEquals(1, properties.size());"],"delete":["47","        assertEquals(0, properties.size());"]}],"log4j-api\/src\/test\/resources\/PropertiesUtilTest.properties":[{"add":["29","","30","# Dotless entry, should be ignored","31","a = invalid"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtil.java":[{"add":["553","            final int idx = key.indexOf('.');","554","            if (idx < 0) continue;","555","            final String prefix = key.substring(0, idx);","559","            parts.get(prefix).setProperty(key.substring(idx + 1), properties.getProperty(key));"],"delete":["553","            final String prefix = key.substring(0, key.indexOf('.'));","557","            parts.get(prefix).setProperty(key.substring(key.indexOf('.') + 1), properties.getProperty(key));"]}]}},"250521073200102c8322705a17c9375b894e3941":{"changes":{"src\/site\/xdoc\/manual\/architecture.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/site\/xdoc\/manual\/architecture.xml":[{"add":["476","            <td class=\"big-red\">NO<\/td>","477","            <td class=\"big-red\">NO<\/td>","478","            <td class=\"big-red\">NO<\/td>","479","            <td class=\"big-red\">NO<\/td>","480","            <td class=\"big-red\">NO<\/td>","481","            <td class=\"big-red\">NO<\/td>","546","            <td class=\"big-red\">YES<\/td>","547","            <td class=\"big-red\">YES<\/td>","548","            <td class=\"big-red\">YES<\/td>","549","            <td class=\"big-red\">YES<\/td>","550","            <td class=\"big-red\">YES<\/td>","551","            <td class=\"big-red\">YES<\/td>","552","            <td class=\"big-red\">YES<\/td>"],"delete":["476","            <td class=\"big-red\">YES<\/td>","477","            <td class=\"big-red\">YES<\/td>","478","            <td class=\"big-red\">YES<\/td>","479","            <td class=\"big-red\">YES<\/td>","480","            <td class=\"big-red\">YES<\/td>","481","            <td class=\"big-red\">YES<\/td>","546","            <td class=\"big-red\">NO<\/td>","547","            <td class=\"big-red\">NO<\/td>","548","            <td class=\"big-red\">NO<\/td>","549","            <td class=\"big-red\">NO<\/td>","550","            <td class=\"big-red\">NO<\/td>","551","            <td class=\"big-red\">NO<\/td>","552","            <td class=\"big-red\">NO<\/td>"]}],"src\/changes\/changes.xml":[{"add":["118","      <action issue=\"LOG4J2-3166\" dev=\"rgoers\">","119","        Fix Log Event Level vs Logger Config Level table.","120","      <\/action>"],"delete":[]}]}},"3dd73eff306c213bf968c9d2afd0ee627de2b366":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/RingBufferAdminMBean.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerConfigAdminMBean.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/StatusLoggerAdminMBean.java":"MODIFY","src\/site\/resources\/images\/jmx-jconsole-statuslogger.png":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/ContextSelectorAdminMBean.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/AsyncAppenderAdminMBean.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdminMBean.java":"MODIFY","log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/ClientGUI.java":"MODIFY","src\/site\/resources\/images\/jmx-jconsole-mbeans.png":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":"MODIFY","src\/site\/resources\/images\/jmx-standalone-statuslogger.png":"MODIFY","src\/site\/resources\/images\/jmx-jconsole-editconfig.png":"MODIFY","src\/site\/resources\/images\/jmx-standalone-editconfig.png":"MODIFY","log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/Client.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/AppenderAdminMBean.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/RingBufferAdminMBean.java":[{"add":["36","    String PATTERN_ASYNC_LOGGER = Server.DOMAIN + \":type=%s,component=AsyncLoggerRingBuffer\";","52","    String PATTERN_ASYNC_LOGGER_CONFIG = Server.DOMAIN + \":type=%s,component=Loggers,name=%s,subtype=RingBuffer\";"],"delete":["36","    String PATTERN_ASYNC_LOGGER = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,name=AsyncLoggerRingBuffer\";","52","    String PATTERN_ASYNC_LOGGER_CONFIG = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=LoggerConfig,name=%s,subtype=RingBuffer\";"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["219","            Server.unregisterLoggerContext(getName()); \/\/ LOG4J2-406, LOG4J2-500"],"delete":["219","            Server.unregisterMBeans(); \/\/ LOG4J2-406"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerConfigAdminMBean.java":[{"add":["47","    String PATTERN = Server.DOMAIN + \":type=%s,component=Loggers,name=%s\";"],"delete":["47","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=LoggerConfig,name=%s\";"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/StatusLoggerAdminMBean.java":[{"add":["51","    String PATTERN = Server.DOMAIN + \":type=%s,component=StatusLogger\";"],"delete":["51","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=StatusLogger\";"]}],"src\/site\/resources\/images\/jmx-jconsole-statuslogger.png":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/ContextSelectorAdminMBean.java":[{"add":["45","    String PATTERN = Server.DOMAIN + \":type=%s,component=ContextSelector\";"],"delete":["45","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=ContextSelector\";"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/AsyncAppenderAdminMBean.java":[{"add":["50","    String PATTERN = Server.DOMAIN + \":type=%s,component=AsyncAppenders,name=%s\";"],"delete":["50","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=AsyncAppender,name=%s\";"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/LoggerContextAdminMBean.java":[{"add":["49","    String PATTERN = Server.DOMAIN + \":type=%s\";"],"delete":["49","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s\";"]}],"log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/ClientGUI.java":[{"add":["29","import javax.management.JMException;","30","import javax.management.MBeanServerDelegate;","31","import javax.management.MBeanServerNotification;","55","import org.apache.logging.log4j.core.jmx.Server;","73","    public ClientGUI(final Client client) throws IOException, JMException {","77","","78","        \/\/ register for Notifications if LoggerContext MBean was added\/removed","79","        ObjectName addRemoveNotifs = MBeanServerDelegate.DELEGATE_NAME;","80","        NotificationFilterSupport filter = new NotificationFilterSupport();","81","        filter.enableType(Server.DOMAIN); \/\/ only interested in Log4J2 MBeans","82","        client.getConnection().addNotificationListener(addRemoveNotifs, this, filter, null);","91","    private void populateWidgets() throws IOException, JMException {","150","        client.getConnection().addNotificationListener(objName, this, filter, status.getContextName());","160","            return;","162","        if (notif instanceof MBeanServerNotification) {","163","            MBeanServerNotification mbsn = (MBeanServerNotification) notif;","164","            ObjectName mbeanName = mbsn.getMBeanName();","165","            if (MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notif.getType())) {","166","                onMBeanRegistered(mbeanName);","167","            } else if (MBeanServerNotification.UNREGISTRATION_NOTIFICATION.equals(notif.getType())) {","168","                onMBeanUnregistered(mbeanName);","169","            }","170","        }","171","    }","172","","173","    \/**","174","     * @param mbeanName","175","     *\/","176","    private void onMBeanRegistered(ObjectName mbeanName) {","177","        \/\/ TODO update widgets if logger context was added","178","    }","179","","180","    \/**","181","     * @param mbeanName","182","     *\/","183","    private void onMBeanUnregistered(ObjectName mbeanName) {","184","        \/\/ TODO update widgets if logger context was removed"],"delete":["69","    public ClientGUI(final Client client) throws InstanceNotFoundException, MalformedObjectNameException, IOException {","81","    private void populateWidgets() throws MalformedObjectNameException, IOException, InstanceNotFoundException {","140","        client.getConnection().addNotificationListener(objName, this, filter,","141","                status.getContextName());"]}],"src\/site\/resources\/images\/jmx-jconsole-mbeans.png":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/Server.java":[{"add":["52","    \/**","53","     * The domain part, or prefix ({@value} ) of the {@code ObjectName} of all","54","     * MBeans that instrument Log4J2 components.","55","     *\/","56","    public static final String DOMAIN = \"org.apache.logging.log4j2\";","139","                unregisterLoggerContext(ctx.getName(), mbs);","212","    public static void unregisterLoggerContext(String loggerContextName) {","214","        unregisterLoggerContext(loggerContextName, mbs);","225","    public static void unregisterLoggerContext(String contextName, MBeanServer mbs) {"],"delete":["122","        \/\/ first unregister the old MBeans","123","        \/\/ TODO is this too drastic? This may impact the MBean of other","124","        \/\/ webapps...","125","        \/\/ but below we will only re-register the MBeans of OUR context selector","126","        unregisterMBeans(mbs);","127","","140","                unregisterAll(ctx.getName(), mbs);","213","    public static void unregisterAll(String loggerContextName) {","215","        unregisterAll(loggerContextName, mbs);","226","    public static void unregisterAll(String contextName, MBeanServer mbs) {"]}],"src\/site\/resources\/images\/jmx-standalone-statuslogger.png":[{"add":[],"delete":[]}],"src\/site\/resources\/images\/jmx-jconsole-editconfig.png":[{"add":[],"delete":[]}],"src\/site\/resources\/images\/jmx-standalone-editconfig.png":[{"add":[],"delete":[]}],"log4j-jmx-gui\/src\/main\/java\/org\/apache\/logging\/log4j\/jmx\/gui\/Client.java":[{"add":["88","     * @throws IOException","89","     * @throws JMException","91","    public List<LoggerContextAdminMBean> getLoggerContextAdmins() throws JMException, IOException {","92","        List<LoggerContextAdminMBean> result = new ArrayList<LoggerContextAdminMBean>();","93","        final Set<ObjectName> contextNames = find(LoggerContextAdminMBean.PATTERN);","94","        for (final ObjectName contextName : contextNames) {","95","            final LoggerContextAdminMBean ctx = JMX.newMBeanProxy(connection, \/\/","96","                    contextName, \/\/","97","                    LoggerContextAdminMBean.class, false);","98","            result.add(ctx);","99","        }","100","        return result;"],"delete":["31","import org.apache.logging.log4j.core.jmx.ContextSelectorAdminMBean;","43","    private List<StatusLoggerAdminMBean> statusLoggerAdminList;","44","    private List<ContextSelectorAdminMBean> contextSelectorAdminList;","45","    private List<LoggerContextAdminMBean> contextAdminList;","46","","80","        statusLoggerAdminList = new ArrayList<StatusLoggerAdminMBean>();","81","        final Set<ObjectName> statusLogNames = find(StatusLoggerAdminMBean.PATTERN);","82","        for (final ObjectName statusLogName : statusLogNames) {","83","            final StatusLoggerAdminMBean ctx = JMX.newMBeanProxy(connection, \/\/","84","                    statusLogName, \/\/","85","                    StatusLoggerAdminMBean.class, true); \/\/ notificationBroadcaster","86","            statusLoggerAdminList.add(ctx);","87","        }","88","","89","        contextSelectorAdminList = new ArrayList<ContextSelectorAdminMBean>();","90","        final Set<ObjectName> selectorNames = find(ContextSelectorAdminMBean.PATTERN);","91","        for (final ObjectName selectorName : selectorNames) {","92","            final ContextSelectorAdminMBean ctx = JMX.newMBeanProxy(connection, \/\/","93","                    selectorName, \/\/","94","                    ContextSelectorAdminMBean.class, false);","95","            contextSelectorAdminList.add(ctx);","96","        }","97","","98","        contextAdminList = new ArrayList<LoggerContextAdminMBean>();","99","        final Set<ObjectName> contextNames = find(LoggerContextAdminMBean.PATTERN);","100","        for (final ObjectName contextName : contextNames) {","101","            final LoggerContextAdminMBean ctx = JMX.newMBeanProxy(connection, \/\/","102","                    contextName, \/\/","103","                    LoggerContextAdminMBean.class, false);","104","            contextAdminList.add(ctx);","105","","106","            \/\/ TODO Appenders, LoggerConfigs","107","        }","117","     * Returns a list of proxies that allows operations to be performed on the","118","     * remote {@code ContextSelectorAdminMBean}s.","119","     * ","120","     * @return a list of proxies to the remote {@code ContextSelectorAdminMBean}","121","     *         s","122","     *\/","123","    public List<ContextSelectorAdminMBean> getContextSelectorAdminList() {","124","        return contextSelectorAdminList;","125","    }","126","","127","    \/**","133","    public List<LoggerContextAdminMBean> getLoggerContextAdmins() {","134","        return new ArrayList<LoggerContextAdminMBean>(contextAdminList);","160","     * Returns a list of proxies that allows operations to be performed on the","161","     * remote {@code StatusLoggerAdminMBean}s.","162","     * ","163","     * @return a list of proxies to the remote {@code StatusLoggerAdminMBean}s","164","     *\/","165","    public List<StatusLoggerAdminMBean> getStatusLoggerAdminList() {","166","        return statusLoggerAdminList;","167","    }","168","","169","    \/**"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/jmx\/AppenderAdminMBean.java":[{"add":["48","    String PATTERN = Server.DOMAIN + \":type=%s,component=Appenders,name=%s\";"],"delete":["48","    String PATTERN = \"org.apache.logging.log4j2:type=LoggerContext,ctx=%s,sub=Appender,name=%s\";"]}]}},"7bb8d95e84e08a5f9e73f0329d1436dd318e3734":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderSocketOptionsTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SecureSocketAppenderSocketOptionsTest.java":"MODIFY","pom.xml":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SocketAppenderSocketOptionsTest.java":[{"add":["92","        \/\/Assert.assertEquals(10000, socket.getReceiveBufferSize());"],"delete":["92","        Assert.assertEquals(10000, socket.getReceiveBufferSize());"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/SecureSocketAppenderSocketOptionsTest.java":[{"add":["112","        \/\/Assert.assertEquals(10000, socket.getReceiveBufferSize());"],"delete":["112","        Assert.assertEquals(10000, socket.getReceiveBufferSize());"]}],"pom.xml":[{"add":["229","    <argLine>-Xms256m -Xmx1024m<\/argLine>"],"delete":["1028","          <argLine>@{argLine} -Xms256m -Xmx1024m<\/argLine>"]}]}},"068f1c19f89299d9aa79431f669fb4cfafea119b":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/LoggerContext.java":[{"add":["356","        ","357","        try { \/\/ LOG4J2-719 network access may throw android.os.NetworkOnMainThreadException","358","            map.putIfAbsent(\"hostName\", NetUtils.getLocalHostname());","359","        } catch (Exception ex) {","360","            LOGGER.debug(\"Ignoring {}, setting hostName to 'unknown'\", ex.toString());","361","            map.putIfAbsent(\"hostName\", \"unknown\");","362","        }"],"delete":["356","        map.putIfAbsent(\"hostName\", NetUtils.getLocalHostname());"]}],"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-719\" dev=\"popmarem\" type=\"fix\">","25","        Correctly handle NetworkOnMainThreadException thrown on Android during Log4j2 initialization.","26","      <\/action>"],"delete":[]}]}},"23b48b3c3f9547ccfba49705e7a10b910f56ec00":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompactFileAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompleteFileAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlFileAppenderTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlRandomAccessFileAppenderTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompactFileAppenderTest.java":[{"add":["49","        ((LifeCycle) LogManager.getContext(false)).stop(); \/\/ stop async thread"],"delete":["49","        ((LifeCycle) LogManager.getContext()).stop(); \/\/ stop async thread"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlCompleteFileAppenderTest.java":[{"add":["50","        ((LifeCycle) LogManager.getContext(false)).stop(); \/\/ stop async thread"],"delete":["50","        ((LifeCycle) LogManager.getContext(true)).stop(); \/\/ stop async thread"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlFileAppenderTest.java":[{"add":["50","        ((LifeCycle) LogManager.getContext(false)).stop(); \/\/ stop async thread"],"delete":["50","        ((LifeCycle) LogManager.getContext()).stop(); \/\/ stop async thread"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/XmlRandomAccessFileAppenderTest.java":[{"add":["52","        ((LifeCycle) LogManager.getContext(false)).stop(); \/\/ stop async thread"],"delete":["52","        ((LifeCycle) LogManager.getContext()).stop(); \/\/ stop async thread"]}]}},"95dedcff70687c1782a36cb6177272dddd64cab1":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigDisruptor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/InternalAsyncUtil.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/MutableLogEvent.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":"MODIFY","log4j-core\/src\/test\/resources\/AsyncLoggerConfigTest2.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest3.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigDisruptor.java":[{"add":["186","    private volatile boolean alreadyLoggedWarning = false;","338","        LogEvent logEvent = ensureImmutable(event);","339","        if (logEvent.getMessage() instanceof ReusableMessage) {","340","            if (logEvent instanceof Log4jLogEvent) {","341","                ((Log4jLogEvent) logEvent).makeMessageImmutable();","342","            } else if (logEvent instanceof MutableLogEvent) {","343","                \/\/ MutableLogEvents need to be translated into the RingBuffer by the MUTABLE_TRANSLATOR.","344","                \/\/ That translator calls MutableLogEvent.initFrom to copy the event, which will makeMessageImmutable the message.","345","                if (translator != MUTABLE_TRANSLATOR) { \/\/ should not happen...","346","                    \/\/ TRANSLATOR expects an immutable LogEvent","347","                    logEvent = ((MutableLogEvent) logEvent).createMemento();","348","                }","349","            } else { \/\/ custom log event, with a ReusableMessage","350","                showWarningAboutCustomLogEventWithReusableMessage(logEvent);","351","            }","352","        } else { \/\/ message is not a ReusableMessage; makeMessageImmutable it to prevent ConcurrentModificationExceptions","353","            InternalAsyncUtil.makeMessageImmutable(logEvent.getMessage()); \/\/ LOG4J2-1988, LOG4J2-1914","358","    private void showWarningAboutCustomLogEventWithReusableMessage(final LogEvent logEvent) {","359","        if (!alreadyLoggedWarning) {","360","            LOGGER.warn(\"Custom log event of type {} contains a mutable message of type {}.\" +","361","                            \" AsyncLoggerConfig does not know how to make an immutable copy of this message.\" +","362","                            \" This may result in ConcurrentModificationExceptions or incorrect log messages\" +","363","                            \" if the application modifies objects in the message while\" +","364","                            \" the background thread is writing it to the appenders.\",","365","                    logEvent.getClass().getName(), logEvent.getMessage().getClass().getName());","366","            alreadyLoggedWarning = true;","367","        }","368","    }","369",""],"delete":["337","        final LogEvent logEvent = ensureImmutable(event);","338","        if (logEvent instanceof Log4jLogEvent && logEvent.getMessage() instanceof ReusableMessage) {","339","            ((Log4jLogEvent) logEvent).makeMessageImmutable();"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/InternalAsyncUtil.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/MutableLogEvent.java":[{"add":["27","import org.apache.logging.log4j.core.async.InternalAsyncUtil;","216","            this.message = InternalAsyncUtil.makeMessageImmutable(msg);"],"delete":["28","import org.apache.logging.log4j.message.AsynchronouslyFormattable;","216","            \/\/ if the Message instance is reused, there is no point in freezing its message here","217","            if (msg != null && !canFormatMessageInBackground(msg)) {","218","                msg.getFormattedMessage(); \/\/ LOG4J2-763: ask message to freeze parameters","219","            }","220","            this.message = msg;","224","    private boolean canFormatMessageInBackground(final Message message) {","225","        return Constants.FORMAT_MESSAGES_IN_BACKGROUND \/\/ LOG4J2-898: user wants to format all msgs in background","226","                || message.getClass().isAnnotationPresent(AsynchronouslyFormattable.class); \/\/ LOG4J2-1718","227","    }","228",""]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/RingBufferLogEvent.java":[{"add":["130","            this.message = InternalAsyncUtil.makeMessageImmutable(msg);"],"delete":["30","import org.apache.logging.log4j.message.AsynchronouslyFormattable;","131","            \/\/ if the Message instance is reused, there is no point in freezing its message here","132","            if (msg != null && !canFormatMessageInBackground(msg)) {","133","                msg.getFormattedMessage(); \/\/ LOG4J2-763: ask message to freeze parameters","134","            }","135","            this.message = msg;","139","    private boolean canFormatMessageInBackground(final Message message) {","140","        return Constants.FORMAT_MESSAGES_IN_BACKGROUND \/\/ LOG4J2-898: user wants to format all msgs in background","141","                || message.getClass().isAnnotationPresent(AsynchronouslyFormattable.class); \/\/ LOG4J2-1718","142","    }","143",""]}],"src\/changes\/changes.xml":[{"add":["33","      <action issue=\"LOG4J2-1988\" dev=\"rpopma\" type=\"fix\">","34","        Prevent ConcurrentModificationException with AsyncLoggerConfig.","35","      <\/action>","36","      <action issue=\"LOG4J2-1914\" dev=\"rpopma\" type=\"fix\">","37","        Prevent ConcurrentModificationException with AsyncLoggerConfig.","38","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLogger.java":[{"add":["244","        if (!isReused(message)) {","245","            InternalAsyncUtil.makeMessageImmutable(message);"],"delete":["34","import org.apache.logging.log4j.core.util.Constants;","36","import org.apache.logging.log4j.message.AsynchronouslyFormattable;","246","        if (!canFormatMessageInBackground(message) && !isReused(message)) {","247","            message.getFormattedMessage(); \/\/ LOG4J2-763: ask message to freeze parameters","254","    private boolean canFormatMessageInBackground(final Message message) {","255","        return Constants.FORMAT_MESSAGES_IN_BACKGROUND \/\/ LOG4J2-898: user wants to format all msgs in background","256","                || message.getClass().isAnnotationPresent(AsynchronouslyFormattable.class); \/\/ LOG4J2-1718","257","    }","258",""]}],"log4j-core\/src\/test\/resources\/AsyncLoggerConfigTest2.xml":[{"add":["1","<Configuration status=\"WARN\">","3","    <File name=\"File\"","4","          fileName=\"target\/AsyncLoggerConfigTest2.log\"","5","          bufferedIO=\"false\"","6","          immediateFlush=\"true\"","13",""],"delete":["1","<Configuration status=\"OFF\">","3","    <File name=\"File\" ","4","          fileName=\"target\/AsyncLoggerConfigTest2.log\" ","5","          bufferedIO=\"false\" ","6","          immediateFlush=\"true\" ","13","  "]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/AsyncAppender.java":[{"add":["37","import org.apache.logging.log4j.core.async.InternalAsyncUtil;","157","        InternalAsyncUtil.makeMessageImmutable(logEvent.getMessage());"],"delete":["49","import org.apache.logging.log4j.core.util.Constants;","51","import org.apache.logging.log4j.message.AsynchronouslyFormattable;","52","import org.apache.logging.log4j.message.Message;","158","        if (!canFormatMessageInBackground(logEvent.getMessage())) {","159","            logEvent.getMessage().getFormattedMessage(); \/\/ LOG4J2-763: ask message to freeze parameters","160","        }","174","    private boolean canFormatMessageInBackground(final Message message) {","175","        return Constants.FORMAT_MESSAGES_IN_BACKGROUND \/\/ LOG4J2-898: user wants to format all msgs in background","176","                || message.getClass().isAnnotationPresent(AsynchronouslyFormattable.class); \/\/ LOG4J2-1718","177","    }","178",""]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/async\/AsyncLoggerConfigTest3.java":[{"add":[],"delete":[]}]}},"24a7f432f89dc3bd80792b6af10b3bd32e00b8c4":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-635\" dev=\"rgoers\" type=\"add\">","27","        Add support for configuration via Properties.","28","      <\/action>","29","      <action issue=\"LOG4J2-952\" dev=\"rgoers\" type=\"add\">","30","        Add ConfigurationBuilder.","31","      <\/action>"],"delete":[]}]}},"35f9db7088ee0150d1bbe22b1f69b306fac2849e":{"changes":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtilTest.java":"MODIFY","log4j-api\/src\/test\/resources\/Jira3413Test.properties":"ADD","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertySource.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertySourceTokenizerTest.java":"MODIFY"},"diff":{"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertiesUtilTest.java":[{"add":["122","","123","    private static final String[][] data = {","124","            { null, \"org.apache.logging.log4j.level\" },","125","            { null, \"Log4jAnotherProperty\" },","126","            { null, \"log4j2.catalinaBase\" },","127","            { \"ok\", \"log4j2.configurationFile\" },","128","            { \"ok\", \"log4j2.defaultStatusLevel\" },","129","            { \"ok\", \"log4j2.newLevel\" },","130","            { \"ok\", \"log4j2.asyncLoggerTimeout\" },","131","            { \"ok\", \"log4j2.asyncLoggerConfigRingBufferSize\" },","132","            { \"ok\", \"log4j2.disableThreadContext\" },","133","            { \"ok\", \"log4j2.disableThreadContextStack\" },","134","            { \"ok\", \"log4j2.disableThreadContextMap\" },","135","            { \"ok\", \"log4j2.isThreadContextMapInheritable\" }","136","            };","137","","138","    \/**","139","     * LOG4J2-3413: Log4j should only resolve properties that start with a 'log4j'","140","     * prefix or similar.","141","     *\/","142","    @Test","143","    @ResourceLock(value = Resources.SYSTEM_PROPERTIES, mode = ResourceAccessMode.READ)","144","    public void testResolvesOnlyLog4jProperties() {","145","        final PropertiesUtil util = new PropertiesUtil(\"Jira3413Test.properties\");","146","        for (final String[] pair : data) {","147","            assertEquals(pair[0], util.getStringProperty(pair[1]));","148","        }","149","    }"],"delete":[]}],"log4j-api\/src\/test\/resources\/Jira3413Test.properties":[{"add":[],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/util\/PropertySource.java":[{"add":["20","import java.util.Arrays;","103","        private static final Pattern PREFIX_PATTERN = Pattern.compile(","104","                \/\/ just lookahead for AsyncLogger","105","                \"(^log4j2?[-._\/]?|^org\\\\.apache\\\\.logging\\\\.log4j\\\\.)|(?=AsyncLogger(Config)?\\\\.)\",","106","                Pattern.CASE_INSENSITIVE);","107","        private static final Pattern PROPERTY_TOKENIZER = Pattern.compile(\"([A-Z]*[a-z0-9]+|[A-Z0-9]+)[-._\/]?\");","109","        static {","110","            \/\/ Add legacy properties without Log4j prefix","111","            CACHE.put(\"disableThreadContext\", Arrays.asList(\"disable\", \"thread\", \"context\"));","112","            CACHE.put(\"disableThreadContextStack\", Arrays.asList(\"disable\", \"thread\", \"context\", \"stack\"));","113","            CACHE.put(\"disableThreadContextMap\", Arrays.asList(\"disable\", \"thread\", \"context\", \"map\"));","114","            CACHE.put(\"isThreadContextMapInheritable\", Arrays.asList(\"is\", \"thread\", \"context\", \"map\", \"inheritable\"));","115","        }","131","            int start = 0;","132","            final Matcher prefixMatcher = PREFIX_PATTERN.matcher(value);","133","            if (prefixMatcher.find(start)) {","134","                start = prefixMatcher.end();","135","                final Matcher matcher = PROPERTY_TOKENIZER.matcher(value);","136","                while (matcher.find(start)) {","137","                    tokens.add(matcher.group(1).toLowerCase());","138","                    start = matcher.end();","139","                }"],"delete":["102","        private static final String PREFIXES = \"(?i:^log4j2?[-._\/]?|^org\\\\.apache\\\\.logging\\\\.log4j\\\\.)?\";","103","        private static final Pattern PROPERTY_TOKENIZER = Pattern.compile(PREFIXES + \"([A-Z]*[a-z0-9]+|[A-Z0-9]+)[-._\/]?\");","120","            final Matcher matcher = PROPERTY_TOKENIZER.matcher(value);","121","            while (matcher.find()) {","122","                tokens.add(matcher.group(1).toLowerCase());"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/util\/PropertySourceTokenizerTest.java":[{"add":["46","            \/\/ LOG4J2-3413","47","            {\"level\", Collections.emptyList()},","48","            {\"user.home\", Collections.emptyList()},","49","            {\"CATALINA_BASE\", Collections.emptyList()}"],"delete":[]}]}},"c9a87be8927c72c0f2a18021bffaaef2cd68d536":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/SslSocketManager.java":[{"add":["223","                \/\/ Not sure which options must be applied before or after the connect() call.","227","            if (socketOptions != null) {","228","                \/\/ Not sure which options must be applied before or after the connect() call.","229","                socketOptions.apply(socket);","230","            }"],"delete":[]}]}},"3bb92e0f6fe9abf14d7ce161d916888e47ee8471":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/SimpleLiteralPatternConverter.java":"ADD","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/SimpleLiteralPatternConverterTest.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/AbstractStringLayout.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LineSeparatorPatternConverter.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LiteralPatternConverter.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/LogEventFactory.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MessagePatternConverter.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/PatternLayout.java":[{"add":["37","import org.apache.logging.log4j.core.pattern.FormattingInfo;","225","        final StringBuilder text = toText(eventSerializer, event, getStringBuilder());","316","    private interface PatternSerializer extends Serializer, Serializer2, LocationAware {}","318","    private static final class NoFormatPatternSerializer implements PatternSerializer {","320","        private final LogEventPatternConverter[] converters;","321","","322","        private NoFormatPatternSerializer(final PatternFormatter[] formatters) {","323","            this.converters = new LogEventPatternConverter[formatters.length];","324","            for (int i = 0; i < formatters.length; i++) {","325","                converters[i] = formatters[i].getConverter();","326","            }","341","            for (LogEventPatternConverter converter : converters) {","342","                converter.format(event, buffer);","344","            return buffer;","345","        }","346","","347","        @Override","348","        public boolean requiresLocation() {","349","            for (LogEventPatternConverter converter : converters) {","350","                if (converter instanceof LocationAware && ((LocationAware) converter).requiresLocation()) {","351","                    return true;","352","                }","353","            }","354","            return false;","355","        }","356","","357","        @Override","358","        public String toString() {","359","            return super.toString() + \"[converters=\" + Arrays.toString(converters) + \"]\";","360","        }","361","    }","362","","363","    private static final class PatternFormatterPatternSerializer implements PatternSerializer {","364","","365","        private final PatternFormatter[] formatters;","366","","367","        private PatternFormatterPatternSerializer(final PatternFormatter[] formatters) {","368","            this.formatters = formatters;","369","        }","370","","371","        @Override","372","        public String toSerializable(final LogEvent event) {","373","            final StringBuilder sb = getStringBuilder();","374","            try {","375","                return toSerializable(event, sb).toString();","376","            } finally {","377","                trimToMaxSize(sb);","378","            }","379","        }","380","","381","        @Override","382","        public StringBuilder toSerializable(final LogEvent event, final StringBuilder buffer) {","383","            for (PatternFormatter formatter : formatters) {","384","                formatter.format(event, buffer);","401","            return super.toString() +","402","                    \"[formatters=\" +","403","                    Arrays.toString(formatters) +","404","                    \"]\";","405","        }","406","    }","407","","408","    private static final class PatternSerializerWithReplacement implements Serializer, Serializer2, LocationAware {","409","","410","        private final PatternSerializer delegate;","411","        private final RegexReplacement replace;","412","","413","        private PatternSerializerWithReplacement(final PatternSerializer delegate, final RegexReplacement replace) {","414","            this.delegate = delegate;","415","            this.replace = replace;","416","        }","417","","418","        @Override","419","        public String toSerializable(final LogEvent event) {","420","            final StringBuilder sb = getStringBuilder();","421","            try {","422","                return toSerializable(event, sb).toString();","423","            } finally {","424","                trimToMaxSize(sb);","425","            }","426","        }","427","","428","        @Override","429","        public StringBuilder toSerializable(final LogEvent event, final StringBuilder buf) {","430","            StringBuilder buffer = delegate.toSerializable(event, buf);","431","            String str = buffer.toString();","432","            str = replace.format(str);","433","            buffer.setLength(0);","434","            buffer.append(str);","435","            return buffer;","436","        }","437","","438","        @Override","439","        public boolean requiresLocation() {","440","            return delegate.requiresLocation();","441","        }","442","","443","        @Override","444","        public String toString() {","445","            return super.toString() +","446","                    \"[delegate=\" +","447","                    delegate +","448","                    \", replace=\" +","449","                    replace +","450","                    \"]\";","476","                    boolean hasFormattingInfo = false;","477","                    for (PatternFormatter formatter : formatters) {","478","                        FormattingInfo info = formatter.getFormattingInfo();","479","                        if (info != null && info != FormattingInfo.getDefault()) {","480","                            hasFormattingInfo = true;","481","                            break;","482","                        }","483","                    }","484","                    PatternSerializer serializer = hasFormattingInfo","485","                            ? new PatternFormatterPatternSerializer(formatters)","486","                            : new NoFormatPatternSerializer(formatters);","487","                    return replace == null ? serializer : new PatternSerializerWithReplacement(serializer, replace);","537","    private static final class PatternSelectorSerializer implements Serializer, Serializer2, LocationAware {","559","            for (PatternFormatter formatter : patternSelector.getFormatters(event)) {","560","                formatter.format(event, buffer);"],"delete":["224","        if (!(eventSerializer instanceof Serializer2)) {","225","            super.encode(event, destination);","226","            return;","227","        }","228","        final StringBuilder text = toText((Serializer2) eventSerializer, event, getStringBuilder());","319","    private static class PatternSerializer implements Serializer, Serializer2, LocationAware {","321","        private final PatternFormatter[] formatters;","322","        private final RegexReplacement replace;","324","        private PatternSerializer(final PatternFormatter[] formatters, final RegexReplacement replace) {","325","            this.formatters = formatters;","326","            this.replace = replace;","341","            final int len = formatters.length;","342","            for (int i = 0; i < len; i++) {","343","                formatters[i].format(event, buffer);","345","            if (replace != null) { \/\/ creates temporary objects","346","                String str = buffer.toString();","347","                str = replace.format(str);","348","                buffer.setLength(0);","349","                buffer.append(str);","366","            final StringBuilder builder = new StringBuilder();","367","            builder.append(super.toString());","368","            builder.append(\"[formatters=\");","369","            builder.append(Arrays.toString(formatters));","370","            builder.append(\", replace=\");","371","            builder.append(replace);","372","            builder.append(\"]\");","373","            return builder.toString();","399","                    return new PatternSerializer(formatters, replace);","449","    private static class PatternSelectorSerializer implements Serializer, Serializer2, LocationAware {","471","            final PatternFormatter[] formatters = patternSelector.getFormatters(event);","472","            final int len = formatters.length;","473","            for (int i = 0; i < len; i++) {","474","                formatters[i].format(event, buffer);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LevelPatternConverter.java":[{"add":["34","public class LevelPatternConverter extends LogEventPatternConverter {","41","    private static final LevelPatternConverter INSTANCE = new SimpleLevelPatternConverter();","46","    private LevelPatternConverter() {","96","        return new LevelMapLevelPatternConverter(levelMap);","122","        throw new UnsupportedOperationException(\"Overridden by subclasses\");","136","","137","    private static final class SimpleLevelPatternConverter extends LevelPatternConverter {","138","","139","        \/**","140","         * {@inheritDoc}","141","         *\/","142","        @Override","143","        public void format(final LogEvent event, final StringBuilder output) {","144","            output.append(event.getLevel());","145","        }","146","    }","147","","148","    private static final class LevelMapLevelPatternConverter extends LevelPatternConverter {","149","","150","        private final Map<Level, String> levelMap;","151","","152","        private LevelMapLevelPatternConverter(final Map<Level, String> levelMap) {","153","            this.levelMap = levelMap;","154","        }","155","","156","        \/**","157","         * {@inheritDoc}","158","         *\/","159","        @Override","160","        public void format(final LogEvent event, final StringBuilder output) {","161","            output.append(levelMap.get(event.getLevel()));","162","        }","163","    }"],"delete":["34","public final class LevelPatternConverter extends LogEventPatternConverter {","41","    private static final LevelPatternConverter INSTANCE = new LevelPatternConverter(null);","42","","43","    private final Map<Level, String> levelMap;","48","    private LevelPatternConverter(final Map<Level, String> map) {","50","        this.levelMap = map;","99","        return new LevelPatternConverter(levelMap);","125","        output.append(levelMap == null ? event.getLevel().toString() : levelMap.get(event.getLevel()));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ReusableLogEventFactory.java":[{"add":["40","    private static final ThreadLocal<MutableLogEvent> mutableLogEventThreadLocal = new ThreadLocal<>();","79","        MutableLogEvent result = getOrCreateMutableLogEvent();","81","        \/\/ No need to clear here, values are cleared in release when reserved is set to false.","82","        \/\/ If the event was dirty we'd create a new one.","102","    private static MutableLogEvent getOrCreateMutableLogEvent() {","103","        MutableLogEvent result = mutableLogEventThreadLocal.get();","104","        return result == null || result.reserved ? createInstance(result) : result;","105","    }","106","","107","    private static MutableLogEvent createInstance(MutableLogEvent existing) {","108","        MutableLogEvent result = new MutableLogEvent();","109","","110","        \/\/ usually no need to re-initialize thread-specific fields since the event is stored in a ThreadLocal","111","        result.setThreadId(Thread.currentThread().getId());","112","        result.setThreadName(Thread.currentThread().getName()); \/\/ Thread.getName() allocates Objects on each call","113","        result.setThreadPriority(Thread.currentThread().getPriority());","114","        if (existing == null) {","115","            mutableLogEventThreadLocal.set(result);","116","        }","117","        return result;","118","    }","119",""],"delete":["40","    private static ThreadLocal<MutableLogEvent> mutableLogEventThreadLocal = new ThreadLocal<>();","79","        MutableLogEvent result = mutableLogEventThreadLocal.get();","80","        if (result == null || result.reserved) {","81","            final boolean initThreadLocal = result == null;","82","            result = new MutableLogEvent();","83","","84","            \/\/ usually no need to re-initialize thread-specific fields since the event is stored in a ThreadLocal","85","            result.setThreadId(Thread.currentThread().getId());","86","            result.setThreadName(Thread.currentThread().getName()); \/\/ Thread.getName() allocates Objects on each call","87","            result.setThreadPriority(Thread.currentThread().getPriority());","88","            if (initThreadLocal) {","89","                mutableLogEventThreadLocal.set(result);","90","            }","91","        }","93","        result.clear(); \/\/ ensure any previously cached values (thrownProxy, source, etc.) are cleared"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/SimpleLiteralPatternConverter.java":[{"add":[],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/SimpleLiteralPatternConverterTest.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParser.java":[{"add":["194","                pc = SimpleLiteralPatternConverter.of(Strings.EMPTY);","378","                            patternConverters.add(literalPattern(currentLiteral.toString(), convertBackslashes));","495","            patternConverters.add(literalPattern(currentLiteral.toString(), convertBackslashes));","670","            msg.append(i);","675","            patternConverters.add(literalPattern(currentLiteral.toString(), convertBackslashes));","683","                        .add(literalPattern(currentLiteral.toString(), convertBackslashes));","692","","693","    \/\/ Create a literal pattern converter with support for substitutions if necessary","694","    private LogEventPatternConverter literalPattern(String literal, boolean convertBackslashes) {","695","        if (config != null && LiteralPatternConverter.containsSubstitutionSequence(literal)) {","696","            return new LiteralPatternConverter(config, literal, convertBackslashes);","697","        }","698","        return SimpleLiteralPatternConverter.of(literal, convertBackslashes);","699","    }"],"delete":["194","                pc = new LiteralPatternConverter(config, Strings.EMPTY, true);","378","                            patternConverters.add(new LiteralPatternConverter(config, currentLiteral.toString(),","379","                                    convertBackslashes));","496","            patternConverters.add(new LiteralPatternConverter(config, currentLiteral.toString(), convertBackslashes));","671","            msg.append(Integer.toString(i));","676","            patternConverters.add(new LiteralPatternConverter(config, currentLiteral.toString(), convertBackslashes));","684","                        .add(new LiteralPatternConverter(config, currentLiteral.toString(), convertBackslashes));"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/layout\/AbstractStringLayout.java":[{"add":["90","    public interface Serializer extends Serializer2 {","93","        @Override"],"delete":["90","    public interface Serializer {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LineSeparatorPatternConverter.java":[{"add":["58","    public void format(final LogEvent ignored, final StringBuilder toAppendTo) {","59","        toAppendTo.append(Strings.LINE_SEPARATOR);","60","    }","61","","62","    \/**","63","     * {@inheritDoc}","64","     *\/","65","    @Override","66","    public void format(final Object ignored, final StringBuilder output) {","67","        output.append(Strings.LINE_SEPARATOR);","68","    }","69","","70","    @Override","71","    public boolean isVariable() {","72","        return false;"],"delete":["37","     * Line separator.","38","     *\/","39","    private final String lineSep;","40","","41","    \/**","46","        lineSep = Strings.LINE_SEPARATOR;","64","    public void format(final LogEvent event, final StringBuilder toAppendTo) {","65","        toAppendTo.append(lineSep);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/LoggerConfig.java":[{"add":["383","        final List<Property> props = getProperties(loggerName, fqcn, marker, level, data, t);","384","        final LogEvent logEvent = logEventFactory.createEvent(","385","                loggerName, marker, fqcn, location(fqcn), level, data, props, t);","394","    private StackTraceElement location(String fqcn) {","395","        return requiresLocation() ?","396","                StackLocatorUtil.calcLocation(fqcn) : null;","397","    }","398","","413","        final List<Property> props = getProperties(loggerName, fqcn, marker, level, data, t);","414","        final LogEvent logEvent = logEventFactory.createEvent(loggerName, marker, fqcn, location, level, data, props, t);","415","        try {","416","            log(logEvent, LoggerConfigPredicate.ALL);","417","        } finally {","418","            \/\/ LOG4J2-1583 prevent scrambled logs when logging calls are nested (logging in toString())","419","            ReusableLogEventFactory.release(logEvent);","420","        }","421","    }","422","","423","    private List<Property> getProperties(","424","            final String loggerName,","425","            final String fqcn,","426","            final Marker marker,","427","            final Level level,","428","            final Message data,","429","            final Throwable t) {","430","        List<Property> snapshot = properties;","431","        if (snapshot == null || !propertiesRequireLookup) {","432","            return snapshot;","433","        }","434","        return getPropertiesWithLookups(loggerName, fqcn, marker, level, data, t, snapshot);","435","    }","436","","437","    private List<Property> getPropertiesWithLookups(","438","            final String loggerName,","439","            final String fqcn,","440","            final Marker marker,","441","            final Level level,","442","            final Message data,","443","            final Throwable t,","444","            final List<Property> props) {","445","        List<Property> results = new ArrayList<>(props.size());","446","        final LogEvent event = Log4jLogEvent.newBuilder()","454","        for (int i = 0; i < props.size(); i++) {","455","            final Property prop = props.get(i);","456","            final String value = prop.isValueNeedsLookup() \/\/ since LOG4J2-1575","459","            results.add(Property.createProperty(prop.getName(), value));","461","        return results;"],"delete":["383","        List<Property> props = null;","384","        if (!propertiesRequireLookup) {","385","            props = properties;","386","        } else if (properties != null) {","387","            props = new ArrayList<>(properties.size());","388","            final LogEvent event = Log4jLogEvent.newBuilder()","389","                    .setMessage(data)","390","                    .setMarker(marker)","391","                    .setLevel(level)","392","                    .setLoggerName(loggerName)","393","                    .setLoggerFqcn(fqcn)","394","                    .setThrown(t)","395","                    .build();","396","            for (int i = 0; i < properties.size(); i++) {","397","                final Property prop = properties.get(i);","398","                final String value = prop.isValueNeedsLookup() \/\/ since LOG4J2-1575","399","                        ? config.getStrSubstitutor().replace(event, prop.getValue()) \/\/","400","                        : prop.getValue();","401","                props.add(Property.createProperty(prop.getName(), value));","402","            }","403","        }","404","        final LogEvent logEvent = logEventFactory instanceof LocationAwareLogEventFactory ?","405","            ((LocationAwareLogEventFactory) logEventFactory).createEvent(loggerName, marker, fqcn, requiresLocation() ?","406","                StackLocatorUtil.calcLocation(fqcn) : null, level, data, props, t) :","407","            logEventFactory.createEvent(loggerName, marker, fqcn, level, data, props, t);","430","        List<Property> props = null;","431","        if (!propertiesRequireLookup) {","432","            props = properties;","433","        } else if (properties != null) {","434","            props = new ArrayList<>(properties.size());","435","            final LogEvent event = Log4jLogEvent.newBuilder()","443","            for (int i = 0; i < properties.size(); i++) {","444","                final Property prop = properties.get(i);","445","                final String value = prop.isValueNeedsLookup() \/\/ since LOG4J2-1575","448","                props.add(Property.createProperty(prop.getName(), value));","449","            }","451","        final LogEvent logEvent = logEventFactory instanceof LocationAwareLogEventFactory ?","452","            ((LocationAwareLogEventFactory) logEventFactory).createEvent(loggerName, marker, fqcn, location, level,","453","                data, props, t) : logEventFactory.createEvent(loggerName, marker, fqcn, level, data, props, t);","454","        try {","455","            log(logEvent, LoggerConfigPredicate.ALL);","456","        } finally {","457","            \/\/ LOG4J2-1583 prevent scrambled logs when logging calls are nested (logging in toString())","458","            ReusableLogEventFactory.release(logEvent);","459","        }"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/LiteralPatternConverter.java":[{"add":["51","        substitute = config != null && containsSubstitutionSequence(literal);","52","    }","53","","54","    static boolean containsSubstitutionSequence(final String literal) {","55","        return literal != null && literal.contains(\"${\");"],"delete":["51","        substitute = config != null && literal.contains(\"${\");"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/pattern\/PatternParserTest.java":[{"add":["364","        validateConverter(formatters, 0, \"SimpleLiteral\");"],"delete":["364","        validateConverter(formatters, 0, \"Literal\");"]}],"src\/changes\/changes.xml":[{"add":["99","      <action issue=\"LOG4J2-3171\" dev=\"ckozak\" type=\"add\">","100","        Improve PatternLayout performance by reducing unnecessary indirection and branching.","101","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/LogEventFactory.java":[{"add":["30","public interface LogEventFactory extends LocationAwareLogEventFactory {","34","","35","    @Override","36","    default LogEvent createEvent(","37","            String loggerName,","38","            Marker marker,","39","            String fqcn,","40","            @SuppressWarnings(\"unused\") StackTraceElement location,","41","            Level level,","42","            Message data,","43","            List<Property> properties,","44","            Throwable t) {","45","        return createEvent(loggerName, marker, fqcn, level, data, properties, t);","46","    }"],"delete":["30","public interface LogEventFactory {"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/pattern\/MessagePatternConverter.java":[{"add":["39","public class MessagePatternConverter extends LogEventPatternConverter {","43","    private MessagePatternConverter() {","47","    private static int loadNoLookups(final String[] options) {","59","    private static TextRenderer loadMessageRenderer(final String[] options) {","88","        int noLookupsIdx = loadNoLookups(options);","89","        boolean noLookups = Constants.FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS || noLookupsIdx >= 0;","90","        String[] formats = noLookupsIdx >= 0 ? ArrayUtils.remove(options, noLookupsIdx) : options;","91","        TextRenderer textRenderer = loadMessageRenderer(noLookupsIdx >= 0 ? ArrayUtils.remove(options, noLookupsIdx) : options);","92","        MessagePatternConverter result = formats == null || formats.length == 0","93","                ? SimpleMessagePatternConverter.INSTANCE","94","                : new FormattedMessagePatternConverter(formats);","95","        if (!noLookups && config != null) {","96","            result = new LookupMessagePatternConverter(result, config);","97","        }","98","        if (textRenderer != null) {","99","            result = new RenderingPatternConverter(result, textRenderer);","100","        }","101","        return result;","106","        throw new UnsupportedOperationException();","107","    }","109","    private static final class SimpleMessagePatternConverter extends MessagePatternConverter {","110","        private static final MessagePatternConverter INSTANCE = new SimpleMessagePatternConverter();","112","        \/**","113","         * {@inheritDoc}","114","         *\/","115","        @Override","116","        public void format(final LogEvent event, final StringBuilder toAppendTo) {","117","            Message msg = event.getMessage();","118","            if (msg instanceof StringBuilderFormattable) {","119","                ((StringBuilderFormattable) msg).formatTo(toAppendTo);","120","            } else if (msg != null) {","121","                toAppendTo.append(msg.getFormattedMessage());","123","        }","124","    }","126","    private static final class FormattedMessagePatternConverter extends MessagePatternConverter {","127","","128","        private final String[] formats;","129","","130","        FormattedMessagePatternConverter(final String[] formats) {","131","            this.formats = formats;","132","        }","133","","134","        \/**","135","         * {@inheritDoc}","136","         *\/","137","        @Override","138","        public void format(final LogEvent event, final StringBuilder toAppendTo) {","139","            Message msg = event.getMessage();","140","            if (msg instanceof StringBuilderFormattable) {","141","                if (msg instanceof MultiFormatStringBuilderFormattable) {","142","                    ((MultiFormatStringBuilderFormattable) msg).formatTo(formats, toAppendTo);","143","                } else {","144","                    ((StringBuilderFormattable) msg).formatTo(toAppendTo);","146","            } else if (msg != null) {","147","                toAppendTo.append(msg instanceof MultiformatMessage","148","                        ? ((MultiformatMessage) msg).getFormattedMessage(formats)","149","                        : msg.getFormattedMessage());","153","","154","    private static final class LookupMessagePatternConverter extends MessagePatternConverter {","155","        private final MessagePatternConverter delegate;","156","        private final Configuration config;","157","","158","        LookupMessagePatternConverter(final MessagePatternConverter delegate, final Configuration config) {","159","            this.delegate = delegate;","160","            this.config = config;","161","        }","162","","163","        \/**","164","         * {@inheritDoc}","165","         *\/","166","        @Override","167","        public void format(final LogEvent event, final StringBuilder toAppendTo) {","168","            int start = toAppendTo.length();","169","            delegate.format(event, toAppendTo);","170","            int indexOfSubstitution = toAppendTo.indexOf(\"${\", start);","171","            if (indexOfSubstitution >= 0) {","172","                config.getStrSubstitutor()","173","                        .replaceIn(event, toAppendTo, indexOfSubstitution, toAppendTo.length() - indexOfSubstitution);","174","            }","175","        }","176","    }","177","","178","    private static final class RenderingPatternConverter extends MessagePatternConverter {","179","","180","        private final MessagePatternConverter delegate;","181","        private final TextRenderer textRenderer;","182","","183","        RenderingPatternConverter(final MessagePatternConverter delegate, final TextRenderer textRenderer) {","184","            this.delegate = delegate;","185","            this.textRenderer = textRenderer;","186","        }","187","","188","        \/**","189","         * {@inheritDoc}","190","         *\/","191","        @Override","192","        public void format(final LogEvent event, final StringBuilder toAppendTo) {","193","            StringBuilder workingBuilder = new StringBuilder(80);","194","            delegate.format(event, workingBuilder);","195","            textRenderer.render(workingBuilder, toAppendTo);","196","        }","197","","198","    }"],"delete":["39","public final class MessagePatternConverter extends LogEventPatternConverter {","43","    private final String[] formats;","44","    private final Configuration config;","45","    private final TextRenderer textRenderer;","46","    private final boolean noLookups;","47","","48","    \/**","49","     * Private constructor.","50","     *","51","     * @param options","52","     *            options, may be null.","53","     *\/","54","    private MessagePatternConverter(final Configuration config, final String[] options) {","56","        this.formats = options;","57","        this.config = config;","58","        final int noLookupsIdx = loadNoLookups(options);","59","        this.noLookups = Constants.FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS || noLookupsIdx >= 0;","60","        this.textRenderer = loadMessageRenderer(noLookupsIdx >= 0 ? ArrayUtils.remove(options, noLookupsIdx) : options);","63","    private int loadNoLookups(final String[] options) {","75","    private TextRenderer loadMessageRenderer(final String[] options) {","104","        return new MessagePatternConverter(config, options);","107","    \/**","108","     * {@inheritDoc}","109","     *\/","112","        final Message msg = event.getMessage();","113","        if (msg instanceof StringBuilderFormattable) {","115","            final boolean doRender = textRenderer != null;","116","            final StringBuilder workingBuilder = doRender ? new StringBuilder(80) : toAppendTo;","118","            final int offset = workingBuilder.length();","119","            if (msg instanceof MultiFormatStringBuilderFormattable) {","120","                ((MultiFormatStringBuilderFormattable) msg).formatTo(formats, workingBuilder);","121","            } else {","122","                ((StringBuilderFormattable) msg).formatTo(workingBuilder);","125","            \/\/ TODO can we optimize this?","126","            if (config != null && !noLookups) {","127","                for (int i = offset; i < workingBuilder.length() - 1; i++) {","128","                    if (workingBuilder.charAt(i) == '$' && workingBuilder.charAt(i + 1) == '{') {","129","                        final String value = workingBuilder.substring(offset, workingBuilder.length());","130","                        workingBuilder.setLength(offset);","131","                        workingBuilder.append(config.getStrSubstitutor().replace(event, value));","132","                    }","134","            }","135","            if (doRender) {","136","                textRenderer.render(workingBuilder, toAppendTo);","137","            }","138","            return;","139","        }","140","        if (msg != null) {","141","            String result;","142","            if (msg instanceof MultiformatMessage) {","143","                result = ((MultiformatMessage) msg).getFormattedMessage(formats);","144","            } else {","145","                result = msg.getFormattedMessage();","146","            }","147","            if (result != null) {","148","                toAppendTo.append(config != null && result.contains(\"${\")","149","                        ? config.getStrSubstitutor().replace(event, result) : result);","150","            } else {","151","                toAppendTo.append(\"null\");"]}]}},"d04659cde3f58521cb8c114ab5032b19a4644cc5":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppenderTest.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppenderTest.java":[{"add":["58","","59","    ByteArrayOutputStream baos;","70","        baos = new ByteArrayOutputStream();","73","    private enum SystemSetter {","74","        SYSTEM_OUT {","75","            @Override","76","            void systemSet(final PrintStream printStream) {","77","                System.setOut(printStream);","78","            }","79","        },","80","        SYSTEM_ERR {","81","            @Override","82","            void systemSet(final PrintStream printStream) {","83","                System.setErr(printStream);","84","            }","85","        },","86","        ;","87","        abstract void systemSet(PrintStream printStream);","88","    }","89","","90","    private void testConsoleStreamManagerDoesNotClose(PrintStream ps, String targetName, SystemSetter systemSetter) {","95","            expectLastCall().anyTimes();","98","            systemSetter.systemSet(psMock);","112","            systemSetter.systemSet(ps);","119","        testFollowSystemPrintStream(System.err, Target.SYSTEM_ERR, SystemSetter.SYSTEM_ERR);","124","        testFollowSystemPrintStream(System.out, Target.SYSTEM_OUT, SystemSetter.SYSTEM_OUT);","127","    private void testFollowSystemPrintStream(PrintStream ps, Target target, SystemSetter systemSetter) {","136","            systemSetter.systemSet(new PrintStream(baos));","137","            try {","138","                app.append(event);","139","            } finally {","140","                systemSetter.systemSet(ps);","141","            }","153","        testConsoleStreamManagerDoesNotClose(System.err, \"SYSTEM_ERR\", SystemSetter.SYSTEM_ERR);","158","        testConsoleStreamManagerDoesNotClose(System.out, \"SYSTEM_OUT\", SystemSetter.SYSTEM_OUT);"],"delete":["40","import org.junit.Ignore;","59","    ","60","    private final ByteArrayOutputStream baos = new ByteArrayOutputStream();","73","    private void testConsoleStreamManagerDoesNotClose(PrintStream ps, String targetName) {","80","            System.setOut(psMock);","94","            System.setOut(ps);","100","    @Ignore","102","        testFollowSystemPrintStream(System.err, Target.SYSTEM_ERR);","107","        testFollowSystemPrintStream(System.out, Target.SYSTEM_OUT);","110","    private void testFollowSystemPrintStream(PrintStream ps, Target target) {","119","            System.setOut(new PrintStream(baos));","120","            app.append(event);","121","            System.setOut(ps);","132","    @Ignore","134","        testConsoleStreamManagerDoesNotClose(System.err, \"SYSTEM_ERR\");","139","        testConsoleStreamManagerDoesNotClose(System.out, \"SYSTEM_OUT\");"]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-965\" dev=\"ggregory\" type=\"fix\" due-to=\"Khotyn Huang\">","27","        System.out no longer works after the Console appender and JANSI are initialized.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/ConsoleAppender.java":[{"add":["183","        OutputStream outputStream = null;","186","            outputStream = target == Target.SYSTEM_OUT ?","190","            outputStream = new CloseShieldOutputStream(outputStream);","197","            return outputStream;","203","            return new CloseShieldOutputStream((OutputStream) constructor.newInstance(outputStream));","211","        return outputStream;"],"delete":["183","        PrintStream printStream = null;","185","            \/\/ Cannot use a CloseShieldOutputStream here;","186","            \/\/ see org.apache.logging.log4j.core.appender.ConsoleAppenderTest","188","            printStream = target == Target.SYSTEM_OUT ?","198","            return printStream;","204","            return (OutputStream) constructor.newInstance(printStream);","212","        return printStream;"]}]}},"226f4348f42bf32890377c6a68c9b1151bd0bff0":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/Priority.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-971\" dev=\"ggregory\" type=\"fix\" due-to=\"Paul D Johe\">","42","        Another bad priority in Syslog messages.","43","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/net\/Priority.java":[{"add":["45","        return toPriority(facility, Severity.getSeverity(level));","48","    private static int toPriority(Facility aFacility, Severity aSeverity) {","49","        return (aFacility.getCode() << 3) + aSeverity.getCode();        ","50","    }","51","    ","73","        return toPriority(facility, severity);"],"delete":["45","        return (facility.getCode() << 3) + Severity.getSeverity(level).getCode();","69","        return facility.getCode() << 3 + severity.getCode();"]}]}},"55b8976187a864cc784fd55685b2ece1a2af85cf":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["32","      <action issue=\"LOG4J2-1946\" dev=\"rgoers\" type=\"fix\" due-to=\"Igor Perelyotov\">","33","        Allow file renames to work when files are missing from the sequence.","34","      <\/action>"],"delete":[]}]}},"44df19934520c487e2dd0672e7deda7d22ff8e05":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/JsonWriterTest.java":"MODIFY","log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/JsonWriter.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["71","      <action issue=\"LOG4J2-3092\" dev=\"vy\" type=\"fix\" due-to=\"xmh51\">","72","        Fix JsonWriter memory leaks due to retained excessive buffer growth.","73","      <\/action>"],"delete":[]}],"log4j-layout-template-json\/src\/test\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/JsonWriterTest.java":[{"add":["31","import java.lang.reflect.Field;","80","    void test_close() {","81","        withLockedWriter(writer -> {","82","            writer.writeString(\"x\");","83","            writer.close();","84","            assertStringBuilderReset(writer);","85","        });","86","    }","87","","88","    @Test","89","    void test_close_after_excessive_write() {","90","        withLockedWriter(writer -> {","91","            final String text = Strings.repeat(\"x\", writer.getMaxStringLength());","92","            writer.writeString(text);","93","            writer.writeString(text);","94","            writer.close();","95","            assertStringBuilderReset(writer);","96","        });","97","    }","98","","99","    private static void assertStringBuilderReset(final JsonWriter writer) {","100","        Assertions","101","                .assertThat(writer.getStringBuilder().capacity())","102","                .isEqualTo(writer.getMaxStringLength());","103","        Assertions","104","                .assertThat(writer.getStringBuilder().length())","105","                .isEqualTo(0);","106","    }","107","","108","    @Test","126","    void test_use_null_Runnable() {","127","        Assertions","128","                .assertThatThrownBy(() -> withLockedWriter(writer -> writer.use(null)))","129","                .isInstanceOf(NullPointerException.class)","130","                .hasMessageContaining(\"runnable\");","131","    }","132","","133","    @Test","134","    void test_use_failing_Runnable() {","135","        final RuntimeException exception = new RuntimeException();","136","        withLockedWriter(writer -> {","137","            final int initialLength = writer.getStringBuilder().length();","138","            Assertions","139","                    .assertThatThrownBy(() -> writer.use(() -> {","140","                        writer.writeString(\"extending the buffer\");","141","                        throw exception;","142","                    }))","143","                    .isSameAs(exception);","144","            Assertions.assertThat(writer.getStringBuilder()).hasSize(initialLength);","145","        });","146","    }","147","","148","    @Test","483","            assertFormattableBufferReset(writer);","505","            assertFormattableBufferReset(writer);","537","            assertFormattableBufferReset(writer);","559","            assertFormattableBufferReset(writer);","563","    private static void assertFormattableBufferReset(final JsonWriter writer) {","564","        final StringBuilder formattableBuffer = getFormattableBuffer(writer);","565","        Assertions","566","                .assertThat(formattableBuffer.capacity())","567","                .isEqualTo(writer.getMaxStringLength());","568","        Assertions","569","                .assertThat(formattableBuffer.length())","570","                .isEqualTo(0);","571","    }","572","","573","    private static StringBuilder getFormattableBuffer(final JsonWriter writer) {","574","        try {","575","            final Field field = JsonWriter.class.getDeclaredField(\"formattableBuffer\");","576","            field.setAccessible(true);","577","            return (StringBuilder) field.get(writer);","578","        } catch (Exception error) {","579","            throw new RuntimeException(error);","580","        }","581","    }","582",""],"delete":[]}],"log4j-layout-template-json\/src\/main\/java\/org\/apache\/logging\/log4j\/layout\/template\/json\/util\/JsonWriter.java":[{"add":["44"," *     <li>arrays of primitive types","63","     * <p>","102","        this.stringBuilder = new StringBuilder(builder.maxStringLength);","103","        this.formattableBuffer = new StringBuilder(builder.maxStringLength);","119","    public String use(final Runnable runnable) {","120","        Objects.requireNonNull(runnable, \"runnable\");","122","        try {","123","            runnable.run();","124","            final StringBuilder sliceStringBuilder = new StringBuilder();","125","            sliceStringBuilder.append(stringBuilder, startIndex, stringBuilder.length());","126","            return sliceStringBuilder.toString();","127","        } finally {","128","            trimStringBuilder(stringBuilder, startIndex);","129","        }","501","        try {","502","            emitter.accept(formattableBuffer, state);","514","        } finally {","515","            trimStringBuilder(formattableBuffer, 0);","516","        }","517","    }","518","","519","    public void writeString(final StringBuilderFormattable formattable) {","520","        if (formattable == null) {","521","            writeNull();","522","        } else {","523","            stringBuilder.append('\"');","524","            try {","525","                formattable.formatTo(formattableBuffer);","526","                final int length = formattableBuffer.length();","527","                \/\/ Handle max. string length complying input.","528","                if (length <= maxStringLength) {","529","                    quoteString(formattableBuffer, 0, length);","530","                }","531","                \/\/ Handle max. string length violating input.","532","                else {","533","                    quoteString(formattableBuffer, 0, maxStringLength);","534","                    stringBuilder.append(quotedTruncatedStringSuffix);","535","                }","536","                stringBuilder.append('\"');","537","            } finally {","538","                trimStringBuilder(formattableBuffer, 0);","539","            }","851","        trimStringBuilder(stringBuilder, 0);","852","    }","853","","854","    private void trimStringBuilder(final StringBuilder stringBuilder, final int length) {","855","        final int trimLength = Math.max(maxStringLength, length);","856","        if (stringBuilder.length() > trimLength) {","857","            stringBuilder.setLength(trimLength);","858","            stringBuilder.trimToSize();","859","        }","860","        stringBuilder.setLength(length);"],"delete":["44"," *     <li>arrays of primitve types","63","     *<p>","102","        this.stringBuilder = new StringBuilder();","103","        this.formattableBuffer = new StringBuilder();","119","    public String use(Runnable runnable) {","121","        runnable.run();","122","        final StringBuilder sliceStringBuilder = new StringBuilder();","123","        sliceStringBuilder.append(stringBuilder, startIndex, stringBuilder.length());","124","        stringBuilder.setLength(startIndex);","125","        return sliceStringBuilder.toString();","497","        formattableBuffer.setLength(0);","498","        emitter.accept(formattableBuffer, state);","499","        final int length = formattableBuffer.length();","500","        \/\/ Handle max. string length complying input.","501","        if (length <= maxStringLength) {","502","            quoteString(formattableBuffer, 0, length);","503","        }","504","        \/\/ Handle max. string length violating input.","505","        else {","506","            quoteString(formattableBuffer, 0, maxStringLength);","507","            stringBuilder.append(quotedTruncatedStringSuffix);","508","        }","509","        stringBuilder.append('\"');","510","    }","511","","512","    public void writeString(final StringBuilderFormattable formattable) {","513","        if (formattable == null) {","514","            writeNull();","515","        } else {","516","            stringBuilder.append('\"');","517","            formattableBuffer.setLength(0);","518","            formattable.formatTo(formattableBuffer);","841","        stringBuilder.setLength(0);"]}]}},"9e58cdf5848135d82ad5cdce7341edc98d182318":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-738\" dev=\"ggregory\" type=\"fix\" due-to=\"Timothy Stack\">","25","        RollingFileManager deadlock if async action thread fails to start.","26","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["189","            if (thread == null || !thread.isAlive()) {"],"delete":["189","            if (thread == null) {"]}]}},"25c589574e15d874ad3d2e77ab2ca41068d65e9d":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-957\" dev=\"ggregory\" type=\"fix\" due-to=\"fatih guleryuz\">","27","        Missing toUpperCase(\"Locale.ENGLISH\").","28","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/Level.java":[{"add":["281","        final String levelName = name.toUpperCase(Locale.ENGLISH);"],"delete":["281","        final String levelName = name.toUpperCase();"]}]}},"d6923c91c37237fc2174f781d04913cbe958f88e":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/JndiContextSelector.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/JndiCloser.java":"ADD","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Closer.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/JndiLookup.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/selector\/JndiContextSelector.java":[{"add":["25","","34","import org.apache.logging.log4j.core.util.JndiCloser;","121","            JndiCloser.closeSilently(ctx);"],"delete":["32","import org.apache.logging.log4j.core.util.Closer;","120","            Closer.closeSilently(ctx);"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/JndiCloser.java":[{"add":[],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/util\/Closer.java":[{"add":[],"delete":["27","import javax.naming.Context;","28","import javax.naming.NamingException;","29","","166","    \/**","167","     * Closes the specified {@code Context}, ignoring any exceptions thrown by the close operation.","168","     *","169","     * @param context the JNDI Context to close, may be {@code null}","170","     *\/","171","    public static void closeSilently(final Context context) {","172","        try {","173","            close(context);","174","        } catch (final NamingException ignored) {","175","            \/\/ ignored","176","        }","177","    }","178","","179","    \/**","180","     * Closes the specified {@code Context}.","181","     *","182","     * @param context the JNDI Context to close, may be {@code null}","183","     * @throws NamingException if a problem occurred closing the specified JNDI Context","184","     *\/","185","    public static void close(final Context context) throws NamingException {","186","        if (context != null) {","187","            context.close();","188","        }","189","    }","190",""]}],"src\/changes\/changes.xml":[{"add":["23","    <release version=\"?\" date=\"2014-mm-dd\" description=\"?\">","24","      <action issue=\"LOG4J2-713\" dev=\"rpopma\" type=\"fix\">","25","        Android: java.lang.VerifyError: org\/apache\/logging\/log4j\/core\/util\/Closer","26","      <\/action>","27","    <\/release> "],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/lookup\/JndiLookup.java":[{"add":["24","import org.apache.logging.log4j.core.util.JndiCloser;","64","            JndiCloser.closeSilently(ctx);"],"delete":["24","import org.apache.logging.log4j.core.util.Closer;","64","            Closer.closeSilently(ctx);"]}]}},"947ca3bc19a7adf0d9471852d406d4ffb8e1fe5b":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/TimeBasedTriggeringPolicy.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/PatternProcessor.java":[{"add":["18","import java.text.SimpleDateFormat;","24","import org.apache.logging.log4j.Logger;","33","import org.apache.logging.log4j.status.StatusLogger;","40","    protected static final Logger LOGGER = StatusLogger.getLogger();","106","            return debugGetNextTime(nextTime);","114","            return debugGetNextTime(nextTime);","123","            return debugGetNextTime(nextTime);","131","            return debugGetNextTime(nextTime);","139","            return debugGetNextTime(nextTime);","147","            return debugGetNextTime(nextTime);","155","            return debugGetNextTime(nextTime);","162","        return debugGetNextTime(nextTime);","163","    }","164","","165","    private long debugGetNextTime(long nextTime) {","166","        if (LOGGER.isTraceEnabled()) {","167","            LOGGER.trace(\"PatternProcessor.getNextTime returning {}, nextFileTime={}, prevFileTime={}, freq={}\", \/\/","168","                    format(nextTime), format(nextFileTime), format(prevFileTime), frequency);","169","        }","173","    private String format(long time) {","174","        return new SimpleDateFormat(\"yyyy\/MM\/dd-HH:mm:ss.SSS\").format(new Date(time));","175","    }","176",""],"delete":["102","            return nextTime;","110","            return nextTime;","119","            return nextTime;","127","            return nextTime;","135","            return nextTime;","143","            return nextTime;","151","            return nextTime;"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/DefaultRolloverStrategy.java":[{"add":["181","        ","182","        \/\/ LOG4J2-531: directory scan & rollover must use same format","183","        manager.getPatternProcessor().formatFileName(subst, buf, highIndex);","212","                        LOGGER.debug(\"DefaultRolloverStrategy.purgeAscending deleting {} base of {}.\", \/\/","213","                                toRenameBase, toRename);","228","                    LOGGER.debug(\"DefaultRolloverStrategy.purgeAscending deleting {} at low index {}: all slots full.\", \/\/","229","                            toRename, i);","241","                \/\/ LOG4J2-531: directory scan & rollover must use same format","242","                manager.getPatternProcessor().formatFileName(subst, buf, i - 1);","255","                \/\/ LOG4J2-531: directory scan & rollover must use same format","256","                manager.getPatternProcessor().formatFileName(subst, buf, i - 1);","271","                LOGGER.debug(\"DefaultRolloverStrategy.purgeAscending executing {} of {}: {}\", \/\/","272","                        i, renames.size(), action);","298","","299","        \/\/ LOG4J2-531: directory scan & rollover must use same format","300","        manager.getPatternProcessor().formatFileName(subst, buf, lowIndex);","320","                        LOGGER.debug(\"DefaultRolloverStrategy.purgeDescending deleting {} base of {}.\", \/\/","321","                                toRenameBase, toRename);","336","                    LOGGER.debug(\"DefaultRolloverStrategy.purgeDescending deleting {} at high index {}: all slots full.\", \/\/","337","                            toRename, i);","349","                \/\/ LOG4J2-531: directory scan & rollover must use same format","350","                manager.getPatternProcessor().formatFileName(subst, buf, i + 1);","372","                LOGGER.debug(\"DefaultRolloverStrategy.purgeDescending executing {} of {}: {}\", \/\/","373","                        i, renames.size(), action);"],"delete":["181","        manager.getPatternProcessor().formatFileName(buf, highIndex);","235","                manager.getPatternProcessor().formatFileName(buf, i - 1);","248","                manager.getPatternProcessor().formatFileName(buf, i - 1);","262","","289","        manager.getPatternProcessor().formatFileName(buf, lowIndex);","334","                manager.getPatternProcessor().formatFileName(buf, i + 1);","355",""]}],"src\/changes\/changes.xml":[{"add":["41","      <action issue=\"LOG4J2-531\" dev=\"rpopma\" type=\"fix\" due-to=\"Geoff Ballinger\">","42","        Fixed bugs where rolled log files were overwritten by RollingFile appender with ","43","        composite time and size based policies.","44","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/TimeBasedTriggeringPolicy.java":[{"add":["48","        ","49","        \/\/ LOG4J2-531: call getNextTime twice to force initialization of both prevFileTime and nextFileTime","50","        manager.getPatternProcessor().getNextTime(manager.getFileTime(), interval, modulate);","51","        "],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingFileManager.java":[{"add":["309","                final long time = file.lastModified(); \/\/ LOG4J2-531 create file first so time has valid value"],"delete":["302","            final long time = file.lastModified();"]}]}},"084db0e76dce868ce7731f467bcc696a2a462ad4":{"changes":{"log4j-core\/src\/test\/resources\/KafkaAppenderTest.xml":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/kafka\/KafkaAppenderTest.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/kafka\/KafkaAppender.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/resources\/KafkaAppenderTest.xml":[{"add":["26","  <Kafka name=\"KafkaAppenderWithSerializedLayout\" topic=\"kafka-topic\">\r","27","    <SerializedLayout\/>\r","28","    <Property name=\"bootstrap.servers\">localhost:9092<\/Property>\r","29","  <\/Kafka>\r","35","      <AppenderRef ref=\"KafkaAppenderWithSerializedLayout\"\/>\r"],"delete":[]}],"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-1195\" dev=\"mikes\" type=\"fix\" due-to=\"Melvin Du\">","27","        Make KafkaAppender support SerializedLayout.","28","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/kafka\/KafkaAppenderTest.java":[{"add":["24","import org.apache.logging.log4j.core.LogEvent;\r","33","import java.io.ByteArrayInputStream;\r","34","import java.io.IOException;\r","35","import java.io.ObjectInput;\r","36","import java.io.ObjectInputStream;\r","37","import java.nio.charset.StandardCharsets;\r","38","import java.util.List;\r","39","import java.util.Properties;\r","40","\r","41","import static org.junit.Assert.*;\r","42","\r","103","    @Test\r","104","    public void testAppendWithSerializedLayout() throws Exception {\r","105","        final Appender appender = ctx.getRequiredAppender(\"KafkaAppenderWithSerializedLayout\");\r","106","        LogEvent logEvent = createLogEvent();\r","107","        appender.append(logEvent);\r","108","        final List<ProducerRecord<byte[], byte[]>> history = kafka.history();\r","109","        assertEquals(1, history.size());\r","110","        final ProducerRecord<byte[], byte[]> item = history.get(0);\r","111","        assertNotNull(item);\r","112","        assertEquals(TOPIC_NAME, item.topic());\r","113","        assertNull(item.key());\r","114","        assertEquals(LOG_MESSAGE, deserializeLogEvent(item.value()).getMessage().getFormattedMessage());\r","115","    }\r","116","\r","117","    private LogEvent deserializeLogEvent(byte[] data) throws IOException, ClassNotFoundException {\r","118","        ByteArrayInputStream bis = new ByteArrayInputStream(data);\r","119","        try (ObjectInput ois = new ObjectInputStream(bis)) {\r","120","            return (LogEvent) ois.readObject();\r","121","        }\r","122","    }\r"],"delete":["19","import static org.junit.Assert.assertEquals;\r","20","import static org.junit.Assert.assertNotNull;\r","21","import static org.junit.Assert.assertNull;\r","22","\r","23","import java.nio.charset.StandardCharsets;\r","24","import java.util.List;\r","25","import java.util.Properties;\r","26","\r"]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/appender\/mom\/kafka\/KafkaAppender.java":[{"add":["30","import org.apache.logging.log4j.core.layout.SerializedLayout;\r","33","import java.io.Serializable;\r","34","import java.nio.charset.StandardCharsets;\r","35","\r","71","                Layout<? extends Serializable> layout = getLayout();\r","72","                byte[] data;\r","73","                if (layout != null) {\r","74","                    if (layout instanceof SerializedLayout) {\r","75","                        byte[] header = layout.getHeader();\r","76","                        byte[] body = layout.toByteArray(event);\r","77","                        data = new byte[header.length + body.length];\r","78","                        System.arraycopy(header, 0, data, 0, header.length);\r","79","                        System.arraycopy(body, 0, data, header.length, body.length);\r","80","                    } else {\r","81","                        data = layout.toByteArray(event);\r","82","                    }\r","84","                    data = StringEncoder.toBytes(event.getMessage().getFormattedMessage(), StandardCharsets.UTF_8);\r","86","                manager.send(data);\r"],"delete":["19","import java.io.Serializable;\r","20","import java.nio.charset.StandardCharsets;\r","21","\r","70","                if (getLayout() != null) {\r","71","                    manager.send(getLayout().toByteArray(event));\r","73","                    manager.send(StringEncoder.toBytes(event.getMessage().getFormattedMessage(), StandardCharsets.UTF_8));\r"]}]}},"f7664b6fd2cefd831e56127d7635b61ee70bb7c8":{"changes":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/layout\/Log4j1XmlLayout.java":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-1.2-api\/src\/main\/java\/org\/apache\/log4j\/layout\/Log4j1XmlLayout.java":[{"add":["18","import java.io.PrintWriter;","19","import java.io.StringWriter;","111","\t\tfinal Throwable thrown = event.getThrown();","114","            final StringWriter w = new StringWriter();","115","            thrown.printStackTrace(new PrintWriter(w));","116","            Transform.appendEscapingCData(buf, w.toString());"],"delete":["109","\t\tfinal","110","        Throwable thrown = event.getThrown();","113","            buf.append(thrown.toString());","114","            buf.append(\"\\r\\n\");","115","            for (final StackTraceElement element : thrown.getStackTrace()) {","116","                Transform.appendEscapingCData(buf, \"\\tat \" + element.toString());","117","                buf.append(\"\\r\\n\");","118","            }"]}],"src\/changes\/changes.xml":[{"add":["67","      <action issue=\"LOG4J2-2070\" dev=\"ggregory\" type=\"fix\" due-to=\"Doug Hughes\">","68","        Log4j1XmlLayout does not provide the entire stack trace, it is missing the caused by information.","69","      <\/action>"],"delete":[]}]}},"edbba3e6a7f2ed37afb0674653ace4bb7d5231ae":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ExtendedStackTraceElement.java":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyHelper.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyRendererTest.java":"ADD"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ExtendedStackTraceElement.java":[{"add":["37","    static final ExtendedStackTraceElement[] EMPTY_ARRAY = {};","38",""],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyHelper.java":[{"add":["128","                return ThrowableProxy.EMPTY_ARRAY;"],"delete":["37","    static final ThrowableProxy[] EMPTY_THROWABLE_PROXY_ARRAY = new ThrowableProxy[0];","38","","130","                return EMPTY_THROWABLE_PROXY_ARRAY;"]}],"src\/changes\/changes.xml":[{"add":["216","      <action issue=\"LOG4J2-3131\" dev=\"ggregory\" type=\"fix\" due-to=\"Adam Long, Gary Gregory\">","217","        Attempting to call getExtendedStackTraceAsString() after deserializing JSON LogEvent results in a NPE.","218","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxy.java":[{"add":["51","    static final ThrowableProxy[] EMPTY_ARRAY = {};","52","","79","    ThrowableProxy() {","82","        this.extendedStackTrace = ExtendedStackTraceElement.EMPTY_ARRAY;","86","        this.suppressedProxies = ThrowableProxy.EMPTY_ARRAY;"],"delete":["77","    private ThrowableProxy() {","80","        this.extendedStackTrace = null;","84","        this.suppressedProxies = ThrowableProxyHelper.EMPTY_THROWABLE_PROXY_ARRAY;"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/impl\/ThrowableProxyRendererTest.java":[{"add":[],"delete":[]}]}},"293ef080b1caef8834e265ade8d845b6d810f7e4":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderDirectWriteWithReconfigureTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/appender\/rolling\/RollingAppenderDirectWriteWithReconfigureTest.java":[{"add":["23","import org.junit.Assume;","53","        \/\/ TODO fix this test on Java 8 and Java 9","54","        Assume.assumeTrue(\"Run only on Java 7\", System.getProperty(\"java.specification.version\").equals(\"1.7\"));","55","        "],"delete":[]}]}},"ec10b16ecada9168f2a47f28268df77c413ce603":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["36","      <action issue=\"LOG4J2-2283\" dev=\"ggregory\" type=\"fix\" due-to=\"Vishnu Priya Matha\">","37","        ParserConfigurationException when using Log4j with oracle.xml.jaxp.JXDocumentBuilderFactory.","38","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/xml\/XmlConfiguration.java":[{"add":["201","    private static void disableDtdProcessing(final DocumentBuilderFactory factory) {","209","    private static void setFeature(final DocumentBuilderFactory factory, final String featureName, final boolean value) {"],"delete":["201","    private static void disableDtdProcessing(final DocumentBuilderFactory factory) throws ParserConfigurationException {","209","    private static void setFeature(final DocumentBuilderFactory factory, final String featureName, final boolean value)","210","            throws ParserConfigurationException {","213","        } catch (ParserConfigurationException e) {","214","            throw e;"]}]}},"9555460405abf5276ffc5f39adb4b96e60e62e92":{"changes":{"src\/changes\/changes.xml":"MODIFY","log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["62","      <action issue=\"LOG4J2-959\" dev=\"ggregory\" type=\"update\">","63","        Fix FindBugs DM_DEFAULT_ENCODING bug in SimpleLogger.logMessage() and simplify code.","64","      <\/action>"],"delete":[]}],"log4j-api\/src\/main\/java\/org\/apache\/logging\/log4j\/simple\/SimpleLogger.java":[{"add":["163","        if (t != null) {","164","            stream.print(SPACE);","165","            t.printStackTrace(stream);","166","        }"],"delete":["162","        if (t != null) {","163","            sb.append(SPACE);","164","            final ByteArrayOutputStream baos = new ByteArrayOutputStream();","165","            t.printStackTrace(new PrintStream(baos));","166","            sb.append(baos.toString());","167","        }"]}]}},"a139b97a02662381eaf6d904f98b3db7eb5e5015":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterSerializationTest.java":"ADD","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractSerializationTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterTest.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/KeyValuePairTest.java":"MODIFY","log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/status\/StatusLoggerTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterSerializationTest.java":[{"add":[],"delete":[]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/AbstractSerializationTest.java":[{"add":["21","import org.junit.runner.RunWith;","22","import org.junit.runners.Parameterized;","27","@RunWith(Parameterized.class)","30","    private Serializable serializable;","32","    public AbstractSerializationTest(Serializable serializable) {","33","        super();","34","        this.serializable = serializable;","39","        SerializationTestUtils.roundtripEquals(serializable);","40","    }","41","","42","    @Test","43","    public void testSerializationRoundtripNoException() {","44","        SerializationTestUtils.roundtripNoException(serializable);"],"delete":["27","    \/**","28","     * Creates the {@link Serializable} objects to test.","29","     * ","30","     * @return new serializables.","31","     *\/","32","    protected abstract Serializable[] createSerializationTestFixtures();","34","    @Test","35","    public void testSerializationRoundtripNoException() {","36","        for (Serializable serializable : createSerializationTestFixtures()) {","37","            SerializationTestUtils.roundtripNoException(serializable);","38","        }","43","        Serializable[] serializables = createSerializationTestFixtures();","44","        for (Serializable serializable : serializables) {","45","            SerializationTestUtils.roundtripEquals(serializable);","46","        }"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/filter\/DynamicThresholdFilterTest.java":[{"add":["43","public class DynamicThresholdFilterTest {"],"delete":["23","import java.io.Serializable;","26","import org.apache.logging.log4j.AbstractSerializationTest;","31","import org.apache.logging.log4j.core.Filter.Result;","46","public class DynamicThresholdFilterTest extends AbstractSerializationTest {","47","","48","    protected Serializable[] createSerializationTestFixtures() {","49","        final KeyValuePair[] pairs = new KeyValuePair[] {","50","                new KeyValuePair(\"testuser\", \"DEBUG\"),","51","                new KeyValuePair(\"JohnDoe\", \"warn\") };","52","        return new Serializable[] {","53","                DynamicThresholdFilter.createFilter(\"userid\", new KeyValuePair[0], Level.ERROR, Result.ACCEPT, Result.DENY),","54","                DynamicThresholdFilter.createFilter(\"userid\", new KeyValuePair[0], Level.ERROR, null, null),","55","                DynamicThresholdFilter.createFilter(\"userid\", pairs, Level.ERROR, null, null) };","56","    }"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/KeyValuePairTest.java":[{"add":["3","import java.util.Arrays;","4","import java.util.Collection;","7","import org.junit.runners.Parameterized.Parameters;","11","    @Parameters","12","    public static Collection<Object[]> data() {","13","        return Arrays.asList(new Object[][] {","14","                { new KeyValuePair(\"testuser\", \"DEBUG\") },                ","15","                { new KeyValuePair(\"JohnDoe\", \"warn\") } });","16","    }","17","","18","    public KeyValuePairTest(Serializable serializable) {","19","        super(serializable);"],"delete":["8","    @Override","9","    protected Serializable[] createSerializationTestFixtures() {","10","        return new KeyValuePair[] {","11","                new KeyValuePair(\"testuser\", \"DEBUG\"),","12","                new KeyValuePair(\"JohnDoe\", \"warn\") };"]}],"log4j-api\/src\/test\/java\/org\/apache\/logging\/log4j\/status\/StatusLoggerTest.java":[{"add":["19","import java.util.Arrays;","20","import java.util.Collection;","24","import org.junit.runners.Parameterized.Parameters;","29","    @Parameters","30","    public static Collection<Object[]> data() {","31","        return Arrays.asList(new Object[][] { { StatusLogger.getLogger() } });","33","","34","    public StatusLoggerTest(Serializable serializable) {","35","        super(serializable);","36","    }","37",""],"delete":["26","    @Override","27","    protected Serializable[] createSerializationTestFixtures() {","28","        return new StatusLogger[] { StatusLogger.getLogger() };"]}]}},"d64be675f06b720da425f1c457ba26e9d7d311d9":{"changes":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/ShutdownCallbackRegistryTest.java":"MODIFY"},"diff":{"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/util\/ShutdownCallbackRegistryTest.java":[{"add":["28","import org.junit.AfterClass;","45","        System.setProperty(\"log4j2.is.webapp\", \"false\");","49","    @AfterClass","50","    public static void afterClass() {","51","        System.clearProperty(ShutdownCallbackRegistry.SHUTDOWN_CALLBACK_REGISTRY);","52","        System.clearProperty(\"log4j2.is.webapp\");","53","    }","54",""],"delete":[]}]}},"0480dc32333fe43e55caa0922d544c010a121031":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["24","      <action issue=\"LOG4J2-731\" dev=\"mattsicker\" type=\"fix\">","25","        Updated documentation regarding extensions to LoggerContextFactory and Log4j 2 providers.","26","      <\/action>"],"delete":[]}]}},"eed00545ab0fb167c406469669b4f00534998fd4":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/filter\/BurstFilter.java":[{"add":["196","            return Long.signum(diff);"],"delete":["196","            return Long.compare(diff, 0);"]}]}},"0cbca29e61863c65541730b1d3c85dff71e80a4c":{"changes":{"log4j-core\/src\/test\/resources\/log4j2-properties-trailing-space-on-level.properties":"ADD","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationTrailingSpaceOnLevelTest.java":"ADD"},"diff":{"log4j-core\/src\/test\/resources\/log4j2-properties-trailing-space-on-level.properties":[{"add":[],"delete":[]}],"src\/changes\/changes.xml":[{"add":["48","      <action issue=\"LOG4J2-1948\" dev=\"ggregory\" type=\"fix\" due-to=\"Michael L¨¹ck\">","49","        Trim levels read from properties file to remove trailing spaces.","50","      <\/action>"],"delete":[]}],"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationBuilder.java":[{"add":["243","        final String level = Strings.trimToNull((String) properties.remove(\"level\"));","256","        final String level = Strings.trimToNull((String) properties.remove(\"level\"));","289","        final String level = Strings.trimToNull((String) properties.remove(\"level\"));"],"delete":["243","        final String level = (String) properties.remove(\"level\");","256","        final String level = (String) properties.remove(\"level\");","289","        final String level = (String) properties.remove(\"level\");"]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/config\/properties\/PropertiesConfigurationTrailingSpaceOnLevelTest.java":[{"add":[],"delete":[]}]}},"73a29ed0e7905f472a6b25a3f2b71271e1f04220":{"changes":{"src\/changes\/changes.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["26","      <action issue=\"LOG4J2-819\" dev=\"mattsicker\" type=\"fix\" due-to=\"Gary Gregory\">","27","        Fixed memory leak in Tomcat 6 caused by clock background threads unintentionally","28","        started by Tomcat after web application stop.","29","      <\/action>"],"delete":[]}]}},"417e3049e0466fa3558f04a6c7f4955014619d7d":{"changes":{"log4j-core\/src\/main\/resources\/Log4j-config.xsd":"MODIFY","src\/changes\/changes.xml":"MODIFY"},"diff":{"log4j-core\/src\/main\/resources\/Log4j-config.xsd":[{"add":["115","            <xs:element name=\"AppenderRef\" type=\"AppenderRefType\" minOccurs=\"0\" maxOccurs=\"unbounded\"\/>"],"delete":["115","            <xs:element name=\"AppenderRef\" type=\"AppenderRefType\" maxOccurs=\"unbounded\" minOccurs=\"1\"\/>"]}],"src\/changes\/changes.xml":[{"add":["76","      <action issue=\"LOG4J2-2073\" dev=\"ggregory\" type=\"fix\" due-to=\"Patrick Lucas\">","77","        Log4j-config.xsd should make AppenderRef optional for each Logger element.","78","      <\/action>"],"delete":[]}]}},"94c2de50aa987c66b4385f98c250dea6a707e253":{"changes":{"src\/changes\/changes.xml":"MODIFY","src\/site\/xdoc\/manual\/eventlogging.xml":"MODIFY"},"diff":{"src\/changes\/changes.xml":[{"add":["50","      <action issue=\"LOG4J2-974\" dev=\"ggregory\" type=\"fix\" due-to=\"Daniel Gal¨¢n y Martins\">","51","        Typo in EventLogger documentation.","52","      <\/action>"],"delete":[]}],"src\/site\/xdoc\/manual\/eventlogging.xml":[{"add":["128","        StructuredDataMessage msg = new StructuredDataMessage(confirm, null, \"transfer\");"],"delete":["128","        StructuredDataMessage msg = new StructureDataMessage(confirm, null, \"transfer\");"]}]}},"96aeca3827fbf5c0aa4b64d2b2bf7cd887325fea":{"changes":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":"MODIFY","src\/changes\/changes.xml":"MODIFY","log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/SslConfigurationTest.java":"MODIFY"},"diff":{"log4j-core\/src\/main\/java\/org\/apache\/logging\/log4j\/core\/config\/AbstractConfiguration.java":[{"add":["213","        try {","214","            scriptManager = new ScriptManager(this, watchManager);","215","        } catch (final LinkageError | Exception e) {","216","            \/\/ LOG4J2-1920 ScriptEngineManager is not available in Android","217","            LOGGER.info(\"Cannot initialize scripting support because this JRE does not support it.\", e);","218","        }","522","                        if (scriptManager != null) {","523","                            scriptManager.addScript(script);","524","                        }}"],"delete":["213","        scriptManager = new ScriptManager(this, watchManager);","517","                        scriptManager.addScript(script);","518","                    }"]}],"src\/changes\/changes.xml":[{"add":["63","      <action issue=\"LOG4J2-1920\" dev=\"ggregory\" type=\"fix\" due-to=\"Ajitha\">","64","        ScriptEngineManager is not available in Android and causes a NoClassDefFoundError.","65","      <\/action>"],"delete":[]}],"log4j-core\/src\/test\/java\/org\/apache\/logging\/log4j\/core\/net\/ssl\/SslConfigurationTest.java":[{"add":["33","    public void equals() {","34","        Assert.assertEquals(SslConfiguration.createSSLConfiguration(null, null, null), SslConfiguration.createSSLConfiguration(null, null, null));","35","    }","36","    ","37","    @Test","38","        public void emptyConfigurationDoesntCauseNullSSLSocketFactory() {"],"delete":["33","    public void emptyConfigurationDoesntCauseNullSSLSocketFactory() {"]}]}}}